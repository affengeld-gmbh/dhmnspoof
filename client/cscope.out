cscope 15 $HOME/iscdhcp/dhcp-4.4.1/client               0000313252
	@client_tables.c

28 
	~"dhıd.h
"

30 
univ”£
 
	gş›Á_univ”£
;

31 
İtiÚ
 
	gş›Á_İtiÚs
[] = {

33 { "dummy-ş›Á-·rm", "T", &
ş›Á_univ”£
, 1, 1 },

34 { 
NULL
, NULL, NULL, 0, 0 }

37 
	#CLIENT_HASH_SIZE
 (2*((
ş›Á_İtiÚs
è/ (
İtiÚ
)))

	)

39 
	$š™Ÿlize_ş›Á_İtiÚ_¥aûs
()

41 
i
;

44 
ş›Á_univ”£
.
Çme
 = "client";

45 
ş›Á_univ”£
.
cÚÿt_du¶iÿ‹s
 = 0;

46 
ş›Á_univ”£
.
lookup_func
 = 
lookup_hashed_İtiÚ
;

47 
ş›Á_univ”£
.
İtiÚ_¡©e_d”eã»nû
 =

48 
hashed_İtiÚ_¡©e_d”eã»nû
;

49 
ş›Á_univ”£
.
§ve_func
 = 
§ve_hashed_İtiÚ
;

50 
ş›Á_univ”£
.
d–‘e_func
 = 
d–‘e_hashed_İtiÚ
;

51 
ş›Á_univ”£
.
’ÿpsuÏ‹
 = 
hashed_İtiÚ_¥aû_’ÿpsuÏ‹
;

52 
ş›Á_univ”£
.
fÜ—ch
 = 
hashed_İtiÚ_¥aû_fÜ—ch
;

53 
ş›Á_univ”£
.
Ëngth_size
 = 1;

54 
ş›Á_univ”£
.
g_size
 = 4;

55 
ş›Á_univ”£
.
¡Üe_g
 = 
putUCh¬
;

56 
ş›Á_univ”£
.
¡Üe_Ëngth
 = 
putUCh¬
;

57 
ş›Á_univ”£
.
s™e_code_mš
 = 0;

58 
ş›Á_univ”£
.
’d
 = 0;

59 
ş›Á_univ”£
.
šdex
 = 
univ”£_couÁ
++;

60 
univ”£s
 [
ş›Á_univ”£
.
šdex
] = &client_universe;

61 ià(!
	`İtiÚ_Çme_Ãw_hash
(&
ş›Á_univ”£
.
Çme_hash
,

62 
CLIENT_HASH_SIZE
, 
MDL
) ||

63 !
	`İtiÚ_code_Ãw_hash
(&
ş›Á_univ”£
.
code_hash
,

64 
CLIENT_HASH_SIZE
, 
MDL
))

65 
	`log_çl
 ("Can't‡llocate client option hashable.");

66 
i
 = 0 ; 
ş›Á_İtiÚs
[i].
Çme
 ; i++) {

67 
	`İtiÚ_code_hash_add
(
ş›Á_univ”£
.
code_hash
,

68 &
ş›Á_İtiÚs
[
i
].
code
, 0,

69 &
ş›Á_İtiÚs
[
i
], 
MDL
);

70 
	`İtiÚ_Çme_hash_add
(
ş›Á_univ”£
.
Çme_hash
,

71 
ş›Á_İtiÚs
[
i
].
Çme
, 0,

72 &
ş›Á_İtiÚs
[
i
], 
MDL
);

76 
	`univ”£_hash_add
 (
univ”£_hash
,

77 
ş›Á_univ”£
.
Çme
, 0, &ş›Á_univ”£, 
MDL
);

80 
cÚfig_univ”£
 = &
ş›Á_univ”£
;

81 
	}
}

	@clparse.c

29 
	~"dhıd.h
"

30 
	~<”ºo.h
>

32 
ş›Á_cÚfig
 
	gtİ_Ëv–_cÚfig
;

34 
	#NUM_DEFAULT_REQUESTED_OPTS
 9

	)

36 
İtiÚ
 *
	gdeçuÉ_»que¡ed_İtiÚs
[
NUM_DEFAULT_REQUESTED_OPTS
 + 2 + 1];

38 
·r£_ş›Á_deçuÉ_duid
(
·r£
 *
cfe
);

39 
·r£_ş›Á6_Ëa£_¡©em’t
(
·r£
 *
cfe
);

40 #ifdeà
DHCPv6


41 
dhc6_Ÿ
 *
·r£_ş›Á6_Ÿ_Ç_¡©em’t
(
·r£
 *
cfe
);

42 
dhc6_Ÿ
 *
·r£_ş›Á6_Ÿ__¡©em’t
(
·r£
 *
cfe
);

43 
dhc6_Ÿ
 *
·r£_ş›Á6_Ÿ_pd_¡©em’t
(
·r£
 *
cfe
);

44 
dhc6_addr
 *
·r£_ş›Á6_Ÿaddr_¡©em’t
(
·r£
 *
cfe
);

45 
dhc6_addr
 *
·r£_ş›Á6_Ÿ´efix_¡©em’t
(
·r£
 *
cfe
);

48 
·r£_Ëa£_id_fÜm©
 (
·r£
 *
cfe
);

55 
isc_»suÉ_t
 
	$»ad_ş›Á_cÚf
 ()

57 
ş›Á_cÚfig
 *
cÚfig
;

58 
š‹rçû_šfo
 *

;

59 
isc_»suÉ_t
 
¡©us
;

60 
code
;

67 #ifdeà
LATER


68 
·r£
 *·r£ = 
NULL
;

72 
	`mem£t
(
deçuÉ_»que¡ed_İtiÚs
, 0, (default_requested_options));

75 
code
 = 
DHO_SUBNET_MASK
;

76 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[0],

77 
dhı_univ”£
.
code_hash
, &
code
, 0, 
MDL
);

80 
code
 = 
DHO_BROADCAST_ADDRESS
;

81 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[1],

82 
dhı_univ”£
.
code_hash
, &
code
, 0, 
MDL
);

85 
code
 = 
DHO_TIME_OFFSET
;

86 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[2],

87 
dhı_univ”£
.
code_hash
, &
code
, 0, 
MDL
);

90 
code
 = 
DHO_ROUTERS
;

91 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[3],

92 
dhı_univ”£
.
code_hash
, &
code
, 0, 
MDL
);

95 
code
 = 
DHO_DOMAIN_NAME
;

96 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[4],

97 
dhı_univ”£
.
code_hash
, &
code
, 0, 
MDL
);

100 
code
 = 
DHO_DOMAIN_NAME_SERVERS
;

101 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[5],

102 
dhı_univ”£
.
code_hash
, &
code
, 0, 
MDL
);

105 
code
 = 
DHO_HOST_NAME
;

106 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[6],

107 
dhı_univ”£
.
code_hash
, &
code
, 0, 
MDL
);

110 
code
 = 
D6O_NAME_SERVERS
;

111 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[7],

112 
dhıv6_univ”£
.
code_hash
, &
code
, 0, 
MDL
);

115 
code
 = 
D6O_DOMAIN_SEARCH
;

116 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[8],

117 
dhıv6_univ”£
.
code_hash
, &
code
, 0, 
MDL
);

119 
code
 = 0 ; cod< 
NUM_DEFAULT_REQUESTED_OPTS
 ; code++) {

120 ià(
deçuÉ_»que¡ed_İtiÚs
[
code
] =ğ
NULL
)

121 
	`log_çl
("Unableo find option definition for "

123 "as£mbly.", 
code
);

126 #ifdeà
DHCP4o6


128 ià(
dhıv4_ov”_dhıv6
 == 1) {

130 
code
 = 
D6O_DHCP4_O_DHCP6_SERVER
;

131 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[9],

132 
dhıv6_univ”£
.
code_hash
,

133 &
code
, 0, 
MDL
);

134 ià(
deçuÉ_»que¡ed_İtiÚs
[9] =ğ
NULL
) {

135 
	`log_çl
("Unableo find option definition for "

137 "as£mbly.", 
code
);

139 } ià(
dhıv4_ov”_dhıv6
 > 1) {

142 
code
 = 
D6O_INFORMATION_REFRESH_TIME
;

143 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[9],

144 
dhıv6_univ”£
.
code_hash
,

145 &
code
, 0, 
MDL
);

146 ià(
deçuÉ_»que¡ed_İtiÚs
[9] =ğ
NULL
) {

147 
	`log_çl
("Unableo find option definition for "

149 "as£mbly.", 
code
);

151 
code
 = 
D6O_DHCP4_O_DHCP6_SERVER
;

152 
	`İtiÚ_code_hash_lookup
(&
deçuÉ_»que¡ed_İtiÚs
[10],

153 
dhıv6_univ”£
.
code_hash
,

154 &
code
, 0, 
MDL
);

155 ià(
deçuÉ_»que¡ed_İtiÚs
[10] =ğ
NULL
) {

156 
	`log_çl
("Unableo find option definition for "

158 "as£mbly.", 
code
);

164 
	`mem£t
 (&
tİ_Ëv–_cÚfig
, 0, op_level_config);

167 
tİ_Ëv–_cÚfig
.
timeout
 = 60;

168 
tİ_Ëv–_cÚfig
.
£Ëù_š‹rv®
 = 0;

169 
tİ_Ëv–_cÚfig
.
»boÙ_timeout
 = 10;

170 
tİ_Ëv–_cÚfig
.
»Œy_š‹rv®
 = 300;

171 
tİ_Ëv–_cÚfig
.
backoff_cutoff
 = 15;

172 
tİ_Ëv–_cÚfig
.
š™Ÿl_š‹rv®
 = 3;

173 
tİ_Ëv–_cÚfig
.
Ëa£_id_fÜm©
 = 
TOKEN_OCTAL
;

182 
tİ_Ëv–_cÚfig
.
š™Ÿl_d–ay
 = 0;

184 
tİ_Ëv–_cÚfig
.
boÙp_pŞicy
 = 
P_ACCEPT
;

185 
tİ_Ëv–_cÚfig
.
süt_Çme
 = 
·th_dhş›Á_süt
;

186 
tİ_Ëv–_cÚfig
.
»que¡ed_İtiÚs
 = 
deçuÉ_»que¡ed_İtiÚs
;

187 
tİ_Ëv–_cÚfig
.
om­i_pÜt
 = -1;

188 
tİ_Ëv–_cÚfig
.
do_fÜw¬d_upd©e
 = 1;

191 
tİ_Ëv–_cÚfig
.
»que¡ed_Ëa£
 = 7200;

193 
	`group_®loÿ‹
 (&
tİ_Ëv–_cÚfig
.
Ú_»ût
, 
MDL
);

194 ià(!
tİ_Ëv–_cÚfig
.
Ú_»ût
)

195 
	`log_çl
 ("no memory forop-level on_receipt group");

197 
	`group_®loÿ‹
 (&
tİ_Ëv–_cÚfig
.
Ú_ŒªsmissiÚ
, 
MDL
);

198 ià(!
tİ_Ëv–_cÚfig
.
Ú_ŒªsmissiÚ
)

199 
	`log_çl
 ("no memory forop-level on_transmission group");

201 
¡©us
 = 
	`»ad_ş›Á_cÚf_fe
 (
·th_dhş›Á_cÚf
,

202 (
š‹rçû_šfo
 *)0,

203 &
tİ_Ëv–_cÚfig
);

205 ià(
¡©us
 !ğ
ISC_R_SUCCESS
) {

207 #ifdeà
LATER


209 
¡©us
 = 
	`Ãw_·r£
(&
·r£
, -1, 
deçuÉ_ş›Á_cÚfig
,

210 (
deçuÉ_ş›Á_cÚfig
) - 1,

212 ià(
¡©us
 !ğ
ISC_R_SUCCESS
)

213 
	`log_çl
 ("can't begin default client config!");

216 ià(
·r£
 !ğ
NULL
) {

218 
tok’
 = 
	`³ek_tok’
(&
v®
, 
NULL
, 
cfe
);

219 ià(
tok’
 =ğ
END_OF_FILE
)

221 
	`·r£_ş›Á_¡©em’t
(
cfe
, 
NULL
, &
tİ_Ëv–_cÚfig
);

223 
	`’d_·r£
(&
·r£
);

229 
cÚfig
 = (
ş›Á_cÚfig
 *)0;

230 

 = 
š‹rçûs
; ip; i°ğ -> 
Ãxt
) {

231 ià(!

 -> 
ş›Á
) {

232 

 -> 
ş›Á
 = (
ş›Á_¡©e
 *)

233 
	`dm®loc
 ( (
ş›Á_¡©e
), 
MDL
);

234 ià(!

 -> 
ş›Á
)

235 
	`log_çl
 ("no memory for client state.");

236 
	`mem£t
 (

 -> 
ş›Á
, 0,  *(ip -> client));

237 

 -> 
ş›Á
 -> 
š‹rçû
 = ip;

240 ià(!

 -> 
ş›Á
 -> 
cÚfig
) {

241 ià(!
cÚfig
) {

242 
cÚfig
 = (
ş›Á_cÚfig
 *)

243 
	`dm®loc
 ( (
ş›Á_cÚfig
),

244 
MDL
);

245 ià(!
cÚfig
)

246 
	`log_çl
 ("no memory for client config.");

247 
	`memıy
 (
cÚfig
, &
tİ_Ëv–_cÚfig
,

248  
tİ_Ëv–_cÚfig
);

250 

 -> 
ş›Á
 -> 
cÚfig
 = config;

253  
¡©us
;

254 
	}
}

256 
	$»ad_ş›Á_cÚf_fe
 (cÚ¡ *
Çme
, 
š‹rçû_šfo
 *

,

257 
ş›Á_cÚfig
 *
ş›Á
)

259 
fe
;

260 
·r£
 *
cfe
;

261 cÚ¡ *
v®
;

262 
tok’
;

263 
isc_»suÉ_t
 
¡©us
;

265 ià((
fe
 = 
	`İ’
 (
Çme
, 
O_RDONLY
)) < 0)

266  
	`u”r2isc
 (
”ºo
);

268 
cfe
 = 
NULL
;

269 
¡©us
 = 
	`Ãw_·r£
(&
cfe
, 
fe
, 
NULL
, 0, 
·th_dhş›Á_cÚf
, 0);

270 ià(
¡©us
 !ğ
ISC_R_SUCCESS
 || 
cfe
 =ğ
NULL
)

271  
¡©us
;

274 
tok’
 = 
	`³ek_tok’
 (&
v®
, (*)0, 
cfe
);

275 ià(
tok’
 =ğ
END_OF_FILE
)

277 
	`·r£_ş›Á_¡©em’t
 (
cfe
, 

, 
ş›Á
);

279 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

280 
¡©us
 = (
cfe
 -> 
w¬nšgs_occu¼ed


281 ? 
DHCP_R_BADPARSE


282 : 
ISC_R_SUCCESS
);

283 
	`’d_·r£
 (&
cfe
);

284  
¡©us
;

285 
	}
}

295 
	$»ad_ş›Á_duid
 ()

297 
fe
;

298 
isc_»suÉ_t
 
¡©us
;

299 
·r£
 *
cfe
;

300 cÚ¡ *
v®
;

301 
tok’
;

305 ià((
fe
 = 
	`İ’
 (
·th_dhş›Á_duid
, 
O_RDONLY
)) < 0)

308 
cfe
 = 
NULL
;

309 
¡©us
 = 
	`Ãw_·r£
(&
cfe
, 
fe
, 
NULL
, 0, 
·th_dhş›Á_duid
, 0);

310 ià(
¡©us
 !ğ
ISC_R_SUCCESS
 || 
cfe
 =ğ
NULL
)

313 (
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
)è!ğ
END_OF_FILE
) {

319 ià(
tok’
 =ğ
DEFAULT_DUID
) {

320 
	`·r£_ş›Á_deçuÉ_duid
(
cfe
);

324 
	`’d_·r£
(&
cfe
);

325 
	}
}

331 
	$»ad_ş›Á_Ëa£s
 ()

333 
fe
;

334 
isc_»suÉ_t
 
¡©us
;

335 
·r£
 *
cfe
;

336 cÚ¡ *
v®
;

337 
tok’
;

341 ià((
fe
 = 
	`İ’
 (
·th_dhş›Á_db
, 
O_RDONLY
)) < 0)

344 
cfe
 = 
NULL
;

345 
¡©us
 = 
	`Ãw_·r£
(&
cfe
, 
fe
, 
NULL
, 0, 
·th_dhş›Á_db
, 0);

346 ià(
¡©us
 !ğ
ISC_R_SUCCESS
 || 
cfe
 =ğ
NULL
)

350 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

351 ià(
tok’
 =ğ
END_OF_FILE
)

354 
tok’
) {

355 
DEFAULT_DUID
:

356 
	`·r£_ş›Á_deçuÉ_duid
(
cfe
);

359 
LEASE
:

360 
	`·r£_ş›Á_Ëa£_¡©em’t
(
cfe
, 0);

363 
LEASE6
:

364 
	`·r£_ş›Á6_Ëa£_¡©em’t
(
cfe
);

368 
	`log_”rÜ
 ("Corrupt†ease file -…ossible data†oss!");

369 
	`sk_to_£mi
 (
cfe
);

374 
	`’d_·r£
 (&
cfe
);

375 
	}
}

399 
	$·r£_ş›Á_¡©em’t
 (
cfe
, 

, 
cÚfig
)

400 
·r£
 *
cfe
;

401 
š‹rçû_šfo
 *

;

402 
ş›Á_cÚfig
 *
cÚfig
;

404 
tok’
;

405 cÚ¡ *
v®
;

406 
İtiÚ
 *İtiÚ = 
NULL
;

407 
execubË_¡©em’t
 *
¡mt
;

408 
lo£
;

409 *
Çme
;

410 
pŞicy
…olicy;

411 
known
;

412 
tmp
, 
i
;

413 
isc_»suÉ_t
 
¡©us
;

414 
İtiÚ
 ***
­³nd_li¡
, **
Ãw_li¡
, **
ÿt_li¡
;

416 
	`³ek_tok’
 (&
v®
, (*)0, 
cfe
)) {

417 
INCLUDE
:

418 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

419 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

420 ià(
tok’
 !ğ
STRING
) {

421 
	`·r£_w¬n
 (
cfe
, "filename stringƒxpected.");

422 
	`sk_to_£mi
 (
cfe
);

424 
¡©us
 = 
	`»ad_ş›Á_cÚf_fe
 (
v®
, 

, 
cÚfig
);

425 ià(
¡©us
 !ğ
ISC_R_SUCCESS
)

426 
	`·r£_w¬n
 (
cfe
, "%s: bad…¬£.", 
v®
);

427 
	`·r£_£mi
 (
cfe
);

431 
KEY
:

432 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

433 ià(

) {

446 
	`·r£_w¬n
 (
cfe
, "key definition‚ot‡llowed here.");

447 
	`sk_to_£mi
 (
cfe
);

450 
	`·r£_key
 (
cfe
);

453 
TOKEN_ALSO
:

455 
	`sk_tok’
(&
v®
, 
NULL
, 
cfe
);

458 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

460 ià(
tok’
 =ğ
REQUEST
) {

461 
­³nd_li¡
 = &
cÚfig
->
»que¡ed_İtiÚs
;

462 } ià(
tok’
 =ğ
REQUIRE
) {

463 
­³nd_li¡
 = &
cÚfig
->
»quœed_İtiÚs
;

465 
	`·r£_w¬n
(
cfe
, "expected REQUEST or REQUIRE†ist");

466 
	`sk_to_£mi
(
cfe
);

471 ià(*
­³nd_li¡
 =ğ
NULL
) {

472 
	`·r£_İtiÚ_li¡
(
cfe
, 
­³nd_li¡
);

477 
i
 = 0 ; (*
­³nd_li¡
)[i] !ğ
NULL
 ; i++)

481 ià(
i
 == 0) {

482 
	`·r£_İtiÚ_li¡
(
cfe
, 
­³nd_li¡
);

486 
tmp
 = 
	`·r£_İtiÚ_li¡
(
cfe
, &
Ãw_li¡
);

488 ià(
tmp
 =ğ0 || 
Ãw_li¡
 =ğ
NULL
)

492 
ÿt_li¡
 = 
	`dm®loc
((
İtiÚ
 *è* (
i
 + 
tmp
 + 1),

493 
MDL
);

495 ià(
ÿt_li¡
 =ğ
NULL
) {

496 
	`log_”rÜ
("Unableo‡llocate memory for‚ew "

498 
	`sk_to_£mi
(
cfe
);

502 
i
 = 0 ; (*
­³nd_li¡
)[i] !ğ
NULL
 ; i++)

503 
	`İtiÚ_»ã»nû
(&
ÿt_li¡
[
i
], (*
­³nd_li¡
)[i], 
MDL
);

505 
tmp
 = 
i
;

507 
i
 = 0 ; 
Ãw_li¡
[i] != 0 ; i++)

508 
	`İtiÚ_»ã»nû
(&
ÿt_li¡
[
tmp
++], 
Ãw_li¡
[
i
], 
MDL
);

510 
ÿt_li¡
[
tmp
] = 0;

516 *
­³nd_li¡
 = 
ÿt_li¡
;

522 
REQUIRE
:

523 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

524 
tok’
 = 
	`³ek_tok’
 (&
v®
, (*)0, 
cfe
);

525 ià(
tok’
 =ğ
AUTHENTICATION
) {

526 
pŞicy
 = 
P_REQUIRE
;

527 
do_pŞicy
;

529 
	`·r£_İtiÚ_li¡
 (
cfe
, &
cÚfig
 -> 
»quœed_İtiÚs
);

532 
IGNORE
:

533 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

534 
pŞicy
 = 
P_IGNORE
;

535 
do_pŞicy
;

537 
ACCEPT
:

538 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

539 
pŞicy
 = 
P_ACCEPT
;

540 
do_pŞicy
;

542 
PREFER
:

543 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

544 
pŞicy
 = 
P_PREFER
;

545 
do_pŞicy
;

547 
DONT
:

548 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

549 
pŞicy
 = 
P_DONT
;

550 
do_pŞicy
;

552 
do_pŞicy
:

553 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

554 ià(
tok’
 =ğ
AUTHENTICATION
) {

555 ià(
pŞicy
 !ğ
P_PREFER
 &&

556 
pŞicy
 !ğ
P_REQUIRE
 &&

557 
pŞicy
 !ğ
P_DONT
) {

558 
	`·r£_w¬n
 (
cfe
,

560 
	`sk_to_£mi
 (
cfe
);

563 
cÚfig
 -> 
auth_pŞicy
 = 
pŞicy
;

564 } ià(
tok’
 !ğ
TOKEN_BOOTP
) {

565 ià(
pŞicy
 !ğ
P_PREFER
 &&

566 
pŞicy
 !ğ
P_IGNORE
 &&

567 
pŞicy
 !ğ
P_ACCEPT
) {

568 
	`·r£_w¬n
 (
cfe
, "invalid bootp…olicy.");

569 
	`sk_to_£mi
 (
cfe
);

572 
cÚfig
 -> 
boÙp_pŞicy
 = 
pŞicy
;

574 
	`·r£_w¬n
 (
cfe
, "expecting‡…olicyype.");

575 
	`sk_to_£mi
 (
cfe
);

580 
OPTION
:

581 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

582 
tok’
 = 
	`³ek_tok’
 (&
v®
, (*)0, 
cfe
);

583 ià(
tok’
 =ğ
SPACE
) {

584 ià(

) {

585 
	`·r£_w¬n
 (
cfe
,

588 
	`sk_to_£mi
 (
cfe
);

591 
	`·r£_İtiÚ_¥aû_deş
 (
cfe
);

595 
known
 = 0;

596 
¡©us
 = 
	`·r£_İtiÚ_Çme
(
cfe
, 1, &
known
, &
İtiÚ
);

597 ià(
¡©us
 !ğ
ISC_R_SUCCESS
 || 
İtiÚ
 =ğ
NULL
)

600 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

601 ià(
tok’
 !ğ
CODE
) {

602 
	`·r£_w¬n
 (
cfe
, "expecting \"code\" keyword.");

603 
	`sk_to_£mi
 (
cfe
);

604 
	`İtiÚ_d”eã»nû
(&
İtiÚ
, 
MDL
);

607 ià(

) {

608 
	`·r£_w¬n
 (
cfe
,

611 
	`sk_to_£mi
 (
cfe
);

612 
	`İtiÚ_d”eã»nû
(&
İtiÚ
, 
MDL
);

620 ià(
known
) {

621 
	`İtiÚ_Çme_hash_d–‘e
(
İtiÚ
->
univ”£
->
Çme_hash
,

622 
İtiÚ
->
Çme
, 0, 
MDL
);

623 
	`İtiÚ_code_hash_d–‘e
(
İtiÚ
->
univ”£
->
code_hash
,

624 &
İtiÚ
->
code
, 0, 
MDL
);

627 
	`·r£_İtiÚ_code_defš™iÚ
(
cfe
, 
İtiÚ
);

628 
	`İtiÚ_d”eã»nû
(&
İtiÚ
, 
MDL
);

631 
MEDIA
:

632 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

633 
	`·r£_¡ršg_li¡
 (
cfe
, &
cÚfig
 -> 
medŸ
, 1);

636 
HARDWARE
:

637 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

638 ià(

) {

639 
	`·r£_h¬dw¬e_·¿m
 (
cfe
, &

 -> 
hw_add»ss
);

641 
	`·r£_w¬n
 (
cfe
, "hardware‡ddress…arameter %s",

643 
	`sk_to_£mi
 (
cfe
);

647 
ANYCAST_MAC
:

648 
	`sk_tok’
(&
v®
, 
NULL
, 
cfe
);

649 ià(

 !ğ
NULL
) {

650 
	`·r£_h¬dw¬e_·¿m
(
cfe
, &

->
ªyÿ¡_mac_addr
);

652 
	`·r£_w¬n
(
cfe
, "anycast mac‡ddress…arameter "

654 
	`sk_to_£mi
 (
cfe
);

658 
REQUEST
:

659 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

660 ià(
cÚfig
 -> 
»que¡ed_İtiÚs
 =ğ
deçuÉ_»que¡ed_İtiÚs
)

661 
cÚfig
 -> 
»que¡ed_İtiÚs
 = 
NULL
;

662 
	`·r£_İtiÚ_li¡
 (
cfe
, &
cÚfig
 -> 
»que¡ed_İtiÚs
);

665 
TIMEOUT
:

666 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

667 
	`·r£_Ëa£_time
 (
cfe
, &
cÚfig
 -> 
timeout
);

670 
RETRY
:

671 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

672 
	`·r£_Ëa£_time
 (
cfe
, &
cÚfig
 -> 
»Œy_š‹rv®
);

675 
SELECT_TIMEOUT
:

676 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

677 
	`·r£_Ëa£_time
 (
cfe
, &
cÚfig
 -> 
£Ëù_š‹rv®
);

680 
OMAPI
:

681 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

682 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

683 ià(
tok’
 !ğ
PORT
) {

684 
	`·r£_w¬n
 (
cfe
,

685 "uÃx³ùed om­˜subty³: %s", 
v®
);

686 
	`sk_to_£mi
 (
cfe
);

689 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

690 ià(
tok’
 !ğ
NUMBER
) {

691 
	`·r£_w¬n
 (
cfe
, "šv®id…Üˆnumb”: `%s'", 
v®
);

692 
	`sk_to_£mi
 (
cfe
);

695 
tmp
 = 
	`©oi
 (
v®
);

696 ià(
tmp
 < 0 ||mp > 65535)

697 
	`·r£_w¬n
 (
cfe
, "šv®id om­˜pÜˆ%d.", 
tmp
);

698 ià(
cÚfig
 !ğ&
tİ_Ëv–_cÚfig
)

699 
	`·r£_w¬n
 (
cfe
,

702 
cÚfig
 -> 
om­i_pÜt
 = 
tmp
;

703 
	`·r£_£mi
 (
cfe
);

706 
DO_FORWARD_UPDATE
:

707 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

708 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

709 ià(!
	`¡rÿ£cmp
 (
v®
, "on") ||

710 !
	`¡rÿ£cmp
 (
v®
, "true"))

711 
cÚfig
 -> 
do_fÜw¬d_upd©e
 = 1;

712 ià(!
	`¡rÿ£cmp
 (
v®
, "off") ||

713 !
	`¡rÿ£cmp
 (
v®
, "false"))

714 
cÚfig
 -> 
do_fÜw¬d_upd©e
 = 0;

716 
	`·r£_w¬n
 (
cfe
, "expecting boolean value.");

717 
	`sk_to_£mi
 (
cfe
);

720 
	`·r£_£mi
 (
cfe
);

723 
REBOOT
:

724 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

725 
	`·r£_Ëa£_time
 (
cfe
, &
cÚfig
 -> 
»boÙ_timeout
);

728 
BACKOFF_CUTOFF
:

729 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

730 
	`·r£_Ëa£_time
 (
cfe
, &
cÚfig
 -> 
backoff_cutoff
);

733 
INITIAL_INTERVAL
:

734 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

735 
	`·r£_Ëa£_time
 (
cfe
, &
cÚfig
 -> 
š™Ÿl_š‹rv®
);

738 
INITIAL_DELAY
:

739 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

740 
	`·r£_Ëa£_time
 (
cfe
, &
cÚfig
 -> 
š™Ÿl_d–ay
);

743 
SCRIPT
:

744 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

745 
	`·r£_¡ršg
 (
cfe
, &
cÚfig
 -> 
süt_Çme
, (*)0);

748 
VENDOR
:

749 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

750 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

751 ià(
tok’
 !ğ
OPTION
) {

752 
	`·r£_w¬n
 (
cfe
, "expecting 'vendor option space'");

753 
	`sk_to_£mi
 (
cfe
);

756 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

757 ià(
tok’
 !ğ
SPACE
) {

758 
	`·r£_w¬n
 (
cfe
, "expecting 'vendor option space'");

759 
	`sk_to_£mi
 (
cfe
);

762 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

763 ià(!
	`is_id’tif›r
 (
tok’
)) {

764 
	`·r£_w¬n
 (
cfe
, "expecting‡n identifier.");

765 
	`sk_to_£mi
 (
cfe
);

768 
cÚfig
 -> 
v’dÜ_¥aû_Çme
 = 
	`dm®loc
 (
	`¡¾’
 (
v®
è+ 1, 
MDL
);

769 ià(!
cÚfig
 -> 
v’dÜ_¥aû_Çme
)

770 
	`log_çl
 ("no memory for vendor option space‚ame.");

771 
	`¡rıy
 (
cÚfig
 -> 
v’dÜ_¥aû_Çme
, 
v®
);

772 
i
 = 0; i < 
univ”£_couÁ
; i++)

773 ià(!
	`¡rcmp
 (
univ”£s
 [
i
] -> 
Çme
,

774 
cÚfig
 -> 
v’dÜ_¥aû_Çme
))

776 ià(
i
 =ğ
univ”£_couÁ
) {

777 
	`log_”rÜ
 ("vendor option space %s‚ot found.",

778 
cÚfig
 -> 
v’dÜ_¥aû_Çme
);

780 
	`·r£_£mi
 (
cfe
);

783 
INTERFACE
:

784 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

785 ià(

)

786 
	`·r£_w¬n
 (
cfe
, "nested interface declaration.");

787 
	`·r£_š‹rçû_deş¬©iÚ
 (
cfe
, 
cÚfig
, (*)0);

790 
PSEUDO
:

791 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

792 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

793 
Çme
 = 
	`dm®loc
 (
	`¡¾’
 (
v®
è+ 1, 
MDL
);

794 ià(!
Çme
)

795 
	`log_çl
 ("no memory for…seudo interface‚ame");

796 
	`¡rıy
 (
Çme
, 
v®
);

797 
	`·r£_š‹rçû_deş¬©iÚ
 (
cfe
, 
cÚfig
, 
Çme
);

800 
LEASE
:

801 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

802 
	`·r£_ş›Á_Ëa£_¡©em’t
 (
cfe
, 1);

805 
ALIAS
:

806 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

807 
	`·r£_ş›Á_Ëa£_¡©em’t
 (
cfe
, 2);

810 
REJECT
:

811 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

812 
	`·r£_»jeù_¡©em’t
 (
cfe
, 
cÚfig
);

815 
LEASE_ID_FORMAT
:

816 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

817 
	`·r£_Ëa£_id_fÜm©
(
cfe
);

822 
lo£
 = 0;

823 
¡mt
 = (
execubË_¡©em’t
 *)0;

824 ià(!
	`·r£_execubË_¡©em’t
 (&
¡mt
,

825 
cfe
, &
lo£
, 
cÚ‹xt_ªy
)) {

826 ià(!
lo£
) {

827 
	`·r£_w¬n
 (
cfe
, "expecting‡ statement.");

828 
	`sk_to_£mi
 (
cfe
);

831 
execubË_¡©em’t
 **
•Œ
, *
¥Œ
;

832 ià(
¡mt
 &&

833 (
¡mt
 -> 
İ
 =ğ
£nd_İtiÚ_¡©em’t
 ||

834 (
¡mt
 -> 
İ
 =ğ
Ú_¡©em’t
 &&

835 (
¡mt
 -> 
d©a
.
Ú
.
evty³s
 & 
ON_TRANSMISSION
)))) {

836 
•Œ
 = &
cÚfig
 -> 
Ú_ŒªsmissiÚ
 -> 
¡©em’ts
;

837 ià(
¡mt
 -> 
İ
 =ğ
Ú_¡©em’t
) {

838 
¥Œ
 = (
execubË_¡©em’t
 *)0;

839 
execubË_¡©em’t_»ã»nû


840 (&
¥Œ
,

841 
¡mt
 -> 
d©a
.
Ú
.
¡©em’ts
, 
MDL
);

842 
	`execubË_¡©em’t_d”eã»nû
 (&
¡mt
,

843 
MDL
);

844 
	`execubË_¡©em’t_»ã»nû
 (&
¡mt
,

845 
¥Œ
,

846 
MDL
);

847 
	`execubË_¡©em’t_d”eã»nû
 (&
¥Œ
,

848 
MDL
);

851 
•Œ
 = &
cÚfig
 -> 
Ú_»ût
 -> 
¡©em’ts
;

853 ià(
¡mt
) {

854 ; *
•Œ
;ƒ±¸ğ&(*•Œè-> 
Ãxt
)

856 
	`execubË_¡©em’t_»ã»nû
 (
•Œ
,

857 
¡mt
, 
MDL
);

863 
	`·r£_£mi
 (
cfe
);

864 
	}
}

870 
	$·r£_İtiÚ_li¡
(
·r£
 *
cfe
, 
İtiÚ
 ***
li¡
)

872 
ix
;

873 
tok’
;

874 cÚ¡ *
v®
;

875 
·œ
 
p
 = (·œ)0, 
q
 = (·œ)0, 
r
;

876 
İtiÚ
 *İtiÚ = 
NULL
;

877 
isc_»suÉ_t
 
¡©us
;

879 
ix
 = 0;

881 
tok’
 = 
	`³ek_tok’
 (&
v®
, (*)0, 
cfe
);

882 ià(
tok’
 =ğ
SEMI
) {

883 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

886 ià(!
	`is_id’tif›r
 (
tok’
)) {

887 
	`·r£_w¬n
 (
cfe
, "%s:ƒx³ùed o±iÚ‚ame.", 
v®
);

888 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

889 
	`sk_to_£mi
 (
cfe
);

892 
¡©us
 = 
	`·r£_İtiÚ_Çme
(
cfe
, 0, 
NULL
, &
İtiÚ
);

893 ià(
¡©us
 !ğ
ISC_R_SUCCESS
 || 
İtiÚ
 =ğ
NULL
) {

894 
	`·r£_w¬n
 (
cfe
, "%s:ƒx³ùed o±iÚ‚ame.", 
v®
);

897 
r
 = 
	`Ãw_·œ
 (
MDL
);

898 ià(!
r
)

899 
	`log_çl
 ("can't‡llocate…air for option code.");

901 
r
->
ÿr
 = (
ÿddr_t
)
İtiÚ
;

902 
	`İtiÚ_d”eã»nû
(&
İtiÚ
, 
MDL
);

903 
r
 -> 
cdr
 = (
·œ
)0;

904 ià(
p
)

905 
q
 -> 
cdr
 = 
r
;

907 
p
 = 
r
;

908 
q
 = 
r
;

909 ++
ix
;

910 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

911 } 
tok’
 =ğ
COMMA
);

912 ià(
tok’
 !ğ
SEMI
) {

913 
	`·r£_w¬n
 (
cfe
, "expecting semicolon.");

914 
	`sk_to_£mi
 (
cfe
);

919 *
li¡
 = 
NULL
;

920 ià(
ix
) {

921 *
li¡
 = 
	`dm®loc
 ((
ix
 + 1è* (
İtiÚ
 *), 
MDL
);

922 ià(!*
li¡
)

923 
	`log_”rÜ
 ("no memory for option†ist.");

925 
ix
 = 0;

926 
q
 = 
p
; q; q = q -> 
cdr
)

927 
	`İtiÚ_»ã»nû
(&(*
li¡
)[
ix
++],

928 (
İtiÚ
 *)
q
->
ÿr
, 
MDL
);

929 (*
li¡
)[
ix
] = 
NULL
;

931 
p
) {

932 
q
 = 
p
 -> 
cdr
;

933 
	`ä“_·œ
 (
p
, 
MDL
);

934 
p
 = 
q
;

938  
ix
;

939 
	}
}

944 
	$·r£_š‹rçû_deş¬©iÚ
 (
cfe
, 
ou‹r_cÚfig
, 
Çme
)

945 
·r£
 *
cfe
;

946 
ş›Á_cÚfig
 *
ou‹r_cÚfig
;

947 *
Çme
;

949 
tok’
;

950 cÚ¡ *
v®
;

951 
ş›Á_¡©e
 *
ş›Á
, **
ı
;

952 
š‹rçû_šfo
 *

 = (interface_info *)0;

954 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

955 ià(
tok’
 !ğ
STRING
) {

956 
	`·r£_w¬n
 (
cfe
, "expecting interface‚ame (in quotes).");

957 
	`sk_to_£mi
 (
cfe
);

961 ià(!
	`š‹rçû_Ü_dummy
 (&

, 
v®
))

962 
	`log_çl
 ("Cª'ˆ®loÿ‹ iÁ”çû %s.", 
v®
);

965 ià(
Çme
) {

966 
	`make_ş›Á_¡©e
 (&
ş›Á
);

967 
ş›Á
 -> 
Çme
 =‚ame;

968 
ş›Á
 -> 
š‹rçû
 = 

;

969 
ı
 = &

 -> 
ş›Á
; *ı; c°ğ&((*ıè-> 
Ãxt
))

971 *
ı
 = 
ş›Á
;

973 ià(!

 -> 
ş›Á
) {

974 
	`make_ş›Á_¡©e
 (&

 -> 
ş›Á
);

975 

 -> 
ş›Á
 -> 
š‹rçû
 = ip;

977 
ş›Á
 = 

 -> client;

980 ià(!
ş›Á
 -> 
cÚfig
)

981 
	`make_ş›Á_cÚfig
 (
ş›Á
, 
ou‹r_cÚfig
);

983 

 -> 
æags
 &ğ~
INTERFACE_AUTOMATIC
;

984 
š‹rçûs_»que¡ed
 = 1;

986 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

987 ià(
tok’
 !ğ
LBRACE
) {

988 
	`·r£_w¬n
 (
cfe
, "expecting†eft brace.");

989 
	`sk_to_£mi
 (
cfe
);

994 
tok’
 = 
	`³ek_tok’
 (&
v®
, (*)0, 
cfe
);

995 ià(
tok’
 =ğ
END_OF_FILE
) {

996 
	`·r£_w¬n
 (
cfe
,

1000 ià(
tok’
 =ğ
RBRACE
)

1002 
	`·r£_ş›Á_¡©em’t
 (
cfe
, 

, 
ş›Á
 -> 
cÚfig
);

1004 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

1005 
	}
}

1007 
	$š‹rçû_Ü_dummy
 (
š‹rçû_šfo
 **
pi
, cÚ¡ *
Çme
)

1009 
š‹rçû_šfo
 *
i
;

1010 
š‹rçû_šfo
 *

 = (interface_info *)0;

1011 
isc_»suÉ_t
 
¡©us
;

1014 
i
 = 
š‹rçûs
; i; i = i -> 
Ãxt
) {

1015 ià(!
	`¡rcmp
 (
i
 -> 
Çme
,‚ame)) {

1016 
	`š‹rçû_»ã»nû
 (&

, 
i
, 
MDL
);

1022 ià(!

) {

1023 

 = 
dummy_š‹rçûs
; ip; i°ğ -> 
Ãxt
) {

1024 ià(!
	`¡rcmp
 (

 -> 
Çme
,‚ame)) {

1025 
	`š‹rçû_»ã»nû
 (&

, 
i
, 
MDL
);

1033 ià(!

) {

1034 ià((
¡©us
 = 
	`š‹rçû_®loÿ‹
 (&

, 
MDL
)è!ğ
ISC_R_SUCCESS
)

1035 
	`log_çl
 ("Can't„ecord interface %s: %s",

1036 
Çme
, 
	`isc_»suÉ_tÙext
 (
¡©us
));

1038 ià(
	`¡¾’
(
Çme
è>ğ(

->name)) {

1039 
	`š‹rçû_d”eã»nû
(&

, 
MDL
);

1042 
	`¡rıy
(

->
Çme
,‚ame);

1044 ià(
dummy_š‹rçûs
) {

1045 
	`š‹rçû_»ã»nû
 (&

 -> 
Ãxt
,

1046 
dummy_š‹rçûs
, 
MDL
);

1047 
	`š‹rçû_d”eã»nû
 (&
dummy_š‹rçûs
, 
MDL
);

1049 
	`š‹rçû_»ã»nû
 (&
dummy_š‹rçûs
, 

, 
MDL
);

1051 ià(
pi
)

1052 
¡©us
 = 
	`š‹rçû_»ã»nû
 (
pi
, 

, 
MDL
);

1054 
¡©us
 = 
ISC_R_FAILURE
;

1055 
	`š‹rçû_d”eã»nû
 (&

, 
MDL
);

1056 ià(
¡©us
 !ğ
ISC_R_SUCCESS
)

1059 
	}
}

1061 
	$make_ş›Á_¡©e
 (
¡©e
)

1062 
ş›Á_¡©e
 **
¡©e
;

1064 *
¡©e
 = ((
ş›Á_¡©e
 *)
	`dm®loc
 ( **¡©e, 
MDL
));

1065 ià(!*
¡©e
)

1066 
	`log_çl
 ("no memory for client state\n");

1067 
	`mem£t
 (*
¡©e
, 0,  **state);

1068 
	}
}

1070 
	$make_ş›Á_cÚfig
 (
ş›Á
, 
cÚfig
)

1071 
ş›Á_¡©e
 *
ş›Á
;

1072 
ş›Á_cÚfig
 *
cÚfig
;

1074 
ş›Á
 -> 
cÚfig
 = (((
ş›Á_cÚfig
 *)

1075 
	`dm®loc
 ( (
ş›Á_cÚfig
), 
MDL
)));

1076 ià(!
ş›Á
 -> 
cÚfig
)

1077 
	`log_çl
 ("no memory for client config\n");

1078 
	`memıy
 (
ş›Á
 -> 
cÚfig
, config,  *config);

1079 ià(!
	`şÚe_group
 (&
ş›Á
 -> 
cÚfig
 -> 
Ú_»ût
,

1080 
cÚfig
 -> 
Ú_»ût
, 
MDL
) ||

1081 !
	`şÚe_group
 (&
ş›Á
 -> 
cÚfig
 -> 
Ú_ŒªsmissiÚ
,

1082 
cÚfig
 -> 
Ú_ŒªsmissiÚ
, 
MDL
))

1083 
	`log_çl
 ("no memory for client state groups.");

1084 
	}
}

1095 
	$·r£_ş›Á_Ëa£_¡©em’t
 (
cfe
, 
is_¡©ic
)

1096 
·r£
 *
cfe
;

1097 
is_¡©ic
;

1099 
ş›Á_Ëa£
 *
Ëa£
, *
Í
, *
¶
, *
Ãxt
;

1100 
š‹rçû_šfo
 *

 = (interface_info *)0;

1101 
tok’
;

1102 cÚ¡ *
v®
;

1103 
ş›Á_¡©e
 *
ş›Á
 = (client_state *)0;

1105 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

1106 ià(
tok’
 !ğ
LBRACE
) {

1107 
	`·r£_w¬n
 (
cfe
, "expecting†eft brace.");

1108 
	`sk_to_£mi
 (
cfe
);

1112 
Ëa£
 = ((
ş›Á_Ëa£
 *)

1113 
	`dm®loc
 ( (
ş›Á_Ëa£
), 
MDL
));

1114 ià(!
Ëa£
)

1115 
	`log_çl
 ("no memory for†ease.\n");

1116 
	`mem£t
 (
Ëa£
, 0,  *lease);

1117 
Ëa£
 -> 
is_¡©ic
 = is_static;

1118 ià(!
	`İtiÚ_¡©e_®loÿ‹
 (&
Ëa£
 -> 
İtiÚs
, 
MDL
))

1119 
	`log_çl
 ("no memory for†ease options.\n");

1122 
tok’
 = 
	`³ek_tok’
 (&
v®
, (*)0, 
cfe
);

1123 ià(
tok’
 =ğ
END_OF_FILE
) {

1124 
	`·r£_w¬n
 (
cfe
, "unterminated†ease declaration.");

1127 ià(
tok’
 =ğ
RBRACE
)

1129 
	`·r£_ş›Á_Ëa£_deş¬©iÚ
 (
cfe
, 
Ëa£
, &

, &
ş›Á
);

1131 
	`sk_tok’
(&
v®
, (*)0, 
cfe
);

1135 ià(!

) {

1136 
	`de¡roy_ş›Á_Ëa£
 (
Ëa£
);

1141 ià(!

 -> 
ş›Á
) {

1142 
	`make_ş›Á_¡©e
 (&

 -> 
ş›Á
);

1143 

 -> 
ş›Á
 -> 
š‹rçû
 = ip;

1145 ià(!
ş›Á
)

1146 
ş›Á
 = 

 -> client;

1149 ià(
is_¡©ic
 == 2) {

1150 

 -> 
ş›Á
 -> 
®Ÿs
 = 
Ëa£
;

1158 
¶
 = (
ş›Á_Ëa£
 *)0;

1159 
Í
 = 
ş›Á
 -> 
Ëa£s
;†p;†°ğ
Ãxt
) {

1160 
Ãxt
 = 
Í
 ->‚ext;

1161 ià(
Í
 -> 
add»ss
.
Ën
 =ğ
Ëa£
 ->‡ddress.len &&

1162 !
	`memcmp
 (
Í
 -> 
add»ss
.
Ÿbuf
, 
Ëa£
 ->‡ddress.iabuf,

1163 
Ëa£
 -> 
add»ss
.
Ën
)) {

1164 ià(
¶
)

1165 
¶
 -> 
Ãxt
 =‚ext;

1167 
ş›Á
 -> 
Ëa£s
 = 
Ãxt
;

1168 
	`de¡roy_ş›Á_Ëa£
 (
Í
);

1171 
¶
 = 
Í
;

1176 ià(
is_¡©ic
) {

1177 
Ëa£
 -> 
Ãxt
 = 
ş›Á
 -> 
Ëa£s
;

1178 
ş›Á
 -> 
Ëa£s
 = 
Ëa£
;

1193 ià(
ş›Á
 -> 
aùive
) {

1194 ià(
ş›Á
 -> 
aùive
 -> 
expœy
 < 
cur_time
)

1195 
	`de¡roy_ş›Á_Ëa£
 (
ş›Á
 -> 
aùive
);

1196 ià(
ş›Á
 -> 
aùive
 -> 
add»ss
.
Ën
 ==

1197 
Ëa£
 -> 
add»ss
.
Ën
 &&

1198 !
	`memcmp
 (
ş›Á
 -> 
aùive
 -> 
add»ss
.
Ÿbuf
,

1199 
Ëa£
 -> 
add»ss
.
Ÿbuf
,

1200 
Ëa£
 -> 
add»ss
.
Ën
))

1201 
	`de¡roy_ş›Á_Ëa£
 (
ş›Á
 -> 
aùive
);

1203 
ş›Á
 -> 
aùive
 -> 
Ãxt
 = cl›Á -> 
Ëa£s
;

1204 
ş›Á
 -> 
Ëa£s
 = cl›Á -> 
aùive
;

1207 
ş›Á
 -> 
aùive
 = 
Ëa£
;

1210 
	}
}

1224 
	$·r£_ş›Á_Ëa£_deş¬©iÚ
 (
cfe
, 
Ëa£
, 
p
, 
ş›Áp
)

1225 
·r£
 *
cfe
;

1226 
ş›Á_Ëa£
 *
Ëa£
;

1227 
š‹rçû_šfo
 **
p
;

1228 
ş›Á_¡©e
 **
ş›Áp
;

1230 
tok’
;

1231 cÚ¡ *
v®
;

1232 
š‹rçû_šfo
 *

;

1233 
İtiÚ_ÿche
 *
oc
;

1234 
ş›Á_¡©e
 *
ş›Á
 = (client_state *)0;

1236 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
)) {

1237 
KEY
:

1238 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

1239 ià(
tok’
 !ğ
STRING
 && !
	`is_id’tif›r
 (token)) {

1240 
	`·r£_w¬n
 (
cfe
, "expecting key‚ame.");

1241 
	`sk_to_£mi
 (
cfe
);

1244 ià(
	`om­i_auth_key_lookup_Çme
 (&
Ëa£
 -> 
key
, 
v®
) !=

1245 
ISC_R_SUCCESS
)

1246 
	`·r£_w¬n
 (
cfe
, "unknowÀkey %s", 
v®
);

1247 
	`·r£_£mi
 (
cfe
);

1249 
TOKEN_BOOTP
:

1250 
Ëa£
 -> 
is_boÙp
 = 1;

1253 
INTERFACE
:

1254 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

1255 ià(
tok’
 !ğ
STRING
) {

1256 
	`·r£_w¬n
 (
cfe
,

1258 
	`sk_to_£mi
 (
cfe
);

1261 ià(!
	`š‹rçû_Ü_dummy
 (
p
, 
v®
))

1262 
	`log_çl
 ("Cª'ˆ®loÿ‹ iÁ”çû %s.", 
v®
);

1265 
NAME
:

1266 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

1267 

 = *
p
;

1268 ià(!

) {

1269 
	`·r£_w¬n
 (
cfe
, "state‚ame…recedes interface.");

1272 
ş›Á
 = 

 -> cl›Á; cl›Á; cl›Á = cl›Á -> 
Ãxt
)

1273 ià(
ş›Á
 -> 
Çme
 && !
	`¡rcmp
 (ş›Á ->‚ame, 
v®
))

1275 ià(!
ş›Á
)

1276 
	`·r£_w¬n
 (
cfe
,

1278 *
ş›Áp
 = 
ş›Á
;

1281 
FIXED_ADDR
:

1282 ià(!
	`·r£__addr
 (
cfe
, &
Ëa£
 -> 
add»ss
))

1286 
MEDIUM
:

1287 
	`·r£_¡ršg_li¡
 (
cfe
, &
Ëa£
 -> 
medium
, 0);

1290 
FILENAME
:

1291 
	`·r£_¡ršg
 (
cfe
, &
Ëa£
 -> 
f’ame
, (*)0);

1294 
SERVER_NAME
:

1295 
	`·r£_¡ršg
 (
cfe
, &
Ëa£
 -> 
£rv”_Çme
, (*)0);

1298 
RENEW
:

1299 
Ëa£
 -> 
»Ãw®
 = 
	`·r£_d©e
 (
cfe
);

1302 
REBIND
:

1303 
Ëa£
 -> 
»bšd
 = 
	`·r£_d©e
 (
cfe
);

1306 
EXPIRE
:

1307 
Ëa£
 -> 
expœy
 = 
	`·r£_d©e
 (
cfe
);

1310 
OPTION
:

1311 
oc
 = (
İtiÚ_ÿche
 *)0;

1312 ià(
	`·r£_İtiÚ_deş
 (&
oc
, 
cfe
)) {

1313 
	`§ve_İtiÚ
(
oc
->
İtiÚ
->
univ”£
, 
Ëa£
->
İtiÚs
, oc);

1314 
	`İtiÚ_ÿche_d”eã»nû
 (&
oc
, 
MDL
);

1319 
	`·r£_w¬n
 (
cfe
, "expecting†ease declaration.");

1320 
	`sk_to_£mi
 (
cfe
);

1323 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

1324 ià(
tok’
 !ğ
SEMI
) {

1325 
	`·r£_w¬n
 (
cfe
, "expecting semicolon.");

1326 
	`sk_to_£mi
 (
cfe
);

1328 
	}
}

1333 
	$·r£_ş›Á_deçuÉ_duid
(
·r£
 *
cfe
)

1335 
d©a_¡ršg
 
Ãw_duid
;

1336 
u_št8_t
 
buf
[128];

1337 
Ën
;

1339 
Ën
 = 
	`·r£_X
(
cfe
, 
buf
, (buf));

1340 ià(
Ën
 <= 2) {

1341 
	`·r£_w¬n
(
cfe
, "Invalid DUID contents.");

1342 
	`sk_to_£mi
(
cfe
);

1346 
	`mem£t
(&
Ãw_duid
, 0, (new_duid));

1347 ià(!
	`bufãr_®loÿ‹
(&
Ãw_duid
.
bufãr
, 
Ën
, 
MDL
)) {

1348 
	`·r£_w¬n
(
cfe
, "Out of memory…arsing default DUID.");

1349 
	`sk_to_£mi
(
cfe
);

1352 
Ãw_duid
.
d©a
 =‚ew_duid.
bufãr
->data;

1353 
Ãw_duid
.
Ën
 =†en;

1355 
	`memıy
(
Ãw_duid
.
bufãr
->
d©a
, 
buf
, 
Ën
);

1358 ià(
deçuÉ_duid
.
bufãr
 !ğ
NULL
)

1359 
	`d©a_¡ršg_fÜg‘
(&
deçuÉ_duid
, 
MDL
);

1360 
	`d©a_¡ršg_cİy
(&
deçuÉ_duid
, &
Ãw_duid
, 
MDL
);

1361 
	`d©a_¡ršg_fÜg‘
(&
Ãw_duid
, 
MDL
);

1363 
	`·r£_£mi
(
cfe
);

1364 
	}
}

1373 
	$·r£_ş›Á6_Ëa£_¡©em’t
(
·r£
 *
cfe
)

1375 #ià!
	`defšed
(
DHCPv6
)

1376 
	`·r£_w¬n
(
cfe
, "No DHCPv6 support.");

1377 
	`sk_to_£mi
(
cfe
);

1379 
İtiÚ_ÿche
 *
oc
 = 
NULL
;

1380 
dhc6_Ëa£
 *
Ëa£
;

1381 
dhc6_Ÿ
 **
Ÿ
;

1382 
ş›Á_¡©e
 *
ş›Á
 = 
NULL
;

1383 
š‹rçû_šfo
 *
içû
 = 
NULL
;

1384 
d©a_¡ršg
 
ds
;

1385 cÚ¡ *
v®
;

1386 
Ën
;

1387 
tok’
, 
has_Ÿ
, 
no_£mi
, 
has_Çme
;

1389 
tok’
 = 
	`Ãxt_tok’
(
NULL
, NULL, 
cfe
);

1390 ià(
tok’
 !ğ
LBRACE
) {

1391 
	`·r£_w¬n
(
cfe
, "Expecting open curly brace.");

1392 
	`sk_to_£mi
(
cfe
);

1396 
Ëa£
 = 
	`dm®loc
((*Ëa£), 
MDL
);

1397 ià(
Ëa£
 =ğ
NULL
) {

1398 
	`·r£_w¬n
(
cfe
, "Unableo‡llocate†ease state.");

1399 
	`sk_to_rb¿û
(
cfe
, 1);

1403 
	`İtiÚ_¡©e_®loÿ‹
(&
Ëa£
->
İtiÚs
, 
MDL
);

1404 ià(
Ëa£
->
İtiÚs
 =ğ
NULL
) {

1405 
	`·r£_w¬n
(
cfe
, "Unableo‡llocate option cache.");

1406 
	`sk_to_rb¿û
(
cfe
, 1);

1407 
	`dä“
(
Ëa£
, 
MDL
);

1411 
has_Ÿ
 = 0;

1412 
has_Çme
 = 0;

1413 
Ÿ
 = &
Ëa£
->
bšdšgs
;

1414 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1415 
tok’
 !ğ
RBRACE
) {

1416 
no_£mi
 = 0;

1418 
tok’
) {

1419 
IA_NA
:

1420 *
Ÿ
 = 
	`·r£_ş›Á6_Ÿ_Ç_¡©em’t
(
cfe
);

1421 ià(*
Ÿ
 !ğ
NULL
) {

1422 
Ÿ
 = &(*Ÿ)->
Ãxt
;

1423 
has_Ÿ
 = 1;

1426 
no_£mi
 = 1;

1430 
IA_TA
:

1431 *
Ÿ
 = 
	`·r£_ş›Á6_Ÿ__¡©em’t
(
cfe
);

1432 ià(*
Ÿ
 !ğ
NULL
) {

1433 
Ÿ
 = &(*Ÿ)->
Ãxt
;

1434 
has_Ÿ
 = 1;

1437 
no_£mi
 = 1;

1441 
IA_PD
:

1442 *
Ÿ
 = 
	`·r£_ş›Á6_Ÿ_pd_¡©em’t
(
cfe
);

1443 ià(*
Ÿ
 !ğ
NULL
) {

1444 
Ÿ
 = &(*Ÿ)->
Ãxt
;

1445 
has_Ÿ
 = 1;

1448 
no_£mi
 = 1;

1452 
INTERFACE
:

1453 ià(
içû
 !ğ
NULL
) {

1454 
	`·r£_w¬n
(
cfe
, "Multiple interface‚ames?");

1455 
	`sk_to_£mi
(
cfe
);

1456 
no_£mi
 = 1;

1460 
tok’
 = 
	`Ãxt_tok’
(&
v®
, &
Ën
, 
cfe
);

1461 ià(
tok’
 !ğ
STRING
) {

1462 
¡»¼Ü
:

1463 
	`·r£_w¬n
(
cfe
, "Expecting‡ string.");

1464 
	`sk_to_£mi
(
cfe
);

1465 
no_£mi
 = 1;

1469 
içû
 = 
š‹rçûs
 ; içû !ğ
NULL
 ;

1470 
içû
 = içû->
Ãxt
) {

1471 ià(
	`¡rcmp
(
içû
->
Çme
, 
v®
) == 0)

1475 ià(
içû
 =ğ
NULL
) {

1476 
	`·r£_w¬n
(
cfe
, "Unknown interface.");

1482 
NAME
:

1483 
has_Çme
 = 1;

1485 ià(
ş›Á
 !ğ
NULL
) {

1486 
	`·r£_w¬n
(
cfe
, "Multiple state‚ames?");

1487 
	`sk_to_£mi
(
cfe
);

1488 
no_£mi
 = 1;

1492 ià(
içû
 =ğ
NULL
) {

1493 
	`·r£_w¬n
(
cfe
, "Client‚ame without "

1495 
	`sk_to_£mi
(
cfe
);

1496 
no_£mi
 = 1;

1500 
tok’
 = 
	`Ãxt_tok’
(&
v®
, &
Ën
, 
cfe
);

1501 ià(
tok’
 !ğ
STRING
)

1502 
¡»¼Ü
;

1504 
ş›Á
 = 
içû
->ş›Á ; cl›Á !ğ
NULL
 ;

1505 
ş›Á
 = cl›Á->
Ãxt
) {

1506 ià((
ş›Á
->
Çme
 !ğ
NULL
) &&

1507 (
	`¡rcmp
(
ş›Á
->
Çme
, 
v®
) == 0))

1511 ià(
ş›Á
 =ğ
NULL
) {

1512 
	`·r£_w¬n
(
cfe
, "Unknown client state %s.",

1513 
v®
);

1519 
OPTION
:

1520 ià(
	`·r£_İtiÚ_deş
(&
oc
, 
cfe
)) {

1521 
	`§ve_İtiÚ
(
oc
->
İtiÚ
->
univ”£
,

1522 
Ëa£
->
İtiÚs
, 
oc
);

1523 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

1525 
no_£mi
 = 1;

1528 
TOKEN_RELEASED
:

1529 
TOKEN_ABANDONED
:

1530 
Ëa£
->
»Ëa£d
 = 
ISC_TRUE
;

1534 
	`·r£_w¬n
(
cfe
, "UÃx³ùedok’, %s.", 
v®
);

1535 
no_£mi
 = 1;

1536 
	`sk_to_£mi
(
cfe
);

1540 ià(!
no_£mi
)

1541 
	`·r£_£mi
(
cfe
);

1543 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1545 ià(
tok’
 =ğ
END_OF_FILE
) {

1546 
	`·r£_w¬n
(
cfe
, "Unexpectedƒnd of file.");

1551 ià(!
has_Ÿ
) {

1552 
	`log_debug
("Lease with‚o IA's discarded from†ease db.");

1553 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

1557 ià(
içû
 =ğ
NULL
)

1558 
	`·r£_w¬n
(
cfe
, "Lease has‚o interface designation.");

1559 ià(!
has_Çme
 && (
ş›Á
 =ğ
NULL
)) {

1560 
ş›Á
 = 
içû
->ş›Á ; cl›Á !ğ
NULL
 ;

1561 
ş›Á
 = cl›Á->
Ãxt
) {

1562 ià(
ş›Á
->
Çme
 =ğ
NULL
)

1567 ià(
ş›Á
 =ğ
NULL
) {

1568 
	`·r£_w¬n
(
cfe
, "No matching client state.");

1569 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

1574 
	`mem£t
(&
ds
, 0, (ds));

1575 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
Ëa£
->
İtiÚs
, 
D6O_PREFERENCE
);

1576 ià((
oc
 !ğ
NULL
) &&

1577 
	`ev®u©e_İtiÚ_ÿche
(&
ds
, 
NULL
, NULL, NULL, 
Ëa£
->
İtiÚs
,

1578 
NULL
, &
glob®_scİe
, 
oc
, 
MDL
)) {

1579 ià(
ds
.
Ën
 != 1) {

1580 
	`log_”rÜ
("Invalid†ength of DHCPv6 Preference option "

1581 "(%d !ğ1)", 
ds
.
Ën
);

1582 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1583 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

1586 
Ëa£
->
´ef
 = 
ds
.
d©a
[0];

1588 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1592 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
Ëa£
->
İtiÚs
, 
D6O_SERVERID
);

1593 ià((
oc
 =ğ
NULL
) ||

1594 !
	`ev®u©e_İtiÚ_ÿche
(&
Ëa£
->
£rv”_id
, 
NULL
, NULL, NULL,

1595 
Ëa£
->
İtiÚs
, 
NULL
, &
glob®_scİe
, 
oc
,

1596 
MDL
) ||

1597 (
Ëa£
->
£rv”_id
.
Ën
 == 0)) {

1599 
	`log_”rÜ
("Invalid SERVERID option cache.");

1600 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

1604 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

1605 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
aùive_Ëa£
, 
MDL
);

1607 
ş›Á
->
aùive_Ëa£
 = 
Ëa£
;

1609 
	}
}

1613 #ifdeà
DHCPv6


1614 
dhc6_Ÿ
 *

1615 
	$·r£_ş›Á6_Ÿ_Ç_¡©em’t
(
·r£
 *
cfe
)

1617 
İtiÚ_ÿche
 *
oc
 = 
NULL
;

1618 
dhc6_Ÿ
 *
Ÿ
;

1619 
dhc6_addr
 **
addr
;

1620 cÚ¡ *
v®
;

1621 
tok’
, 
no_£mi
, 
Ën
;

1622 
u_št8_t
 
buf
[5];

1624 
Ÿ
 = 
	`dm®loc
((*Ÿ), 
MDL
);

1625 ià(
Ÿ
 =ğ
NULL
) {

1626 
	`·r£_w¬n
(
cfe
, "Out of memory‡llocating IA_NA state.");

1627 
	`sk_to_£mi
(
cfe
);

1628  
NULL
;

1630 
Ÿ
->
Ÿ_ty³
 = 
D6O_IA_NA
;

1633 
Ën
 = 
	`·r£_X
(
cfe
, 
buf
, 5);

1634 ià(
Ën
 == 4) {

1635 
	`memıy
(
Ÿ
->
Ÿid
, 
buf
, 4);

1637 
	`·r£_w¬n
(
cfe
, "Ex³ùšg IAID oàËngth 4, gÙ %d.", 
Ën
);

1638 
	`sk_to_£mi
(
cfe
);

1639 
	`dä“
(
Ÿ
, 
MDL
);

1640  
NULL
;

1643 
tok’
 = 
	`Ãxt_tok’
(
NULL
, NULL, 
cfe
);

1644 ià(
tok’
 !ğ
LBRACE
) {

1645 
	`·r£_w¬n
(
cfe
, "Expecting open curly brace.");

1646 
	`sk_to_£mi
(
cfe
);

1647 
	`dä“
(
Ÿ
, 
MDL
);

1648  
NULL
;

1651 
	`İtiÚ_¡©e_®loÿ‹
(&
Ÿ
->
İtiÚs
, 
MDL
);

1652 ià(
Ÿ
->
İtiÚs
 =ğ
NULL
) {

1653 
	`·r£_w¬n
(
cfe
, "Unableo‡llocate option state.");

1654 
	`sk_to_rb¿û
(
cfe
, 1);

1655 
	`dä“
(
Ÿ
, 
MDL
);

1656  
NULL
;

1659 
addr
 = &
Ÿ
->
addrs
;

1660 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1661 
tok’
 !ğ
RBRACE
) {

1662 
no_£mi
 = 0;

1664 
tok’
) {

1665 
STARTS
:

1666 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1667 ià(
tok’
 =ğ
NUMBER
) {

1668 
Ÿ
->
¡¬ts
 = 
	`©oi
(
v®
);

1670 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

1671 
	`sk_to_£mi
(
cfe
);

1672 
no_£mi
 = 1;

1676 
RENEW
:

1677 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1678 ià(
tok’
 =ğ
NUMBER
) {

1679 
Ÿ
->
»Ãw
 = 
	`©oi
(
v®
);

1681 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

1682 
	`sk_to_£mi
(
cfe
);

1683 
no_£mi
 = 1;

1687 
REBIND
:

1688 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1689 ià(
tok’
 =ğ
NUMBER
) {

1690 
Ÿ
->
»bšd
 = 
	`©oi
(
v®
);

1692 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

1693 
	`sk_to_£mi
(
cfe
);

1694 
no_£mi
 = 1;

1698 
IAADDR
:

1699 *
addr
 = 
	`·r£_ş›Á6_Ÿaddr_¡©em’t
(
cfe
);

1701 ià(*
addr
 !ğ
NULL
)

1702 
addr
 = &(*addr)->
Ãxt
;

1704 
no_£mi
 = 1;

1708 
OPTION
:

1709 ià(
	`·r£_İtiÚ_deş
(&
oc
, 
cfe
)) {

1710 
	`§ve_İtiÚ
(
oc
->
İtiÚ
->
univ”£
,

1711 
Ÿ
->
İtiÚs
, 
oc
);

1712 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

1714 
no_£mi
 = 1;

1718 
	`·r£_w¬n
(
cfe
, "Unexpectedoken.");

1719 
no_£mi
 = 1;

1720 
	`sk_to_£mi
(
cfe
);

1724 ià(!
no_£mi
)

1725 
	`·r£_£mi
(
cfe
);

1727 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1729 ià(
tok’
 =ğ
END_OF_FILE
) {

1730 
	`·r£_w¬n
(
cfe
, "Unexpectedƒnd of file.");

1735  
Ÿ
;

1736 
	}
}

1741 #ifdeà
DHCPv6


1742 
dhc6_Ÿ
 *

1743 
	$·r£_ş›Á6_Ÿ__¡©em’t
(
·r£
 *
cfe
)

1745 
İtiÚ_ÿche
 *
oc
 = 
NULL
;

1746 
dhc6_Ÿ
 *
Ÿ
;

1747 
dhc6_addr
 **
addr
;

1748 cÚ¡ *
v®
;

1749 
tok’
, 
no_£mi
, 
Ën
;

1750 
u_št8_t
 
buf
[5];

1752 
Ÿ
 = 
	`dm®loc
((*Ÿ), 
MDL
);

1753 ià(
Ÿ
 =ğ
NULL
) {

1754 
	`·r£_w¬n
(
cfe
, "Out of memory‡llocating IA_TA state.");

1755 
	`sk_to_£mi
(
cfe
);

1756  
NULL
;

1758 
Ÿ
->
Ÿ_ty³
 = 
D6O_IA_TA
;

1761 
Ën
 = 
	`·r£_X
(
cfe
, 
buf
, 5);

1762 ià(
Ën
 == 4) {

1763 
	`memıy
(
Ÿ
->
Ÿid
, 
buf
, 4);

1765 
	`·r£_w¬n
(
cfe
, "Ex³ùšg IAID oàËngth 4, gÙ %d.", 
Ën
);

1766 
	`sk_to_£mi
(
cfe
);

1767 
	`dä“
(
Ÿ
, 
MDL
);

1768  
NULL
;

1771 
tok’
 = 
	`Ãxt_tok’
(
NULL
, NULL, 
cfe
);

1772 ià(
tok’
 !ğ
LBRACE
) {

1773 
	`·r£_w¬n
(
cfe
, "Expecting open curly brace.");

1774 
	`sk_to_£mi
(
cfe
);

1775 
	`dä“
(
Ÿ
, 
MDL
);

1776  
NULL
;

1779 
	`İtiÚ_¡©e_®loÿ‹
(&
Ÿ
->
İtiÚs
, 
MDL
);

1780 ià(
Ÿ
->
İtiÚs
 =ğ
NULL
) {

1781 
	`·r£_w¬n
(
cfe
, "Unableo‡llocate option state.");

1782 
	`sk_to_rb¿û
(
cfe
, 1);

1783 
	`dä“
(
Ÿ
, 
MDL
);

1784  
NULL
;

1787 
addr
 = &
Ÿ
->
addrs
;

1788 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1789 
tok’
 !ğ
RBRACE
) {

1790 
no_£mi
 = 0;

1792 
tok’
) {

1793 
STARTS
:

1794 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1795 ià(
tok’
 =ğ
NUMBER
) {

1796 
Ÿ
->
¡¬ts
 = 
	`©oi
(
v®
);

1798 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

1799 
	`sk_to_£mi
(
cfe
);

1800 
no_£mi
 = 1;

1806 
IAADDR
:

1807 *
addr
 = 
	`·r£_ş›Á6_Ÿaddr_¡©em’t
(
cfe
);

1809 ià(*
addr
 !ğ
NULL
)

1810 
addr
 = &(*addr)->
Ãxt
;

1812 
no_£mi
 = 1;

1816 
OPTION
:

1817 ià(
	`·r£_İtiÚ_deş
(&
oc
, 
cfe
)) {

1818 
	`§ve_İtiÚ
(
oc
->
İtiÚ
->
univ”£
,

1819 
Ÿ
->
İtiÚs
, 
oc
);

1820 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

1822 
no_£mi
 = 1;

1826 
	`·r£_w¬n
(
cfe
, "Unexpectedoken.");

1827 
no_£mi
 = 1;

1828 
	`sk_to_£mi
(
cfe
);

1832 ià(!
no_£mi
)

1833 
	`·r£_£mi
(
cfe
);

1835 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1837 ià(
tok’
 =ğ
END_OF_FILE
) {

1838 
	`·r£_w¬n
(
cfe
, "Unexpectedƒnd of file.");

1843  
Ÿ
;

1844 
	}
}

1849 #ifdeà
DHCPv6


1850 
dhc6_Ÿ
 *

1851 
	$·r£_ş›Á6_Ÿ_pd_¡©em’t
(
·r£
 *
cfe
)

1853 
İtiÚ_ÿche
 *
oc
 = 
NULL
;

1854 
dhc6_Ÿ
 *
Ÿ
;

1855 
dhc6_addr
 **
´ef
;

1856 cÚ¡ *
v®
;

1857 
tok’
, 
no_£mi
, 
Ën
;

1858 
u_št8_t
 
buf
[5];

1860 
Ÿ
 = 
	`dm®loc
((*Ÿ), 
MDL
);

1861 ià(
Ÿ
 =ğ
NULL
) {

1862 
	`·r£_w¬n
(
cfe
, "Out of memory‡llocating IA_PD state.");

1863 
	`sk_to_£mi
(
cfe
);

1864  
NULL
;

1866 
Ÿ
->
Ÿ_ty³
 = 
D6O_IA_PD
;

1869 
Ën
 = 
	`·r£_X
(
cfe
, 
buf
, 5);

1870 ià(
Ën
 == 4) {

1871 
	`memıy
(
Ÿ
->
Ÿid
, 
buf
, 4);

1873 
	`·r£_w¬n
(
cfe
, "Ex³ùšg IAID oàËngth 4, gÙ %d.", 
Ën
);

1874 
	`sk_to_£mi
(
cfe
);

1875 
	`dä“
(
Ÿ
, 
MDL
);

1876  
NULL
;

1879 
tok’
 = 
	`Ãxt_tok’
(
NULL
, NULL, 
cfe
);

1880 ià(
tok’
 !ğ
LBRACE
) {

1881 
	`·r£_w¬n
(
cfe
, "Expecting open curly brace.");

1882 
	`sk_to_£mi
(
cfe
);

1883 
	`dä“
(
Ÿ
, 
MDL
);

1884  
NULL
;

1887 
	`İtiÚ_¡©e_®loÿ‹
(&
Ÿ
->
İtiÚs
, 
MDL
);

1888 ià(
Ÿ
->
İtiÚs
 =ğ
NULL
) {

1889 
	`·r£_w¬n
(
cfe
, "Unableo‡llocate option state.");

1890 
	`sk_to_rb¿û
(
cfe
, 1);

1891 
	`dä“
(
Ÿ
, 
MDL
);

1892  
NULL
;

1895 
´ef
 = &
Ÿ
->
addrs
;

1896 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1897 
tok’
 !ğ
RBRACE
) {

1898 
no_£mi
 = 0;

1900 
tok’
) {

1901 
STARTS
:

1902 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1903 ià(
tok’
 =ğ
NUMBER
) {

1904 
Ÿ
->
¡¬ts
 = 
	`©oi
(
v®
);

1906 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

1907 
	`sk_to_£mi
(
cfe
);

1908 
no_£mi
 = 1;

1912 
RENEW
:

1913 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1914 ià(
tok’
 =ğ
NUMBER
) {

1915 
Ÿ
->
»Ãw
 = 
	`©oi
(
v®
);

1917 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

1918 
	`sk_to_£mi
(
cfe
);

1919 
no_£mi
 = 1;

1923 
REBIND
:

1924 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1925 ià(
tok’
 =ğ
NUMBER
) {

1926 
Ÿ
->
»bšd
 = 
	`©oi
(
v®
);

1928 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

1929 
	`sk_to_£mi
(
cfe
);

1930 
no_£mi
 = 1;

1934 
IAPREFIX
:

1935 *
´ef
 = 
	`·r£_ş›Á6_Ÿ´efix_¡©em’t
(
cfe
);

1937 ià(*
´ef
 !ğ
NULL
)

1938 
´ef
 = &(*´ef)->
Ãxt
;

1940 
no_£mi
 = 1;

1944 
OPTION
:

1945 ià(
	`·r£_İtiÚ_deş
(&
oc
, 
cfe
)) {

1946 
	`§ve_İtiÚ
(
oc
->
İtiÚ
->
univ”£
,

1947 
Ÿ
->
İtiÚs
, 
oc
);

1948 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

1950 
no_£mi
 = 1;

1954 
	`·r£_w¬n
(
cfe
, "Unexpectedoken.");

1955 
no_£mi
 = 1;

1956 
	`sk_to_£mi
(
cfe
);

1960 ià(!
no_£mi
)

1961 
	`·r£_£mi
(
cfe
);

1963 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

1965 ià(
tok’
 =ğ
END_OF_FILE
) {

1966 
	`·r£_w¬n
(
cfe
, "Unexpectedƒnd of file.");

1971  
Ÿ
;

1972 
	}
}

1976 #ifdeà
DHCPv6


1977 
dhc6_addr
 *

1978 
	$·r£_ş›Á6_Ÿaddr_¡©em’t
(
·r£
 *
cfe
)

1980 
İtiÚ_ÿche
 *
oc
 = 
NULL
;

1981 
dhc6_addr
 *
addr
;

1982 cÚ¡ *
v®
;

1983 
tok’
, 
no_£mi
;

1985 
addr
 = 
	`dm®loc
((*addr), 
MDL
);

1986 ià(
addr
 =ğ
NULL
) {

1987 
	`·r£_w¬n
(
cfe
, "Unableo‡llocate IAADDR state.");

1988 
	`sk_to_£mi
(
cfe
);

1989  
NULL
;

1993 ià(!
	`·r£_6_addr
(
cfe
, &
addr
->
add»ss
)) {

1994 
	`sk_to_£mi
(
cfe
);

1995 
	`dä“
(
addr
, 
MDL
);

1996  
NULL
;

1999 
tok’
 = 
	`Ãxt_tok’
(
NULL
, NULL, 
cfe
);

2000 ià(
tok’
 !ğ
LBRACE
) {

2001 
	`·r£_w¬n
(
cfe
, "Expecting open curly bracket.");

2002 
	`sk_to_£mi
(
cfe
);

2003 
	`dä“
(
addr
, 
MDL
);

2004  
NULL
;

2007 
	`İtiÚ_¡©e_®loÿ‹
(&
addr
->
İtiÚs
, 
MDL
);

2008 ià(
addr
->
İtiÚs
 =ğ
NULL
) {

2009 
	`·r£_w¬n
(
cfe
, "Unableo‡llocate option state.");

2010 
	`sk_to_£mi
(
cfe
);

2011 
	`dä“
(
addr
, 
MDL
);

2012  
NULL
;

2015 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2016 
tok’
 !ğ
RBRACE
) {

2017 
no_£mi
 = 0;

2019 
tok’
) {

2020 
STARTS
:

2021 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2022 ià(
tok’
 =ğ
NUMBER
) {

2023 
addr
->
¡¬ts
 = 
	`©oi
(
v®
);

2025 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

2026 
	`sk_to_£mi
(
cfe
);

2027 
no_£mi
 = 1;

2031 
PREFERRED_LIFE
:

2032 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2033 ià(
tok’
 =ğ
NUMBER
) {

2034 
addr
->
´eã¼ed_liã
 = 
	`©oi
(
v®
);

2036 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

2037 
	`sk_to_£mi
(
cfe
);

2038 
no_£mi
 = 1;

2042 
MAX_LIFE
:

2043 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2044 ià(
tok’
 =ğ
NUMBER
) {

2045 
addr
->
max_liã
 = 
	`©oi
(
v®
);

2047 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

2048 
	`sk_to_£mi
(
cfe
);

2049 
no_£mi
 = 1;

2053 
OPTION
:

2054 ià(
	`·r£_İtiÚ_deş
(&
oc
, 
cfe
)) {

2055 
	`§ve_İtiÚ
(
oc
->
İtiÚ
->
univ”£
,

2056 
addr
->
İtiÚs
, 
oc
);

2057 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

2059 
no_£mi
 = 1;

2063 
	`·r£_w¬n
(
cfe
, "Unexpectedoken.");

2064 
	`sk_to_rb¿û
(
cfe
, 1);

2065 
no_£mi
 = 1;

2069 ià(!
no_£mi
)

2070 
	`·r£_£mi
(
cfe
);

2072 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2073 ià(
tok’
 =ğ
END_OF_FILE
) {

2074 
	`·r£_w¬n
(
cfe
, "Unexpectedƒnd of file.");

2079  
addr
;

2080 
	}
}

2084 #ifdeà
DHCPv6


2085 
dhc6_addr
 *

2086 
	$·r£_ş›Á6_Ÿ´efix_¡©em’t
(
·r£
 *
cfe
)

2088 
İtiÚ_ÿche
 *
oc
 = 
NULL
;

2089 
dhc6_addr
 *
´ef
;

2090 cÚ¡ *
v®
;

2091 
tok’
, 
no_£mi
;

2093 
´ef
 = 
	`dm®loc
((*´ef), 
MDL
);

2094 ià(
´ef
 =ğ
NULL
) {

2095 
	`·r£_w¬n
(
cfe
, "Unableo‡llocate IAPREFIX state.");

2096 
	`sk_to_£mi
(
cfe
);

2097  
NULL
;

2101 ià(!
	`·r£_6_´efix
(
cfe
, &
´ef
->
add»ss
, &´ef->
¶’
)) {

2102 
	`sk_to_£mi
(
cfe
);

2103 
	`dä“
(
´ef
, 
MDL
);

2104  
NULL
;

2107 
tok’
 = 
	`Ãxt_tok’
(
NULL
, NULL, 
cfe
);

2108 ià(
tok’
 !ğ
LBRACE
) {

2109 
	`·r£_w¬n
(
cfe
, "Expecting open curly bracket.");

2110 
	`sk_to_£mi
(
cfe
);

2111 
	`dä“
(
´ef
, 
MDL
);

2112  
NULL
;

2115 
	`İtiÚ_¡©e_®loÿ‹
(&
´ef
->
İtiÚs
, 
MDL
);

2116 ià(
´ef
->
İtiÚs
 =ğ
NULL
) {

2117 
	`·r£_w¬n
(
cfe
, "Unableo‡llocate option state.");

2118 
	`sk_to_£mi
(
cfe
);

2119 
	`dä“
(
´ef
, 
MDL
);

2120  
NULL
;

2123 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2124 
tok’
 !ğ
RBRACE
) {

2125 
no_£mi
 = 0;

2127 
tok’
) {

2128 
STARTS
:

2129 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2130 ià(
tok’
 =ğ
NUMBER
) {

2131 
´ef
->
¡¬ts
 = 
	`©oi
(
v®
);

2133 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

2134 
	`sk_to_£mi
(
cfe
);

2135 
no_£mi
 = 1;

2139 
PREFERRED_LIFE
:

2140 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2141 ià(
tok’
 =ğ
NUMBER
) {

2142 
´ef
->
´eã¼ed_liã
 = 
	`©oi
(
v®
);

2144 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

2145 
	`sk_to_£mi
(
cfe
);

2146 
no_£mi
 = 1;

2150 
MAX_LIFE
:

2151 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2152 ià(
tok’
 =ğ
NUMBER
) {

2153 
´ef
->
max_liã
 = 
	`©oi
(
v®
);

2155 
	`·r£_w¬n
(
cfe
, "Expecting‡‚umber.");

2156 
	`sk_to_£mi
(
cfe
);

2157 
no_£mi
 = 1;

2161 
OPTION
:

2162 ià(
	`·r£_İtiÚ_deş
(&
oc
, 
cfe
)) {

2163 
	`§ve_İtiÚ
(
oc
->
İtiÚ
->
univ”£
,

2164 
´ef
->
İtiÚs
, 
oc
);

2165 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

2167 
no_£mi
 = 1;

2171 
	`·r£_w¬n
(
cfe
, "Unexpectedoken.");

2172 
	`sk_to_rb¿û
(
cfe
, 1);

2173 
no_£mi
 = 1;

2177 ià(!
no_£mi
)

2178 
	`·r£_£mi
(
cfe
);

2180 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2181 ià(
tok’
 =ğ
END_OF_FILE
) {

2182 
	`·r£_w¬n
(
cfe
, "Unexpectedƒnd of file.");

2187  
´ef
;

2188 
	}
}

2191 
	$·r£_¡ršg_li¡
 (
cfe
, 
Í
, 
muÉË
)

2192 
·r£
 *
cfe
;

2193 
¡ršg_li¡
 **
Í
;

2194 
muÉË
;

2196 
tok’
;

2197 cÚ¡ *
v®
;

2198 
¡ršg_li¡
 *
cur
, *
tmp
;

2201 ià(*
Í
) {

2202 
cur
 = *
Í
; cu¸-> 
Ãxt
; cur = cur ->‚ext)

2205 
cur
 = (
¡ršg_li¡
 *)0;

2209 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

2210 ià(
tok’
 !ğ
STRING
) {

2211 
	`·r£_w¬n
 (
cfe
, "Expecting media options.");

2212 
	`sk_to_£mi
 (
cfe
);

2216 
tmp
 = ((
¡ršg_li¡
 *)

2217 
	`dm®loc
 (
	`¡¾’
 (
v®
è+  (
¡ršg_li¡
),

2218 
MDL
));

2219 ià(!
tmp
)

2220 
	`log_çl
 ("no memory for string†istƒntry.");

2222 
	`¡rıy
 (
tmp
 -> 
¡ršg
, 
v®
);

2223 
tmp
 -> 
Ãxt
 = (
¡ršg_li¡
 *)0;

2226 ià(
cur
)

2227 
cur
 -> 
Ãxt
 = 
tmp
;

2229 *
Í
 = 
tmp
;

2230 
cur
 = 
tmp
;

2232 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

2233 } 
muÉË
 && 
tok’
 =ğ
COMMA
);

2235 ià(
tok’
 !ğ
SEMI
) {

2236 
	`·r£_w¬n
 (
cfe
, "expecting semicolon.");

2237 
	`sk_to_£mi
 (
cfe
);

2239 
	}
}

2241 
	$·r£_»jeù_¡©em’t
 (
cfe
, 
cÚfig
)

2242 
·r£
 *
cfe
;

2243 
ş›Á_cÚfig
 *
cÚfig
;

2245 
tok’
;

2246 cÚ¡ *
v®
;

2247 
Ÿddrm©ch
 
m©ch
;

2248 
Ÿddrm©chli¡
 *
li¡
;

2249 
i
;

2252 ià(!
	`·r£__addr_w™h_subÃt
 (
cfe
, &
m©ch
)) {

2254 
	`sk_to_£mi
 (
cfe
);

2269 
i
=0 ; i < 
m©ch
.
mask
.
Ën
 ; i++) {

2270 ià(
m©ch
.
mask
.
Ÿbuf
[
i
]) {

2275 ià(
i
 =ğ
m©ch
.
mask
.
Ën
) {

2277 
	`·r£_w¬n
(
cfe
, "zero-length…refix is‚ot…ermitted "

2279 
	`sk_to_£mi
(
cfe
);

2283 
li¡
 = 
	`dm®loc
((
Ÿddrm©chli¡
), 
MDL
);

2284 ià(!
li¡
)

2285 
	`log_çl
 ("no memory for„eject†ist!");

2287 
li¡
->
m©ch
 = match;

2288 
li¡
->
Ãxt
 = 
cÚfig
->
»jeù_li¡
;

2289 
cÚfig
->
»jeù_li¡
 = 
li¡
;

2291 
tok’
 = 
	`Ãxt_tok’
 (&
v®
, (*)0, 
cfe
);

2292 } 
tok’
 =ğ
COMMA
);

2294 ià(
tok’
 !ğ
SEMI
) {

2295 
	`·r£_w¬n
 (
cfe
, "expecting semicolon.");

2296 
	`sk_to_£mi
 (
cfe
);

2298 
	}
}

2305 
	$·r£_®low_d’y
 (
oc
, 
cfe
, 
æag
)

2306 
İtiÚ_ÿche
 **
oc
;

2307 
·r£
 *
cfe
;

2308 
æag
;

2310 
	`·r£_w¬n
 (
cfe
, "allow/deny/ignore‚ot…ermitted here.");

2311 
	`sk_to_£mi
 (
cfe
);

2313 
	}
}

2331 
	$·r£_Ëa£_id_fÜm©
 (
·r£
 *
cfe
)

2333 
dhı_tok’
 
tok’
;

2334 cÚ¡ *
v®
;

2336 
tok’
 = 
	`Ãxt_tok’
(&
v®
, 
NULL
, 
cfe
);

2337 
tok’
) {

2338 
TOKEN_OCTAL
:

2339 
tİ_Ëv–_cÚfig
.
Ëa£_id_fÜm©
 = 
TOKEN_OCTAL
;

2341 
TOKEN_HEX
:

2342 
tİ_Ëv–_cÚfig
.
Ëa£_id_fÜm©
 = 
TOKEN_HEX
;

2345 
	`·r£_w¬n
(
cfe
, "lease-id-format is invalid: "

2347 
	`sk_to_£mi
(
cfe
);

2351 
	`log_debug
("lease_id_format is: %s",

2352 (
tİ_Ëv–_cÚfig
.
Ëa£_id_fÜm©
 =ğ
TOKEN_OCTAL


2355 
	}
}

	@dhc6.c

26 
	~"dhıd.h
"

28 #ifdeà
DHCPv6


30 
sockaddr_š6
 
	gDHCPv6De¡Addr
;

36 
İtiÚ
 *
	gş›Áid_İtiÚ
 = 
NULL
;

37 
İtiÚ
 *
	g–­£d_İtiÚ
 = 
NULL
;

38 
İtiÚ
 *
	gŸ_Ç_İtiÚ
 = 
NULL
;

39 
İtiÚ
 *
	gŸ__İtiÚ
 = 
NULL
;

40 
İtiÚ
 *
	gŸ_pd_İtiÚ
 = 
NULL
;

41 
İtiÚ
 *
	gŸaddr_İtiÚ
 = 
NULL
;

42 
İtiÚ
 *
	gŸ´efix_İtiÚ
 = 
NULL
;

43 
İtiÚ
 *
	gÜo_İtiÚ
 = 
NULL
;

44 
İtiÚ
 *
	gœt_İtiÚ
 = 
NULL
;

46 
dhc6_Ëa£
 *
dhc6_dup_Ëa£
(dhc6_Ëa£ *
Ëa£
,

47 cÚ¡ *
fe
, 
lše
);

48 
dhc6_Ÿ
 *
dhc6_dup_Ÿ
(dhc6_Ÿ *
Ÿ
,

49 cÚ¡ *
fe
, 
lše
);

50 
dhc6_addr
 *
dhc6_dup_addr
(dhc6_add¸*
addr
,

51 cÚ¡ *
fe
, 
lše
);

52 
dhc6_Ÿ_de¡roy
(
dhc6_Ÿ
 **
¤c
, cÚ¡ *
fe
, 
lše
);

53 
isc_»suÉ_t
 
dhc6_·r£_Ÿ_Ç
(
dhc6_Ÿ
 **
pŸ
,

54 
·ck‘
 *packet,

55 
İtiÚ_¡©e
 *
İtiÚs
,

56 
code
);

57 
isc_»suÉ_t
 
dhc6_·r£_Ÿ_
(
dhc6_Ÿ
 **
pŸ
,

58 
·ck‘
 *packet,

59 
İtiÚ_¡©e
 *
İtiÚs
,

60 
code
);

61 
isc_»suÉ_t
 
dhc6_·r£_Ÿ_pd
(
dhc6_Ÿ
 **
pŸ
,

62 
·ck‘
 *packet,

63 
İtiÚ_¡©e
 *
İtiÚs
,

64 
code
);

65 
isc_»suÉ_t
 
dhc6_·r£_addrs
(
dhc6_addr
 **
·ddr
,

66 
·ck‘
 *packet,

67 
İtiÚ_¡©e
 *
İtiÚs
);

68 
isc_»suÉ_t
 
dhc6_·r£_´efixes
(
dhc6_addr
 **
µ»f
,

69 
·ck‘
 *packet,

70 
İtiÚ_¡©e
 *
İtiÚs
);

71 
dhc6_Ÿ
 *
fšd_Ÿ
(dhc6_Ÿ *
h—d
,

72 
u_št16_t
 
ty³
, cÚ¡ *
id
);

73 
dhc6_addr
 *
fšd_addr
(dhc6_add¸*
h—d
,

74 
Ÿddr
 *
add»ss
);

75 
dhc6_addr
 *
fšd_´ef
(dhc6_add¸*
h—d
,

76 
Ÿddr
 *
´efix
, 
u_št8_t
 
¶’
);

77 
š™_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
);

78 
šfo_»que¡_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
);

79 
¿pid_comm™_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
);

80 
do_š™6
(*
šput
);

81 
do_šfo_»que¡6
(*
šput
);

82 
do_cÚfœm6
(*
šput
);

83 
»¶y_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
);

84 
isc_»suÉ_t
 
dhc6_ü—‹_Ÿid
(
ş›Á_¡©e
 *
ş›Á
,

85 
d©a_¡ršg
 *
Ÿ
,

86 
idx
,

87 
Ën
);

88 
dhc6_couÁ_Ÿ
(
dhc6_Ëa£
 *
Ëa£
,

89 
u_št16_t
 
Ÿ_ty³
);

90 
isc_»suÉ_t
 
dhc6_b¬e_Ÿ_xx
(
ş›Á_¡©e
 *
ş›Á
,

91 
d©a_¡ršg
 *
·ck‘
,

92 
wª‹d
,

93 
u_št16_t
 
Ÿ_ty³
);

94 
isc_»suÉ_t
 
dhc6_add_Ÿ_Ç
(
ş›Á_¡©e
 *
ş›Á
,

95 
d©a_¡ršg
 *
·ck‘
,

96 
dhc6_Ëa£
 *
Ëa£
,

97 
u_št8_t
 
mes§ge
,

98 
wª‹d
,

99 *
added
);

100 
isc_»suÉ_t
 
dhc6_add_Ÿ_
(
ş›Á_¡©e
 *
ş›Á
,

101 
d©a_¡ršg
 *
·ck‘
,

102 
dhc6_Ëa£
 *
Ëa£
,

103 
u_št8_t
 
mes§ge
,

104 
wª‹d
,

105 *
added
);

106 
isc_»suÉ_t
 
dhc6_add_Ÿ_pd
(
ş›Á_¡©e
 *
ş›Á
,

107 
d©a_¡ršg
 *
·ck‘
,

108 
dhc6_Ëa£
 *
Ëa£
,

109 
u_št8_t
 
mes§ge
,

110 
wª‹d
,

111 *
added
);

112 
isc_boŞ—n_t
 
¡İpšg_fšished
();

113 
dhc6_m”ge_Ëa£
(
dhc6_Ëa£
 *
¤c
, dhc6_Ëa£ *
d¡
);

114 
do_£Ëù6
(*
šput
);

115 
do_»äesh6
(*
šput
);

116 
do_»Ëa£6
(*
šput
);

117 
¡¬t_bound
(
ş›Á_¡©e
 *
ş›Á
);

118 
¡¬t_deşše6
(
ş›Á_¡©e
 *
ş›Á
);

119 
do_deşše6
(*
šput
);

120 
¡¬t_šfÜmed
(
ş›Á_¡©e
 *
ş›Á
);

121 
šfÜmed_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
);

122 
bound_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
);

123 
¡¬t_»Ãw6
(*
šput
);

124 
¡¬t_»bšd6
(*
šput
);

125 
do_d•»f
(*
šput
);

126 
do_expœe
(*
šput
);

127 
make_ş›Á6_İtiÚs
(
ş›Á_¡©e
 *
ş›Á
,

128 
İtiÚ_¡©e
 **
İ
,

129 
dhc6_Ëa£
 *
Ëa£
, 
u_št8_t
 
mes§ge
);

130 
süt_wr™e_·¿ms6
(
ş›Á_¡©e
 *
ş›Á
,

131 cÚ¡ *
´efix
,

132 
İtiÚ_¡©e
 *
İtiÚs
);

133 
süt_wr™e_»que¡ed6
(
ş›Á_¡©e
 *
ş›Á
);

134 
isc_boŞ—n_t
 
aùive_´efix
(
ş›Á_¡©e
 *
ş›Á
);

136 
check_timšg6
(
ş›Á_¡©e
 *
ş›Á
, 
u_št8_t
 
msg_ty³
,

137 *
msg_¡r
, 
dhc6_Ëa£
 *
Ëa£
,

138 
d©a_¡ršg
 *
ds
);

139 
isc_»suÉ_t
 
dhc6_g‘_¡©us_code
(
İtiÚ_¡©e
 *
İtiÚs
,

140 *
code
,

141 
d©a_¡ršg
 *
msg
);

142 
isc_»suÉ_t
 
dhc6_check_¡©us
(isc_»suÉ_ˆ
rv®
,

143 
İtiÚ_¡©e
 *
İtiÚs
,

144 cÚ¡ *
scİe
,

145 *
code
);

146 
dhc6_scÜe_Ëa£
(
ş›Á_¡©e
 *
ş›Á
,

147 
dhc6_Ëa£
 *
Ëa£
);

148 
isc_»suÉ_t
 
dhc6_add_Ÿ_Ç_deşše
(
ş›Á_¡©e
 *
ş›Á
,

149 
d©a_¡ršg
 *
·ck‘
,

150 
dhc6_Ëa£
 *
Ëa£
);

151 
drİ_deşšed_addrs
(
dhc6_Ëa£
 *
Ëa£
);

152 
isc_boŞ—n_t
 
uÃxpœed_add»ss_š_Ëa£
(
dhc6_Ëa£
 *
Ëa£
);

154 
Ú‘ry
;

155 
¡©–ess
;

156 
´efix_Ën_hšt
;

157 
add»ss_´efix_Ën
;

163 
	$dhıv6_ş›Á_assignm’ts
()

165 
£rv’t
 *
’t
;

166 
code
;

168 ià(
·th_dhş›Á_pid
 =ğ
NULL
)

169 
·th_dhş›Á_pid
 = 
_PATH_DHCLIENT6_PID
;

170 ià(
·th_dhş›Á_db
 =ğ
NULL
)

171 
·th_dhş›Á_db
 = 
_PATH_DHCLIENT6_DB
;

173 ià(
loÿl_pÜt
 == 0) {

174 
’t
 = 
	`g‘£rvbyÇme
("dhcpv6-client", "udp");

175 ià(
’t
 =ğ
NULL
)

176 
loÿl_pÜt
 = 
	`htÚs
(546);

178 
loÿl_pÜt
 = 
’t
->
s_pÜt
;

181 ià(
»mÙe_pÜt
 == 0) {

182 
’t
 = 
	`g‘£rvbyÇme
("dhcpv6-server", "udp");

183 ià(
’t
 =ğ
NULL
)

184 
»mÙe_pÜt
 = 
	`htÚs
(547);

186 
»mÙe_pÜt
 = 
’t
->
s_pÜt
;

189 
	`mem£t
(&
DHCPv6De¡Addr
, 0, (DHCPv6DestAddr));

190 
DHCPv6De¡Addr
.
sš6_çmy
 = 
AF_INET6
;

191 
DHCPv6De¡Addr
.
sš6_pÜt
 = 
»mÙe_pÜt
;

192 ià(
	`š‘_±Ú
(
AF_INET6
, 
AÎ_DHCP_R–ay_Ag’ts_ªd_S”v”s
,

193 &
DHCPv6De¡Addr
.
sš6_addr
) <= 0) {

194 
	`log_çl
("Bad‡dd»s %s", 
AÎ_DHCP_R–ay_Ag’ts_ªd_S”v”s
);

197 
code
 = 
D6O_CLIENTID
;

198 ià(!
	`İtiÚ_code_hash_lookup
(&
ş›Áid_İtiÚ
,

199 
dhıv6_univ”£
.
code_hash
, &
code
, 0, 
MDL
))

200 
	`log_çl
("Unableo findhe CLIENTID option definition.");

202 
code
 = 
D6O_ELAPSED_TIME
;

203 ià(!
	`İtiÚ_code_hash_lookup
(&
–­£d_İtiÚ
,

204 
dhıv6_univ”£
.
code_hash
, &
code
, 0, 
MDL
))

205 
	`log_çl
("Unableo findhe ELAPSED_TIME option definition.");

207 
code
 = 
D6O_IA_NA
;

208 ià(!
	`İtiÚ_code_hash_lookup
(&
Ÿ_Ç_İtiÚ
, 
dhıv6_univ”£
.
code_hash
,

209 &
code
, 0, 
MDL
))

210 
	`log_çl
("Unableo findhe IA_NA option definition.");

212 
code
 = 
D6O_IA_TA
;

213 ià(!
	`İtiÚ_code_hash_lookup
(&
Ÿ__İtiÚ
, 
dhıv6_univ”£
.
code_hash
,

214 &
code
, 0, 
MDL
))

215 
	`log_çl
("Unableo findhe IA_TA option definition.");

217 
code
 = 
D6O_IA_PD
;

218 ià(!
	`İtiÚ_code_hash_lookup
(&
Ÿ_pd_İtiÚ
, 
dhıv6_univ”£
.
code_hash
,

219 &
code
, 0, 
MDL
))

220 
	`log_çl
("Unableo findhe IA_PD option definition.");

222 
code
 = 
D6O_IAADDR
;

223 ià(!
	`İtiÚ_code_hash_lookup
(&
Ÿaddr_İtiÚ
, 
dhıv6_univ”£
.
code_hash
,

224 &
code
, 0, 
MDL
))

225 
	`log_çl
("Unableo findhe IAADDR option definition.");

227 
code
 = 
D6O_IAPREFIX
;

228 ià(!
	`İtiÚ_code_hash_lookup
(&
Ÿ´efix_İtiÚ
,

229 
dhıv6_univ”£
.
code_hash
,

230 &
code
, 0, 
MDL
))

231 
	`log_çl
("Unableo findhe IAPREFIX option definition.");

233 
code
 = 
D6O_ORO
;

234 ià(!
	`İtiÚ_code_hash_lookup
(&
Üo_İtiÚ
, 
dhıv6_univ”£
.
code_hash
,

235 &
code
, 0, 
MDL
))

236 
	`log_çl
("Unableo findhe ORO option definition.");

238 
code
 = 
D6O_INFORMATION_REFRESH_TIME
;

239 ià(!
	`İtiÚ_code_hash_lookup
(&
œt_İtiÚ
, 
dhıv6_univ”£
.
code_hash
,

240 &
code
, 0, 
MDL
))

241 
	`log_çl
("Unableo findhe IRT option definition.");

243 #iâdeà
__CYGWIN32__


244 
	`’d£rv’t
();

246 
	}
}

267 
TIME


268 
	$dhc6_¿nd
(
TIME
 
ba£
)

270 
TIME
 
rv®
;

271 
TIME
 
¿nge
;

272 
TIME
 
¥l™
;

278 ià(
ba£
 <= 0)

279 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

286 
¥l™
 = (
ba£
 - 1) / 10;

289 ià(
¥l™
 == 0)

297 
¿nge
 = (
¥l™
 * 2) + 1;

300 
rv®
 = 
	`¿ndom
();

301 
rv®
 %ğ
¿nge
;

304 
rv®
 -ğ
¥l™
;

306  
rv®
;

307 
	}
}

311 
	$dhc6_»Œªs_š™
(
ş›Á_¡©e
 *
ş›Á
)

313 
xid
;

316 
ş›Á
->
txcouÁ
 = 0;

317 
ş›Á
->
RT
 = cl›Á->
IRT
 + 
	`dhc6_¿nd
(client->IRT);

321 #ià(
RAND_MAX
 >= 0x00ffffff)

322 
xid
 = 
	`¿ndom
();

323 #–ià(
RAND_MAX
 >= 0x0000ffff)

324 
xid
 = (
	`¿ndom
() << 16) ^„andom();

325 #–ià(
RAND_MAX
 >= 0x000000ff)

326 
xid
 = (
	`¿ndom
() << 16) ^ (random() << 8) ^„andom();

331 
ş›Á
->
dhıv6_Œª§ùiÚ_id
[0] = (
xid
 >> 16) & 0xff;

332 
ş›Á
->
dhıv6_Œª§ùiÚ_id
[1] = (
xid
 >> 8) & 0xff;

333 
ş›Á
->
dhıv6_Œª§ùiÚ_id
[2] = 
xid
 & 0xff;

334 
	}
}

338 
	$dhc6_»Œªs_advªû
(
ş›Á_¡©e
 *
ş›Á
)

340 
timev®
 
–­£d
, 
–­£d_¶us_¹
;

343 
–­£d
.
tv_£c
 = 
cur_tv
.tv_£ø- 
ş›Á
->
¡¬t_time
.tv_sec;

344 
–­£d
.
tv_u£c
 = 
cur_tv
.tv_u£ø- 
ş›Á
->
¡¬t_time
.tv_usec;

345 ià(
–­£d
.
tv_u£c
 < 0) {

346 
–­£d
.
tv_£c
 -= 1;

347 
–­£d
.
tv_u£c
 += 1000000;

351 
–­£d
.
tv_£c
 +ğ
ş›Á
->
RT
 / 100;

352 
–­£d
.
tv_u£c
 +ğ(
ş›Á
->
RT
 % 100) * 10000;

353 ià(
–­£d
.
tv_u£c
 >= 1000000) {

354 
–­£d
.
tv_£c
 += 1;

355 
–­£d
.
tv_u£c
 -= 1000000;

361 
–­£d_¶us_¹
.
tv_£c
 = 
–­£d
.tv_sec;

362 
–­£d_¶us_¹
.
tv_u£c
 = 
–­£d
.tv_usec;

370 
ş›Á
->
RT
 +ğş›Á->RT + 
	`dhc6_¿nd
(client->RT);

380 ià((
ş›Á
->
MRT
 !ğ0è&& (ş›Á->
RT
 > client->MRT))

381 
ş›Á
->
RT
 = cl›Á->
MRT
 + 
	`dhc6_¿nd
(client->MRT);

387 ià(
ş›Á
->
MRD
 == 0) {

389 
ş›Á
->
txcouÁ
++;

393 
–­£d
.
tv_£c
 +ğ
ş›Á
->
RT
 / 100;

394 
–­£d
.
tv_u£c
 +ğ(
ş›Á
->
RT
 % 100) * 10000;

395 ià(
–­£d
.
tv_u£c
 >= 1000000) {

396 
–­£d
.
tv_£c
 += 1;

397 
–­£d
.
tv_u£c
 -= 1000000;

399 ià(
–­£d
.
tv_£c
 >ğ
ş›Á
->
MRD
) {

406 
ş›Á
->
RT
 = cl›Á->
MRD
 - 
–­£d_¶us_¹
.
tv_£c
;

407 
ş›Á
->
RT
 = (client->RT * 100) -

408 (
–­£d_¶us_¹
.
tv_u£c
 / 10000);

409 ià(
ş›Á
->
RT
 < 0)

410 
ş›Á
->
RT
 = 0;

412 
ş›Á
->
txcouÁ
++;

413 
	}
}

417 
	$v®id_»¶y
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
)

419 
d©a_¡ršg
 
sid
, 
cid
;

420 
İtiÚ_ÿche
 *
oc
;

421 
rv®
 = 
ISC_TRUE
;

423 
	`mem£t
(&
sid
, 0, (sid));

424 
	`mem£t
(&
cid
, 0, (cid));

426 ià(!
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
·ck‘
->
İtiÚs
, 
D6O_SERVERID
)) {

427 
	`log_”rÜ
("Response without‡ server identifier„eceived.");

428 
rv®
 = 
ISC_FALSE
;

431 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
·ck‘
->
İtiÚs
, 
D6O_CLIENTID
);

432 ià(!
oc
 ||

433 !
	`ev®u©e_İtiÚ_ÿche
(&
sid
, 
·ck‘
, 
NULL
, 
ş›Á
,…ack‘->
İtiÚs
,

434 
ş›Á
->
£Á_İtiÚs
, &
glob®_scİe
, 
oc
,

435 
MDL
)) {

436 
	`log_”rÜ
("Response without‡ client identifier.");

437 
rv®
 = 
ISC_FALSE
;

440 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
ş›Á
->
£Á_İtiÚs
,

441 
D6O_CLIENTID
);

442 ià(!
oc
 ||

443 !
	`ev®u©e_İtiÚ_ÿche
(&
cid
, 
·ck‘
, 
NULL
, 
ş›Á
,

444 
ş›Á
->
£Á_İtiÚs
, 
NULL
, &
glob®_scİe
,

445 
oc
, 
MDL
)) {

446 
	`log_”rÜ
("Local client identifier is missing!");

447 
rv®
 = 
ISC_FALSE
;

450 ià(
sid
.
Ën
 == 0 ||

451 
sid
.
Ën
 !ğ
cid
.len ||

452 
	`memcmp
(
sid
.
d©a
, 
cid
.d©a, sid.
Ën
)) {

453 
	`log_”rÜ
("Advertise with matchingransaction ID, but "

455 
rv®
 = 
ISC_FALSE
;

459 ià(
sid
.
d©a
 !ğ
NULL
)

460 
	`d©a_¡ršg_fÜg‘
(&
sid
, 
MDL
);

461 ià(
cid
.
d©a
 !ğ
NULL
)

462 
	`d©a_¡ršg_fÜg‘
(&
cid
, 
MDL
);

464  
rv®
;

465 
	}
}

470 
dhc6_Ëa£
 *

471 
	$dhc6_dup_Ëa£
(
dhc6_Ëa£
 *
Ëa£
, cÚ¡ *
fe
, 
lše
)

473 
dhc6_Ëa£
 *
cİy
;

474 
dhc6_Ÿ
 **
š£¹_Ÿ
, *
Ÿ
;

476 
cİy
 = 
	`dm®loc
((*cİy), 
fe
, 
lše
);

477 ià(
cİy
 =ğ
NULL
) {

478 
	`log_”rÜ
("Out of memory for v6†ease structure.");

479  
NULL
;

482 
	`d©a_¡ršg_cİy
(&
cİy
->
£rv”_id
, &
Ëa£
->£rv”_id, 
fe
, 
lše
);

483 
cİy
->
´ef
 = 
Ëa£
->pref;

485 
	`memıy
(
cİy
->
dhıv6_Œª§ùiÚ_id
, 
Ëa£
->dhcpv6_transaction_id,

486 (
cİy
->
dhıv6_Œª§ùiÚ_id
));

488 
	`İtiÚ_¡©e_»ã»nû
(&
cİy
->
İtiÚs
, 
Ëa£
->İtiÚs, 
fe
, 
lše
);

490 
š£¹_Ÿ
 = &
cİy
->
bšdšgs
;

491 
Ÿ
 = 
Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

492 *
š£¹_Ÿ
 = 
	`dhc6_dup_Ÿ
(
Ÿ
, 
fe
, 
lše
);

494 ià(*
š£¹_Ÿ
 =ğ
NULL
) {

495 
	`dhc6_Ëa£_de¡roy
(&
cİy
, 
fe
, 
lše
);

496  
NULL
;

499 
š£¹_Ÿ
 = &(*š£¹_Ÿ)->
Ãxt
;

502  
cİy
;

503 
	}
}

508 
dhc6_Ÿ
 *

509 
	$dhc6_dup_Ÿ
(
dhc6_Ÿ
 *
Ÿ
, cÚ¡ *
fe
, 
lše
)

511 
dhc6_Ÿ
 *
cİy
;

512 
dhc6_addr
 **
š£¹_addr
, *
addr
;

514 
cİy
 = 
	`dm®loc
((*
Ÿ
), 
fe
, 
lše
);

515 ià(
cİy
 =ğ
NULL
) {

516 
	`log_”rÜ
("Out of memory for v6 duplicate IA structure.");

517  
NULL
;

520 
	`memıy
(
cİy
->
Ÿid
, 
Ÿ
->iaid, (copy->iaid));

522 
cİy
->
Ÿ_ty³
 = 
Ÿ
->ia_type;

523 
cİy
->
¡¬ts
 = 
Ÿ
->starts;

524 
cİy
->
»Ãw
 = 
Ÿ
->renew;

525 
cİy
->
»bšd
 = 
Ÿ
->rebind;

527 
š£¹_addr
 = &
cİy
->
addrs
;

528 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

529 *
š£¹_addr
 = 
	`dhc6_dup_addr
(
addr
, 
fe
, 
lše
);

531 ià(*
š£¹_addr
 =ğ
NULL
) {

532 
	`dhc6_Ÿ_de¡roy
(&
cİy
, 
fe
, 
lše
);

533  
NULL
;

536 
š£¹_addr
 = &(*š£¹_addr)->
Ãxt
;

539 ià(
Ÿ
->
İtiÚs
 !ğ
NULL
)

540 
	`İtiÚ_¡©e_»ã»nû
(&
cİy
->
İtiÚs
, 
Ÿ
->options,

541 
fe
, 
lše
);

543  
cİy
;

544 
	}
}

549 
dhc6_addr
 *

550 
	$dhc6_dup_addr
(
dhc6_addr
 *
addr
, cÚ¡ *
fe
, 
lše
)

552 
dhc6_addr
 *
cİy
;

554 
cİy
 = 
	`dm®loc
((*
addr
), 
fe
, 
lše
);

556 ià(
cİy
 =ğ
NULL
)

557  
NULL
;

559 
	`memıy
(&
cİy
->
add»ss
, &
addr
->address, (copy->address));

561 
cİy
->
¶’
 = 
addr
->plen;

562 
cİy
->
æags
 = 
addr
->flags;

563 
cİy
->
¡¬ts
 = 
addr
->starts;

564 
cİy
->
´eã¼ed_liã
 = 
addr
->preferred_life;

565 
cİy
->
max_liã
 = 
addr
->max_life;

567 ià(
addr
->
İtiÚs
 !ğ
NULL
)

568 
	`İtiÚ_¡©e_»ã»nû
(&
cİy
->
İtiÚs
, 
addr
->options,

569 
fe
, 
lše
);

571  
cİy
;

572 
	}
}

585 
dhc6_Ëa£
 *

586 
	$dhc6_Ëa£ify
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
* 
ş›Á
)

588 
d©a_¡ršg
 
ds
;

589 
dhc6_Ëa£
 *
Ëa£
;

590 
İtiÚ_ÿche
 *
oc
;

591 
code
;

593 
Ëa£
 = 
	`dm®loc
((*Ëa£), 
MDL
);

594 ià(
Ëa£
 =ğ
NULL
) {

595 
	`log_”rÜ
("Out of memory for v6†ease structure.");

596  
NULL
;

599 
	`memıy
(
Ëa£
->
dhıv6_Œª§ùiÚ_id
, 
·ck‘
->dhcpv6_transaction_id, 3);

600 
	`İtiÚ_¡©e_»ã»nû
(&
Ëa£
->
İtiÚs
, 
·ck‘
->İtiÚs, 
MDL
);

602 
	`mem£t
(&
ds
, 0, (ds));

605 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
Ëa£
->
İtiÚs
, 
D6O_PREFERENCE
);

606 ià(
oc
 &&

607 
	`ev®u©e_İtiÚ_ÿche
(&
ds
, 
·ck‘
, 
NULL
, NULL, 
Ëa£
->
İtiÚs
,

608 
NULL
, &
glob®_scİe
, 
oc
, 
MDL
)) {

609 ià(
ds
.
Ën
 != 1) {

610 
	`log_”rÜ
("Invalid†ength of DHCPv6 Preference option "

611 "(%d !ğ1)", 
ds
.
Ën
);

612 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

613 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

614  
NULL
;

616 
Ëa£
->
´ef
 = 
ds
.
d©a
[0];

617 
	`log_debug
("RCV: X-- Preference %u.",

618 ()
Ëa£
->
´ef
);

621 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

623 
	`d–‘e_İtiÚ
(&
dhıv6_univ”£
, 
Ëa£
->
İtiÚs
, 
D6O_PREFERENCE
);

633 
code
 = 
STATUS_Sucûss
;

634 ià((
	`dhc6_g‘_¡©us_code
(
Ëa£
->
İtiÚs
, &
code
, 
NULL
è=ğ
ISC_R_SUCCESS
)

636 ((
code
 =ğ
STATUS_NoAddrsAva
è|| (cod=ğ
STATUS_NoP»fixAva
))) {

637 
	`d–‘e_İtiÚ
(&
dhıv6_univ”£
, 
Ëa£
->
İtiÚs
,

638 
D6O_STATUS_CODE
);

645 ià(
	`dhc6_·r£_Ÿ_Ç
(&
Ëa£
->
bšdšgs
, 
·ck‘
,

646 
Ëa£
->
İtiÚs
, 
code
è!ğ
ISC_R_SUCCESS
) {

648 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

649  
NULL
;

655 ià(
	`dhc6_·r£_Ÿ_
(&
Ëa£
->
bšdšgs
, 
·ck‘
,

656 
Ëa£
->
İtiÚs
, 
code
è!ğ
ISC_R_SUCCESS
) {

658 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

659  
NULL
;

665 ià(
	`dhc6_·r£_Ÿ_pd
(&
Ëa£
->
bšdšgs
, 
·ck‘
,

666 
Ëa£
->
İtiÚs
, 
code
è!ğ
ISC_R_SUCCESS
) {

668 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

669  
NULL
;

678 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
·ck‘
->
İtiÚs
, 
D6O_SERVERID
);

679 ià((
oc
 =ğ
NULL
) ||

680 !
	`ev®u©e_İtiÚ_ÿche
(&
Ëa£
->
£rv”_id
, 
·ck‘
, 
NULL
, NULL,

681 
Ëa£
->
İtiÚs
, 
NULL
, &
glob®_scİe
,

682 
oc
, 
MDL
) ||

683 
Ëa£
->
£rv”_id
.
Ën
 == 0) {

686 
	`log_”rÜ
("Invalid SERVERID option cache.");

687 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

688  
NULL
;

690 
	`log_debug
("RCV: X-- Server ID: %s",

691 
	`´št_hex_1
(
Ëa£
->
£rv”_id
.
Ën
,

692 
Ëa£
->
£rv”_id
.
d©a
, 52));

695 
	`execu‹_¡©em’ts_š_scİe
(
NULL
, (
·ck‘
 *)packet, NULL,

696 
ş›Á
, 
Ëa£
->
İtiÚs
,†ease->options,

697 &
glob®_scİe
, 
ş›Á
->
cÚfig
->
Ú_»ût
,

698 
NULL
, NULL);

700  
Ëa£
;

701 
	}
}

703 
isc_»suÉ_t


704 
	$dhc6_·r£_Ÿ_Ç
(
dhc6_Ÿ
 **
pŸ
, 
·ck‘
 *packet,

705 
İtiÚ_¡©e
 *
İtiÚs
, 
code
)

707 
d©a_¡ršg
 
ds
;

708 
dhc6_Ÿ
 *
Ÿ
;

709 
İtiÚ_ÿche
 *
oc
;

710 
isc_»suÉ_t
 
»suÉ
;

711 
Ÿ_code
;

713 
	`mem£t
(&
ds
, 0, (ds));

715 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_IA_NA
);

716  ; 
oc
 !ğ
NULL
 ; oøğoc->
Ãxt
) {

717 
Ÿ
 = 
	`dm®loc
((*Ÿ), 
MDL
);

718 ià(
Ÿ
 =ğ
NULL
) {

719 
	`log_”rÜ
("Out of memory‡llocating IA_NA structure.");

720  
ISC_R_NOMEMORY
;

721 } ià(
	`ev®u©e_İtiÚ_ÿche
(&
ds
, 
·ck‘
, 
NULL
, NULL,

722 
İtiÚs
, 
NULL
,

723 &
glob®_scİe
, 
oc
, 
MDL
) &&

724 
ds
.
Ën
 >= 12) {

725 
	`memıy
(
Ÿ
->
Ÿid
, 
ds
.
d©a
, 4);

726 
Ÿ
->
Ÿ_ty³
 = 
D6O_IA_NA
;

727 
Ÿ
->
¡¬ts
 = 
cur_time
;

728 
Ÿ
->
»Ãw
 = 
	`g‘ULÚg
(
ds
.
d©a
 + 4);

729 
Ÿ
->
»bšd
 = 
	`g‘ULÚg
(
ds
.
d©a
 + 8);

731 
	`log_debug
("RCV: X-- IA_NA %s",

732 
	`´št_hex_1
(4, 
Ÿ
->
Ÿid
, 59));

734 
	`log_debug
("RCV: | X-- starts %u",

735 ()
Ÿ
->
¡¬ts
);

736 
	`log_debug
("RCV: | X--1 -„’ew +%u", 
Ÿ
->
»Ãw
);

737 
	`log_debug
("RCV: | X--2 -„ebšd +%u", 
Ÿ
->
»bšd
);

749 ià((
Ÿ
->
»Ãw
 > 0è&& (Ÿ->
»bšd
 > 0) &&

750 (
Ÿ
->
»Ãw
 > ia->
»bšd
)) {

751 
	`log_debug
("RCV: | !-- INVALID„enew/rebind "

753 
	`dä“
(
Ÿ
, 
MDL
);

754 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

758 ià(
ds
.
Ën
 > 12) {

759 
	`log_debug
("RCV: | X-- [Options]");

761 ià(!
	`İtiÚ_¡©e_®loÿ‹
(&
Ÿ
->
İtiÚs
,

762 
MDL
)) {

763 
	`log_”rÜ
("Out of memory‡llocating "

765 
	`dä“
(
Ÿ
, 
MDL
);

766 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

767  
ISC_R_NOMEMORY
;

770 ià(!
	`·r£_İtiÚ_bufãr
(
Ÿ
->
İtiÚs
,

771 
ds
.
d©a
 + 12,

772 
ds
.
Ën
 - 12,

773 &
dhıv6_univ”£
)) {

774 
	`log_”rÜ
("Corrupt IA_NA options.");

775 
	`İtiÚ_¡©e_d”eã»nû
(&
Ÿ
->
İtiÚs
,

776 
MDL
);

777 
	`dä“
(
Ÿ
, 
MDL
);

778 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

779  
DHCP_R_BADPARSE
;

782 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

784 ià(
Ÿ
->
İtiÚs
 !ğ
NULL
) {

785 
»suÉ
 = 
	`dhc6_·r£_addrs
(&
Ÿ
->
addrs
, 
·ck‘
,

786 
Ÿ
->
İtiÚs
);

787 ià(
»suÉ
 !ğ
ISC_R_SUCCESS
) {

788 
	`İtiÚ_¡©e_d”eã»nû
(&
Ÿ
->
İtiÚs
,

789 
MDL
);

790 
	`dä“
(
Ÿ
, 
MDL
);

791  
»suÉ
;

799 
Ÿ_code
 = 
STATUS_Sucûss
;

800 ià((
Ÿ
->
addrs
 =ğ
NULL
) ||

801 (
code
 =ğ
STATUS_NoAddrsAva
) ||

802 ((
Ÿ
->
İtiÚs
 !ğ
NULL
) &&

803 (
	`dhc6_g‘_¡©us_code
(
Ÿ
->
İtiÚs
, &
Ÿ_code
, 
NULL
)

804 =ğ
ISC_R_SUCCESS
) &&

805 (
Ÿ_code
 =ğ
STATUS_NoAddrsAva
))) {

806 
	`log_debug
("RCV: | !-- Status code of "

808 
	`dhc6_Ÿ_de¡roy
(&
Ÿ
, 
MDL
);

812 *
pŸ
 !ğ
NULL
)

813 
pŸ
 = &(*pŸ)->
Ãxt
;

814 *
pŸ
 = 
Ÿ
;

815 
pŸ
 = &
Ÿ
->
Ãxt
;

817 
	`log_”rÜ
("Invalid IA_NA option cache.");

818 
	`dä“
(
Ÿ
, 
MDL
);

819 ià(
ds
.
Ën
 != 0)

820 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

821  
ISC_R_UNEXPECTED
;

824 
	`d–‘e_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_IA_NA
);

826  
ISC_R_SUCCESS
;

827 
	}
}

829 
isc_»suÉ_t


830 
	$dhc6_·r£_Ÿ_
(
dhc6_Ÿ
 **
pŸ
, 
·ck‘
 *packet,

831 
İtiÚ_¡©e
 *
İtiÚs
, 
code
)

833 
d©a_¡ršg
 
ds
;

834 
dhc6_Ÿ
 *
Ÿ
;

835 
İtiÚ_ÿche
 *
oc
;

836 
isc_»suÉ_t
 
»suÉ
;

837 
Ÿ_code
;

839 
	`mem£t
(&
ds
, 0, (ds));

841 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_IA_TA
);

842  ; 
oc
 !ğ
NULL
 ; oøğoc->
Ãxt
) {

843 
Ÿ
 = 
	`dm®loc
((*Ÿ), 
MDL
);

844 ià(
Ÿ
 =ğ
NULL
) {

845 
	`log_”rÜ
("Out of memory‡llocating IA_TA structure.");

846  
ISC_R_NOMEMORY
;

847 } ià(
	`ev®u©e_İtiÚ_ÿche
(&
ds
, 
·ck‘
, 
NULL
, NULL,

848 
İtiÚs
, 
NULL
,

849 &
glob®_scİe
, 
oc
, 
MDL
) &&

850 
ds
.
Ën
 >= 4) {

851 
	`memıy
(
Ÿ
->
Ÿid
, 
ds
.
d©a
, 4);

852 
Ÿ
->
Ÿ_ty³
 = 
D6O_IA_TA
;

853 
Ÿ
->
¡¬ts
 = 
cur_time
;

855 
	`log_debug
("RCV: X-- IA_TA %s",

856 
	`´št_hex_1
(4, 
Ÿ
->
Ÿid
, 59));

858 
	`log_debug
("RCV: | X-- starts %u",

859 ()
Ÿ
->
¡¬ts
);

861 ià(
ds
.
Ën
 > 4) {

862 
	`log_debug
("RCV: | X-- [Options]");

864 ià(!
	`İtiÚ_¡©e_®loÿ‹
(&
Ÿ
->
İtiÚs
,

865 
MDL
)) {

866 
	`log_”rÜ
("Out of memory‡llocating "

868 
	`dä“
(
Ÿ
, 
MDL
);

869 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

870  
ISC_R_NOMEMORY
;

873 ià(!
	`·r£_İtiÚ_bufãr
(
Ÿ
->
İtiÚs
,

874 
ds
.
d©a
 + 4,

875 
ds
.
Ën
 - 4,

876 &
dhıv6_univ”£
)) {

877 
	`log_”rÜ
("Corrupt IA_TA options.");

878 
	`İtiÚ_¡©e_d”eã»nû
(&
Ÿ
->
İtiÚs
,

879 
MDL
);

880 
	`dä“
(
Ÿ
, 
MDL
);

881 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

882  
DHCP_R_BADPARSE
;

885 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

887 ià(
Ÿ
->
İtiÚs
 !ğ
NULL
) {

888 
»suÉ
 = 
	`dhc6_·r£_addrs
(&
Ÿ
->
addrs
, 
·ck‘
,

889 
Ÿ
->
İtiÚs
);

890 ià(
»suÉ
 !ğ
ISC_R_SUCCESS
) {

891 
	`İtiÚ_¡©e_d”eã»nû
(&
Ÿ
->
İtiÚs
,

892 
MDL
);

893 
	`dä“
(
Ÿ
, 
MDL
);

894  
»suÉ
;

902 
Ÿ_code
 = 
STATUS_Sucûss
;

903 ià((
Ÿ
->
addrs
 =ğ
NULL
) ||

904 (
code
 =ğ
STATUS_NoAddrsAva
) ||

905 ((
Ÿ
->
İtiÚs
 !ğ
NULL
) &&

906 (
	`dhc6_g‘_¡©us_code
(
Ÿ
->
İtiÚs
, &
Ÿ_code
, 
NULL
)

907 =ğ
ISC_R_SUCCESS
) &&

908 (
Ÿ_code
 =ğ
STATUS_NoAddrsAva
))) {

909 
	`log_debug
("RCV: | !-- Status code of "

911 
	`dhc6_Ÿ_de¡roy
(&
Ÿ
, 
MDL
);

915 *
pŸ
 !ğ
NULL
)

916 
pŸ
 = &(*pŸ)->
Ãxt
;

917 *
pŸ
 = 
Ÿ
;

918 
pŸ
 = &
Ÿ
->
Ãxt
;

920 
	`log_”rÜ
("Invalid IA_TA option cache.");

921 
	`dä“
(
Ÿ
, 
MDL
);

922 ià(
ds
.
Ën
 != 0)

923 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

924  
ISC_R_UNEXPECTED
;

927 
	`d–‘e_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_IA_TA
);

929  
ISC_R_SUCCESS
;

930 
	}
}

932 
isc_»suÉ_t


933 
	$dhc6_·r£_Ÿ_pd
(
dhc6_Ÿ
 **
pŸ
, 
·ck‘
 *packet,

934 
İtiÚ_¡©e
 *
İtiÚs
, 
code
)

936 
d©a_¡ršg
 
ds
;

937 
dhc6_Ÿ
 *
Ÿ
;

938 
İtiÚ_ÿche
 *
oc
;

939 
isc_»suÉ_t
 
»suÉ
;

940 
Ÿ_code
;

942 
	`mem£t
(&
ds
, 0, (ds));

944 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_IA_PD
);

945  ; 
oc
 !ğ
NULL
 ; oøğoc->
Ãxt
) {

946 
Ÿ
 = 
	`dm®loc
((*Ÿ), 
MDL
);

947 ià(
Ÿ
 =ğ
NULL
) {

948 
	`log_”rÜ
("Out of memory‡llocating IA_PD structure.");

949  
ISC_R_NOMEMORY
;

950 } ià(
	`ev®u©e_İtiÚ_ÿche
(&
ds
, 
·ck‘
, 
NULL
, NULL,

951 
İtiÚs
, 
NULL
,

952 &
glob®_scİe
, 
oc
, 
MDL
) &&

953 
ds
.
Ën
 >= 12) {

954 
	`memıy
(
Ÿ
->
Ÿid
, 
ds
.
d©a
, 4);

955 
Ÿ
->
Ÿ_ty³
 = 
D6O_IA_PD
;

956 
Ÿ
->
¡¬ts
 = 
cur_time
;

957 
Ÿ
->
»Ãw
 = 
	`g‘ULÚg
(
ds
.
d©a
 + 4);

958 
Ÿ
->
»bšd
 = 
	`g‘ULÚg
(
ds
.
d©a
 + 8);

960 
	`log_debug
("RCV: X-- IA_PD %s",

961 
	`´št_hex_1
(4, 
Ÿ
->
Ÿid
, 59));

963 
	`log_debug
("RCV: | X-- starts %u",

964 ()
Ÿ
->
¡¬ts
);

965 
	`log_debug
("RCV: | X--1 -„’ew +%u", 
Ÿ
->
»Ãw
);

966 
	`log_debug
("RCV: | X--2 -„ebšd +%u", 
Ÿ
->
»bšd
);

974 ià((
Ÿ
->
»Ãw
 > 0è&& (Ÿ->
»bšd
 > 0) &&

975 (
Ÿ
->
»Ãw
 > ia->
»bšd
)) {

976 
	`log_debug
("RCV: | !-- INVALID„enew/rebind "

978 
	`dä“
(
Ÿ
, 
MDL
);

979 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

983 ià(
ds
.
Ën
 > 12) {

984 
	`log_debug
("RCV: | X-- [Options]");

986 ià(!
	`İtiÚ_¡©e_®loÿ‹
(&
Ÿ
->
İtiÚs
,

987 
MDL
)) {

988 
	`log_”rÜ
("Out of memory‡llocating "

990 
	`dä“
(
Ÿ
, 
MDL
);

991 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

992  
ISC_R_NOMEMORY
;

995 ià(!
	`·r£_İtiÚ_bufãr
(
Ÿ
->
İtiÚs
,

996 
ds
.
d©a
 + 12,

997 
ds
.
Ën
 - 12,

998 &
dhıv6_univ”£
)) {

999 
	`log_”rÜ
("Corrupt IA_PD options.");

1000 
	`İtiÚ_¡©e_d”eã»nû
(&
Ÿ
->
İtiÚs
,

1001 
MDL
);

1002 
	`dä“
(
Ÿ
, 
MDL
);

1003 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1004  
DHCP_R_BADPARSE
;

1007 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1009 ià(
Ÿ
->
İtiÚs
 !ğ
NULL
) {

1010 
»suÉ
 = 
	`dhc6_·r£_´efixes
(&
Ÿ
->
addrs
,

1011 
·ck‘
,

1012 
Ÿ
->
İtiÚs
);

1013 ià(
»suÉ
 !ğ
ISC_R_SUCCESS
) {

1014 
	`İtiÚ_¡©e_d”eã»nû
(&
Ÿ
->
İtiÚs
,

1015 
MDL
);

1016 
	`dä“
(
Ÿ
, 
MDL
);

1017  
»suÉ
;

1025 
Ÿ_code
 = 
STATUS_Sucûss
;

1026 ià((
Ÿ
->
addrs
 =ğ
NULL
) ||

1027 (
code
 =ğ
STATUS_NoP»fixAva
) ||

1028 ((
Ÿ
->
İtiÚs
 !ğ
NULL
) &&

1029 (
	`dhc6_g‘_¡©us_code
(
Ÿ
->
İtiÚs
, &
Ÿ_code
, 
NULL
)

1030 =ğ
ISC_R_SUCCESS
) &&

1031 (
Ÿ_code
 =ğ
STATUS_NoP»fixAva
))) {

1032 
	`log_debug
("RCV: | !-- Status code of "

1034 
	`dhc6_Ÿ_de¡roy
(&
Ÿ
, 
MDL
);

1038 *
pŸ
 !ğ
NULL
)

1039 
pŸ
 = &(*pŸ)->
Ãxt
;

1040 *
pŸ
 = 
Ÿ
;

1041 
pŸ
 = &
Ÿ
->
Ãxt
;

1043 
	`log_”rÜ
("Invalid IA_PD option cache.");

1044 
	`dä“
(
Ÿ
, 
MDL
);

1045 ià(
ds
.
Ën
 != 0)

1046 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1047  
ISC_R_UNEXPECTED
;

1050 
	`d–‘e_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_IA_PD
);

1052  
ISC_R_SUCCESS
;

1053 
	}
}

1056 
isc_»suÉ_t


1057 
	$dhc6_·r£_addrs
(
dhc6_addr
 **
·ddr
, 
·ck‘
 *packet,

1058 
İtiÚ_¡©e
 *
İtiÚs
)

1060 
d©a_¡ršg
 
ds
;

1061 
İtiÚ_ÿche
 *
oc
;

1062 
dhc6_addr
 *
addr
;

1063 
isc_»suÉ_t
 
rv®
 = 
ISC_R_SUCCESS
;

1064 
code
;

1066 
	`mem£t
(&
ds
, 0, (ds));

1068 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_IAADDR
);

1069  ; 
oc
 !ğ
NULL
 ; oøğoc->
Ãxt
) {

1070 
addr
 = 
	`dm®loc
((*addr), 
MDL
);

1071 ià(
addr
 =ğ
NULL
) {

1072 
	`log_”rÜ
("Out of memory‡llocating "

1074  
ISC_R_NOMEMORY
;

1075 } ià(
	`ev®u©e_İtiÚ_ÿche
(&
ds
, 
·ck‘
, 
NULL
, NULL,

1076 
İtiÚs
, 
NULL
, &
glob®_scİe
,

1077 
oc
, 
MDL
) &&

1078 (
ds
.
Ën
 >= 24)) {

1080 
addr
->
add»ss
.
Ën
 = 16;

1081 
	`memıy
(
addr
->
add»ss
.
Ÿbuf
, 
ds
.
d©a
, 16);

1082 
addr
->
¡¬ts
 = 
cur_time
;

1083 
addr
->
´eã¼ed_liã
 = 
	`g‘ULÚg
(
ds
.
d©a
 + 16);

1084 
addr
->
max_liã
 = 
	`g‘ULÚg
(
ds
.
d©a
 + 20);

1086 
	`log_debug
("RCV: | | X-- IAADDR %s",

1087 
	`pŸddr
(
addr
->
add»ss
));

1088 
	`log_debug
("RCV: | | | X-- Preferred†ifetime %u.",

1089 
addr
->
´eã¼ed_liã
);

1090 
	`log_debug
("RCV: | | | X-- Max†ifetime %u.",

1091 
addr
->
max_liã
);

1097 ià((
addr
->
´eã¼ed_liã
 >‡ddr->
max_liã
)) {

1098 
	`log_debug
("RCV: | | | !-- INVALID†ifetimes, "

1101 
	`dä“
(
addr
, 
MDL
);

1102 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1110 ià(
ds
.
Ën
 > 24) {

1111 ià(!
	`İtiÚ_¡©e_®loÿ‹
(&
addr
->
İtiÚs
,

1112 
MDL
)) {

1113 
	`log_”rÜ
("Out of memory‡llocating "

1115 
	`dä“
(
addr
, 
MDL
);

1116 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1117  
ISC_R_NOMEMORY
;

1120 ià(!
	`·r£_İtiÚ_bufãr
(
addr
->
İtiÚs
,

1121 
ds
.
d©a
 + 24,

1122 
ds
.
Ën
 - 24,

1123 &
dhıv6_univ”£
)) {

1124 
	`log_”rÜ
("Corrupt IAADDR options.");

1125 
	`İtiÚ_¡©e_d”eã»nû
(&
addr
->
İtiÚs
,

1126 
MDL
);

1127 
	`dä“
(
addr
, 
MDL
);

1128 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1129  
DHCP_R_BADPARSE
;

1133 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1135 ià(
addr
->
İtiÚs
 !ğ
NULL
) {

1136 
	`log_debug
("RCV: | | | X-- [Options]");

1142 
code
 = 
STATUS_Sucûss
;

1143 
rv®
 = 
	`dhc6_check_¡©us
(
ISC_R_SUCCESS
,

1144 
addr
->
İtiÚs
,

1145 "IAADDR", &
code
);

1146 ià(
rv®
 !ğ
ISC_R_SUCCESS
) {

1147 
	`log_debug
("RCV: | | | X-- Status code"

1149 
	`İtiÚ_¡©e_d”eã»nû
(&
addr
->
İtiÚs
,

1150 
MDL
);

1151 
	`dä“
(
addr
, 
MDL
);

1156 *
·ddr
 = 
addr
;

1157 
·ddr
 = &
addr
->
Ãxt
;

1159 
	`log_”rÜ
("Invalid IAADDR option cache.");

1160 
	`dä“
(
addr
, 
MDL
);

1161 ià(
ds
.
Ën
 != 0)

1162 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1163  
ISC_R_UNEXPECTED
;

1166 
	`d–‘e_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_IAADDR
);

1168  
ISC_R_SUCCESS
;

1169 
	}
}

1171 
isc_»suÉ_t


1172 
	$dhc6_·r£_´efixes
(
dhc6_addr
 **
µfx
, 
·ck‘
 *packet,

1173 
İtiÚ_¡©e
 *
İtiÚs
)

1175 
d©a_¡ršg
 
ds
;

1176 
İtiÚ_ÿche
 *
oc
;

1177 
dhc6_addr
 *
pfx
;

1178 
isc_»suÉ_t
 
rv®
 = 
ISC_R_SUCCESS
;

1179 
code
;

1181 
	`mem£t
(&
ds
, 0, (ds));

1183 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_IAPREFIX
);

1184  ; 
oc
 !ğ
NULL
 ; oøğoc->
Ãxt
) {

1185 
pfx
 = 
	`dm®loc
((*pfx), 
MDL
);

1186 ià(
pfx
 =ğ
NULL
) {

1187 
	`log_”rÜ
("Out of memory‡llocating "

1189  
ISC_R_NOMEMORY
;

1190 } ià(
	`ev®u©e_İtiÚ_ÿche
(&
ds
, 
·ck‘
, 
NULL
, NULL,

1191 
İtiÚs
, 
NULL
, &
glob®_scİe
,

1192 
oc
, 
MDL
) &&

1193 (
ds
.
Ën
 >= 25)) {

1195 
pfx
->
´eã¼ed_liã
 = 
	`g‘ULÚg
(
ds
.
d©a
);

1196 
pfx
->
max_liã
 = 
	`g‘ULÚg
(
ds
.
d©a
 + 4);

1197 
pfx
->
¶’
 = 
	`g‘UCh¬
(
ds
.
d©a
 + 8);

1198 
pfx
->
add»ss
.
Ën
 = 16;

1199 
	`memıy
(
pfx
->
add»ss
.
Ÿbuf
, 
ds
.
d©a
 + 9, 16);

1200 
pfx
->
¡¬ts
 = 
cur_time
;

1202 
	`log_debug
("RCV: | | X-- IAPREFIX %s/%d",

1203 
	`pŸddr
(
pfx
->
add»ss
), (ífx->
¶’
);

1204 
	`log_debug
("RCV: | | | X-- Preferred†ifetime %u.",

1205 
pfx
->
´eã¼ed_liã
);

1206 
	`log_debug
("RCV: | | | X-- Max†ifetime %u.",

1207 
pfx
->
max_liã
);

1210 ià((
pfx
->
¶’
 < 4) || (pfx->plen > 128)) {

1211 
	`log_debug
("RCV: | | | !-- INVALID…refix "

1214 
	`dä“
(
pfx
, 
MDL
);

1215 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1222 ià((
pfx
->
´eã¼ed_liã
 >…fx->
max_liã
)) {

1223 
	`log_debug
("RCV: | | | !-- INVALID†ifetimes, "

1226 
	`dä“
(
pfx
, 
MDL
);

1227 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1235 ià(
ds
.
Ën
 > 25) {

1236 ià(!
	`İtiÚ_¡©e_®loÿ‹
(&
pfx
->
İtiÚs
,

1237 
MDL
)) {

1238 
	`log_”rÜ
("Out of memory‡llocating "

1240 
	`dä“
(
pfx
, 
MDL
);

1241 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1242  
ISC_R_NOMEMORY
;

1245 ià(!
	`·r£_İtiÚ_bufãr
(
pfx
->
İtiÚs
,

1246 
ds
.
d©a
 + 25,

1247 
ds
.
Ën
 - 25,

1248 &
dhıv6_univ”£
)) {

1249 
	`log_”rÜ
("Corrupt IAPREFIX options.");

1250 
	`İtiÚ_¡©e_d”eã»nû
(&
pfx
->
İtiÚs
,

1251 
MDL
);

1252 
	`dä“
(
pfx
, 
MDL
);

1253 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1254  
DHCP_R_BADPARSE
;

1258 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1260 ià(
pfx
->
İtiÚs
 !ğ
NULL
) {

1261 
	`log_debug
("RCV: | | | X-- [Options]");

1267 
code
 = 
STATUS_Sucûss
;

1268 
rv®
 = 
	`dhc6_check_¡©us
(
ISC_R_SUCCESS
,

1269 
pfx
->
İtiÚs
,

1270 "IAPREFIX", &
code
);

1271 ià(
rv®
 !ğ
ISC_R_SUCCESS
) {

1272 
	`log_debug
("RCV: | | | X-- Status code"

1274 
	`İtiÚ_¡©e_d”eã»nû
(&
pfx
->
İtiÚs
,

1275 
MDL
);

1276 
	`dä“
(
pfx
, 
MDL
);

1281 *
µfx
 = 
pfx
;

1282 
µfx
 = &
pfx
->
Ãxt
;

1284 
	`log_”rÜ
("Invalid IAPREFIX option cache.");

1285 
	`dä“
(
pfx
, 
MDL
);

1286 ià(
ds
.
Ën
 != 0)

1287 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1288  
ISC_R_UNEXPECTED
;

1291 
	`d–‘e_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_IAPREFIX
);

1293  
ISC_R_SUCCESS
;

1294 
	}
}

1298 
	$dhc6_Ëa£_de¡roy
(
dhc6_Ëa£
 **
¤c
, cÚ¡ *
fe
, 
lše
)

1300 
dhc6_Ÿ
 *
Ÿ
, *
nŸ
;

1301 
dhc6_Ëa£
 *
Ëa£
;

1303 ià(
¤c
 =ğ
NULL
 || *src == NULL) {

1304 
	`log_”rÜ
("Attempto destroy‚ull†ease.");

1307 
Ëa£
 = *
¤c
;

1309 ià(
Ëa£
->
£rv”_id
.
Ën
 != 0)

1310 
	`d©a_¡ršg_fÜg‘
(&
Ëa£
->
£rv”_id
, 
fe
, 
lše
);

1312 
Ÿ
 = 
Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğ
nŸ
) {

1313 
nŸ
 = 
Ÿ
->
Ãxt
;

1315 
	`dhc6_Ÿ_de¡roy
(&
Ÿ
, 
fe
, 
lše
);

1318 ià(
Ëa£
->
İtiÚs
 !ğ
NULL
)

1319 
	`İtiÚ_¡©e_d”eã»nû
(&
Ëa£
->
İtiÚs
, 
fe
, 
lše
);

1321 
	`dä“
(
Ëa£
, 
fe
, 
lše
);

1322 *
¤c
 = 
NULL
;

1323 
	}
}

1330 
	$dhc6_Ÿ_de¡roy
(
dhc6_Ÿ
 **
¤c
, cÚ¡ *
fe
, 
lše
)

1332 
dhc6_addr
 *
addr
, *
Çddr
;

1333 
dhc6_Ÿ
 *
Ÿ
;

1335 ià(
¤c
 =ğ
NULL
 || *src == NULL) {

1336 
	`log_”rÜ
("Attempto destroy‚ull IA.");

1339 
Ÿ
 = *
¤c
;

1341 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğ
Çddr
) {

1342 
Çddr
 = 
addr
->
Ãxt
;

1344 ià(
addr
->
İtiÚs
 !ğ
NULL
)

1345 
	`İtiÚ_¡©e_d”eã»nû
(&
addr
->
İtiÚs
, 
fe
, 
lše
);

1347 
	`dä“
(
addr
, 
fe
, 
lše
);

1350 ià(
Ÿ
->
İtiÚs
 !ğ
NULL
)

1351 
	`İtiÚ_¡©e_d”eã»nû
(&
Ÿ
->
İtiÚs
, 
fe
, 
lše
);

1353 
	`dä“
(
Ÿ
, 
fe
, 
lše
);

1354 *
¤c
 = 
NULL
;

1355 
	}
}

1362 
	$š£¹_Ëa£
(
dhc6_Ëa£
 **
h—d
, dhc6_Ëa£ *
Ãw
)

1364 *
h—d
 !ğ
NULL
) {

1365 ià((*
h—d
)->
£rv”_id
.
Ën
 =ğ
Ãw
->server_id.len &&

1366 
	`memcmp
((*
h—d
)->
£rv”_id
.
d©a
, 
Ãw
->server_id.data,

1367 
Ãw
->
£rv”_id
.
Ën
) == 0) {

1368 
Ãw
->
Ãxt
 = (*
h—d
)->next;

1369 
	`dhc6_Ëa£_de¡roy
(
h—d
, 
MDL
);

1373 
h—d
ğ&(*h—d)->
Ãxt
;

1376 *
h—d
 = 
Ãw
;

1378 
	}
}

1402 #ifdeà
USE_ORIGINAL_CLIENT_LEASE_WEIGHTS


1403 
	#SCORE_BINDING
 50

	)

1404 
	#SCORE_ADDRESS
 100

	)

1406 
	#SCORE_BINDING
 10000

	)

1407 
	#SCORE_ADDRESS
 100

	)

1410 
	#SCORE_OPTION
 1

	)

1412 
	#SCORE_MIN
 (
SCORE_BINDING
 + 
SCORE_ADDRESS
)

	)

1415 
	$dhc6_scÜe_Ëa£
(
ş›Á_¡©e
 *
ş›Á
, 
dhc6_Ëa£
 *
Ëa£
)

1417 
dhc6_Ÿ
 *
Ÿ
;

1418 
dhc6_addr
 *
addr
;

1419 
İtiÚ
 **
»q
;

1420 
i
;

1422 ià(
Ëa£
->
scÜe
)

1423  
Ëa£
->
scÜe
;

1425 
Ëa£
->
scÜe
 = 
SCORE_OPTION
;

1429 
»q
 = 
ş›Á
->
cÚfig
->
»quœed_İtiÚs
;

1430 ià(
»q
 !ğ
NULL
) {

1431 
i
 = 0 ; 
»q
[i] !ğ
NULL
 ; i++) {

1432 ià(
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
Ëa£
->
İtiÚs
,

1433 
»q
[
i
]->
code
è=ğ
NULL
) {

1434 
Ëa£
->
scÜe
 = 0;

1435  
Ëa£
->
scÜe
;

1441 
»q
 = 
ş›Á
->
cÚfig
->
»que¡ed_İtiÚs
;

1442 ià(
»q
 !ğ
NULL
) {

1443 
i
 = 0 ; 
»q
[i] !ğ
NULL
 ; i++) {

1444 ià(
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
Ëa£
->
İtiÚs
,

1445 
»q
[
i
]->
code
è!ğ
NULL
)

1446 
Ëa£
->
scÜe
 +ğ
SCORE_OPTION
;

1450 
Ÿ
 = 
Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

1451 
Ëa£
->
scÜe
 +ğ
SCORE_BINDING
;

1453 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

1454 
Ëa£
->
scÜe
 +ğ
SCORE_ADDRESS
;

1458  
Ëa£
->
scÜe
;

1459 
	}
}

1466 
	$¡¬t_š™6
(
ş›Á_¡©e
 *
ş›Á
)

1468 
timev®
 
tv
;

1470 
	`log_debug
("PRC: Soliciting for†eases (INIT).");

1471 
ş›Á
->
¡©e
 = 
S_INIT
;

1474 
ş›Á
->
IRT
 = 
SOL_TIMEOUT
 * 100;

1475 
ş›Á
->
MRT
 = 
SOL_MAX_RT
 * 100;

1476 
ş›Á
->
MRC
 = 0;

1478 ià(!
Ú‘ry
)

1479 
ş›Á
->
MRD
 = 0;

1481 
ş›Á
->
MRD
 = cl›Á->
cÚfig
->
timeout
;

1483 
	`dhc6_»Œªs_š™
(
ş›Á
);

1491 ià(
ş›Á
->
RT
 <ğş›Á->
IRT
)

1492 
ş›Á
->
RT
 = cl›Á->
IRT
 + (client->IRT - client->RT);

1494 ià(
ş›Á
->
RT
 <ğş›Á->
IRT
)

1495 
ş›Á
->
RT
 = cl›Á->
IRT
 + 1;

1497 
ş›Á
->
v6_hªdËr
 = 
š™_hªdËr
;

1504 
tv
.
tv_£c
 = 
cur_tv
.tv_sec;

1505 
tv
.
tv_u£c
 = 
cur_tv
.tv_usec;

1506 
tv
.
tv_u£c
 +ğ(
	`¿ndom
(è% (
SOL_MAX_DELAY
 * 100)) * 10000;

1507 ià(
tv
.
tv_u£c
 >= 1000000) {

1508 
tv
.
tv_£c
 += 1;

1509 
tv
.
tv_u£c
 -= 1000000;

1511 
	`add_timeout
(&
tv
, 
do_š™6
, 
ş›Á
, 
NULL
, NULL);

1513 ià(
nowa™
)

1514 
	`d‘ach
();

1515 
	}
}

1522 
	$¡¬t_šfo_»que¡6
(
ş›Á_¡©e
 *
ş›Á
)

1524 
timev®
 
tv
;

1526 
	`log_debug
("PRC: Requesting information (INIT).");

1527 
ş›Á
->
¡©e
 = 
S_INIT
;

1530 
ş›Á
->
IRT
 = 
INF_TIMEOUT
 * 100;

1531 
ş›Á
->
MRT
 = 
INF_MAX_RT
 * 100;

1532 
ş›Á
->
MRC
 = 0;

1534 ià(!
Ú‘ry
)

1535 
ş›Á
->
MRD
 = 0;

1537 
ş›Á
->
MRD
 = cl›Á->
cÚfig
->
timeout
;

1539 
	`dhc6_»Œªs_š™
(
ş›Á
);

1541 
ş›Á
->
v6_hªdËr
 = 
šfo_»que¡_hªdËr
;

1548 
tv
.
tv_£c
 = 
cur_tv
.tv_sec;

1549 
tv
.
tv_u£c
 = 
cur_tv
.tv_usec;

1550 
tv
.
tv_u£c
 +ğ(
	`¿ndom
(è% (
INF_MAX_DELAY
 * 100)) * 10000;

1551 ià(
tv
.
tv_u£c
 >= 1000000) {

1552 
tv
.
tv_£c
 += 1;

1553 
tv
.
tv_u£c
 -= 1000000;

1555 
	`add_timeout
(&
tv
, 
do_šfo_»que¡6
, 
ş›Á
, 
NULL
, NULL);

1557 ià(
nowa™
)

1558 
	`d‘ach
();

1559 
	}
}

1567 
	$¡¬t_cÚfœm6
(
ş›Á_¡©e
 *
ş›Á
)

1569 
timev®
 
tv
;

1572 ià((
ş›Á
->
aùive_Ëa£
 =ğ
NULL
) ||

1573 !
	`aùive_´efix
(
ş›Á
) ||

1574 
ş›Á
->
aùive_Ëa£
->
»Ëa£d
 ||

1575 !
	`uÃxpœed_add»ss_š_Ëa£
(
ş›Á
->
aùive_Ëa£
)) {

1576 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
aùive_Ëa£
, 
MDL
);

1577 
	`¡¬t_š™6
(
ş›Á
);

1581 
	`log_debug
("PRC: Confirming‡ctive†ease (INIT-REBOOT).");

1582 
ş›Á
->
¡©e
 = 
S_REBOOTING
;

1585 
ş›Á
->
IRT
 = 
CNF_TIMEOUT
 * 100;

1586 
ş›Á
->
MRT
 = 
CNF_MAX_RT
 * 100;

1587 
ş›Á
->
MRC
 = 0;

1588 
ş›Á
->
MRD
 = 
CNF_MAX_RD
;

1590 
	`dhc6_»Œªs_š™
(
ş›Á
);

1592 
ş›Á
->
v6_hªdËr
 = 
»¶y_hªdËr
;

1599 
tv
.
tv_£c
 = 
cur_tv
.tv_sec;

1600 
tv
.
tv_u£c
 = 
cur_tv
.tv_usec;

1601 
tv
.
tv_u£c
 +ğ(
	`¿ndom
(è% (
CNF_MAX_DELAY
 * 100)) * 10000;

1602 ià(
tv
.
tv_u£c
 >= 1000000) {

1603 
tv
.
tv_£c
 += 1;

1604 
tv
.
tv_u£c
 -= 1000000;

1614 ià((
wª‹d_Ÿ_pd
 != 0) ||

1615 (
	`dhc6_couÁ_Ÿ
(
ş›Á
->
aùive_Ëa£
, 
D6O_IA_PD
) != 0) ||

1616 (
	`dhc6_couÁ_Ÿ
(
ş›Á
->
aùive_Ëa£
, 
D6O_IA_NA
è< 
wª‹d_Ÿ_Ç
) ||

1617 (
	`dhc6_couÁ_Ÿ
(
ş›Á
->
aùive_Ëa£
, 
D6O_IA_TA
è< 
wª‹d_Ÿ_
)) {

1618 
ş›Á
->
¡©e
 = 
S_REBINDING
;

1619 
ş›Á
->
»äesh_ty³
 = 
DHCPV6_REBIND
;

1620 
	`add_timeout
(&
tv
, 
do_»äesh6
, 
ş›Á
, 
NULL
, NULL);

1622 
	`add_timeout
(&
tv
, 
do_cÚfœm6
, 
ş›Á
, 
NULL
, NULL);

1623 
	}
}

1629 
	#CHK_TIM_SUCCESS
 0

	)

1630 
	#CHK_TIM_MRC_EXCEEDED
 1

	)

1631 
	#CHK_TIM_MRD_EXCEEDED
 2

	)

1632 
	#CHK_TIM_ALLOC_FAILURE
 3

	)

1635 
	$check_timšg6
 (
ş›Á_¡©e
 *
ş›Á
, 
u_št8_t
 
msg_ty³
,

1636 *
msg_¡r
, 
dhc6_Ëa£
 *
Ëa£
,

1637 
d©a_¡ršg
 *
ds
)

1639 
timev®
 
–­£d
;

1644 ià(
ş›Á
->
txcouÁ
 == 0) {

1645 
ş›Á
->
¡¬t_time
.
tv_£c
 = 
cur_tv
.tv_sec;

1646 
ş›Á
->
¡¬t_time
.
tv_u£c
 = 
cur_tv
.tv_usec;

1647 } ià((
ş›Á
->
MRC
 !ğ0è&& (ş›Á->
txcouÁ
 > client->MRC)) {

1648 
	`log_šfo
("Max„etransmission countƒxceeded.");

1649 (
CHK_TIM_MRC_EXCEEDED
);

1653 
–­£d
.
tv_£c
 = 
cur_tv
.tv_£ø- 
ş›Á
->
¡¬t_time
.tv_sec;

1654 
–­£d
.
tv_u£c
 = 
cur_tv
.tv_u£ø- 
ş›Á
->
¡¬t_time
.tv_usec;

1655 ià(
–­£d
.
tv_u£c
 < 0) {

1656 
–­£d
.
tv_£c
 -= 1;

1657 
–­£d
.
tv_u£c
 += 1000000;

1661 ià((
ş›Á
->
MRD
 !ğ0è&& (
–­£d
.
tv_£c
 >= client->MRD)) {

1662 
	`log_šfo
("Max„etransmission durationƒxceeded.");

1663 (
CHK_TIM_MRD_EXCEEDED
);

1666 
	`mem£t
(
ds
, 0, (*ds));

1667 ià(!
	`bufãr_®loÿ‹
(&(
ds
->
bufãr
), 4, 
MDL
)) {

1668 
	`log_”rÜ
("UÇbËØ®loÿ‹ memÜy fÜ %s.", 
msg_¡r
);

1669 (
CHK_TIM_ALLOC_FAILURE
);

1671 
ds
->
d©a
 = ds->
bufãr
->data;

1672 
ds
->
Ën
 = 4;

1674 
ds
->
bufãr
->
d©a
[0] = 
msg_ty³
;

1675 
	`memıy
(
ds
->
bufãr
->
d©a
 + 1, 
ş›Á
->
dhıv6_Œª§ùiÚ_id
, 3);

1679 ià((
–­£d
.
tv_£c
 < 0) || (elapsed.tv_sec > 655) ||

1680 ((
–­£d
.
tv_£c
 =ğ655è&& (–­£d.
tv_u£c
 > 350000))) {

1681 
ş›Á
->
–­£d
 = 0xffff;

1683 
ş›Á
->
–­£d
 =ƒÏp£d.
tv_£c
 * 100;

1684 
ş›Á
->
–­£d
 +ğ–­£d.
tv_u£c
 / 10000;

1687 ià(
ş›Á
->
–­£d
 == 0)

1688 
	`log_debug
("XMT: FÜmšg %s, 0 m –­£d.", 
msg_¡r
);

1690 
	`log_debug
("XMT: FÜmšg %s, %u0 m –­£d.", 
msg_¡r
,

1691 ()
ş›Á
->
–­£d
);

1693 
ş›Á
->
–­£d
 = 
	`htÚs
(client->elapsed);

1695 
	`make_ş›Á6_İtiÚs
(
ş›Á
, &ş›Á->
£Á_İtiÚs
, 
Ëa£
, 
msg_ty³
);

1697 (
CHK_TIM_SUCCESS
);

1698 
	}
}

1713 
isc_»suÉ_t


1714 
	$dhc6_ü—‹_Ÿid
(
ş›Á_¡©e
 *
ş›Á
,

1715 
d©a_¡ršg
 *
Ÿ
,

1716 
idx
,

1717 
Ën
)

1719 
¡¬t_idx
, 
cİy_Ën
;

1721 
	`mem£t
(
Ÿ
, 0, (*ia));

1722 ià(!
	`bufãr_®loÿ‹
(&
Ÿ
->
bufãr
, 
Ën
, 
MDL
)) {

1723  (
ISC_R_NOMEMORY
);

1725 
Ÿ
->
d©a
 = ia->
bufãr
->data;

1726 
Ÿ
->
Ën
 =†en;

1732 ià(
ş›Á
->
š‹rçû
->
hw_add»ss
.
hËn
 > 4) {

1733 
¡¬t_idx
 = 
ş›Á
->
š‹rçû
->
hw_add»ss
.
hËn
 - 4;

1734 
cİy_Ën
 = 4;

1736 
¡¬t_idx
 = 0;

1737 
cİy_Ën
 = 
ş›Á
->
š‹rçû
->
hw_add»ss
.
hËn
;

1739 
	`memıy
(
Ÿ
->
bufãr
->
d©a
,

1740 
ş›Á
->
š‹rçû
->
hw_add»ss
.
hbuf
 + 
¡¬t_idx
,

1741 
cİy_Ën
);

1742 ià(
idx
)

1743 
Ÿ
->
bufãr
->
d©a
[3] +ğ
idx
;

1745  (
ISC_R_SUCCESS
);

1746 
	}
}

1766 
isc_»suÉ_t


1767 
	$dhc6_b¬e_Ÿ_xx
(
ş›Á_¡©e
 *
ş›Á
,

1768 
d©a_¡ršg
 *
·ck‘
,

1769 
wª‹d
,

1770 
u_št16_t
 
Ÿ_ty³
)

1772 
dhc6_Ÿ
 *
Şd_Ÿ
;

1773 
d©a_¡ršg
 
Ÿ
;

1774 
u_št32_t
 
t1
, 
t2
;

1775 
i
, 
Ën
;

1776 
isc_»suÉ_t
 
rv®
;

1777 *
ty³_¡ršg
;

1778 
İtiÚ
 *
ty³_İtiÚ
;

1781 
Ÿ_ty³
) {

1782 
D6O_IA_NA
:

1783 
ty³_¡ršg
 = "IA_NA";

1784 
ty³_İtiÚ
 = 
Ÿ_Ç_İtiÚ
;

1785 
Ën
 = 
IA_NA_OFFSET
;

1787 
D6O_IA_TA
:

1788 
ty³_¡ršg
 = "IA_TA";

1789 
ty³_İtiÚ
 = 
Ÿ__İtiÚ
;

1790 
Ën
 = 
IA_TA_OFFSET
;

1792 
D6O_IA_PD
:

1793 
ty³_¡ršg
 = "IA_PD";

1794 
ty³_İtiÚ
 = 
Ÿ_pd_İtiÚ
;

1795 
Ën
 = 
IA_PD_OFFSET
;

1796 ià(
´efix_Ën_hšt
 > 0) {

1797 
Ën
 +ğ
IASUBOPT_PD_LEN
;

1802  (
ISC_R_FAILURE
);

1805 
i
 = 0; 
wª‹d
 != 0; i++) {

1806 
rv®
 = 
	`dhc6_ü—‹_Ÿid
(
ş›Á
, &
Ÿ
, 
i
, 
Ën
);

1807 ià(
rv®
 !ğ
ISC_R_SUCCESS
) {

1808 
	`log_”rÜ
("Unableo‡llocate memory for %s.",

1809 
ty³_¡ršg
);

1810  (
rv®
);

1814 ià((
ş›Á
->
aùive_Ëa£
 !ğ
NULL
) &&

1815 ((
Şd_Ÿ
 = 
	`fšd_Ÿ
(
ş›Á
->
aùive_Ëa£
->
bšdšgs
,

1816 
Ÿ_ty³
,

1817 (*)
Ÿ
.
bufãr
->
d©a
)è!ğ
NULL
)) {

1818 
	`d©a_¡ršg_fÜg‘
(&
Ÿ
, 
MDL
);

1823 
	`log_debug
("XMT: X-- %s %s",

1824 
ty³_¡ršg
, 
	`´št_hex_1
(4, 
Ÿ
.
bufãr
->
d©a
, 55));

1829 ià(
Ÿ_ty³
 !ğ
D6O_IA_TA
) {

1830 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
 / 2;

1831 
t2
 = 
t1
 + (t1 / 2);

1832 
	`putULÚg
(
Ÿ
.
bufãr
->
d©a
 + 4, 
t1
);

1833 
	`putULÚg
(
Ÿ
.
bufãr
->
d©a
 + 8, 
t2
);

1835 
	`log_debug
("XMT: | X-- Request„enew in +%u",

1836 ()
t1
);

1837 
	`log_debug
("XMT: | X-- Request„ebind in +%u",

1838 ()
t2
);

1841 ià(
Ÿ_ty³
 =ğ
D6O_IA_PD
 && 
´efix_Ën_hšt
 > 0) {

1842 *
±r
 = 
Ÿ
.
bufãr
->
d©a
 + 
IA_NA_OFFSET
;

1843 
	`putUShÜt
(
±r
, 
D6O_IAPREFIX
);

1844 
±r
 += 2;

1845 
	`putUShÜt
(
±r
, 
IASUBOPT_PD_LEN
);

1846 
±r
 += 2;

1847 
	`putUCh¬
(
±r
 + 
IASUBOPT_PD_PREFLEN_OFFSET
,

1848 
´efix_Ën_hšt
);

1849 
	`log_debug
("XMT: | | X-- Request…refix ::/%u.",

1850 
´efix_Ën_hšt
);

1854 
	`­³nd_İtiÚ
(
·ck‘
, &
dhıv6_univ”£
, 
ty³_İtiÚ
, &
Ÿ
);

1855 
	`d©a_¡ršg_fÜg‘
(&
Ÿ
, 
MDL
);

1858 
wª‹d
--;

1861  (
ISC_R_SUCCESS
);

1862 
	}
}

1868 
	$do_š™6
(*
šput
)

1870 
ş›Á_¡©e
 *
ş›Á
;

1871 
dhc6_Ÿ
 *
Şd_Ÿ
;

1872 
dhc6_addr
 *
Şd_addr
;

1873 
d©a_¡ršg
 
ds
;

1874 
d©a_¡ršg
 
Ÿ
;

1875 
d©a_¡ršg
 
addr
;

1876 
timev®
 
tv
;

1877 
u_št32_t
 
t1
, 
t2
;

1878 
i
, 
£nd_»t
;

1880 
ş›Á
 = 
šput
;

1886 ià(
ş›Á
->
adv”ti£d_Ëa£s
 !ğ
NULL
) {

1887 
	`¡¬t_£Ëùšg6
(
ş›Á
);

1891 
	`check_timšg6
(
ş›Á
, 
DHCPV6_SOLICIT
, "SŞic™", 
NULL
, &
ds
)) {

1892 
CHK_TIM_MRC_EXCEEDED
:

1893 
CHK_TIM_ALLOC_FAILURE
:

1895 
CHK_TIM_MRD_EXCEEDED
:

1896 
ş›Á
->
¡©e
 = 
S_STOPPED
;

1897 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
) {

1898 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
aùive_Ëa£
, 
MDL
);

1899 
ş›Á
->
aùive_Ëa£
 = 
NULL
;

1902 ià(
	`¡İpšg_fšished
())

1903 
	`fšish
(2);

1910 
dhıv6_univ”£
.
	`’ÿpsuÏ‹
(&
ds
, 
NULL
, NULL, 
ş›Á
,

1911 
NULL
, 
ş›Á
->
£Á_İtiÚs
, &
glob®_scİe
,

1912 &
dhıv6_univ”£
);

1915 ià(
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
ş›Á
->
£Á_İtiÚs
,

1916 
D6O_RAPID_COMMIT
è!ğ
NULL
) {

1917 
ş›Á
->
v6_hªdËr
 = 
¿pid_comm™_hªdËr
;

1921 
i
 = 0; i < 
wª‹d_Ÿ_Ç
; i++) {

1927 ià(
	`dhc6_ü—‹_Ÿid
(
ş›Á
, &
Ÿ
, 
i
, 12è!ğ
ISC_R_SUCCESS
) {

1928 
	`log_”rÜ
("Unableo‡llocate memory for IA_NA.");

1929 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1933 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
 / 2;

1934 
t2
 = 
t1
 + (t1 / 2);

1935 
	`putULÚg
(
Ÿ
.
bufãr
->
d©a
 + 4, 
t1
);

1936 
	`putULÚg
(
Ÿ
.
bufãr
->
d©a
 + 8, 
t2
);

1938 
	`log_debug
("XMT: X-- IA_NA %s",

1939 
	`´št_hex_1
(4, 
Ÿ
.
bufãr
->
d©a
, 55));

1940 
	`log_debug
("XMT: | X-- Reque¡„’ew iÀ +%u", ()
t1
);

1941 
	`log_debug
("XMT: | X-- Reque¡„ebšd iÀ+%u", ()
t2
);

1943 ià((
ş›Á
->
aùive_Ëa£
 !ğ
NULL
) &&

1944 ((
Şd_Ÿ
 = 
	`fšd_Ÿ
(
ş›Á
->
aùive_Ëa£
->
bšdšgs
,

1945 
D6O_IA_NA
,

1946 (*)
Ÿ
.
bufãr
->
d©a
)è!ğ
NULL
)) {

1951 
	`mem£t
(&
addr
, 0, (addr));

1952 
Şd_addr
 = 
Şd_Ÿ
->
addrs
 ; old_add¸!ğ
NULL
 ;

1953 
Şd_addr
 = old_addr->
Ãxt
) {

1954 ià(
Şd_addr
->
add»ss
.
Ën
 != 16) {

1955 
	`log_”rÜ
("Invalid IPv6‡ddress "

1958 
Şd_addr
->
add»ss
.
Ën
,

1959 
MDL
);

1963 ià(!
	`bufãr_®loÿ‹
(&
addr
.
bufãr
, 24, 
MDL
)) {

1964 
	`log_”rÜ
("Unableo‡llocate memory "

1966 
	`d©a_¡ršg_fÜg‘
(&
Ÿ
, 
MDL
);

1967 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1970 
addr
.
d©a
 =‡ddr.
bufãr
->data;

1971 
addr
.
Ën
 = 24;

1973 
	`memıy
(
addr
.
bufãr
->
d©a
,

1974 
Şd_addr
->
add»ss
.
Ÿbuf
,

1977 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
;

1978 
t2
 = 
t1
 + (t1 / 2);

1979 
	`putULÚg
(
addr
.
bufãr
->
d©a
 + 16, 
t1
);

1980 
	`putULÚg
(
addr
.
bufãr
->
d©a
 + 20, 
t2
);

1982 
	`log_debug
("XMT: | X-- Request‡ddress %s.",

1983 
	`pŸddr
(
Şd_addr
->
add»ss
));

1984 
	`log_debug
("XMT: | | X-- Request "

1986 ()
t1
);

1987 
	`log_debug
("XMT: | | X-- Request valid "

1989 ()
t2
);

1991 
	`­³nd_İtiÚ
(&
Ÿ
, &
dhıv6_univ”£
,

1992 
Ÿaddr_İtiÚ
,

1993 &
addr
);

1995 
	`d©a_¡ršg_fÜg‘
(&
addr
, 
MDL
);

1999 
	`­³nd_İtiÚ
(&
ds
, &
dhıv6_univ”£
, 
Ÿ_Ç_İtiÚ
, &
Ÿ
);

2000 
	`d©a_¡ršg_fÜg‘
(&
Ÿ
, 
MDL
);

2004 
i
 = 0; i < 
wª‹d_Ÿ_
; i++) {

2010 ià(
	`dhc6_ü—‹_Ÿid
(
ş›Á
, &
Ÿ
, 
i
, 4è!ğ
ISC_R_SUCCESS
) {

2011 
	`log_”rÜ
("Unableo‡llocate memory for IA_TA.");

2012 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2016 
	`log_debug
("XMT: X-- IA_TA %s",

2017 
	`´št_hex_1
(4, 
Ÿ
.
bufãr
->
d©a
, 55));

2019 ià((
ş›Á
->
aùive_Ëa£
 !ğ
NULL
) &&

2020 ((
Şd_Ÿ
 = 
	`fšd_Ÿ
(
ş›Á
->
aùive_Ëa£
->
bšdšgs
,

2021 
D6O_IA_TA
,

2022 (*)
Ÿ
.
bufãr
->
d©a
)è!ğ
NULL
)) {

2027 
	`mem£t
(&
addr
, 0, (addr));

2028 
Şd_addr
 = 
Şd_Ÿ
->
addrs
 ; old_add¸!ğ
NULL
 ;

2029 
Şd_addr
 = old_addr->
Ãxt
) {

2030 ià(
Şd_addr
->
add»ss
.
Ën
 != 16) {

2031 
	`log_”rÜ
("Invalid IPv6‡ddress "

2034 
Şd_addr
->
add»ss
.
Ën
,

2035 
MDL
);

2039 ià(!
	`bufãr_®loÿ‹
(&
addr
.
bufãr
, 24, 
MDL
)) {

2040 
	`log_”rÜ
("Unableo‡llocate memory "

2042 
	`d©a_¡ršg_fÜg‘
(&
Ÿ
, 
MDL
);

2043 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2046 
addr
.
d©a
 =‡ddr.
bufãr
->data;

2047 
addr
.
Ën
 = 24;

2049 
	`memıy
(
addr
.
bufãr
->
d©a
,

2050 
Şd_addr
->
add»ss
.
Ÿbuf
,

2053 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
;

2054 
t2
 = 
t1
 + (t1 / 2);

2055 
	`putULÚg
(
addr
.
bufãr
->
d©a
 + 16, 
t1
);

2056 
	`putULÚg
(
addr
.
bufãr
->
d©a
 + 20, 
t2
);

2058 
	`log_debug
("XMT: | X-- Request‡ddress %s.",

2059 
	`pŸddr
(
Şd_addr
->
add»ss
));

2060 
	`log_debug
("XMT: | | X-- Request "

2062 ()
t1
);

2063 
	`log_debug
("XMT: | | X-- Request valid "

2065 ()
t2
);

2067 
	`­³nd_İtiÚ
(&
Ÿ
, &
dhıv6_univ”£
,

2068 
Ÿaddr_İtiÚ
,

2069 &
addr
);

2071 
	`d©a_¡ršg_fÜg‘
(&
addr
, 
MDL
);

2075 
	`­³nd_İtiÚ
(&
ds
, &
dhıv6_univ”£
, 
Ÿ__İtiÚ
, &
Ÿ
);

2076 
	`d©a_¡ršg_fÜg‘
(&
Ÿ
, 
MDL
);

2080 
i
 = 0; i < 
wª‹d_Ÿ_pd
; i++) {

2086 
	`mem£t
(&
Ÿ
, 0, (ia));

2087 ià(
	`dhc6_ü—‹_Ÿid
(
ş›Á
, &
Ÿ
, 
i
, 12è!ğ
ISC_R_SUCCESS
) {

2088 
	`log_”rÜ
("Unableo‡llocate memory for IA_PD.");

2089 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2093 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
 / 2;

2094 
t2
 = 
t1
 + (t1 / 2);

2095 
	`putULÚg
(
Ÿ
.
bufãr
->
d©a
 + 4, 
t1
);

2096 
	`putULÚg
(
Ÿ
.
bufãr
->
d©a
 + 8, 
t2
);

2098 
	`log_debug
("XMT: X-- IA_PD %s",

2099 
	`´št_hex_1
(4, 
Ÿ
.
bufãr
->
d©a
, 55));

2100 
	`log_debug
("XMT: | X-- Reque¡„’ew iÀ +%u", ()
t1
);

2101 
	`log_debug
("XMT: | X-- Reque¡„ebšd iÀ+%u", ()
t2
);

2103 ià((
ş›Á
->
aùive_Ëa£
 !ğ
NULL
) &&

2104 ((
Şd_Ÿ
 = 
	`fšd_Ÿ
(
ş›Á
->
aùive_Ëa£
->
bšdšgs
,

2105 
D6O_IA_PD
,

2106 (*)
Ÿ
.
bufãr
->
d©a
)è!ğ
NULL
)) {

2111 
	`mem£t
(&
addr
, 0, (addr));

2112 
Şd_addr
 = 
Şd_Ÿ
->
addrs
 ; old_add¸!ğ
NULL
 ;

2113 
Şd_addr
 = old_addr->
Ãxt
) {

2114 ià(
Şd_addr
->
add»ss
.
Ën
 != 16) {

2115 
	`log_”rÜ
("Invalid IPv6…refix, "

2117 
MDL
);

2121 ià(!
	`bufãr_®loÿ‹
(&
addr
.
bufãr
, 25, 
MDL
)) {

2122 
	`log_”rÜ
("Unableo‡llocate memory "

2124 
	`d©a_¡ršg_fÜg‘
(&
Ÿ
, 
MDL
);

2125 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2128 
addr
.
d©a
 =‡ddr.
bufãr
->data;

2129 
addr
.
Ën
 = 25;

2131 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
;

2132 
t2
 = 
t1
 + (t1 / 2);

2133 
	`putULÚg
(
addr
.
bufãr
->
d©a
, 
t1
);

2134 
	`putULÚg
(
addr
.
bufãr
->
d©a
 + 4, 
t2
);

2136 
	`putUCh¬
(
addr
.
bufãr
->
d©a
 + 8,

2137 
Şd_addr
->
¶’
);

2138 
	`memıy
(
addr
.
bufãr
->
d©a
 + 9,

2139 
Şd_addr
->
add»ss
.
Ÿbuf
,

2142 
	`log_debug
("XMT: | X-- Request…refix %s/%u.",

2143 
	`pŸddr
(
Şd_addr
->
add»ss
),

2144 (è
Şd_addr
->
¶’
);

2145 
	`log_debug
("XMT: | | X-- Request "

2147 ()
t1
);

2148 
	`log_debug
("XMT: | | X-- Request valid "

2150 ()
t2
);

2152 
	`­³nd_İtiÚ
(&
Ÿ
, &
dhıv6_univ”£
,

2153 
Ÿ´efix_İtiÚ
,

2154 &
addr
);

2156 
	`d©a_¡ršg_fÜg‘
(&
addr
, 
MDL
);

2158 } ià(
´efix_Ën_hšt
 > 0) {

2159 
	`mem£t
(&
addr
, 0, (addr));

2160 ià(!
	`bufãr_®loÿ‹
(&
addr
.
bufãr
, 25, 
MDL
)) {

2161 
	`log_”rÜ
("Unableo‡llocate memory "

2163 
	`d©a_¡ršg_fÜg‘
(&
Ÿ
, 
MDL
);

2164 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2168 
addr
.
d©a
 =‡ddr.
bufãr
->data;

2169 
addr
.
Ën
 = 25;

2171 
	`putUCh¬
(
addr
.
bufãr
->
d©a
 + 8, 
´efix_Ën_hšt
);

2172 
	`log_debug
("XMT: | | X-- Request…refix ::/%u.",

2173 
´efix_Ën_hšt
);

2174 
	`­³nd_İtiÚ
(&
Ÿ
, &
dhıv6_univ”£
, 
Ÿ´efix_İtiÚ
,

2175 &
addr
);

2176 
	`d©a_¡ršg_fÜg‘
(&
addr
, 
MDL
);

2179 
	`­³nd_İtiÚ
(&
ds
, &
dhıv6_univ”£
, 
Ÿ_pd_İtiÚ
, &
Ÿ
);

2180 
	`d©a_¡ršg_fÜg‘
(&
Ÿ
, 
MDL
);

2185 
	`log_šfo
("XMT: Solicit on %s, interval %ld0ms.",

2186 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name,

2187 ()
ş›Á
->
RT
);

2189 
£nd_»t
 = 
	`£nd_·ck‘6
(
ş›Á
->
š‹rçû
,

2190 
ds
.
d©a
, ds.
Ën
, &
DHCPv6De¡Addr
);

2191 ià(
£nd_»t
 !ğ
ds
.
Ën
) {

2192 
	`log_”rÜ
("dhc6: send_packet6() sent %d of %d bytes",

2193 
£nd_»t
, 
ds
.
Ën
);

2196 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2199 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
ş›Á
->
RT
 / 100;

2200 
tv
.
tv_u£c
 = 
cur_tv
.tv_u£ø+ (
ş›Á
->
RT
 % 100) * 10000;

2201 ià(
tv
.
tv_u£c
 >= 1000000) {

2202 
tv
.
tv_£c
 += 1;

2203 
tv
.
tv_u£c
 -= 1000000;

2205 
	`add_timeout
(&
tv
, 
do_š™6
, 
ş›Á
, 
NULL
, NULL);

2207 
	`dhc6_»Œªs_advªû
(
ş›Á
);

2208 
	}
}

2212 
	$do_šfo_»que¡6
(*
šput
)

2214 
ş›Á_¡©e
 *
ş›Á
;

2215 
d©a_¡ršg
 
ds
;

2216 
timev®
 
tv
;

2217 
£nd_»t
;

2219 
ş›Á
 = 
šput
;

2221 
	`check_timšg6
(
ş›Á
, 
DHCPV6_INFORMATION_REQUEST
,

2222 "Info-Reque¡", 
NULL
, &
ds
)) {

2223 
CHK_TIM_MRC_EXCEEDED
:

2224 
CHK_TIM_ALLOC_FAILURE
:

2226 
CHK_TIM_MRD_EXCEEDED
:

2227 
	`fšish
(2);

2228 
CHK_TIM_SUCCESS
:

2234 
dhıv6_univ”£
.
	`’ÿpsuÏ‹
(&
ds
, 
NULL
, NULL, 
ş›Á
,

2235 
NULL
, 
ş›Á
->
£Á_İtiÚs
, &
glob®_scİe
,

2236 &
dhıv6_univ”£
);

2240 
	`log_šfo
("XMT: Info-Request on %s, interval %ld0ms.",

2241 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name,

2242 ()
ş›Á
->
RT
);

2244 
£nd_»t
 = 
	`£nd_·ck‘6
(
ş›Á
->
š‹rçû
,

2245 
ds
.
d©a
, ds.
Ën
, &
DHCPv6De¡Addr
);

2246 ià(
£nd_»t
 !ğ
ds
.
Ën
) {

2247 
	`log_”rÜ
("dhc6: send_packet6() sent %d of %d bytes",

2248 
£nd_»t
, 
ds
.
Ën
);

2251 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2254 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
ş›Á
->
RT
 / 100;

2255 
tv
.
tv_u£c
 = 
cur_tv
.tv_u£ø+ (
ş›Á
->
RT
 % 100) * 10000;

2256 ià(
tv
.
tv_u£c
 >= 1000000) {

2257 
tv
.
tv_£c
 += 1;

2258 
tv
.
tv_u£c
 -= 1000000;

2260 
	`add_timeout
(&
tv
, 
do_šfo_»que¡6
, 
ş›Á
, 
NULL
, NULL);

2262 
	`dhc6_»Œªs_advªû
(
ş›Á
);

2263 
	}
}

2269 
	$do_cÚfœm6
(*
šput
)

2271 
ş›Á_¡©e
 *
ş›Á
;

2272 
d©a_¡ršg
 
ds
;

2273 
£nd_»t
, 
added
;

2274 
timev®
 
tv
;

2276 
ş›Á
 = 
šput
;

2278 ià(
ş›Á
->
aùive_Ëa£
 =ğ
NULL
)

2279 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

2295 
	`check_timšg6
(
ş›Á
, 
DHCPV6_CONFIRM
, "Confirm",

2296 
ş›Á
->
aùive_Ëa£
, &
ds
)) {

2297 
CHK_TIM_MRC_EXCEEDED
:

2298 
CHK_TIM_MRD_EXCEEDED
:

2299 
	`¡¬t_bound
(
ş›Á
);

2301 
CHK_TIM_ALLOC_FAILURE
:

2303 
CHK_TIM_SUCCESS
:

2309 
dhıv6_univ”£
.
	`’ÿpsuÏ‹
(&
ds
, 
NULL
, NULL, 
ş›Á
, NULL,

2310 
ş›Á
->
£Á_İtiÚs
, &
glob®_scİe
,

2311 &
dhıv6_univ”£
);

2314 ià(
wª‹d_Ÿ_Ç
 &&

2315 
	`dhc6_add_Ÿ_Ç
(
ş›Á
, &
ds
, cl›Á->
aùive_Ëa£
,

2316 
DHCPV6_CONFIRM
, 0, &
added
è!ğ
ISC_R_SUCCESS
) {

2317 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2320 ià(
wª‹d_Ÿ_
 &&

2321 
	`dhc6_add_Ÿ_
(
ş›Á
, &
ds
, cl›Á->
aùive_Ëa£
,

2322 
DHCPV6_CONFIRM
, 0, &
added
è!ğ
ISC_R_SUCCESS
) {

2323 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2329 
	`log_šfo
("XMT: Confirm on %s, interval %ld0ms.",

2330 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name,

2331 ()
ş›Á
->
RT
);

2333 
£nd_»t
 = 
	`£nd_·ck‘6
(
ş›Á
->
š‹rçû
, 
ds
.
d©a
, ds.
Ën
,

2334 &
DHCPv6De¡Addr
);

2335 ià(
£nd_»t
 !ğ
ds
.
Ën
) {

2336 
	`log_”rÜ
("dhc6: sendpacket6() sent %d of %d bytes",

2337 
£nd_»t
, 
ds
.
Ën
);

2340 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2343 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
ş›Á
->
RT
 / 100;

2344 
tv
.
tv_u£c
 = 
cur_tv
.tv_u£ø+ (
ş›Á
->
RT
 % 100) * 10000;

2345 ià(
tv
.
tv_u£c
 >= 1000000) {

2346 
tv
.
tv_£c
 += 1;

2347 
tv
.
tv_u£c
 -= 1000000;

2349 
	`add_timeout
(&
tv
, 
do_cÚfœm6
, 
ş›Á
, 
NULL
, NULL);

2351 
	`dhc6_»Œªs_advªû
(
ş›Á
);

2352 
	}
}

2358 
	$¡¬t_»Ëa£6
(
ş›Á_¡©e
 *
ş›Á
)

2361 
	`ÿnûl_timeout
(
do_cÚfœm6
, 
ş›Á
);

2362 
	`ÿnûl_timeout
(
do_£Ëù6
, 
ş›Á
);

2363 
	`ÿnûl_timeout
(
do_»äesh6
, 
ş›Á
);

2364 
	`ÿnûl_timeout
(
do_»Ëa£6
, 
ş›Á
);

2365 
	`ÿnûl_timeout
(
do_deşše6
, 
ş›Á
);

2366 
ş›Á
->
¡©e
 = 
S_STOPPED
;

2373 
	`uncÚfigu»6
(
ş›Á
, "RELEASE6");

2376 ià(
ş›Á
->
aùive_Ëa£
 =ğ
NULL
)

2378 
ş›Á
->
aùive_Ëa£
->
»Ëa£d
 = 
ISC_TRUE
;

2379 
	`wr™e_ş›Á6_Ëa£
(
ş›Á
, cl›Á->
aùive_Ëa£
, 0, 1);

2382 
ş›Á
->
IRT
 = 
REL_TIMEOUT
 * 100;

2383 
ş›Á
->
MRT
 = 0;

2384 
ş›Á
->
MRC
 = 
REL_MAX_RC
;

2385 
ş›Á
->
MRD
 = 0;

2387 
	`dhc6_»Œªs_š™
(
ş›Á
);

2388 
ş›Á
->
v6_hªdËr
 = 
»¶y_hªdËr
;

2390 
	`do_»Ëa£6
(
ş›Á
);

2391 
	}
}

2396 
	$do_»Ëa£6
(*
šput
)

2398 
ş›Á_¡©e
 *
ş›Á
;

2399 
d©a_¡ršg
 
ds
;

2400 
£nd_»t
, 
added
;

2401 
timev®
 
tv
;

2403 
ş›Á
 = 
šput
;

2405 ià((
ş›Á
->
aùive_Ëa£
 =ğ
NULL
è|| !
	`aùive_´efix
(client))

2408 
	`check_timšg6
(
ş›Á
, 
DHCPV6_RELEASE
, "Release",

2409 
ş›Á
->
aùive_Ëa£
, &
ds
)) {

2410 
CHK_TIM_MRC_EXCEEDED
:

2411 
CHK_TIM_ALLOC_FAILURE
:

2412 
CHK_TIM_MRD_EXCEEDED
:

2413 
»Ëa£_dÚe
;

2414 
CHK_TIM_SUCCESS
:

2423 
dhıv6_univ”£
.
	`’ÿpsuÏ‹
(&
ds
, 
NULL
, NULL, 
ş›Á
, NULL,

2424 
ş›Á
->
£Á_İtiÚs
, &
glob®_scİe
,

2425 &
dhıv6_univ”£
);

2428 ià(
wª‹d_Ÿ_Ç
 &&

2429 
	`dhc6_add_Ÿ_Ç
(
ş›Á
, &
ds
, cl›Á->
aùive_Ëa£
,

2430 
DHCPV6_RELEASE
, 0, &
added
è!ğ
ISC_R_SUCCESS
) {

2431 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2432 
»Ëa£_dÚe
;

2434 ià(
wª‹d_Ÿ_pd
 &&

2435 
	`dhc6_add_Ÿ_pd
(
ş›Á
, &
ds
, cl›Á->
aùive_Ëa£
,

2436 
DHCPV6_RELEASE
, 0, &
added
è!ğ
ISC_R_SUCCESS
) {

2437 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2438 
»Ëa£_dÚe
;

2442 
	`log_šfo
("XMT: Release on %s, interval %ld0ms.",

2443 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name,

2444 ()
ş›Á
->
RT
);

2446 
£nd_»t
 = 
	`£nd_·ck‘6
(
ş›Á
->
š‹rçû
, 
ds
.
d©a
, ds.
Ën
,

2447 &
DHCPv6De¡Addr
);

2448 ià(
£nd_»t
 !ğ
ds
.
Ën
) {

2449 
	`log_”rÜ
("dhc6: sendpacket6() sent %d of %d bytes",

2450 
£nd_»t
, 
ds
.
Ën
);

2453 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2456 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
ş›Á
->
RT
 / 100;

2457 
tv
.
tv_u£c
 = 
cur_tv
.tv_u£ø+ (
ş›Á
->
RT
 % 100) * 10000;

2458 ià(
tv
.
tv_u£c
 >= 1000000) {

2459 
tv
.
tv_£c
 += 1;

2460 
tv
.
tv_u£c
 -= 1000000;

2462 
	`add_timeout
(&
tv
, 
do_»Ëa£6
, 
ş›Á
, 
NULL
, NULL);

2463 
	`dhc6_»Œªs_advªû
(
ş›Á
);

2466 
»Ëa£_dÚe
:

2467 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
aùive_Ëa£
, 
MDL
);

2468 
ş›Á
->
aùive_Ëa£
 = 
NULL
;

2469 ià(
	`¡İpšg_fšished
())

2470 
	`fšish
(0);

2471 
	}
}

2477 
	$¡©us_log
(
code
, cÚ¡ *
scİe
, cÚ¡ *
add™iÚ®
, 
Ën
)

2479 cÚ¡ *
msg
 = 
NULL
;

2481 
code
) {

2482 
STATUS_Sucûss
:

2483 
msg
 = "Success";

2486 
STATUS_Un¥ecFa
:

2487 
msg
 = "UnspecFail";

2490 
STATUS_NoAddrsAva
:

2491 
msg
 = "NoAddrsAvail";

2494 
STATUS_NoBšdšg
:

2495 
msg
 = "NoBinding";

2498 
STATUS_NÙOnLšk
:

2499 
msg
 = "NotOnLink";

2502 
STATUS_U£MuÉiÿ¡
:

2503 
msg
 = "UseMulticast";

2506 
STATUS_NoP»fixAva
:

2507 
msg
 = "NoPrefixAvail";

2511 
msg
 = "UNKNOWN";

2515 ià(
Ën
 > 0)

2516 
	`log_šfo
("% ¡©u cod%s: %s", 
scİe
, 
msg
,

2517 
	`´št_hex_1
(
Ën
,

2518 (cÚ¡ *)
add™iÚ®
, 50));

2520 
	`log_šfo
("% ¡©u cod%s.", 
scİe
, 
msg
);

2521 
	}
}

2525 
isc_»suÉ_t


2526 
	$dhc6_g‘_¡©us_code
(
İtiÚ_¡©e
 *
İtiÚs
, *
code
,

2527 
d©a_¡ršg
 *
msg
)

2529 
İtiÚ_ÿche
 *
oc
;

2530 
d©a_¡ršg
 
ds
;

2531 
isc_»suÉ_t
 
rv®
 = 
ISC_R_SUCCESS
;

2533 ià((
İtiÚs
 =ğ
NULL
è|| (
code
 == NULL))

2534  
DHCP_R_INVALIDARG
;

2536 ià((
msg
 !ğ
NULL
è&& (msg->
Ën
 != 0))

2537  
DHCP_R_INVALIDARG
;

2539 
	`mem£t
(&
ds
, 0, (ds));

2542 *
code
 = 
STATUS_Sucûss
;

2544 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
İtiÚs
, 
D6O_STATUS_CODE
);

2545 ià((
oc
 !ğ
NULL
) &&

2546 
	`ev®u©e_İtiÚ_ÿche
(&
ds
, 
NULL
, NULL, NULL, 
İtiÚs
,

2547 
NULL
, &
glob®_scİe
, 
oc
, 
MDL
)) {

2548 ià(
ds
.
Ën
 < 2) {

2549 
	`log_”rÜ
("Inv®id stu codËngth %d.", 
ds
.
Ën
);

2550 
rv®
 = 
DHCP_R_FORMERR
;

2552 *
code
 = 
	`g‘UShÜt
(
ds
.
d©a
);

2554 ià((
msg
 !ğ
NULL
è&& (
ds
.
Ën
 > 2)) {

2555 
	`d©a_¡ršg_cİy
(
msg
, &
ds
, 
MDL
);

2556 
msg
->
d©a
 += 2;

2557 
msg
->
Ën
 -= 2;

2560 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

2561  
rv®
;

2564  
ISC_R_NOTFOUND
;

2565 
	}
}

2569 
isc_»suÉ_t


2570 
	$dhc6_check_¡©us
(
isc_»suÉ_t
 
rv®
, 
İtiÚ_¡©e
 *
İtiÚs
,

2571 cÚ¡ *
scİe
, *
code
)

2573 
d©a_¡ršg
 
msg
;

2574 
isc_»suÉ_t
 
¡©us
;

2576 ià((
scİe
 =ğ
NULL
è|| (
code
 == NULL))

2577  
DHCP_R_INVALIDARG
;

2580 *
code
 = 
STATUS_Sucûss
;

2583 ià(
İtiÚs
 !ğ
NULL
) {

2584 
	`mem£t
(&
msg
, 0, (msg));

2585 
¡©us
 = 
	`dhc6_g‘_¡©us_code
(
İtiÚs
, 
code
, &
msg
);

2587 ià(
¡©us
 =ğ
ISC_R_SUCCESS
) {

2588 
	`¡©us_log
(*
code
, 
scİe
, (*)
msg
.
d©a
, msg.
Ën
);

2589 
	`d©a_¡ršg_fÜg‘
(&
msg
, 
MDL
);

2591 ià(*
code
 !ğ
STATUS_Sucûss
)

2592 
rv®
 = 
ISC_R_FAILURE
;

2594 } ià(
¡©us
 !ğ
ISC_R_NOTFOUND
)

2595 
rv®
 = 
¡©us
;

2598  
rv®
;

2599 
	}
}

2610 
isc_»suÉ_t


2611 
	$dhc6_check_adv”ti£
(
dhc6_Ëa£
 *
Ëa£
)

2613 
dhc6_Ÿ
 *
Ÿ
;

2614 
isc_»suÉ_t
 
rv®
 = 
ISC_R_SUCCESS
;

2615 
have_addrs
 = 
ISC_FALSE
;

2616 
code
;

2617 cÚ¡ *
scİe
;

2618 
gÙ_Ç
 = 0, 
gÙ_
 = 0, 
gÙ_pd
 = 0;

2620 
rv®
 = 
	`dhc6_check_¡©us
Ôv®, 
Ëa£
->
İtiÚs
, "mes§ge", &
code
);

2622 
Ÿ
 = 
Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

2623 
Ÿ
->
Ÿ_ty³
) {

2624 
D6O_IA_NA
:

2625 
scİe
 = "IA_NA";

2626 
gÙ_Ç
++;

2628 
D6O_IA_TA
:

2629 
scİe
 = "IA_TA";

2630 
gÙ_
++;

2632 
D6O_IA_PD
:

2633 
scİe
 = "IA_PD";

2634 
gÙ_pd
++;

2637 
	`log_”rÜ
("dhc6_check_advertise:‚oype.");

2638  
ISC_R_FAILURE
;

2643 
rv®
 = 
	`dhc6_check_¡©us
Ôv®, 
Ÿ
->
İtiÚs
, 
scİe
, &
code
);

2644 ià(
rv®
 !ğ
ISC_R_SUCCESS
)

2652 ià(
Ÿ
->
addrs
 !ğ
NULL
) {

2653 
have_addrs
 = 
ISC_TRUE
;

2660 ià((
have_addrs
 !ğ
ISC_TRUE
) ||

2661 ((
»quœe_®l_Ÿs
 != 0) &&

2662 ((
gÙ_Ç
 < 
wª‹d_Ÿ_Ç
) ||

2663 (
gÙ_
 < 
wª‹d_Ÿ_
) ||

2664 (
gÙ_pd
 < 
wª‹d_Ÿ_pd
))))

2665 
rv®
 = 
ISC_R_ADDRNOTAVAIL
;

2667  
rv®
;

2668 
	}
}

2673 
isc_boŞ—n_t


2674 
	$dhc6_š™_aùiÚ
(
ş›Á_¡©e
 *
ş›Á
, 
isc_»suÉ_t
 *
rv®p
,

2675 
code
)

2677 ià(
rv®p
 =ğ
NULL
)

2678 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

2680 ià(
ş›Á
 =ğ
NULL
) {

2681 *
rv®p
 = 
DHCP_R_INVALIDARG
;

2682  
ISC_FALSE
;

2685 ià(*
rv®p
 =ğ
ISC_R_SUCCESS
)

2686  
ISC_FALSE
;

2689  
ISC_FALSE
;

2690 
	}
}

2696 
isc_boŞ—n_t


2697 
	$dhc6_£Ëù_aùiÚ
(
ş›Á_¡©e
 *
ş›Á
, 
isc_»suÉ_t
 *
rv®p
,

2698 
code
)

2700 
dhc6_Ëa£
 *
Ëa£
;

2701 
isc_»suÉ_t
 
rv®
;

2703 ià(
rv®p
 =ğ
NULL
)

2704 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

2706 ià(
ş›Á
 =ğ
NULL
) {

2707 *
rv®p
 = 
DHCP_R_INVALIDARG
;

2708  
ISC_FALSE
;

2710 
rv®
 = *
rv®p
;

2712 ià(
rv®
 =ğ
ISC_R_SUCCESS
)

2713  
ISC_FALSE
;

2715 
code
) {

2721 
STATUS_Sucûss
:

2723 
STATUS_NoBšdšg
:

2724 
STATUS_U£MuÉiÿ¡
:

2726  
ISC_FALSE
;

2733 
STATUS_Un¥ecFa
:

2734 ià(
ş›Á
->
adv”ti£d_Ëa£s
 !ğ
NULL
) {

2735 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
£Ëùed_Ëa£
, 
MDL
);

2736 
ş›Á
->
£Ëùed_Ëa£
 = 
NULL
;

2738 
	`¡¬t_£Ëùšg6
(
ş›Á
);

2742  
ISC_FALSE
;

2748 
STATUS_NoAddrsAva
:

2749 
STATUS_NoP»fixAva
:

2750 ià(
ş›Á
->
¡©e
 =ğ
S_REBOOTING
)

2751  
ISC_FALSE
;

2753 ià(
ş›Á
->
£Ëùed_Ëa£
 =ğ
NULL
)

2754 
	`log_çl
("ImpossibË ca£‡ˆ%s:%d.", 
MDL
);

2756 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
£Ëùed_Ëa£
, 
MDL
);

2757 
ş›Á
->
£Ëùed_Ëa£
 = 
NULL
;

2759 ià(
ş›Á
->
adv”ti£d_Ëa£s
 !ğ
NULL
)

2760 
	`¡¬t_£Ëùšg6
(
ş›Á
);

2762 
	`¡¬t_š™6
(
ş›Á
);

2772 
STATUS_NÙOnLšk
:

2773 ià(
ş›Á
->
¡©e
 =ğ
S_REBOOTING
) {

2774 ià(
ş›Á
->
aùive_Ëa£
 =ğ
NULL
)

2775 
	`log_çl
("ImpossibË ca£‡ˆ%s:%d.", 
MDL
);

2777 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
aùive_Ëa£
, 
MDL
);

2779 ià(
ş›Á
->
£Ëùed_Ëa£
 =ğ
NULL
)

2780 
	`log_çl
("ImpossibË ca£‡ˆ%s:%d.", 
MDL
);

2782 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
£Ëùed_Ëa£
, 
MDL
);

2783 
ş›Á
->
£Ëùed_Ëa£
 = 
NULL
;

2785 
ş›Á
->
adv”ti£d_Ëa£s
 !ğ
NULL
) {

2786 
Ëa£
 = 
ş›Á
->
adv”ti£d_Ëa£s
;

2787 
ş›Á
->
adv”ti£d_Ëa£s
 = 
Ëa£
->
Ãxt
;

2789 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

2793 
	`¡¬t_š™6
(
ş›Á
);

2797  
ISC_TRUE
;

2798 
	}
}

2801 
	$dhc6_w™hd¿w_Ëa£
(
ş›Á_¡©e
 *
ş›Á
)

2803 
dhc6_Ÿ
 *
Ÿ
;

2804 
dhc6_addr
 *
addr
;

2806 ià((
ş›Á
 =ğ
NULL
è|| (ş›Á->
aùive_Ëa£
 == NULL))

2809 
Ÿ
 = 
ş›Á
->
aùive_Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ;

2810 
Ÿ
 = ia->
Ãxt
) {

2811 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

2812 
addr
->
max_liã
 =‡ddr->
´eã¼ed_liã
 = 0;

2817 
	`do_expœe
(
ş›Á
);

2818 
	}
}

2824 
isc_boŞ—n_t


2825 
	$dhc6_»¶y_aùiÚ
(
ş›Á_¡©e
 *
ş›Á
, 
isc_»suÉ_t
 *
rv®p
,

2826 
code
)

2828 
isc_»suÉ_t
 
rv®
;

2830 ià(
rv®p
 =ğ
NULL
)

2831 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

2833 ià(
ş›Á
 =ğ
NULL
) {

2834 *
rv®p
 = 
DHCP_R_INVALIDARG
;

2835  
ISC_FALSE
;

2837 
rv®
 = *
rv®p
;

2839 ià(
rv®
 =ğ
ISC_R_SUCCESS
)

2840  
ISC_FALSE
;

2842 
code
) {

2846 
STATUS_Sucûss
:

2852 
STATUS_Un¥ecFa
:

2855  
ISC_FALSE
;

2863 
STATUS_U£MuÉiÿ¡
:

2864 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

2865 
	`d–‘e_İtiÚ
(&
dhı_univ”£
,

2866 
ş›Á
->
aùive_Ëa£
->
İtiÚs
,

2867 
D6O_UNICAST
);

2868  
ISC_FALSE
;

2883 
STATUS_NÙOnLšk
:

2889 
	`dhc6_w™hd¿w_Ëa£
(
ş›Á
);

2897 
STATUS_NoAddrsAva
:

2898 
STATUS_NoP»fixAva
:

2900 
	`¡¬t_š™6
(
ş›Á
);

2907 
STATUS_NoBšdšg
:

2908 ià(
ş›Á
->
adv”ti£d_Ëa£s
 !ğ
NULL
)

2909 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

2911 
ş›Á
->
adv”ti£d_Ëa£s
 =

2912 
	`dhc6_dup_Ëa£
(
ş›Á
->
aùive_Ëa£
, 
MDL
);

2913 
	`¡¬t_£Ëùšg6
(
ş›Á
);

2917  
ISC_TRUE
;

2918 
	}
}

2925 
isc_boŞ—n_t


2926 
	$dhc6_¡İ_aùiÚ
(
ş›Á_¡©e
 *
ş›Á
, 
isc_»suÉ_t
 *
rv®p
,

2927 
code
)

2929 
isc_»suÉ_t
 
rv®
;

2931 ià(
rv®p
 =ğ
NULL
)

2932 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

2934 ià(
ş›Á
 =ğ
NULL
) {

2935 *
rv®p
 = 
DHCP_R_INVALIDARG
;

2936  
ISC_FALSE
;

2938 
rv®
 = *
rv®p
;

2940 ià(
rv®
 =ğ
ISC_R_SUCCESS
)

2941  
ISC_FALSE
;

2943 
code
) {

2947 
STATUS_Sucûss
:

2949 
STATUS_Un¥ecFa
:

2951  
ISC_FALSE
;

2954 
STATUS_NoBšdšg
:

2955 ià(
rv®
 =ğ
ISC_R_FAILURE
)

2956 *
rv®p
 = 
ISC_R_SUCCESS
;

2957  
ISC_FALSE
;

2960 
STATUS_NoAddrsAva
:

2961 
STATUS_NoP»fixAva
:

2965 
STATUS_NÙOnLšk
:

2974 
STATUS_U£MuÉiÿ¡
:

2975 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

2976 
	`d–‘e_İtiÚ
(&
dhı_univ”£
,

2977 
ş›Á
->
aùive_Ëa£
->
İtiÚs
,

2978 
D6O_UNICAST
);

2979  
ISC_FALSE
;

2982  
ISC_TRUE
;

2983 
	}
}

2985 
isc_boŞ—n_t


2986 
	$dhc6_deşše_aùiÚ
(
ş›Á_¡©e
 *
ş›Á
, 
isc_»suÉ_t
 *
rv®p
,

2987 
code
)

2989 
isc_»suÉ_t
 
rv®
;

2991 ià(
rv®p
 =ğ
NULL
)

2992 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

2994 ià(
ş›Á
 =ğ
NULL
) {

2995 *
rv®p
 = 
DHCP_R_INVALIDARG
;

2996  
ISC_FALSE
;

2998 
rv®
 = *
rv®p
;

3000 ià(
rv®
 =ğ
ISC_R_SUCCESS
) {

3001  
ISC_FALSE
;

3004 
code
) {

3005 
STATUS_U£MuÉiÿ¡
:

3012 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

3013 
	`d–‘e_İtiÚ
(&
dhı_univ”£
,

3014 
ş›Á
->
aùive_Ëa£
->
İtiÚs
,

3015 
D6O_UNICAST
);

3016  
ISC_FALSE
;

3022  
ISC_TRUE
;

3023 
	}
}

3029 
isc_»suÉ_t


3030 
	$dhc6_check_»¶y
(
ş›Á_¡©e
 *
ş›Á
, 
dhc6_Ëa£
 *
Ãw
)

3032 
	`isc_boŞ—n_t
 (*
aùiÚ
)(
ş›Á_¡©e
 *,

3033 
isc_»suÉ_t
 *, );

3034 
dhc6_Ÿ
 *
Ÿ
;

3035 
isc_»suÉ_t
 
rv®
 = 
ISC_R_SUCCESS
;

3036 
code
;

3037 cÚ¡ *
scİe
;

3038 
nscÜe
, 
sscÜe
;

3039 
have_addrs
 = 
ISC_FALSE
;

3040 
gÙ_Ç
 = 0, 
gÙ_
 = 0, 
gÙ_pd
 = 0;

3042 ià((
ş›Á
 =ğ
NULL
è|| (
Ãw
 == NULL))

3043  
DHCP_R_INVALIDARG
;

3045 
ş›Á
->
¡©e
) {

3046 
S_INIT
:

3047 
aùiÚ
 = 
dhc6_š™_aùiÚ
;

3050 
S_SELECTING
:

3051 
S_REBOOTING
:

3052 
aùiÚ
 = 
dhc6_£Ëù_aùiÚ
;

3055 
S_RENEWING
:

3056 
S_REBINDING
:

3057 
aùiÚ
 = 
dhc6_»¶y_aùiÚ
;

3060 
S_STOPPED
:

3061 
aùiÚ
 = 
dhc6_¡İ_aùiÚ
;

3064 
S_DECLINING
:

3065 
aùiÚ
 = 
dhc6_deşše_aùiÚ
;

3069 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

3070  
ISC_R_CANCELED
;

3077 
rv®
 = 
	`dhc6_check_¡©us
Ôv®, 
Ãw
->
İtiÚs
, "mes§ge", &
code
);

3078 ià(
	`aùiÚ
(
ş›Á
, &
rv®
, 
code
))

3079  
ISC_R_CANCELED
;

3081 
Ÿ
 = 
Ãw
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

3082 
Ÿ
->
Ÿ_ty³
) {

3083 
D6O_IA_NA
:

3084 
scİe
 = "IA_NA";

3085 
gÙ_Ç
++;

3087 
D6O_IA_TA
:

3088 
scİe
 = "IA_TA";

3089 
gÙ_
++;

3091 
D6O_IA_PD
:

3092 
scİe
 = "IA_PD";

3093 
gÙ_pd
++;

3096 
	`log_”rÜ
("dhc6_check_reply:‚oype.");

3097  
DHCP_R_INVALIDARG
;

3099 
rv®
 = 
	`dhc6_check_¡©us
Ôv®, 
Ÿ
->
İtiÚs
, 
scİe
, &
code
);

3101 ià(
	`aùiÚ
(
ş›Á
, &
rv®
, 
code
))

3102  
ISC_R_CANCELED
;

3104 ià(
Ÿ
->
addrs
 !ğ
NULL
) {

3105 
have_addrs
 = 
ISC_TRUE
;

3110 ià(
ş›Á
->
¡©e
 =ğ
S_REBOOTING
)

3111  
rv®
;

3122 ià((
have_addrs
 !ğ
ISC_TRUE
) ||

3123 ((
»quœe_®l_Ÿs
 != 0) &&

3124 ((
gÙ_Ç
 < 
wª‹d_Ÿ_Ç
) ||

3126 (
gÙ_pd
 < 
wª‹d_Ÿ_pd
)))) {

3127 
rv®
 = 
ISC_R_FAILURE
;

3128 ià(
	`aùiÚ
(
ş›Á
, &
rv®
, 
STATUS_NoAddrsAva
è=ğ
ISC_TRUE
) {

3129  
ISC_R_CANCELED
;

3134 ià(
ş›Á
->
¡©e
 =ğ
S_INIT
)

3135  
rv®
;

3137 
ş›Á
->
¡©e
) {

3138 
S_SELECTING
:

3142 
nscÜe
 = 
	`dhc6_scÜe_Ëa£
(
ş›Á
, 
Ãw
);

3143 
sscÜe
 = 
	`dhc6_scÜe_Ëa£
(
ş›Á
, cl›Á->
£Ëùed_Ëa£
);

3144 ià((
ş›Á
->
adv”ti£d_Ëa£s
 !ğ
NULL
) &&

3145 (
nscÜe
 < (
sscÜe
 / 2))) {

3151 
	`log_”rÜ
("PRC: BAIT AND SWITCH detected. Score of "

3155 
nscÜe
, 
sscÜe
);

3157 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
£Ëùed_Ëa£
, 
MDL
);

3158 
ş›Á
->
£Ëùed_Ëa£
 = 
NULL
;

3160 
	`¡¬t_£Ëùšg6
(
ş›Á
);

3162  
ISC_R_CANCELED
;

3166 
S_RENEWING
:

3167 
S_REBINDING
:

3180 
S_STOPPED
:

3181 
S_DECLINING
:

3186 
	`log_çl
("REALLY impossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

3187  
ISC_R_CANCELED
;

3190  
rv®
;

3191 
	}
}

3199 
	$š™_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
)

3201 
dhc6_Ëa£
 *
Ëa£
;

3206 ià(
·ck‘
->
dhıv6_msg_ty³
 !ğ
DHCPV6_ADVERTISE
)

3212 ià(!
	`v®id_»¶y
(
·ck‘
, 
ş›Á
)) {

3213 
	`log_”rÜ
("Invalid Advertise -„ejecting.");

3217 
Ëa£
 = 
	`dhc6_Ëa£ify
(
·ck‘
, 
ş›Á
);

3222 ià(
Ëa£
 =ğ
NULL
)

3225 ià(
	`dhc6_check_adv”ti£
(
Ëa£
è!ğ
ISC_R_SUCCESS
) {

3226 
	`log_debug
("PRC: Lease failedo satisfy.");

3227 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

3231 
Ëa£_scÜe
 = 
	`dhc6_scÜe_Ëa£
(
ş›Á
, 
Ëa£
);

3232 #ifdeà
ENFORCE_DHCPV6_CLIENT_REQUIRE


3233 ià(
Ëa£_scÜe
 == 0) {

3234 
	`log_debug
("RCV:Advertised†ease scored 0,oss it.");

3235 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

3240 
	`š£¹_Ëa£
(&
ş›Á
->
adv”ti£d_Ëa£s
, 
Ëa£
);

3252 ià((
ş›Á
->
txcouÁ
 > 1) ||

3253 ((
Ëa£
->
´ef
 =ğ255è&& (
Ëa£_scÜe
 > 
SCORE_MIN
))) {

3254 
	`log_debug
("RCV: Advertisement immediately selected.");

3255 
	`ÿnûl_timeout
(
do_š™6
, 
ş›Á
);

3256 
	`¡¬t_£Ëùšg6
(
ş›Á
);

3258 
	`log_debug
("RCV: Advertisement„ecorded.");

3259 
	}
}

3264 
	$šfo_»que¡_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
)

3266 
isc_»suÉ_t
 
check_¡©us
;

3267 
code
;

3269 ià(
·ck‘
->
dhıv6_msg_ty³
 !ğ
DHCPV6_REPLY
)

3275 ià(!
	`v®id_»¶y
(
·ck‘
, 
ş›Á
)) {

3276 
	`log_”rÜ
("Invalid Reply -„ejecting.");

3280 
check_¡©us
 = 
	`dhc6_check_¡©us
(
ISC_R_SUCCESS
, 
·ck‘
->
İtiÚs
,

3281 "mes§ge", &
code
);

3283 ià(
check_¡©us
 !ğ
ISC_R_SUCCESS
) {

3287 ià(
check_¡©us
 !ğ
ISC_R_CANCELED
)

3292 
	`ÿnûl_timeout
(
do_šfo_»que¡6
, 
ş›Á
);

3297 ià(
check_¡©us
 =ğ
ISC_R_CANCELED
)

3301 ià(
ş›Á
->
Şd_Ëa£
 !ğ
NULL
) {

3302 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
Şd_Ëa£
, 
MDL
);

3303 
ş›Á
->
Şd_Ëa£
 = 
NULL
;

3307 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

3308 
ş›Á
->
Şd_Ëa£
 = cl›Á->
aùive_Ëa£
;

3309 
ş›Á
->
aùive_Ëa£
 = 
	`dm®loc
((
dhc6_Ëa£
), 
MDL
);

3310 ià(
ş›Á
->
aùive_Ëa£
 =ğ
NULL
)

3311 
	`log_çl
("Out of memory for v6†ease structure.");

3312 
	`İtiÚ_¡©e_»ã»nû
(&
ş›Á
->
aùive_Ëa£
->
İtiÚs
,

3313 
·ck‘
->
İtiÚs
, 
MDL
);

3315 
	`execu‹_¡©em’ts_š_scİe
(
NULL
, (
·ck‘
 *íack‘, NULL, 
ş›Á
,

3316 
ş›Á
->
aùive_Ëa£
->
İtiÚs
,

3317 
ş›Á
->
aùive_Ëa£
->
İtiÚs
,

3318 &
glob®_scİe
, 
ş›Á
->
cÚfig
->
Ú_»ût
,

3319 
NULL
, NULL);

3321 
	`¡¬t_šfÜmed
(
ş›Á
);

3322 
	}
}

3327 
	$¿pid_comm™_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
)

3329 
dhc6_Ëa£
 *
Ëa£
;

3330 
isc_»suÉ_t
 
check_¡©us
;

3334 ià(
·ck‘
->
dhıv6_msg_ty³
 =ğ
DHCPV6_ADVERTISE
) {

3335 
	`š™_hªdËr
(
·ck‘
, 
ş›Á
);

3337 } ià(
·ck‘
->
dhıv6_msg_ty³
 !ğ
DHCPV6_REPLY
)

3343 ià(!
	`v®id_»¶y
(
·ck‘
, 
ş›Á
)) {

3344 
	`log_”rÜ
("Invalid Reply -„ejecting.");

3349 ià(
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
·ck‘
->
İtiÚs
,

3350 
D6O_RAPID_COMMIT
) == 0) {

3351 
	`log_”rÜ
("Reply without Rapid-Commit -„ejecting.");

3355 
Ëa£
 = 
	`dhc6_Ëa£ify
(
·ck‘
, 
ş›Á
);

3360 ià(
Ëa£
 =ğ
NULL
)

3363 
check_¡©us
 = 
	`dhc6_check_»¶y
(
ş›Á
, 
Ëa£
);

3364 ià(
check_¡©us
 !ğ
ISC_R_SUCCESS
) {

3365 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

3370 
	`ÿnûl_timeout
(
do_š™6
, 
ş›Á
);

3371 
ş›Á
->
¡©e
 = 
S_SELECTING
;

3376 
	`dhc6_m”ge_Ëa£
(
ş›Á
->
aùive_Ëa£
, 
Ëa£
);

3379 ià(
ş›Á
->
Şd_Ëa£
 !ğ
NULL
) {

3380 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
Şd_Ëa£
, 
MDL
);

3381 
ş›Á
->
Şd_Ëa£
 = 
NULL
;

3385 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

3386 
ş›Á
->
Şd_Ëa£
 = cl›Á->
aùive_Ëa£
;

3387 
ş›Á
->
aùive_Ëa£
 = 
Ëa£
;

3390 
ş›Á
->
adv”ti£d_Ëa£s
 !ğ
NULL
) {

3391 
Ëa£
 = 
ş›Á
->
adv”ti£d_Ëa£s
;

3392 
ş›Á
->
adv”ti£d_Ëa£s
 = 
Ëa£
->
Ãxt
;

3394 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

3397 
	`¡¬t_bound
(
ş›Á
);

3398 
	}
}

3429 
dhc6_Ëa£
 *

3430 
	$dhc6_be¡_Ëa£
(
ş›Á_¡©e
 *
ş›Á
, 
dhc6_Ëa£
 **
h—d
)

3432 
dhc6_Ëa£
 **
½os
, *
rv®
, **
ÿndp
, *
ÿnd
;

3433 
cscÜe
, 
rscÜe
;

3435 ià(
h—d
 =ğ
NULL
 || *head == NULL)

3436  
NULL
;

3438 
½os
 = 
h—d
;

3439 
rv®
 = *
½os
;

3440 
rscÜe
 = 
	`dhc6_scÜe_Ëa£
(
ş›Á
, 
rv®
);

3441 
ÿndp
 = &
rv®
->
Ãxt
;

3442 
ÿnd
 = *
ÿndp
;

3444 
	`log_debug
("PRC: Considering best†ease.");

3445 
	`log_debug
("PRC: X-- Initial candidate %s (s: %d,…: %u).",

3446 
	`´št_hex_1
(
rv®
->
£rv”_id
.
Ën
,

3447 
rv®
->
£rv”_id
.
d©a
, 48),

3448 
rscÜe
, ()
rv®
->
´ef
);

3450 ; 
ÿnd
 !ğ
NULL
 ; 
ÿndp
 = &ÿnd->
Ãxt
, cand = *candp) {

3451 
cscÜe
 = 
	`dhc6_scÜe_Ëa£
(
ş›Á
, 
ÿnd
);

3453 
	`log_debug
("PRC: X-- Candidate %s (s: %d,…: %u).",

3454 
	`´št_hex_1
(
ÿnd
->
£rv”_id
.
Ën
,

3455 
ÿnd
->
£rv”_id
.
d©a
, 48),

3456 
cscÜe
, ()
ÿnd
->
´ef
);

3480 ià((
rscÜe
 < 
SCORE_MIN
è&& (
cscÜe
 >= SCORE_MIN)) {

3481 
	`log_debug
("PRC: | X-- Selected, has bindings.");

3482 } ià(
ÿnd
->
´ef
 < 
rv®
->pref) {

3483 
	`log_debug
("PRC: | X-- Rejected,†ower…reference.");

3485 } ià(
ÿnd
->
´ef
 > 
rv®
->pref) {

3486 
	`log_debug
("PRC: | X-- Selected, higher…reference.");

3487 } ià(
cscÜe
 > 
rscÜe
) {

3488 
	`log_debug
("PRC: | X-- Selected,ƒqual…reference, "

3490 } ià(
cscÜe
 < 
rscÜe
) {

3491 
	`log_debug
("PRC: | X-- Rejected,ƒqual…reference, "

3494 } ià((
ÿnd
->
£rv”_id
.
Ën
 < 
rv®
->server_id.len) ||

3495 ((
ÿnd
->
£rv”_id
.
Ën
 =ğ
rv®
->server_id.len) &&

3496 (
	`memcmp
(
ÿnd
->
£rv”_id
.
d©a
,

3497 
rv®
->
£rv”_id
.
d©a
,

3498 
ÿnd
->
£rv”_id
.
Ën
) < 0))) {

3499 
	`log_debug
("PRC: | X-- Selected,ƒqual…reference, "

3502 
	`log_debug
("PRC: | X-- Rejected,ƒqual…reference, "

3507 
½os
 = 
ÿndp
;

3508 
rv®
 = 
ÿnd
;

3509 
rscÜe
 = 
cscÜe
;

3513 *
½os
 = 
rv®
->
Ãxt
;

3515  
rv®
;

3516 
	}
}

3522 
	$¡¬t_£Ëùšg6
(
ş›Á_¡©e
 *
ş›Á
)

3524 
dhc6_Ëa£
 *
Ëa£
;

3526 ià(
ş›Á
->
adv”ti£d_Ëa£s
 =ğ
NULL
) {

3527 
	`log_”rÜ
("Can‚otƒnter DHCPv6 SELECTING state with‚o "

3532 
	`log_debug
("PRC: Selecting best‡dvertised†ease.");

3533 
ş›Á
->
¡©e
 = 
S_SELECTING
;

3535 
Ëa£
 = 
	`dhc6_be¡_Ëa£
(
ş›Á
, &ş›Á->
adv”ti£d_Ëa£s
);

3537 ià(
Ëa£
 =ğ
NULL
)

3538 
	`log_çl
("ImpossibËƒ¼Ü‡ˆ%s:%d.", 
MDL
);

3540 
ş›Á
->
£Ëùed_Ëa£
 = 
Ëa£
;

3543 
ş›Á
->
IRT
 = 
REQ_TIMEOUT
 * 100;

3544 
ş›Á
->
MRT
 = 
REQ_MAX_RT
 * 100;

3545 
ş›Á
->
MRC
 = 
REQ_MAX_RC
;

3546 
ş›Á
->
MRD
 = 0;

3548 
	`dhc6_»Œªs_š™
(
ş›Á
);

3550 
ş›Á
->
v6_hªdËr
 = 
»¶y_hªdËr
;

3553 
	`do_£Ëù6
(
ş›Á
);

3554 
	}
}

3561 
	$do_£Ëù6
(*
šput
)

3563 
ş›Á_¡©e
 *
ş›Á
;

3564 
dhc6_Ëa£
 *
Ëa£
;

3565 
d©a_¡ršg
 
ds
;

3566 
timev®
 
tv
;

3567 
£nd_»t
, 
added
;

3569 
ş›Á
 = 
šput
;

3572 
Ëa£
 = 
ş›Á
->
£Ëùed_Ëa£
;

3573 ià(
Ëa£
 =ğ
NULL
 ||†—£->
bšdšgs
 == NULL) {

3574 
	`log_”rÜ
("Illegalo‡ttempt selection without selecting "

3579 
	`check_timšg6
(
ş›Á
, 
DHCPV6_REQUEST
, "Reque¡", 
Ëa£
, &
ds
)) {

3580 
CHK_TIM_MRC_EXCEEDED
:

3581 
CHK_TIM_MRD_EXCEEDED
:

3582 
	`log_debug
("PRC: Lease %s failed.",

3583 
	`´št_hex_1
(
Ëa£
->
£rv”_id
.
Ën
,

3584 
Ëa£
->
£rv”_id
.
d©a
, 56));

3587 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

3588 
ş›Á
->
£Ëùed_Ëa£
 = 
NULL
;

3591 ià(
ş›Á
->
adv”ti£d_Ëa£s
 !ğ
NULL
)

3592 
	`¡¬t_£Ëùšg6
(
ş›Á
);

3594 
	`¡¬t_š™6
(
ş›Á
);

3596 
CHK_TIM_ALLOC_FAILURE
:

3598 
CHK_TIM_SUCCESS
:

3615 
dhıv6_univ”£
.
	`’ÿpsuÏ‹
(&
ds
, 
NULL
, NULL, 
ş›Á
,

3616 
NULL
, 
ş›Á
->
£Á_İtiÚs
, &
glob®_scİe
,

3617 &
dhıv6_univ”£
);

3624 ià(
wª‹d_Ÿ_Ç
 &&

3625 ((
	`dhc6_add_Ÿ_Ç
(
ş›Á
, &
ds
, 
Ëa£
, 
DHCPV6_REQUEST
,

3626 
wª‹d_Ÿ_Ç
, &
added
è!ğ
ISC_R_SUCCESS
) ||

3627 (
	`dhc6_b¬e_Ÿ_xx
(
ş›Á
, &
ds
, 
wª‹d_Ÿ_Ç
 - 
added
,

3628 
D6O_IA_NA
è!ğ
ISC_R_SUCCESS
))) {

3629 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

3632 ià(
wª‹d_Ÿ_
 &&

3633 ((
	`dhc6_add_Ÿ_
(
ş›Á
, &
ds
, 
Ëa£
, 
DHCPV6_REQUEST
,

3634 
wª‹d_Ÿ_
, &
added
è!ğ
ISC_R_SUCCESS
) ||

3635 (
	`dhc6_b¬e_Ÿ_xx
(
ş›Á
, &
ds
, 
wª‹d_Ÿ_
 - 
added
,

3636 
D6O_IA_TA
è!ğ
ISC_R_SUCCESS
))) {

3637 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

3640 ià(
wª‹d_Ÿ_pd
 &&

3641 ((
	`dhc6_add_Ÿ_pd
(
ş›Á
, &
ds
, 
Ëa£
, 
DHCPV6_REQUEST
,

3642 
wª‹d_Ÿ_pd
, &
added
è!ğ
ISC_R_SUCCESS
) ||

3643 (
	`dhc6_b¬e_Ÿ_xx
(
ş›Á
, &
ds
, 
wª‹d_Ÿ_pd
 - 
added
,

3644 
D6O_IA_PD
è!ğ
ISC_R_SUCCESS
))) {

3645 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

3649 
	`log_šfo
("XMT: Request on %s, interval %ld0ms.",

3650 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name,

3651 ()
ş›Á
->
RT
);

3653 
£nd_»t
 = 
	`£nd_·ck‘6
(
ş›Á
->
š‹rçû
,

3654 
ds
.
d©a
, ds.
Ën
, &
DHCPv6De¡Addr
);

3655 ià(
£nd_»t
 !ğ
ds
.
Ën
) {

3656 
	`log_”rÜ
("dhc6: send_packet6() sent %d of %d bytes",

3657 
£nd_»t
, 
ds
.
Ën
);

3660 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

3663 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
ş›Á
->
RT
 / 100;

3664 
tv
.
tv_u£c
 = 
cur_tv
.tv_u£ø+ (
ş›Á
->
RT
 % 100) * 10000;

3665 ià(
tv
.
tv_u£c
 >= 1000000) {

3666 
tv
.
tv_£c
 += 1;

3667 
tv
.
tv_u£c
 -= 1000000;

3669 
	`add_timeout
(&
tv
, 
do_£Ëù6
, 
ş›Á
, 
NULL
, NULL);

3671 
	`dhc6_»Œªs_advªû
(
ş›Á
);

3672 
	}
}

3684 
	$dhc6_couÁ_Ÿ
(
dhc6_Ëa£
 *
Ëa£
, 
u_št16_t
 
Ÿ_ty³
)

3686 
dhc6_Ÿ
 *
Ÿ
;

3687 
i
 = 0;

3689 
Ÿ
 = 
Ëa£
->
bšdšgs
; i¨!ğ
NULL
; i¨ğŸ->
Ãxt
) {

3690 ià(
Ÿ
->
Ÿ_ty³
 == ia_type)

3692 
i
++;

3695  (
i
);

3696 
	}
}

3723 
isc_»suÉ_t


3724 
	$dhc6_add_Ÿ_Ç
(
ş›Á_¡©e
 *
ş›Á
, 
d©a_¡ršg
 *
·ck‘
,

3725 
dhc6_Ëa£
 *
Ëa£
, 
u_št8_t
 
mes§ge
,

3726 
wª‹d
, *
added
)

3728 
d©a_¡ršg
 
Ÿds
;

3729 
d©a_¡ršg
 
addrds
;

3730 
dhc6_addr
 *
addr
;

3731 
dhc6_Ÿ
 *
Ÿ
;

3732 
isc_»suÉ_t
 
rv®
 = 
ISC_R_SUCCESS
;

3733 
TIME
 
t1
, 
t2
;

3734 
i
;

3736 *
added
 = 0;

3737 
	`mem£t
(&
Ÿds
, 0, (iads));

3738 
	`mem£t
(&
addrds
, 0, (addrds));

3739 
Ÿ
 = 
Ëa£
->
bšdšgs
, 
i
 = 0;

3740 
Ÿ
 !ğ
NULL
 && 
rv®
 =ğ
ISC_R_SUCCESS
 && (
wª‹d
 =ğ0 || 
i
 < wanted);

3741 
Ÿ
 = ia->
Ãxt
) {

3742 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_NA
)

3746 
i
++;

3748 ià(!
	`bufãr_®loÿ‹
(&
Ÿds
.
bufãr
, 12, 
MDL
)) {

3749 
	`log_”rÜ
("Unableo‡llocate memory for IA_NA.");

3750 
rv®
 = 
ISC_R_NOMEMORY
;

3755 
	`memıy
(
Ÿds
.
bufãr
->
d©a
, 
Ÿ
->
Ÿid
, 4);

3756 
Ÿds
.
d©a
 = iads.
bufãr
->data;

3757 
Ÿds
.
Ën
 = 12;

3759 
mes§ge
) {

3760 
DHCPV6_REQUEST
:

3761 
DHCPV6_RENEW
:

3762 
DHCPV6_REBIND
:

3764 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
 / 2;

3765 
t2
 = 
t1
 + (t1 / 2);

3766 #ià
MAX_TIME
 > 0xffffffff

3767 ià(
t1
 > 0xffffffff)

3768 
t1
 = 0xffffffff;

3769 ià(
t2
 > 0xffffffff)

3770 
t2
 = 0xffffffff;

3772 
	`putULÚg
(
Ÿds
.
bufãr
->
d©a
 + 4, 
t1
);

3773 
	`putULÚg
(
Ÿds
.
bufãr
->
d©a
 + 8, 
t2
);

3775 
	`log_debug
("XMT: X-- IA_NA %s",

3776 
	`´št_hex_1
(4, 
Ÿds
.
d©a
, 59));

3777 
	`log_debug
("XMT: | X-- Requested„enew +%u",

3778 (è
t1
);

3779 
	`log_debug
("XMT: | X-- Requested„ebind +%u",

3780 (è
t2
);

3783 
DHCPV6_CONFIRM
:

3784 
DHCPV6_RELEASE
:

3785 
DHCPV6_DECLINE
:

3787 
	`mem£t
(
Ÿds
.
bufãr
->
d©a
 + 4, 0, 8);

3788 
	`log_debug
("XMT: X-- IA_NA %s",

3789 
	`´št_hex_1
(4, 
Ÿds
.
bufãr
->
d©a
, 55));

3794 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

3797 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

3803 ià(
addr
->
æags
 & 
DHC6_ADDR_EXPIRED
)

3806 ià(
addr
->
add»ss
.
Ën
 != 16) {

3807 
	`log_”rÜ
("Illegal IPv6‡ddress†ength (%d), "

3809 
addr
->
add»ss
.
Ën
, 
MDL
);

3813 ià(!
	`bufãr_®loÿ‹
(&
addrds
.
bufãr
, 24, 
MDL
)) {

3814 
	`log_”rÜ
("Unableo‡llocate memory for "

3816 
rv®
 = 
ISC_R_NOMEMORY
;

3820 
addrds
.
d©a
 =‡ddrds.
bufãr
->data;

3821 
addrds
.
Ën
 = 24;

3824 
	`memıy
(
addrds
.
bufãr
->
d©a
, 
addr
->
add»ss
.
Ÿbuf
, 16);

3827 
mes§ge
) {

3828 
DHCPV6_REQUEST
:

3829 
DHCPV6_RENEW
:

3830 
DHCPV6_REBIND
:

3831 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
;

3832 
t2
 = 
t1
 + 300;

3833 
	`putULÚg
(
addrds
.
bufãr
->
d©a
 + 16, 
t1
);

3834 
	`putULÚg
(
addrds
.
bufãr
->
d©a
 + 20, 
t2
);

3836 
	`log_debug
("XMT: | | X-- IAADDR %s",

3837 
	`pŸddr
(
addr
->
add»ss
));

3838 
	`log_debug
("XMT: | | | X-- Preferred "

3839 "liãtim+%u", ()
t1
);

3840 
	`log_debug
("XMT: | | | X-- Max†ifetime +%u",

3841 ()
t2
);

3845 
DHCPV6_CONFIRM
:

3850 
	`mem£t
(
addrds
.
bufãr
->
d©a
 + 16, 0, 8);

3851 
	`log_debug
("XMT: | X-- Confirm Address %s",

3852 
	`pŸddr
(
addr
->
add»ss
));

3855 
DHCPV6_RELEASE
:

3857 
	`mem£t
(
addrds
.
bufãr
->
d©a
 + 16, 0, 8);

3858 
	`log_debug
("XMT: | X-- Release Address %s",

3859 
	`pŸddr
(
addr
->
add»ss
));

3862 
DHCPV6_DECLINE
:

3864 
	`mem£t
(
addrds
.
bufãr
->
d©a
 + 16, 0, 8);

3865 
	`log_debug
("XMT: | X-- Decline Address %s",

3866 
	`pŸddr
(
addr
->
add»ss
));

3870 
	`log_çl
("Impossible condition‡t %s:%d.",

3871 
MDL
);

3874 
	`­³nd_İtiÚ
(&
Ÿds
, &
dhıv6_univ”£
, 
Ÿaddr_İtiÚ
,

3875 &
addrds
);

3876 
	`d©a_¡ršg_fÜg‘
(&
addrds
, 
MDL
);

3883 ià(
Ÿ
->
addrs
 =ğ
NULL
) {

3884 
	`log_debug
("!!!: V IA_NA has‚o IAADDRs -„emoved.");

3885 
rv®
 = 
ISC_R_FAILURE
;

3886 } ià(
rv®
 =ğ
ISC_R_SUCCESS
) {

3887 
	`log_debug
("XMT: V IA_NA‡ppended.");

3888 
	`­³nd_İtiÚ
(
·ck‘
, &
dhıv6_univ”£
, 
Ÿ_Ç_İtiÚ
,

3889 &
Ÿds
);

3892 
	`d©a_¡ršg_fÜg‘
(&
Ÿds
, 
MDL
);

3895 ià(
rv®
 =ğ
ISC_R_SUCCESS
)

3896 *
added
 = 
i
;

3898  (
rv®
);

3899 
	}
}

3926 
isc_»suÉ_t


3927 
	$dhc6_add_Ÿ_
(
ş›Á_¡©e
 *
ş›Á
, 
d©a_¡ršg
 *
·ck‘
,

3928 
dhc6_Ëa£
 *
Ëa£
, 
u_št8_t
 
mes§ge
,

3929 
wª‹d
, *
added
)

3931 
d©a_¡ršg
 
Ÿds
;

3932 
d©a_¡ršg
 
addrds
;

3933 
dhc6_addr
 *
addr
;

3934 
dhc6_Ÿ
 *
Ÿ
;

3935 
isc_»suÉ_t
 
rv®
 = 
ISC_R_SUCCESS
;

3936 
TIME
 
t1
, 
t2
;

3937 
i
;

3939 *
added
 = 0;

3940 
	`mem£t
(&
Ÿds
, 0, (iads));

3941 
	`mem£t
(&
addrds
, 0, (addrds));

3942 
Ÿ
 = 
Ëa£
->
bšdšgs
, 
i
 = 0;

3943 
Ÿ
 !ğ
NULL
 && 
rv®
 =ğ
ISC_R_SUCCESS
 && (
wª‹d
 =ğ0 || 
i
 < wanted);

3944 
Ÿ
 = ia->
Ãxt
) {

3945 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_TA
)

3949 
i
++;

3951 ià(!
	`bufãr_®loÿ‹
(&
Ÿds
.
bufãr
, 4, 
MDL
)) {

3952 
	`log_”rÜ
("Unableo‡llocate memory for IA_TA.");

3953 
rv®
 = 
ISC_R_NOMEMORY
;

3958 
	`memıy
(
Ÿds
.
bufãr
->
d©a
, 
Ÿ
->
Ÿid
, 4);

3959 
Ÿds
.
d©a
 = iads.
bufãr
->data;

3960 
Ÿds
.
Ën
 = 4;

3962 
	`log_debug
("XMT: X-- IA_TA %s",

3963 
	`´št_hex_1
(4, 
Ÿds
.
bufãr
->
d©a
, 55));

3965 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

3971 ià(
addr
->
æags
 & 
DHC6_ADDR_EXPIRED
)

3974 ià(
addr
->
add»ss
.
Ën
 != 16) {

3975 
	`log_”rÜ
("Illegal IPv6‡ddress†ength (%d), "

3977 
addr
->
add»ss
.
Ën
, 
MDL
);

3981 ià(!
	`bufãr_®loÿ‹
(&
addrds
.
bufãr
, 24, 
MDL
)) {

3982 
	`log_”rÜ
("Unableo‡llocate memory for "

3984 
rv®
 = 
ISC_R_NOMEMORY
;

3988 
addrds
.
d©a
 =‡ddrds.
bufãr
->data;

3989 
addrds
.
Ën
 = 24;

3992 
	`memıy
(
addrds
.
bufãr
->
d©a
, 
addr
->
add»ss
.
Ÿbuf
, 16);

3995 
mes§ge
) {

3996 
DHCPV6_REQUEST
:

3997 
DHCPV6_RENEW
:

3998 
DHCPV6_REBIND
:

3999 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
;

4000 
t2
 = 
t1
 + 300;

4001 
	`putULÚg
(
addrds
.
bufãr
->
d©a
 + 16, 
t1
);

4002 
	`putULÚg
(
addrds
.
bufãr
->
d©a
 + 20, 
t2
);

4004 
	`log_debug
("XMT: | | X-- IAADDR %s",

4005 
	`pŸddr
(
addr
->
add»ss
));

4006 
	`log_debug
("XMT: | | | X-- Preferred "

4007 "liãtim+%u", ()
t1
);

4008 
	`log_debug
("XMT: | | | X-- Max†ifetime +%u",

4009 ()
t2
);

4013 
DHCPV6_CONFIRM
:

4018 
	`mem£t
(
addrds
.
bufãr
->
d©a
 + 16, 0, 8);

4019 
	`log_debug
("XMT: | X-- Confirm Address %s",

4020 
	`pŸddr
(
addr
->
add»ss
));

4023 
DHCPV6_RELEASE
:

4025 
	`mem£t
(
addrds
.
bufãr
->
d©a
 + 16, 0, 8);

4026 
	`log_debug
("XMT: | X-- Release Address %s",

4027 
	`pŸddr
(
addr
->
add»ss
));

4031 
	`log_çl
("Impossible condition‡t %s:%d.",

4032 
MDL
);

4035 
	`­³nd_İtiÚ
(&
Ÿds
, &
dhıv6_univ”£
, 
Ÿaddr_İtiÚ
,

4036 &
addrds
);

4037 
	`d©a_¡ršg_fÜg‘
(&
addrds
, 
MDL
);

4044 ià(
Ÿ
->
addrs
 =ğ
NULL
) {

4045 
	`log_debug
("!!!: V IA_TA has‚o IAADDRs -„emoved.");

4046 
rv®
 = 
ISC_R_FAILURE
;

4047 } ià(
rv®
 =ğ
ISC_R_SUCCESS
) {

4048 
	`log_debug
("XMT: V IA_TA‡ppended.");

4049 
	`­³nd_İtiÚ
(
·ck‘
, &
dhıv6_univ”£
, 
Ÿ__İtiÚ
,

4050 &
Ÿds
);

4053 
	`d©a_¡ršg_fÜg‘
(&
Ÿds
, 
MDL
);

4056 ià(
rv®
 =ğ
ISC_R_SUCCESS
)

4057 *
added
 = 
i
;

4059  (
rv®
);

4060 
	}
}

4087 
isc_»suÉ_t


4088 
	$dhc6_add_Ÿ_pd
(
ş›Á_¡©e
 *
ş›Á
, 
d©a_¡ršg
 *
·ck‘
,

4089 
dhc6_Ëa£
 *
Ëa£
, 
u_št8_t
 
mes§ge
,

4090 
wª‹d
, *
added
)

4092 
d©a_¡ršg
 
Ÿds
;

4093 
d©a_¡ršg
 
´efds
;

4094 
dhc6_addr
 *
´ef
;

4095 
dhc6_Ÿ
 *
Ÿ
;

4096 
isc_»suÉ_t
 
rv®
 = 
ISC_R_SUCCESS
;

4097 
TIME
 
t1
, 
t2
;

4098 
i
;

4100 *
added
 = 0;

4101 
	`mem£t
(&
Ÿds
, 0, (iads));

4102 
	`mem£t
(&
´efds
, 0, (prefds));

4103 
Ÿ
 = 
Ëa£
->
bšdšgs
, 
i
 = 0;

4104 
Ÿ
 !ğ
NULL
 && 
rv®
 =ğ
ISC_R_SUCCESS
 && (
wª‹d
 =ğ0 || 
i
 < wanted);

4105 
Ÿ
 = ia->
Ãxt
) {

4106 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_PD
)

4110 
i
++;

4112 ià(!
	`bufãr_®loÿ‹
(&
Ÿds
.
bufãr
, 12, 
MDL
)) {

4113 
	`log_”rÜ
("Unableo‡llocate memory for IA_PD.");

4114 
rv®
 = 
ISC_R_NOMEMORY
;

4119 
	`memıy
(
Ÿds
.
bufãr
->
d©a
, 
Ÿ
->
Ÿid
, 4);

4120 
Ÿds
.
d©a
 = iads.
bufãr
->data;

4121 
Ÿds
.
Ën
 = 12;

4123 
mes§ge
) {

4124 
DHCPV6_REQUEST
:

4125 
DHCPV6_RENEW
:

4126 
DHCPV6_REBIND
:

4128 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
 / 2;

4129 
t2
 = 
t1
 + (t1 / 2);

4130 #ià
MAX_TIME
 > 0xffffffff

4131 ià(
t1
 > 0xffffffff)

4132 
t1
 = 0xffffffff;

4133 ià(
t2
 > 0xffffffff)

4134 
t2
 = 0xffffffff;

4136 
	`putULÚg
(
Ÿds
.
bufãr
->
d©a
 + 4, 
t1
);

4137 
	`putULÚg
(
Ÿds
.
bufãr
->
d©a
 + 8, 
t2
);

4139 
	`log_debug
("XMT: X-- IA_PD %s",

4140 
	`´št_hex_1
(4, 
Ÿds
.
d©a
, 59));

4141 
	`log_debug
("XMT: | X-- Requested„enew +%u",

4142 (è
t1
);

4143 
	`log_debug
("XMT: | X-- Requested„ebind +%u",

4144 (è
t2
);

4147 
DHCPV6_RELEASE
:

4149 
	`mem£t
(
Ÿds
.
bufãr
->
d©a
 + 4, 0, 8);

4150 
	`log_debug
("XMT: X-- IA_PD %s",

4151 
	`´št_hex_1
(4, 
Ÿds
.
bufãr
->
d©a
, 55));

4156 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

4159 
´ef
 = 
Ÿ
->
addrs
 ;…»à!ğ
NULL
 ;…»àğ´ef->
Ãxt
) {

4165 ià(
´ef
->
æags
 & 
DHC6_ADDR_EXPIRED
)

4168 ià(
´ef
->
add»ss
.
Ën
 != 16) {

4169 
	`log_”rÜ
("Illegal IPv6…refix "

4171 
MDL
);

4175 ià(
´ef
->
¶’
 == 0) {

4176 
	`log_šfo
("Null IPv6…refix, "

4178 
MDL
);

4181 ià(!
	`bufãr_®loÿ‹
(&
´efds
.
bufãr
, 25, 
MDL
)) {

4182 
	`log_”rÜ
("Unableo‡llocate memory for "

4184 
rv®
 = 
ISC_R_NOMEMORY
;

4188 
´efds
.
d©a
 =…»fds.
bufãr
->data;

4189 
´efds
.
Ën
 = 25;

4192 
	`putUCh¬
(
´efds
.
bufãr
->
d©a
 + 8, 
´ef
->
¶’
);

4193 
	`memıy
(
´efds
.
bufãr
->
d©a
 + 9,

4194 
´ef
->
add»ss
.
Ÿbuf
,

4198 
mes§ge
) {

4199 
DHCPV6_REQUEST
:

4200 
DHCPV6_RENEW
:

4201 
DHCPV6_REBIND
:

4202 
t1
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
;

4203 
t2
 = 
t1
 + 300;

4204 
	`putULÚg
(
´efds
.
bufãr
->
d©a
, 
t1
);

4205 
	`putULÚg
(
´efds
.
bufãr
->
d©a
 + 4, 
t2
);

4207 
	`log_debug
("XMT: | | X-- IAPREFIX %s/%u",

4208 
	`pŸddr
(
´ef
->
add»ss
),

4209 (è
´ef
->
¶’
);

4210 
	`log_debug
("XMT: | | | X-- Preferred "

4211 "liãtim+%u", ()
t1
);

4212 
	`log_debug
("XMT: | | | X-- Max†ifetime +%u",

4213 ()
t2
);

4217 
DHCPV6_RELEASE
:

4219 
	`mem£t
(
´efds
.
bufãr
->
d©a
, 0, 8);

4220 
	`log_debug
("XMT: | X-- Release Prefix %s/%u",

4221 
	`pŸddr
(
´ef
->
add»ss
),

4222 (è
´ef
->
¶’
);

4226 
	`log_çl
("Impossible condition‡t %s:%d.",

4227 
MDL
);

4230 
	`­³nd_İtiÚ
(&
Ÿds
, &
dhıv6_univ”£
,

4231 
Ÿ´efix_İtiÚ
, &
´efds
);

4232 
	`d©a_¡ršg_fÜg‘
(&
´efds
, 
MDL
);

4239 ià(
Ÿ
->
addrs
 =ğ
NULL
) {

4240 
	`log_debug
("!!!: V IA_PD has‚o IAPREFIXs -„emoved.");

4241 
rv®
 = 
ISC_R_FAILURE
;

4242 } ià(
rv®
 =ğ
ISC_R_SUCCESS
) {

4243 
	`log_debug
("XMT: V IA_PD‡ppended.");

4244 
	`­³nd_İtiÚ
(
·ck‘
, &
dhıv6_univ”£
,

4245 
Ÿ_pd_İtiÚ
, &
Ÿds
);

4248 
	`d©a_¡ršg_fÜg‘
(&
Ÿds
, 
MDL
);

4251 ià(
rv®
 =ğ
ISC_R_SUCCESS
)

4252 *
added
 = 
i
;

4254  (
rv®
);

4255 
	}
}

4259 
isc_boŞ—n_t


4260 
	$¡İpšg_fšished
()

4262 
š‹rçû_šfo
 *

;

4263 
ş›Á_¡©e
 *
ş›Á
;

4265 

 = 
š‹rçûs
; ip; i°ğ -> 
Ãxt
) {

4266 
ş›Á
 = 

 -> cl›Á; cl›Á; cl›Á = cl›Á -> 
Ãxt
) {

4267 ià(
ş›Á
->
¡©e
 !ğ
S_STOPPED
)

4268  
ISC_FALSE
;

4269 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

4270  
ISC_FALSE
;

4273  
ISC_TRUE
;

4274 
	}
}

4280 
	$»¶y_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
)

4282 
dhc6_Ëa£
 *
Ëa£
;

4283 
isc_»suÉ_t
 
check_¡©us
;

4285 ià(
·ck‘
->
dhıv6_msg_ty³
 !ğ
DHCPV6_REPLY
)

4291 ià(!
	`v®id_»¶y
(
·ck‘
, 
ş›Á
)) {

4292 
	`log_”rÜ
("Invalid Reply -„ejecting.");

4296 
Ëa£
 = 
	`dhc6_Ëa£ify
(
·ck‘
, 
ş›Á
);

4301 ià(
Ëa£
 =ğ
NULL
)

4304 
check_¡©us
 = 
	`dhc6_check_»¶y
(
ş›Á
, 
Ëa£
);

4305 ià(
check_¡©us
 !ğ
ISC_R_SUCCESS
) {

4306 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

4311 ià(
check_¡©us
 !ğ
ISC_R_CANCELED
)

4316 
	`ÿnûl_timeout
(
do_cÚfœm6
, 
ş›Á
);

4317 
	`ÿnûl_timeout
(
do_£Ëù6
, 
ş›Á
);

4318 
	`ÿnûl_timeout
(
do_»äesh6
, 
ş›Á
);

4319 
	`ÿnûl_timeout
(
do_»Ëa£6
, 
ş›Á
);

4320 
	`ÿnûl_timeout
(
do_deşše6
, 
ş›Á
);

4323 ià(
ş›Á
->
¡©e
 =ğ
S_STOPPED
) {

4324 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
) {

4325 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
aùive_Ëa£
, 
MDL
);

4326 
ş›Á
->
aùive_Ëa£
 = 
NULL
;

4328 ià(
	`¡İpšg_fšished
()) {

4329 
	`fšish
(0);

4336 ià(
ş›Á
->
¡©e
 =ğ
S_DECLINING
) {

4339 
live_út
 = 
	`drİ_deşšed_addrs
(
ş›Á
->
aùive_Ëa£
);

4340 ià(
live_út
 == 0) {

4341 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
aùive_Ëa£
, 
MDL
);

4342 
ş›Á
->
aùive_Ëa£
 = 
NULL
;

4348 
	`¡¬t_š™6
(
ş›Á
);

4355 ià(
check_¡©us
 =ğ
ISC_R_CANCELED
)

4358 ià(
ş›Á
->
£Ëùed_Ëa£
 !ğ
NULL
) {

4359 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
£Ëùed_Ëa£
, 
MDL
);

4360 
ş›Á
->
£Ëùed_Ëa£
 = 
NULL
;

4366 ià(
ş›Á
->
¡©e
 =ğ
S_REBOOTING
) {

4367 ià(
ş›Á
->
aùive_Ëa£
 =ğ
NULL
)

4368 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

4370 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

4371 
	`¡¬t_bound
(
ş›Á
);

4378 
	`dhc6_m”ge_Ëa£
(
ş›Á
->
aùive_Ëa£
, 
Ëa£
);

4381 ià(
ş›Á
->
Şd_Ëa£
 !ğ
NULL
) {

4382 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
Şd_Ëa£
, 
MDL
);

4383 
ş›Á
->
Şd_Ëa£
 = 
NULL
;

4387 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

4388 
ş›Á
->
Şd_Ëa£
 = cl›Á->
aùive_Ëa£
;

4389 
ş›Á
->
aùive_Ëa£
 = 
Ëa£
;

4392 
ş›Á
->
adv”ti£d_Ëa£s
 !ğ
NULL
) {

4393 
Ëa£
 = 
ş›Á
->
adv”ti£d_Ëa£s
;

4394 
ş›Á
->
adv”ti£d_Ëa£s
 = 
Ëa£
->
Ãxt
;

4396 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

4399 
	`¡¬t_bound
(
ş›Á
);

4400 
	}
}

4416 
	$dhc6_m¬sh®l_v®ues
(cÚ¡ *
´efix
, 
ş›Á_¡©e
 *
ş›Á
,

4417 
dhc6_Ëa£
 *
Ëa£
, 
dhc6_Ÿ
 *
Ÿ
,

4418 
dhc6_addr
 *
addr
)

4423 ià((
Ëa£
 !ğ
NULL
è&& (Ëa£->
İtiÚs
 != NULL))

4424 
	`süt_wr™e_·¿ms6
(
ş›Á
, 
´efix
, 
Ëa£
->
İtiÚs
);

4425 ià((
Ÿ
 !ğ
NULL
è&& (Ÿ->
İtiÚs
 != NULL))

4426 
	`süt_wr™e_·¿ms6
(
ş›Á
, 
´efix
, 
Ÿ
->
İtiÚs
);

4427 ià((
addr
 !ğ
NULL
è&& (addr->
İtiÚs
 != NULL))

4428 
	`süt_wr™e_·¿ms6
(
ş›Á
, 
´efix
, 
addr
->
İtiÚs
);

4431 ià(
addr
 !ğ
NULL
) {

4432 ià((
Ÿ
 !ğ
NULL
è&& (Ÿ->
Ÿ_ty³
 =ğ
D6O_IA_PD
)) {

4433 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
,

4435 
	`pŸddr
(
addr
->
add»ss
),

4436 (è
addr
->
¶’
);

4438 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "ip6_prefixlen",

4439 "%d", 
add»ss_´efix_Ën
);

4440 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "ip6_address",

4441 "%s", 
	`pŸddr
(
addr
->
add»ss
));

4443 ià((
Ÿ
 !ğ
NULL
è&& (Ÿ->
Ÿ_ty³
 =ğ
D6O_IA_TA
)) {

4444 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
,

4447 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "life_starts", "%d",

4448 ()(
addr
->
¡¬ts
));

4449 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "preferred_life", "%u",

4450 
addr
->
´eã¼ed_liã
);

4451 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "max_life", "%u",

4452 
addr
->
max_liã
);

4456 ià(
Ÿ
 !ğ
NULL
) {

4457 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "iaid", "%s",

4458 
	`´št_hex_1
(4, 
Ÿ
->
Ÿid
, 12));

4459 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "starts", "%d",

4460 ()(
Ÿ
->
¡¬ts
));

4461 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "»Ãw", "%u", 
Ÿ
->
»Ãw
);

4462 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "»bšd", "%u", 
Ÿ
->
»bšd
);

4464 
	}
}

4470 
	$dhc6_check_times
(
ş›Á_¡©e
 *
ş›Á
)

4472 
dhc6_Ëa£
 *
Ëa£
;

4473 
dhc6_Ÿ
 *
Ÿ
;

4474 
dhc6_addr
 *
addr
;

4475 
TIME
 
»Ãw
=
MAX_TIME
, 
»bšd
=MAX_TIME, 
d•»f
=MAX_TIME,

4476 
lo_expœe
=
MAX_TIME
, 
hi_expœe
=0, 
max_Ÿ_¡¬ts
 = 0, 
tmp
;

4477 
has_addrs
 = 
ISC_FALSE
;

4478 
has_´eã¼ed_addrs
 = 
ISC_FALSE
;

4479 
timev®
 
tv
;

4481 
Ëa£
 = 
ş›Á
->
aùive_Ëa£
;

4486 
	`ÿnûl_timeout
(
¡¬t_»Ãw6
, 
ş›Á
);

4487 
	`ÿnûl_timeout
(
¡¬t_»bšd6
, 
ş›Á
);

4488 
	`ÿnûl_timeout
(
do_d•»f
, 
ş›Á
);

4489 
	`ÿnûl_timeout
(
do_expœe
, 
ş›Á
);

4491 
Ÿ
 = 
Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

4492 
TIME
 
this_Ÿ_lo_expœe
, 
this_Ÿ_hi_expœe
, 
u£_expœe
;

4494 
this_Ÿ_lo_expœe
 = 
MAX_TIME
;

4495 
this_Ÿ_hi_expœe
 = 0;

4497 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

4498 if(!(
addr
->
æags
 & 
DHC6_ADDR_DEPREFFED
)) {

4499 ià(
addr
->
´eã¼ed_liã
 == 0xffffffff)

4500 
tmp
 = 
MAX_TIME
;

4502 
tmp
 = 
addr
->
¡¬ts
 +

4503 
addr
->
´eã¼ed_liã
;

4505 ià(
tmp
 < 
d•»f
)

4506 
d•»f
 = 
tmp
;

4508 ià(!(
addr
->
æags
 & 
DHC6_ADDR_EXPIRED
)) {

4509 
has_´eã¼ed_addrs
 = 
ISC_TRUE
;

4513 ià(!(
addr
->
æags
 & 
DHC6_ADDR_EXPIRED
)) {

4515 ià(
addr
->
max_liã
 == 0xffffffff)

4516 
tmp
 = 
MAX_TIME
;

4518 
tmp
 = 
addr
->
¡¬ts
 +‡ddr->
max_liã
;

4521 
tmp
 -ğ
Ÿ
->
¡¬ts
;

4523 ià(
tmp
 > 
this_Ÿ_hi_expœe
)

4524 
this_Ÿ_hi_expœe
 = 
tmp
;

4525 ià(
tmp
 < 
this_Ÿ_lo_expœe
)

4526 
this_Ÿ_lo_expœe
 = 
tmp
;

4528 
has_addrs
 = 
ISC_TRUE
;

4533 ià(
this_Ÿ_lo_expœe
 <ğ(
this_Ÿ_hi_expœe
 / 2))

4534 
u£_expœe
 = 
this_Ÿ_hi_expœe
;

4536 
u£_expœe
 = 
this_Ÿ_lo_expœe
;

4542 ià((
u£_expœe
 =ğ
MAX_TIME
) || (use_expire <= 1))

4543 
u£_expœe
 = 
ş›Á
->
cÚfig
->
»que¡ed_Ëa£
 / 2;

4545 
u£_expœe
 /= 2;

4558 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_TA
) {

4559 ià(
Ÿ
->
¡¬ts
 > 
max_Ÿ_¡¬ts
)

4560 
max_Ÿ_¡¬ts
 = 
Ÿ
->
¡¬ts
;

4562 ià(
Ÿ
->
»Ãw
 == 0) {

4563 
tmp
 = 
u£_expœe
;

4564 } ià(
Ÿ
->
»Ãw
 == 0xffffffff)

4565 
tmp
 = 
MAX_TIME
;

4567 
tmp
 = 
Ÿ
->
»Ãw
;

4569 ià(
tmp
 < 
»Ãw
)

4570 
»Ãw
 = 
tmp
;

4572 ià(
Ÿ
->
»bšd
 == 0) {

4574 
tmp
 = 
u£_expœe
 + (use_expire / 2);

4575 } ià(
Ÿ
->
»bšd
 == 0xffffffff)

4576 
tmp
 = 
MAX_TIME
;

4578 
tmp
 = 
Ÿ
->
»bšd
;

4580 ià(
tmp
 < 
»bšd
)

4581 
»bšd
 = 
tmp
;

4588 
this_Ÿ_hi_expœe
 +ğ
Ÿ
->
¡¬ts
;

4589 
this_Ÿ_lo_expœe
 +ğ
Ÿ
->
¡¬ts
;

4591 ià(
this_Ÿ_hi_expœe
 > 
hi_expœe
)

4592 
hi_expœe
 = 
this_Ÿ_hi_expœe
;

4593 ià(
this_Ÿ_lo_expœe
 < 
lo_expœe
)

4594 
lo_expœe
 = 
this_Ÿ_lo_expœe
;

4606 ià(
has_addrs
 =ğ
ISC_FALSE
) {

4607 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
aùive_Ëa£
, 
MDL
);

4608 
ş›Á
->
aùive_Ëa£
 = 
NULL
;

4611 
	`¡¬t_š™6
(
ş›Á
);

4619 ià(
»Ãw
 !ğ
MAX_TIME
)

4620 
»Ãw
 +ğ
max_Ÿ_¡¬ts
;

4621 ià(
»bšd
 !ğ
MAX_TIME
)

4622 
»bšd
 +ğ
max_Ÿ_¡¬ts
;

4624 
ş›Á
->
¡©e
) {

4625 
S_BOUND
:

4629 ià((
»bšd
 > 
cur_time
è&& (
»Ãw
 <„ebind)) {

4630 
	`log_debug
("PRC: Renewalƒvent scheduled in %d seconds, "

4632 ()(
»Ãw
 - 
cur_time
),

4633 ()(
»bšd
 - 
»Ãw
));

4634 
ş›Á
->
Ãxt_MRD
 = 
»bšd
;

4635 
tv
.
tv_£c
 = 
»Ãw
;

4636 
tv
.
tv_u£c
 = 0;

4637 
	`add_timeout
(&
tv
, 
¡¬t_»Ãw6
, 
ş›Á
, 
NULL
, NULL);

4642 
S_RENEWING
:

4647 
ş›Á
->
MRD
 = 
»bšd
 - 
cur_time
;

4648 ià(
»bšd
 !ğ
MAX_TIME
) {

4649 
	`log_debug
("PRC: Rebindƒvent scheduled in %d seconds, "

4651 ()(
»bšd
 - 
cur_time
),

4652 ()(
hi_expœe
 - 
»bšd
));

4653 
ş›Á
->
Ãxt_MRD
 = 
hi_expœe
;

4654 
tv
.
tv_£c
 = 
»bšd
;

4655 
tv
.
tv_u£c
 = 0;

4656 
	`add_timeout
(&
tv
, 
¡¬t_»bšd6
, 
ş›Á
, 
NULL
, NULL);

4660 
S_REBINDING
:

4665 
ş›Á
->
MRD
 = 
hi_expœe
 - 
cur_time
;

4669 ià(
has_´eã¼ed_addrs
) {

4670 
	`log_çl
("Impossible condition, state %d‡t %s:%d.",

4671 
ş›Á
->
¡©e
, 
MDL
);

4679 ià(
d•»f
 !ğ
MAX_TIME
) {

4680 
	`log_debug
("PRC: Depreference scheduled in %d seconds.",

4681 ()(
d•»f
 - 
cur_time
));

4682 
tv
.
tv_£c
 = 
d•»f
;

4683 
tv
.
tv_u£c
 = 0;

4684 
	`add_timeout
(&
tv
, 
do_d•»f
, 
ş›Á
, 
NULL
, NULL);

4686 ià(
lo_expœe
 !ğ
MAX_TIME
) {

4687 
	`log_debug
("PRC: Expiration scheduled in %d seconds.",

4688 ()(
lo_expœe
 - 
cur_time
));

4689 
tv
.
tv_£c
 = 
lo_expœe
;

4690 
tv
.
tv_u£c
 = 0;

4691 
	`add_timeout
(&
tv
, 
do_expœe
, 
ş›Á
, 
NULL
, NULL);

4693 
	}
}

4696 
dhc6_Ÿ
 *

4697 
	$fšd_Ÿ
(
dhc6_Ÿ
 *
h—d
, 
u_št16_t
 
ty³
, cÚ¡ *
id
)

4699 
dhc6_Ÿ
 *
Ÿ
;

4701 
Ÿ
 = 
h—d
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

4702 ià(
Ÿ
->
Ÿ_ty³
 !ğ
ty³
)

4704 ià(
	`memcmp
(
Ÿ
->
Ÿid
, 
id
, 4) == 0)

4705  
Ÿ
;

4708  
NULL
;

4709 
	}
}

4712 
dhc6_addr
 *

4713 
	$fšd_addr
(
dhc6_addr
 *
h—d
, 
Ÿddr
 *
add»ss
)

4715 
dhc6_addr
 *
addr
;

4717 
addr
 = 
h—d
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

4718 ià((
addr
->
add»ss
.
Ën
 ==‡ddress->len) &&

4719 (
	`memcmp
(
addr
->
add»ss
.
Ÿbuf
,‡ddress->iabuf,

4720 
add»ss
->
Ën
) == 0))

4721  
addr
;

4724  
NULL
;

4725 
	}
}

4728 
dhc6_addr
 *

4729 
	$fšd_´ef
(
dhc6_addr
 *
h—d
, 
Ÿddr
 *
´efix
, 
u_št8_t
 
¶’
)

4731 
dhc6_addr
 *
´ef
;

4733 
´ef
 = 
h—d
 ;…»à!ğ
NULL
 ;…»àğ´ef->
Ãxt
) {

4734 ià((
´ef
->
add»ss
.
Ën
 =ğ
´efix
->len) &&

4735 (
´ef
->
¶’
 ==…len) &&

4736 (
	`memcmp
(
´ef
->
add»ss
.
Ÿbuf
, 
´efix
->iabuf,

4737 
´efix
->
Ën
) == 0))

4738  
´ef
;

4741  
NULL
;

4742 
	}
}

4764 
	$dhc6_m”ge_Ëa£
(
dhc6_Ëa£
 *
¤c
, dhc6_Ëa£ *
d¡
)

4766 
dhc6_Ÿ
 *
sŸ
, *
dŸ
, *
tŸ
, **
eŸ
;

4767 
dhc6_addr
 *
§ddr
, *
daddr
, *
ddr
;

4768 
chªges
 = 0;

4770 ià((
d¡
 =ğ
NULL
è|| (
¤c
 == NULL))

4773 
sŸ
 = 
¤c
->
bšdšgs
 ; sŸ !ğ
NULL
 ; sŸ = sŸ->
Ãxt
) {

4774 
dŸ
 = 
	`fšd_Ÿ
(
d¡
->
bšdšgs
, 
sŸ
->
Ÿ_ty³
, (*)sŸ->
Ÿid
);

4776 ià(
dŸ
 =ğ
NULL
) {

4777 
tŸ
 = 
	`dhc6_dup_Ÿ
(
sŸ
, 
MDL
);

4779 ià(
tŸ
 =ğ
NULL
)

4780 
	`log_çl
("Out of memory merging†ease - "

4782 "¡©e! (%s:%d)", 
MDL
);

4792 
eŸ
 = &
d¡
->
bšdšgs
;

4793 *
eŸ
 !ğ
NULL
;

4794 
eŸ
 = &(*eŸ)->
Ãxt
) {

4797 *
eŸ
 = 
tŸ
;

4798 
chªges
 = 1;

4800 
§ddr
 = 
sŸ
->
addrs
 ; sadd¸!ğ
NULL
 ;

4801 
§ddr
 = saddr->
Ãxt
) {

4802 ià(
sŸ
->
Ÿ_ty³
 !ğ
D6O_IA_PD
)

4803 
daddr
 = 
	`fšd_addr
(
dŸ
->
addrs
,

4804 &
§ddr
->
add»ss
);

4806 
daddr
 = 
	`fšd_´ef
(
dŸ
->
addrs
,

4807 &
§ddr
->
add»ss
,

4808 
§ddr
->
¶’
);

4810 ià(
daddr
 =ğ
NULL
) {

4811 
ddr
 = 
	`dhc6_dup_addr
(
§ddr
, 
MDL
);

4813 ià(
ddr
 =ğ
NULL
)

4814 
	`log_çl
("Out of memory "

4819 
MDL
);

4822 
ddr
->
Ãxt
 = 
dŸ
->
addrs
;

4823 
dŸ
->
addrs
 = 
ddr
;

4824 
chªges
 = 1;

4831 ià(
chªges
)

4832 
d¡
->
scÜe
 = 0;

4833 
	}
}

4841 
	$¡¬t_bound
(
ş›Á_¡©e
 *
ş›Á
)

4843 
dhc6_Ÿ
 *
Ÿ
, *
ŞdŸ
;

4844 
dhc6_addr
 *
addr
, *
Şdaddr
;

4845 
dhc6_Ëa£
 *
Ëa£
, *
Şd
;

4846 cÚ¡ *
»asÚ
;

4847 
deşše_út
 = 0;

4848 #ià
	`defšed
 (
NSUPDATE
)

4849 
TIME
 
dns_upd©e_off£t
 = 1;

4852 
Ëa£
 = 
ş›Á
->
aùive_Ëa£
;

4853 ià(
Ëa£
 =ğ
NULL
) {

4854 
	`log_”rÜ
("Cannotƒnter bound state unless‡n‡ctive†ease "

4858 
Ëa£
->
»Ëa£d
 = 
ISC_FALSE
;

4859 
Şd
 = 
ş›Á
->
Şd_Ëa£
;

4861 
ş›Á
->
v6_hªdËr
 = 
bound_hªdËr
;

4863 
ş›Á
->
¡©e
) {

4864 
S_SELECTING
:

4865 
S_REBOOTING
:

4866 
»asÚ
 = "BOUND6";

4869 
S_RENEWING
:

4870 
»asÚ
 = "RENEW6";

4873 
S_REBINDING
:

4874 
»asÚ
 = "REBIND6";

4878 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

4883 
	`log_debug
("PRC: Boundo†ease %s.",

4884 
	`´št_hex_1
(
ş›Á
->
aùive_Ëa£
->
£rv”_id
.
Ën
,

4885 
ş›Á
->
aùive_Ëa£
->
£rv”_id
.
d©a
, 55));

4886 
ş›Á
->
¡©e
 = 
S_BOUND
;

4888 
	`wr™e_ş›Á6_Ëa£
(
ş›Á
, 
Ëa£
, 0, 1);

4890 
ŞdŸ
 = 
NULL
;

4891 
Ÿ
 = 
Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

4892 ià(
Şd
 !ğ
NULL
)

4893 
ŞdŸ
 = 
	`fšd_Ÿ
(
Şd
->
bšdšgs
,

4894 
Ÿ
->
Ÿ_ty³
,

4895 (*)
Ÿ
->
Ÿid
);

4897 
ŞdŸ
 = 
NULL
;

4899 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

4901 ià(
addr
->
æags
 & 
DHC6_ADDR_EXPIRED
)

4904 ià(
ŞdŸ
 !ğ
NULL
) {

4905 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_PD
)

4906 
Şdaddr
 = 
	`fšd_addr
(
ŞdŸ
->
addrs
,

4907 &
addr
->
add»ss
);

4909 
Şdaddr
 = 
	`fšd_´ef
(
ŞdŸ
->
addrs
,

4910 &
addr
->
add»ss
,

4911 
addr
->
¶’
);

4913 
Şdaddr
 = 
NULL
;

4915 #ià
	`defšed
 (
NSUPDATE
)

4916 ià((
Şdaddr
 =ğ
NULL
è&& (
Ÿ
->
Ÿ_ty³
 =ğ
D6O_IA_NA
))

4917 
	`dhş›Á_scheduË_upd©es
(
ş›Á
,

4918 &
addr
->
add»ss
,

4919 
dns_upd©e_off£t
++);

4923 
	`süt_š™
(
ş›Á
, 
»asÚ
, 
NULL
);

4925 ià(
Şd
 !ğ
NULL
)

4926 
	`dhc6_m¬sh®l_v®ues
("Şd_", 
ş›Á
, 
Şd
,

4927 
ŞdŸ
, 
Şdaddr
);

4928 
	`dhc6_m¬sh®l_v®ues
("Ãw_", 
ş›Á
, 
Ëa£
, 
Ÿ
, 
addr
);

4929 
	`süt_wr™e_»que¡ed6
(
ş›Á
);

4932 ià(
	`süt_go
(
ş›Á
) == 3) {

4933 ià(
Ÿ
->
Ÿ_ty³
 =ğ
D6O_IA_NA
) {

4934 
addr
->
æags
 |ğ
DHC6_ADDR_DECLINED
;

4935 
	`log_debug
 ("Flag‡ddress declined:%s",

4936 
	`pŸddr
(
addr
->
add»ss
));

4937 
deşše_út
++;

4944 ià(
deşše_út
) {

4945 
	`¡¬t_deşše6
(
ş›Á
);

4950 ià(
Ÿ
->
addrs
 =ğ
NULL
) {

4951 
	`süt_š™
(
ş›Á
, 
»asÚ
, 
NULL
);

4953 ià(
Şd
 !ğ
NULL
)

4954 
	`dhc6_m¬sh®l_v®ues
("Şd_", 
ş›Á
, 
Şd
,

4955 
ŞdŸ
,

4956 
ŞdŸ
 !ğ
NULL
 ?

4957 
ŞdŸ
->
addrs
 : 
NULL
);

4959 
	`dhc6_m¬sh®l_v®ues
("Ãw_", 
ş›Á
, 
Ëa£
, 
Ÿ
,

4960 
NULL
);

4961 
	`süt_wr™e_»que¡ed6
(
ş›Á
);

4963 
	`süt_go
(
ş›Á
);

4968 ià(
Ëa£
->
bšdšgs
 =ğ
NULL
) {

4969 
	`süt_š™
(
ş›Á
, 
»asÚ
, 
NULL
);

4971 ià(
Şd
 !ğ
NULL
)

4972 
	`dhc6_m¬sh®l_v®ues
("Şd_", 
ş›Á
, 
Şd
,

4973 
Şd
->
bšdšgs
,

4974 (
Şd
->
bšdšgs
 !ğ
NULL
) ?

4975 
Şd
->
bšdšgs
->
addrs
 : 
NULL
);

4977 
	`dhc6_m¬sh®l_v®ues
("Ãw_", 
ş›Á
, 
Ëa£
, 
NULL
, NULL);

4978 
	`süt_wr™e_»que¡ed6
(
ş›Á
);

4980 
	`süt_go
(
ş›Á
);

4983 #ifdeà
DHCP4o6


4984 ià(
dhıv4_ov”_dhıv6
)

4985 
	`dhı4o6_¡¬t
();

4988 
	`d‘ach
();

4990 ià(
ş›Á
->
Şd_Ëa£
 !ğ
NULL
) {

4991 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
Şd_Ëa£
, 
MDL
);

4992 
ş›Á
->
Şd_Ëa£
 = 
NULL
;

4996 
	`dhc6_check_times
(
ş›Á
);

4997 
	}
}

5003 
	$bound_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
)

5005 
	`log_debug
("RCV: Input…ackets‡re ignored once bound.");

5006 
	}
}

5013 
	$¡¬t_deşše6
(
ş›Á_¡©e
 *
ş›Á
)

5016 
	`ÿnûl_timeout
(
do_cÚfœm6
, 
ş›Á
);

5017 
	`ÿnûl_timeout
(
do_£Ëù6
, 
ş›Á
);

5018 
	`ÿnûl_timeout
(
do_»äesh6
, 
ş›Á
);

5019 
	`ÿnûl_timeout
(
do_»Ëa£6
, 
ş›Á
);

5020 
	`ÿnûl_timeout
(
do_deşše6
, 
ş›Á
);

5021 
ş›Á
->
¡©e
 = 
S_DECLINING
;

5023 ià(
ş›Á
->
aùive_Ëa£
 =ğ
NULL
)

5027 
ş›Á
->
IRT
 = 
DEC_TIMEOUT
 * 100;

5028 
ş›Á
->
MRT
 = 0;

5029 
ş›Á
->
MRC
 = 
DEC_MAX_RC
;

5030 
ş›Á
->
MRD
 = 0;

5032 
	`dhc6_»Œªs_š™
(
ş›Á
);

5033 
ş›Á
->
v6_hªdËr
 = 
»¶y_hªdËr
;

5035 
ş›Á
->
»äesh_ty³
 = 
DHCPV6_DECLINE
;

5036 
	`do_deşše6
(
ş›Á
);

5037 
	}
}

5046 
	$do_deşše6
(*
šput
)

5048 
ş›Á_¡©e
 *
ş›Á
;

5049 
d©a_¡ršg
 
ds
;

5050 
£nd_»t
;

5051 
timev®
 
–­£d
, 
tv
;

5053 
ş›Á
 = 
šput
;

5054 ià(
ş›Á
 =ğ
NULL
 || cl›Á->
aùive_Ëa£
 == NULL) {

5058 ià((
ş›Á
->
MRC
 !ğ0è&& (ş›Á->
txcouÁ
 > client->MRC)) {

5059 
	`log_šfo
("Max„etransmission countƒxceeded.");

5060 
deşše_dÚe
;

5066 ià(
ş›Á
->
txcouÁ
 == 0) {

5067 
ş›Á
->
¡¬t_time
.
tv_£c
 = 
cur_tv
.tv_sec;

5068 
ş›Á
->
¡¬t_time
.
tv_u£c
 = 
cur_tv
.tv_usec;

5072 
–­£d
.
tv_£c
 = 
cur_tv
.tv_£ø- 
ş›Á
->
¡¬t_time
.tv_sec;

5073 
–­£d
.
tv_u£c
 = 
cur_tv
.tv_u£ø- 
ş›Á
->
¡¬t_time
.tv_usec;

5074 ià(
–­£d
.
tv_u£c
 < 0) {

5075 
–­£d
.
tv_£c
 -= 1;

5076 
–­£d
.
tv_u£c
 += 1000000;

5079 
	`mem£t
(&
ds
, 0, (ds));

5080 ià(!
	`bufãr_®loÿ‹
(&
ds
.
bufãr
, 4, 
MDL
)) {

5081 
	`log_”rÜ
("Unableo‡llocate memory for Decline.");

5082 
deşše_dÚe
;

5085 
ds
.
d©a
 = ds.
bufãr
->data;

5086 
ds
.
Ën
 = 4;

5087 
ds
.
bufãr
->
d©a
[0] = 
DHCPV6_DECLINE
;

5088 
	`memıy
(
ds
.
bufãr
->
d©a
 + 1, 
ş›Á
->
dhıv6_Œª§ùiÚ_id
, 3);

5092 ià((
–­£d
.
tv_£c
 < 0) || (elapsed.tv_sec > 655) ||

5093 ((
–­£d
.
tv_£c
 =ğ655è&& (–­£d.
tv_u£c
 > 350000))) {

5094 
ş›Á
->
–­£d
 = 0xffff;

5096 
ş›Á
->
–­£d
 =ƒÏp£d.
tv_£c
 * 100;

5097 
ş›Á
->
–­£d
 +ğ–­£d.
tv_u£c
 / 10000;

5100 
ş›Á
->
–­£d
 = 
	`htÚs
(client->elapsed);

5102 
	`log_debug
("XMT: Forming Decline.");

5103 
	`make_ş›Á6_İtiÚs
(
ş›Á
, &ş›Á->
£Á_İtiÚs
,

5104 
ş›Á
->
aùive_Ëa£
, 
DHCPV6_DECLINE
);

5105 
dhıv6_univ”£
.
	`’ÿpsuÏ‹
(&
ds
, 
NULL
, NULL, 
ş›Á
, NULL,

5106 
ş›Á
->
£Á_İtiÚs
, &
glob®_scİe
,

5107 &
dhıv6_univ”£
);

5110 ià(
	`dhc6_add_Ÿ_Ç_deşše
(
ş›Á
, &
ds
, cl›Á->
aùive_Ëa£
)

5111 !ğ
ISC_R_SUCCESS
) {

5112 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

5113 
deşše_dÚe
;

5117 
	`log_šfo
("XMT: Decline on %s, interval %ld0ms.",

5118 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name,

5119 ()
ş›Á
->
RT
);

5121 
£nd_»t
 = 
	`£nd_·ck‘6
(
ş›Á
->
š‹rçû
, 
ds
.
d©a
, ds.
Ën
,

5122 &
DHCPv6De¡Addr
);

5123 ià(
£nd_»t
 !ğ
ds
.
Ën
) {

5124 
	`log_”rÜ
("dhc6: sendpacket6() sent %d of %d bytes",

5125 
£nd_»t
, 
ds
.
Ën
);

5128 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

5131 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
ş›Á
->
RT
 / 100;

5132 
tv
.
tv_u£c
 = 
cur_tv
.tv_u£ø+ (
ş›Á
->
RT
 % 100) * 10000;

5133 ià(
tv
.
tv_u£c
 >= 1000000) {

5134 
tv
.
tv_£c
 += 1;

5135 
tv
.
tv_u£c
 -= 1000000;

5137 
	`add_timeout
(&
tv
, 
do_deşše6
, 
ş›Á
, 
NULL
, NULL);

5138 
	`dhc6_»Œªs_advªû
(
ş›Á
);

5141 
deşše_dÚe
:

5145 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
aùive_Ëa£
, 
MDL
);

5146 
ş›Á
->
aùive_Ëa£
 = 
NULL
;

5148 
	`¡¬t_š™6
(
ş›Á
);

5150 
	}
}

5157 
	$¡¬t_»Ãw6
(*
šput
)

5159 
ş›Á_¡©e
 *
ş›Á
;

5161 
ş›Á
 = (
ş›Á_¡©e
 *)
šput
;

5163 
	`log_šfo
("PRC: Renewing†ease on %s.",

5164 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name);

5165 
ş›Á
->
¡©e
 = 
S_RENEWING
;

5167 
ş›Á
->
v6_hªdËr
 = 
»¶y_hªdËr
;

5170 
ş›Á
->
IRT
 = 
REN_TIMEOUT
 * 100;

5171 
ş›Á
->
MRT
 = 
REN_MAX_RT
 * 100;

5172 
ş›Á
->
MRC
 = 0;

5176 
ş›Á
->
MRD
 = cl›Á->
Ãxt_MRD
 - 
cur_time
;

5178 
	`dhc6_»Œªs_š™
(
ş›Á
);

5180 
ş›Á
->
»äesh_ty³
 = 
DHCPV6_RENEW
;

5181 
	`do_»äesh6
(
ş›Á
);

5182 
	}
}

5189 
	$do_»äesh6
(*
šput
)

5191 
İtiÚ_ÿche
 *
oc
;

5192 
sockaddr_š6
 
uniÿ¡
, *
de¡_addr
 = &
DHCPv6De¡Addr
;

5193 
d©a_¡ršg
 
ds
;

5194 
ş›Á_¡©e
 *
ş›Á
;

5195 
dhc6_Ëa£
 *
Ëa£
;

5196 
timev®
 
–­£d
, 
tv
;

5197 
£nd_»t
, 
added
;

5199 
ş›Á
 = (
ş›Á_¡©e
 *)
šput
;

5200 
	`mem£t
(&
ds
, 0, (ds));

5202 
Ëa£
 = 
ş›Á
->
aùive_Ëa£
;

5203 ià(
Ëa£
 =ğ
NULL
) {

5204 
	`log_”rÜ
("Cannot„enew without‡n‡ctive binding.");

5209 
ş›Á
->
»äesh_ty³
) {

5210 
DHCPV6_RENEW
:

5211 
DHCPV6_REBIND
:

5215 
	`log_çl
("Internal inconsistency (%d)‡t %s:%d.",

5216 
ş›Á
->
»äesh_ty³
, 
MDL
);

5222 ià(
ş›Á
->
txcouÁ
 == 0) {

5223 
ş›Á
->
¡¬t_time
.
tv_£c
 = 
cur_tv
.tv_sec;

5224 
ş›Á
->
¡¬t_time
.
tv_u£c
 = 
cur_tv
.tv_usec;

5228 
–­£d
.
tv_£c
 = 
cur_tv
.tv_£ø- 
ş›Á
->
¡¬t_time
.tv_sec;

5229 
–­£d
.
tv_u£c
 = 
cur_tv
.tv_u£ø- 
ş›Á
->
¡¬t_time
.tv_usec;

5230 ià(
–­£d
.
tv_u£c
 < 0) {

5231 
–­£d
.
tv_£c
 -= 1;

5232 
–­£d
.
tv_u£c
 += 1000000;

5234 ià(((
ş›Á
->
MRC
 !ğ0è&& (ş›Á->
txcouÁ
 > client->MRC)) ||

5235 ((
ş›Á
->
MRD
 !ğ0è&& (
–­£d
.
tv_£c
 >= client->MRD))) {

5237 
	`dhc6_check_times
(
ş›Á
);

5245 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
Ëa£
->
İtiÚs
, 
D6O_UNICAST
);

5246 ià(
oc
 && 
	`ev®u©e_İtiÚ_ÿche
(&
ds
, 
NULL
, NULL, NULL,

5247 
Ëa£
->
İtiÚs
, 
NULL
, &
glob®_scİe
,

5248 
oc
, 
MDL
)) {

5249 ià(
ds
.
Ën
 < 16) {

5250 
	`log_”rÜ
("Inv®id uniÿ¡ o±iÚ†’gth %d.", 
ds
.
Ën
);

5252 
	`mem£t
(&
uniÿ¡
, 0, (
DHCPv6De¡Addr
));

5253 
uniÿ¡
.
sš6_çmy
 = 
AF_INET6
;

5254 
uniÿ¡
.
sš6_pÜt
 = 
»mÙe_pÜt
;

5255 
	`memıy
(&
uniÿ¡
.
sš6_addr
, 
ds
.
d©a
, 16);

5256 ià(
ş›Á
->
»äesh_ty³
 =ğ
DHCPV6_RENEW
) {

5257 
de¡_addr
 = &
uniÿ¡
;

5261 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

5265 
	`mem£t
(&
ds
, 0, (ds));

5266 ià(!
	`bufãr_®loÿ‹
(&
ds
.
bufãr
, 4, 
MDL
)) {

5267 
	`log_”rÜ
("Unableo‡llocate memory for…acket.");

5270 
ds
.
d©a
 = ds.
bufãr
->data;

5271 
ds
.
Ën
 = 4;

5273 
ds
.
bufãr
->
d©a
[0] = 
ş›Á
->
»äesh_ty³
;

5274 
	`memıy
(
ds
.
bufãr
->
d©a
 + 1, 
ş›Á
->
dhıv6_Œª§ùiÚ_id
, 3);

5278 ià((
–­£d
.
tv_£c
 < 0) || (elapsed.tv_sec > 655) ||

5279 ((
–­£d
.
tv_£c
 =ğ655è&& (–­£d.
tv_u£c
 > 350000))) {

5280 
ş›Á
->
–­£d
 = 0xffff;

5282 
ş›Á
->
–­£d
 =ƒÏp£d.
tv_£c
 * 100;

5283 
ş›Á
->
–­£d
 +ğ–­£d.
tv_u£c
 / 10000;

5286 ià(
ş›Á
->
–­£d
 == 0)

5287 
	`log_debug
("XMT: Forming %s, 0 msƒlapsed.",

5288 
dhıv6_ty³_Çmes
[
ş›Á
->
»äesh_ty³
]);

5290 
	`log_debug
("XMT: Forming %s, %u0 msƒlapsed.",

5291 
dhıv6_ty³_Çmes
[
ş›Á
->
»äesh_ty³
],

5292 ()
ş›Á
->
–­£d
);

5294 
ş›Á
->
–­£d
 = 
	`htÚs
(client->elapsed);

5296 
	`make_ş›Á6_İtiÚs
(
ş›Á
, &ş›Á->
£Á_İtiÚs
, 
Ëa£
,

5297 
ş›Á
->
»äesh_ty³
);

5300 
dhıv6_univ”£
.
	`’ÿpsuÏ‹
(&
ds
, 
NULL
, NULL, 
ş›Á
, NULL,

5301 
ş›Á
->
£Á_İtiÚs
, &
glob®_scİe
,

5302 &
dhıv6_univ”£
);

5309 ià(
wª‹d_Ÿ_Ç
 &&

5310 ((
	`dhc6_add_Ÿ_Ç
(
ş›Á
, &
ds
, 
Ëa£
, cl›Á->
»äesh_ty³
,

5311 
wª‹d_Ÿ_Ç
, &
added
è!ğ
ISC_R_SUCCESS
) ||

5312 (
	`dhc6_b¬e_Ÿ_xx
(
ş›Á
, &
ds
, 
wª‹d_Ÿ_Ç
 - 
added
,

5313 
D6O_IA_NA
è!ğ
ISC_R_SUCCESS
))) {

5314 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

5317 ià(
wª‹d_Ÿ_pd
 &&

5318 ((
	`dhc6_add_Ÿ_pd
(
ş›Á
, &
ds
, 
Ëa£
, cl›Á->
»äesh_ty³
,

5319 
wª‹d_Ÿ_pd
, &
added
è!ğ
ISC_R_SUCCESS
) ||

5320 (
	`dhc6_b¬e_Ÿ_xx
(
ş›Á
, &
ds
, 
wª‹d_Ÿ_pd
 - 
added
,

5321 
D6O_IA_PD
è!ğ
ISC_R_SUCCESS
))) {

5322 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

5326 
	`log_šfo
("XMT: %s on %s, interval %ld0ms.",

5327 
dhıv6_ty³_Çmes
[
ş›Á
->
»äesh_ty³
],

5328 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name,

5329 ()
ş›Á
->
RT
);

5331 
£nd_»t
 = 
	`£nd_·ck‘6
(
ş›Á
->
š‹rçû
, 
ds
.
d©a
, ds.
Ën
, 
de¡_addr
);

5333 ià(
£nd_»t
 !ğ
ds
.
Ën
) {

5334 
	`log_”rÜ
("dhc6: send_packet6() sent %d of %d bytes",

5335 
£nd_»t
, 
ds
.
Ën
);

5338 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

5341 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
ş›Á
->
RT
 / 100;

5342 
tv
.
tv_u£c
 = 
cur_tv
.tv_u£ø+ (
ş›Á
->
RT
 % 100) * 10000;

5343 ià(
tv
.
tv_u£c
 >= 1000000) {

5344 
tv
.
tv_£c
 += 1;

5345 
tv
.
tv_u£c
 -= 1000000;

5347 
	`add_timeout
(&
tv
, 
do_»äesh6
, 
ş›Á
, 
NULL
, NULL);

5349 
	`dhc6_»Œªs_advªû
(
ş›Á
);

5350 
	}
}

5358 
	$¡¬t_»bšd6
(*
šput
)

5360 
ş›Á_¡©e
 *
ş›Á
;

5362 
ş›Á
 = (
ş›Á_¡©e
 *)
šput
;

5364 
	`log_šfo
("PRC: Rebinding†ease on %s.",

5365 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name);

5366 
ş›Á
->
¡©e
 = 
S_REBINDING
;

5368 
ş›Á
->
v6_hªdËr
 = 
»¶y_hªdËr
;

5371 
ş›Á
->
IRT
 = 
REB_TIMEOUT
 * 100;

5372 
ş›Á
->
MRT
 = 
REB_MAX_RT
 * 100;

5373 
ş›Á
->
MRC
 = 0;

5377 
ş›Á
->
MRD
 = cl›Á->
Ãxt_MRD
 - 
cur_time
;

5379 
	`dhc6_»Œªs_š™
(
ş›Á
);

5381 
ş›Á
->
»äesh_ty³
 = 
DHCPV6_REBIND
;

5382 
	`do_»äesh6
(
ş›Á
);

5383 
	}
}

5392 
	$do_d•»f
(*
šput
)

5394 
ş›Á_¡©e
 *
ş›Á
;

5395 
dhc6_Ëa£
 *
Ëa£
;

5396 
dhc6_Ÿ
 *
Ÿ
;

5397 
dhc6_addr
 *
addr
;

5399 
ş›Á
 = (
ş›Á_¡©e
 *)
šput
;

5401 
Ëa£
 = 
ş›Á
->
aùive_Ëa£
;

5402 ià(
Ëa£
 =ğ
NULL
)

5405 
Ÿ
 = 
Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

5406 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

5407 ià(
addr
->
æags
 & 
DHC6_ADDR_DEPREFFED
)

5410 ià(
addr
->
¡¬ts
 +‡ddr->
´eã¼ed_liã
 <ğ
cur_time
) {

5411 
	`süt_š™
(
ş›Á
, "DEPREF6", 
NULL
);

5412 
	`dhc6_m¬sh®l_v®ues
("cur_", 
ş›Á
, 
Ëa£
,

5413 
Ÿ
, 
addr
);

5414 
	`süt_wr™e_»que¡ed6
(
ş›Á
);

5415 
	`süt_go
(
ş›Á
);

5417 
addr
->
æags
 |ğ
DHC6_ADDR_DEPREFFED
;

5419 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_PD
)

5420 
	`log_šfo
("PRC: Address %s depreferred.",

5421 
	`pŸddr
(
addr
->
add»ss
));

5423 
	`log_šfo
("PRC: Prefix %s/%u depreferred.",

5424 
	`pŸddr
(
addr
->
add»ss
),

5425 (è
addr
->
¶’
);

5427 #ià
	`defšed
 (
NSUPDATE
)

5429 ià((
Ÿ
->
Ÿ_ty³
 =ğ
D6O_IA_NA
) &&

5430 
ş›Á
->
cÚfig
->
do_fÜw¬d_upd©e
)

5431 
	`ş›Á_dns_»move
(
ş›Á
,

5432 &
addr
->
add»ss
);

5438 
	`dhc6_check_times
(
ş›Á
);

5439 
	}
}

5445 
	$do_expœe
(*
šput
)

5447 
ş›Á_¡©e
 *
ş›Á
;

5448 
dhc6_Ëa£
 *
Ëa£
;

5449 
dhc6_Ÿ
 *
Ÿ
, **
tŸ
;

5450 
dhc6_addr
 *
addr
;

5451 
has_addrs
 = 
ISC_FALSE
;

5452 
Ÿ_has_addrs
 = 
ISC_FALSE
;

5454 
ş›Á
 = (
ş›Á_¡©e
 *)
šput
;

5456 
Ëa£
 = 
ş›Á
->
aùive_Ëa£
;

5457 ià(
Ëa£
 =ğ
NULL
)

5460 
Ÿ
 = 
Ëa£
->
bšdšgs
, 
tŸ
 = &Ëa£->bšdšgs; i¨!ğ
NULL
 ; ) {

5461 
Ÿ_has_addrs
 = 
ISC_FALSE
;

5462 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

5463 ià(
addr
->
æags
 & 
DHC6_ADDR_EXPIRED
)

5466 ià(
addr
->
¡¬ts
 +‡ddr->
max_liã
 <ğ
cur_time
) {

5467 
	`süt_š™
(
ş›Á
, "EXPIRE6", 
NULL
);

5468 
	`dhc6_m¬sh®l_v®ues
("Şd_", 
ş›Á
, 
Ëa£
,

5469 
Ÿ
, 
addr
);

5470 
	`süt_wr™e_»que¡ed6
(
ş›Á
);

5471 
	`süt_go
(
ş›Á
);

5473 
addr
->
æags
 |ğ
DHC6_ADDR_EXPIRED
;

5475 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_PD
)

5476 
	`log_šfo
("PRC: Address %sƒxpired.",

5477 
	`pŸddr
(
addr
->
add»ss
));

5479 
	`log_šfo
("PRC: Prefix %s/%uƒxpired.",

5480 
	`pŸddr
(
addr
->
add»ss
),

5481 (è
addr
->
¶’
);

5483 #ià
	`defšed
 (
NSUPDATE
)

5488 ià((
Ÿ
->
Ÿ_ty³
 =ğ
D6O_IA_NA
) &&

5489 
ş›Á
->
cÚfig
->
do_fÜw¬d_upd©e
 &&

5490 !(
addr
->
æags
 & 
DHC6_ADDR_DEPREFFED
))

5491 
	`ş›Á_dns_»move
(
ş›Á
,

5492 &
addr
->
add»ss
);

5498 
Ÿ_has_addrs
 = 
ISC_TRUE
;

5499 
has_addrs
 = 
ISC_TRUE
;

5505 ià(
Ÿ_has_addrs
 =ğ
ISC_TRUE
) {

5507 
tŸ
 = &(*tŸ)->
Ãxt
;

5512 *
tŸ
 = 
Ÿ
->
Ãxt
;

5513 
	`dhc6_Ÿ_de¡roy
(&
Ÿ
, 
MDL
);

5516 
Ÿ
 = *
tŸ
;

5520 ià(
has_addrs
 =ğ
ISC_FALSE
) {

5521 
	`log_šfo
("PRC: Bound†ease is devoid of‡ctive‡ddresses."

5524 
	`dhc6_Ëa£_de¡roy
(&
Ëa£
, 
MDL
);

5525 
ş›Á
->
aùive_Ëa£
 = 
NULL
;

5527 
	`¡¬t_š™6
(
ş›Á
);

5532 
	`dhc6_check_times
(
ş›Á
);

5533 
	}
}

5542 
	$uncÚfigu»6
(
ş›Á_¡©e
 *
ş›Á
, cÚ¡ *
»asÚ
)

5544 
dhc6_Ÿ
 *
Ÿ
;

5545 
dhc6_addr
 *
addr
;

5547 ià(
¡©–ess
) {

5548 
	`süt_š™
(
ş›Á
, 
»asÚ
, 
NULL
);

5549 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

5550 
	`süt_wr™e_·¿ms6
(
ş›Á
, "old_",

5551 
ş›Á
->
aùive_Ëa£
->
İtiÚs
);

5552 
	`süt_wr™e_»que¡ed6
(
ş›Á
);

5553 
	`süt_go
(
ş›Á
);

5557 ià(
ş›Á
->
aùive_Ëa£
 =ğ
NULL
)

5560 
Ÿ
 = 
ş›Á
->
aùive_Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

5561 ià(
Ÿ
->
Ÿ_ty³
 =ğ
D6O_IA_TA
)

5564 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

5565 
	`süt_š™
(
ş›Á
, 
»asÚ
, 
NULL
);

5566 
	`dhc6_m¬sh®l_v®ues
("Şd_", 
ş›Á
,

5567 
ş›Á
->
aùive_Ëa£
, 
Ÿ
, 
addr
);

5568 
	`süt_wr™e_»que¡ed6
(
ş›Á
);

5569 
	`süt_go
(
ş›Á
);

5571 #ià
	`defšed
 (
NSUPDATE
)

5572 ià((
Ÿ
->
Ÿ_ty³
 =ğ
D6O_IA_NA
) &&

5573 
ş›Á
->
cÚfig
->
do_fÜw¬d_upd©e
)

5574 
	`ş›Á_dns_»move
(
ş›Á
, &
addr
->
add»ss
);

5578 
	}
}

5581 
	$»äesh_šfo_»que¡6
(*
šput
)

5583 
ş›Á_¡©e
 *
ş›Á
;

5585 
ş›Á
 = (
ş›Á_¡©e
 *)
šput
;

5586 
	`¡¬t_šfo_»que¡6
(
ş›Á
);

5587 
	}
}

5592 
	$dhc6_check_œt
(
ş›Á_¡©e
 *
ş›Á
)

5594 
İtiÚ
 **
»q
;

5595 
İtiÚ_ÿche
 *
oc
;

5596 
TIME
 
expœe
 = 
MAX_TIME
;

5597 
timev®
 
tv
;

5598 
i
;

5599 
isc_boŞ—n_t
 
found
 = 
ISC_FALSE
;

5601 
	`ÿnûl_timeout
(
»äesh_šfo_»que¡6
, 
ş›Á
);

5603 
»q
 = 
ş›Á
->
cÚfig
->
»que¡ed_İtiÚs
;

5604 
i
 = 0; 
»q
[i] !ğ
NULL
; i++) {

5605 ià(
»q
[
i
] =ğ
œt_İtiÚ
) {

5606 
found
 = 
ISC_TRUE
;

5611 ià(!
found
) {

5612 #ifdeà
DHCP4o6


5613 ià(!
dhıv4_ov”_dhıv6
)

5615 
	`fšish
(0);

5618 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
ş›Á
->
aùive_Ëa£
->
İtiÚs
,

5619 
D6O_INFORMATION_REFRESH_TIME
);

5620 ià(
oc
 !ğ
NULL
) {

5621 
d©a_¡ršg
 
œt
;

5623 
	`mem£t
(&
œt
, 0, (irt));

5624 ià(!
	`ev®u©e_İtiÚ_ÿche
(&
œt
, 
NULL
, NULL, 
ş›Á
,

5625 
ş›Á
->
aùive_Ëa£
->
İtiÚs
,

5626 
NULL
, &
glob®_scİe
, 
oc
, 
MDL
) ||

5627 (
œt
.
Ën
 < 4)) {

5628 
	`log_”rÜ
("Can'tƒvaluate IRT.");

5630 
expœe
 = 
	`g‘ULÚg
(
œt
.
d©a
);

5631 ià(
expœe
 < 
IRT_MINIMUM
)

5632 
expœe
 = 
IRT_MINIMUM
;

5633 ià(
expœe
 == 0xffffffff)

5634 
expœe
 = 
MAX_TIME
;

5636 
	`d©a_¡ršg_fÜg‘
(&
œt
, 
MDL
);

5638 
expœe
 = 
IRT_DEFAULT
;

5640 ià(
expœe
 !ğ
MAX_TIME
) {

5641 
	`log_debug
("PRC: Refreshƒvent scheduled in %u seconds.",

5642 (è
expœe
);

5643 
tv
.
tv_£c
 = 
cur_time
 + 
expœe
;

5644 
tv
.
tv_u£c
 = 0;

5645 
	`add_timeout
(&
tv
, 
»äesh_šfo_»que¡6
, 
ş›Á
, 
NULL
, NULL);

5647 
	}
}

5653 
	$¡¬t_šfÜmed
(
ş›Á_¡©e
 *
ş›Á
)

5655 
ş›Á
->
v6_hªdËr
 = 
šfÜmed_hªdËr
;

5657 
	`log_debug
("PRC: Done.");

5659 
ş›Á
->
¡©e
 = 
S_BOUND
;

5661 
	`süt_š™
(
ş›Á
, "RENEW6", 
NULL
);

5662 ià(
ş›Á
->
Şd_Ëa£
 !ğ
NULL
)

5663 
	`süt_wr™e_·¿ms6
(
ş›Á
, "old_",

5664 
ş›Á
->
Şd_Ëa£
->
İtiÚs
);

5665 
	`süt_wr™e_·¿ms6
(
ş›Á
, "Ãw_", cl›Á->
aùive_Ëa£
->
İtiÚs
);

5666 
	`süt_wr™e_»que¡ed6
(
ş›Á
);

5667 
	`süt_go
(
ş›Á
);

5669 #ifdeà
DHCP4o6


5670 ià(
dhıv4_ov”_dhıv6
)

5671 
	`dhı4o6_¡¬t
();

5674 
	`d‘ach
();

5676 ià(
ş›Á
->
Şd_Ëa£
 !ğ
NULL
) {

5677 
	`dhc6_Ëa£_de¡roy
(&
ş›Á
->
Şd_Ëa£
, 
MDL
);

5678 
ş›Á
->
Şd_Ëa£
 = 
NULL
;

5682 
	`dhc6_check_œt
(
ş›Á
);

5683 
	}
}

5688 
	$šfÜmed_hªdËr
(
·ck‘
 *·ck‘, 
ş›Á_¡©e
 *
ş›Á
)

5690 
	`log_debug
("RCV: Input…ackets‡re ignored once bound.");

5691 
	}
}

5698 
	$make_ş›Á6_İtiÚs
(
ş›Á_¡©e
 *
ş›Á
, 
İtiÚ_¡©e
 **
İ
,

5699 
dhc6_Ëa£
 *
Ëa£
, 
u_št8_t
 
mes§ge
)

5701 
İtiÚ_ÿche
 *
oc
;

5702 
İtiÚ
 **
»q
;

5703 
bufãr
 *buffer;

5704 
buæ’
, 
i
, 
Üo_Ën
;

5706 ià((
İ
 =ğ
NULL
è|| (
ş›Á
 == NULL))

5709 ià(*
İ
)

5710 
	`İtiÚ_¡©e_d”eã»nû
(
İ
, 
MDL
);

5713 
	`İtiÚ_¡©e_®loÿ‹
(
İ
, 
MDL
);

5716 
oc
 = 
NULL
;

5717 ià(
	`İtiÚ_ÿche_®loÿ‹
(&
oc
, 
MDL
)) {

5718 cÚ¡ *
cd©a
;

5720 
cd©a
 = (*)&
ş›Á
->
–­£d
;

5722 ià(
	`make_cÚ¡_d©a
(&
oc
->
ex´essiÚ
, 
cd©a
, 2, 0, 0, 
MDL
)) {

5723 
	`İtiÚ_»ã»nû
(&
oc
->
İtiÚ
, 
–­£d_İtiÚ
, 
MDL
);

5724 
	`§ve_İtiÚ
(&
dhıv6_univ”£
, *
İ
, 
oc
);

5727 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

5731 ià(
ş›Á
->
cÚfig
->
Ú_ŒªsmissiÚ
)

5732 
	`execu‹_¡©em’ts_š_scİe
(
NULL
, NULL, NULL, 
ş›Á
,

5733 
Ëa£
 ?†—£->
İtiÚs
 : 
NULL
,

5734 *
İ
, &
glob®_scİe
,

5735 
ş›Á
->
cÚfig
->
Ú_ŒªsmissiÚ
,

5736 
NULL
, NULL);

5739 ià(
mes§ge
 !ğ
DHCPV6_SOLICIT
)

5740 
	`d–‘e_İtiÚ
(&
dhıv6_univ”£
, *
İ
, 
D6O_RAPID_COMMIT
);

5745 ià((
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, *
İ
,

5746 
D6O_CLIENTID
)è=ğ
NULL
) {

5747 ià(!
	`İtiÚ_ÿche
(&
oc
, &
deçuÉ_duid
, 
NULL
, 
ş›Áid_İtiÚ
,

5748 
MDL
))

5749 
	`log_çl
("Failure‡ssembling‡ DUID.");

5751 
	`§ve_İtiÚ
(&
dhıv6_univ”£
, *
İ
, 
oc
);

5752 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

5761 ià(
Ëa£
 =ğ
NULL
) {

5762 ià((
mes§ge
 !ğ
DHCPV6_SOLICIT
) &&

5763 (
mes§ge
 !ğ
DHCPV6_INFORMATION_REQUEST
))

5764 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

5765 } ià((
mes§ge
 !ğ
DHCPV6_REBIND
) &&

5766 (
mes§ge
 !ğ
DHCPV6_CONFIRM
)) {

5767 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
Ëa£
->
İtiÚs
,

5768 
D6O_SERVERID
);

5769 ià(
oc
 !ğ
NULL
)

5770 
	`§ve_İtiÚ
(&
dhıv6_univ”£
, *
İ
, 
oc
);

5777 ià(
	`lookup_İtiÚ
(&
dhıv6_univ”£
, *
İ
, 
D6O_ORO
è!ğ
NULL
)

5778 
	`log_”rÜ
("'send dhcp6.oro' syntax is deprecated,…lease "

5815 
bufãr
 = 
NULL
;

5816 
Üo_Ën
 = 0;

5817 
buæ’
 = 32;

5818 ià(!
	`bufãr_®loÿ‹
(&
bufãr
, 
buæ’
, 
MDL
))

5819 
	`log_çl
("Out of memory constructing DHCPv6 ORO.");

5820 
»q
 = 
ş›Á
->
cÚfig
->
»que¡ed_İtiÚs
;

5821 ià(
»q
 !ğ
NULL
) {

5822 
i
 = 0 ; 
»q
[i] !ğ
NULL
 ; i++) {

5823 ià(
buæ’
 =ğ
Üo_Ën
) {

5824 
bufãr
 *
tmpbuf
 = 
NULL
;

5826 
buæ’
 += 32;

5829 
	`bufãr_»ã»nû
(&
tmpbuf
, 
bufãr
, 
MDL
);

5830 
	`bufãr_d”eã»nû
(&
bufãr
, 
MDL
);

5832 ià(!
	`bufãr_®loÿ‹
(&
bufãr
, 
buæ’
, 
MDL
))

5833 
	`log_çl
("Out of memory„esizing "

5836 
	`memıy
(
bufãr
->
d©a
, 
tmpbuf
->d©a, 
Üo_Ën
);

5838 
	`bufãr_d”eã»nû
(&
tmpbuf
, 
MDL
);

5841 ià(
»q
[
i
]->
univ”£
 =ğ&
dhıv6_univ”£
) {

5843 
	`putUShÜt
(
bufãr
->
d©a
 + 
Üo_Ën
,

5844 
»q
[
i
]->
code
);

5845 
Üo_Ën
 += 2;

5850 
oc
 = 
NULL
;

5851 ià(
	`make_cÚ¡_İtiÚ_ÿche
(&
oc
, &
bufãr
, 
NULL
, 
Üo_Ën
,

5852 
Üo_İtiÚ
, 
MDL
)) {

5853 
	`§ve_İtiÚ
(&
dhıv6_univ”£
, *
İ
, 
oc
);

5855 
	`log_çl
("Unableo create ORO option cache.");

5862 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

5863 
	}
}

5879 
	$süt_wr™e_·¿ms6
(
ş›Á_¡©e
 *
ş›Á
, cÚ¡ *
´efix
,

5880 
İtiÚ_¡©e
 *
İtiÚs
)

5882 
’vadd_¡©e
 
es
;

5883 
i
;

5885 ià(
İtiÚs
 =ğ
NULL
)

5888 
es
.
ş›Á
 = client;

5889 
es
.
´efix
 =…refix;

5891 
i
 = 0 ; i < 
İtiÚs
->
univ”£_couÁ
 ; i++) {

5892 
	`İtiÚ_¥aû_fÜ—ch
(
NULL
, NULL, 
ş›Á
, NULL, 
İtiÚs
,

5893 &
glob®_scİe
, 
univ”£s
[
i
], &
es
,

5894 
ş›Á_İtiÚ_’vadd
);

5896 
	}
}

5905 
	$süt_wr™e_»que¡ed6
(
ş›Á
)

5906 
ş›Á_¡©e
 *
ş›Á
;

5908 
i
;

5909 
İtiÚ
 **
»q
;

5910 
Çme
[256];

5911 
»q
 = 
ş›Á
->
cÚfig
->
»que¡ed_İtiÚs
;

5913 ià(
»q
 =ğ
NULL
)

5916 
i
 = 0 ; 
»q
[i] !ğ
NULL
 ; i++) {

5917 ià((
»q
[
i
]->
univ”£
 =ğ&
dhıv6_univ”£
) &&

5918 
	`dhı_İtiÚ_ev_Çme
 (
Çme
, Òame), 
»q
[
i
])) {

5919 
	`ş›Á_’vadd
(
ş›Á
, "»que¡ed_", 
Çme
, "%d", 1);

5922 
	}
}

5927 
isc_boŞ—n_t


5928 
	$aùive_´efix
(
ş›Á_¡©e
 *
ş›Á
)

5930 
dhc6_Ëa£
 *
Ëa£
;

5931 
dhc6_Ÿ
 *
Ÿ
;

5932 
dhc6_addr
 *
´ef
;

5933 
z”os
[16];

5935 
Ëa£
 = 
ş›Á
->
aùive_Ëa£
;

5936 ià(
Ëa£
 =ğ
NULL
)

5937  
ISC_FALSE
;

5938 
	`mem£t
(
z”os
, 0, 16);

5939 
Ÿ
 = 
Ëa£
->
bšdšgs
; i¨!ğ
NULL
; i¨ğŸ->
Ãxt
) {

5940 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_PD
)

5942 
´ef
 = 
Ÿ
->
addrs
;…»à!ğ
NULL
;…»àğ´ef->
Ãxt
) {

5943 ià(
´ef
->
¶’
 == 0)

5944  
ISC_FALSE
;

5945 ià(
´ef
->
add»ss
.
Ën
 != 16)

5946  
ISC_FALSE
;

5947 ià(
	`memcmp
(
´ef
->
add»ss
.
Ÿbuf
, 
z”os
, 16) == 0)

5948  
ISC_FALSE
;

5951  
ISC_TRUE
;

5952 
	}
}

5962 
isc_»suÉ_t


5963 
	$dhc6_add_Ÿ_Ç_deşše
(
ş›Á_¡©e
 *
ş›Á
, 
d©a_¡ršg
 *
·ck‘
,

5964 
dhc6_Ëa£
 *
Ëa£
) {

5965 
d©a_¡ršg
 
Ÿds
;

5966 
d©a_¡ršg
 
addrds
;

5967 
dhc6_addr
 *
addr
;

5968 
dhc6_Ÿ
 *
Ÿ
;

5969 
isc_»suÉ_t
 
rv®
 = 
ISC_R_SUCCESS
;

5971 
	`mem£t
(&
Ÿds
, 0, (iads));

5972 
	`mem£t
(&
addrds
, 0, (addrds));

5973 
Ÿ
 = 
Ëa£
->
bšdšgs
; i¨!ğ
NULL
 && 
rv®
 =ğ
ISC_R_SUCCESS
;

5974 
Ÿ
 = ia->
Ãxt
) {

5975 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_NA
)

5978 
¡¬t_Ãw_Ÿ
 = 1;

5979 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

5985 ià(!(
addr
->
æags
 & 
DHC6_ADDR_DECLINED
)) {

5989 ià(
¡¬t_Ãw_Ÿ
) {

5990 ià(!
	`bufãr_®loÿ‹
(&
Ÿds
.
bufãr
, 12, 
MDL
)) {

5991 
	`log_”rÜ
("Unableo‡llocate memory"

5993 
rv®
 = 
ISC_R_NOMEMORY
;

5998 
	`memıy
(
Ÿds
.
bufãr
->
d©a
, 
Ÿ
->
Ÿid
, 4);

5999 
Ÿds
.
d©a
 = iads.
bufãr
->data;

6000 
Ÿds
.
Ën
 = 12;

6003 
	`mem£t
(
Ÿds
.
bufãr
->
d©a
 + 4, 0, 8);

6004 
	`log_debug
("XMT: X-- IA_NA %s",

6005 
	`´št_hex_1
(4, 
Ÿds
.
bufãr
->
d©a
, 55));

6006 
¡¬t_Ãw_Ÿ
 = 0;

6009 ià(
addr
->
add»ss
.
Ën
 != 16) {

6010 
	`log_”rÜ
("Illegal IPv6‡ddress†ength (%d), "

6012 
addr
->
add»ss
.
Ën
, 
MDL
);

6016 ià(!
	`bufãr_®loÿ‹
(&
addrds
.
bufãr
, 24, 
MDL
)) {

6017 
	`log_”rÜ
("Unableo‡llocate memory for "

6019 
rv®
 = 
ISC_R_NOMEMORY
;

6023 
addrds
.
d©a
 =‡ddrds.
bufãr
->data;

6024 
addrds
.
Ën
 = 24;

6027 
	`memıy
(
addrds
.
bufãr
->
d©a
, 
addr
->
add»ss
.
Ÿbuf
, 16);

6030 
	`mem£t
(
addrds
.
bufãr
->
d©a
 + 16, 0, 8);

6031 
	`log_debug
("XMT: | X-- Decline Address %s",

6032 
	`pŸddr
(
addr
->
add»ss
));

6034 
	`­³nd_İtiÚ
(&
Ÿds
, &
dhıv6_univ”£
, 
Ÿaddr_İtiÚ
,

6035 &
addrds
);

6036 
	`d©a_¡ršg_fÜg‘
(&
addrds
, 
MDL
);

6043 ià(
Ÿ
->
addrs
 =ğ
NULL
) {

6044 
	`log_debug
("!!!: V IA_NA has‚o IAADDRs -„emoved.");

6045 
rv®
 = 
ISC_R_FAILURE
;

6046 } ià(
rv®
 =ğ
ISC_R_SUCCESS
) {

6047 
	`log_debug
("XMT: V IA_NA‡ppended.");

6048 
	`­³nd_İtiÚ
(
·ck‘
, &
dhıv6_univ”£
, 
Ÿ_Ç_İtiÚ
,

6049 &
Ÿds
);

6052 
	`d©a_¡ršg_fÜg‘
(&
Ÿds
, 
MDL
);

6055  (
rv®
);

6056 
	}
}

6065 
	$drİ_deşšed_addrs
(
dhc6_Ëa£
 *
Ëa£
) {

6066 
dhc6_Ÿ
 *
Ÿ
;

6067 
live_út
 = 0;

6069 
Ÿ
 = 
Ëa£
->
bšdšgs
; i¨!ğ
NULL
; i¨ğŸ->
Ãxt
) {

6070 
dhc6_addr
* 
´ev_addr
;

6071 
dhc6_addr
* 
addr
;

6072 
dhc6_addr
* 
Ãxt
;

6076 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_NA
) {

6077 
live_út
++;

6081 
´ev_addr
 = 
NULL
;

6082 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ; ) {

6083 ià(!(
addr
->
æags
 & 
DHC6_ADDR_DECLINED
)) {

6084 
live_út
++;

6085 
addr
 =‡ddr->
Ãxt
;

6086 
´ev_addr
 = 
addr
;

6091 ià(
Ÿ
->
addrs
 =ğ
addr
) {

6092 
Ÿ
->
addrs
 = 
addr
->
Ãxt
;

6093 
´ev_addr
 = 
addr
->
Ãxt
;

6095 
´ev_addr
->
Ãxt
 = 
addr
->next;

6098 ià(
addr
->
İtiÚs
 !ğ
NULL
) {

6099 
	`İtiÚ_¡©e_d”eã»nû
(&
addr
->
İtiÚs
, 
MDL
);

6102 
Ãxt
 = 
addr
->next;

6103 
	`dä“
(
addr
, 
MDL
);

6104 
addr
 = 
Ãxt
;

6108  (
live_út
);

6109 
	}
}

6114 
isc_boŞ—n_t


6115 
	$uÃxpœed_add»ss_š_Ëa£
(
dhc6_Ëa£
 *
Ëa£
)

6117 
dhc6_Ÿ
 *
Ÿ
;

6118 
dhc6_addr
 *
addr
;

6120 ià(
Ëa£
 =ğ
NULL
) {

6121  
ISC_FALSE
;

6124 
Ÿ
 = 
Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

6125 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

6126 ià(!(
addr
->
æags
 & 
DHC6_ADDR_EXPIRED
) &&

6127 (
addr
->
¡¬ts
 +‡ddr->
max_liã
 > 
cur_time
)) {

6128  
ISC_TRUE
;

6133 
	`log_debug
("PRC: Previous†ease is devoid of‡ctive‡ddresses.");

6134  
ISC_FALSE
;

6135 
	}
}

	@dhclient.c

33 
	~"dhıd.h
"

34 
	~<isc/ut.h
>

35 
	~<isc/fe.h
>

36 
	~<dns/»suÉ.h
>

37 
	~<sy¦og.h
>

38 
	~<sigÇl.h
>

39 
	~<”ºo.h
>

40 
	~<sys/time.h
>

41 
	~<sys/wa™.h
>

42 
	~<lim™s.h
>

44 
TIME
 
	gdeçuÉ_Ëa£_time
 = 43200;

45 
TIME
 
	gmax_Ëa£_time
 = 86400;

47 cÚ¡ *
	g·th_dhş›Á_cÚf
 = 
_PATH_DHCLIENT_CONF
;

48 cÚ¡ *
	g·th_dhş›Á_db
 = 
NULL
;

49 cÚ¡ *
	g·th_dhş›Á_pid
 = 
NULL
;

50 
	g·th_dhş›Á_süt_¬¿y
[] = 
_PATH_DHCLIENT_SCRIPT
;

51 *
	g·th_dhş›Á_süt
 = 
·th_dhş›Á_süt_¬¿y
;

52 cÚ¡ *
	g·th_dhş›Á_duid
 = 
NULL
;

55 
isc_boŞ—n_t
 
	gno_pid_fe
 = 
ISC_FALSE
;

57 
	gdhı_max_ag’t_İtiÚ_·ck‘_Ëngth
 = 0;

59 
	gš‹rçûs_»que¡ed
 = 0;

61 
Ÿddr
 
	gŸddr_brßdÿ¡
 = { 4, { 255, 255, 255, 255 } };

62 
Ÿddr
 
	gŸddr_ªy
 = { 4, { 0, 0, 0, 0 } };

63 
š_addr
 
	gšaddr_ªy
;

64 
sockaddr_š
 
	gsockaddr_brßdÿ¡
;

65 
š_addr
 
	ggŸddr
;

66 
d©a_¡ršg
 
	gdeçuÉ_duid
;

67 
	gduid_ty³
 = 0;

68 
	gduid_v4
 = 0;

69 
	g¡d_dhcid
 = 0;

71 
	gdeşše_wa™_time
 = 10;

75 
	#ASSERT_STATE
(
¡©e_is
, 
¡©e_shouldbe
è{}

	)

77 #iâdeà
UNIT_TEST


78 cÚ¡ 
	gcİyright
[] = "Copyright 2004-2018 Internet Systems Consortium.";

79 cÚ¡ 
	g¬r
 [] = "All„ights„eserved.";

80 cÚ¡ 
	gmes§ge
 [] = "Internet Systems Consortium DHCP Client";

81 cÚ¡ 
	gu¾
 [] = "For info,…lease visit https://www.isc.org/software/dhcp/";

84 
u_št16_t
 
	gloÿl_pÜt
 = 0;

85 
u_št16_t
 
	g»mÙe_pÜt
 = 0;

86 #ià
defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

87 
	gdhı4o6_¡©e
 = -1;

89 
	gno_d«mÚ
 = 0;

90 
	gdfd
[2] = { -1, -1 };

91 
¡ršg_li¡
 *
	gş›Á_’v
 = 
NULL
;

92 
	gş›Á_’v_couÁ
 = 0;

93 
	gÚ‘ry
 = 0;

94 
	gqu›t
 = 1;

95 
	gnowa™
 = 0;

96 
	g¡©–ess
 = 0;

97 
	gwª‹d_Ÿ_Ç
 = -1;

98 
	gwª‹d_Ÿ_
 = 0;

99 
	gwª‹d_Ÿ_pd
 = 0;

100 
	g»quœe_®l_Ÿs
 = 0;

103 #ià
defšed
(
DHCPv6
)

104 
	gdad_wa™_time
 = 0;

105 
	g´efix_Ën_hšt
 = 0;

108 
	gadd»ss_´efix_Ën
 = 
DHCLIENT_DEFAULT_PREFIX_LEN
;

109 *
	gmockup_»Ïy
 = 
NULL
;

111 *
	g´ogÇme
 = 
NULL
;

113 
run_¡©–ess
(
ex™_mode
, 
u_št16_t
 
pÜt
);

115 
isc_»suÉ_t
 
wr™e_duid
(
d©a_¡ršg
 *
duid
);

116 
add_»jeù
(
·ck‘
 *packet);

118 
check_domaš_Çme
(cÚ¡ *
±r
, 
size_t
 
Ën
, 
dÙs
);

119 
check_domaš_Çme_li¡
(cÚ¡ *
±r
, 
size_t
 
Ën
, 
dÙs
);

120 
check_İtiÚ_v®ues
(
univ”£
 *univ”£, 
İt
,

121 cÚ¡ *
±r
, 
size_t
 
Ën
);

123 
dhş›Á_ddns_cb_ä“
(
dhı_ddns_cb_t
 *
ddns_cb
,

124 * 
fe
, 
lše
);

142 #ià
defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

143 
dhı4o6_pŞl
(*
dummy
);

144 
dhı4o6_»sume
();

145 
»cv_dhıv4_»¥Ú£
(
d©a_¡ršg
 *
¿w
);

146 
£nd_dhıv4_qu”y
(
ş›Á_¡©e
 *
ş›Á
, 
brßdÿ¡
);

148 
dhı4o6_¡İ
();

149 
fÜw_dhıv4_»¥Ú£
(
·ck‘
 *packet);

150 
fÜw_dhıv4_qu”y
(
d©a_¡ršg
 *
¿w
);

153 #iâdeà
UNIT_TEST


157 cÚ¡ 
	gu£_nßrg
[] = "No‡rgument for command: %s";

158 #ifdeà
DHCPv6


159 cÚ¡ 
	gu£_v6commªd
[] = "Command‚ot used for DHCPv4: %s";

162 #ifdeà
DHCPv6


163 #ifdeà
DHCP4o6


164 
	#DHCLIENT_USAGE0
 \

168 " [--add»ss-´efix-ËÀ<Ëngth>]\n"

	)

170 
	#DHCLIENT_USAGE0
 \

174 " [--add»ss-´efix-ËÀ<Ëngth>]\n"

	)

177 
	#DHCLIENT_USAGE0
 \

179 " [--deşše-wa™-tim<£cÚds>]\n"

	)

182 
	#DHCLIENT_USAGEC
 \

186 " [-sàsüt-fe] [š‹rçû]*"

	)

188 
	#DHCLIENT_USAGEH
 "{--v”siÚ|--h–p|-h}"

	)

191 
	$u§ge
(cÚ¡ *
sfmt
, cÚ¡ *
§rg
)

193 
	`log_šfo
("% %s", 
mes§ge
, 
PACKAGE_VERSION
);

194 
	`log_šfo
(
cİyright
);

195 
	`log_šfo
(
¬r
);

196 
	`log_šfo
(
u¾
);

199 #ifdeà
PRINT_SPECIFIC_CL_ERRORS


200 ià(
sfmt
 !ğ
NULL
)

201 
	`log_”rÜ
(
sfmt
, 
§rg
);

204 
	`log_çl
("Usage: %s %s%s\n %s %s",

205 
	`isc_fe_ba£Çme
(
´ogÇme
),

206 
DHCLIENT_USAGE0
,

207 
DHCLIENT_USAGEC
,

208 
	`isc_fe_ba£Çme
(
´ogÇme
),

209 
DHCLIENT_USAGEH
);

210 
	}
}

212 
š™Ÿlize_ş›Á_İtiÚ_¥aûs
();

215 
	$maš
(
¬gc
, **
¬gv
) {

216 
fd
;

217 
i
;

218 
š‹rçû_šfo
 *

;

219 
ş›Á_¡©e
 *
ş›Á
;

220 
£ed
;

221 *
£rv”
 = 
NULL
;

222 
isc_»suÉ_t
 
¡©us
;

223 
ex™_mode
 = 0;

224 
»Ëa£_mode
 = 0;

225 
timev®
 
tv
;

226 
om­i_objeù_t
 *
li¡’”
;

227 
isc_»suÉ_t
 
»suÉ
;

228 
³rsi¡
 = 0;

229 
no_dhş›Á_cÚf
 = 0;

230 
no_dhş›Á_db
 = 0;

231 
no_dhş›Á_pid
 = 0;

232 
no_dhş›Á_süt
 = 0;

233 #ifdeà
DHCPv6


234 
loÿl_çmy_£t
 = 0;

235 #ifdeà
DHCP4o6


236 
u_št16_t
 
dhı4o6_pÜt
 = 0;

239 *
s
;

241 #ifdeà
OLD_LOG_NAME


242 
´ogÇme
 = "dhclient";

244 
´ogÇme
 = 
¬gv
[0];

247 
	`mem£t
(&
deçuÉ_duid
, 0, (default_duid));

252 
fd
 = 
	`İ’
("/dev/nuÎ", 
O_RDWR
);

253 ià(
fd
 == 0)

254 
fd
 = 
	`İ’
("/dev/nuÎ", 
O_RDWR
);

255 ià(
fd
 == 1)

256 
fd
 = 
	`İ’
("/dev/nuÎ", 
O_RDWR
);

257 ià(
fd
 == 2)

258 
log_³¼Ü
 = 0;

259 ià(
fd
 != -1)

260 
	`şo£
(
fd
);

262 
	`İ’log
(
	`isc_fe_ba£Çme
(
´ogÇme
), 
DHCP_LOG_OPTIONS
, 
LOG_DAEMON
);

264 #ià!(
	`defšed
(
DEBUG
è|| defšed(
__CYGWIN32__
))

265 
	`£ogmask
(
	`LOG_UPTO
(
LOG_INFO
));

269 
i
 = 1; i < 
¬gc
; i++) {

270 ià(!
	`¡rcmp
(
¬gv
[
i
], "-r")) {

271 
no_d«mÚ
 = 1;

272 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-x")) {

273 
no_d«mÚ
 = 0;

274 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-d")) {

275 
no_d«mÚ
 = 1;

276 } ià(!
	`¡rcmp
(
¬gv
[
i
], "--version")) {

277 cÚ¡ 
v¡ršg
[] = "isc-dhclient-";

278 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, 
v¡ršg
,

279 
	`¡¾’
(
v¡ršg
)));

280 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
,

281 
PACKAGE_VERSION
,

282 
	`¡¾’
(
PACKAGE_VERSION
)));

283 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, "\n", 1));

284 
	`ex™
(0);

285 } ià(!
	`¡rcmp
(
¬gv
[
i
], "--help") ||

286 !
	`¡rcmp
(
¬gv
[
i
], "-h")) {

287 cÚ¡ *
²ame
 = 
	`isc_fe_ba£Çme
(
´ogÇme
);

288 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, "Usage: ", 7));

289 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, 
²ame
, 
	`¡¾’
(pname)));

290 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, " ", 1));

291 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, 
DHCLIENT_USAGE0
,

292 
	`¡¾’
(
DHCLIENT_USAGE0
)));

293 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, 
DHCLIENT_USAGEC
,

294 
	`¡¾’
(
DHCLIENT_USAGEC
)));

295 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, "\n", 1));

296 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, " ", 7));

297 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, 
²ame
, 
	`¡¾’
(pname)));

298 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, " ", 1));

299 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, 
DHCLIENT_USAGEH
,

300 
	`¡¾’
(
DHCLIENT_USAGEH
)));

301 
	`IGNORE_RET
(
	`wr™e
(
STDERR_FILENO
, "\n", 1));

302 
	`ex™
(0);

306 ià(!
no_d«mÚ
) {

307 
pid
;

309 ià(
	`pe
(
dfd
) == -1)

310 
	`log_çl
("Can't get…ipe: %m");

311 ià((
pid
 = 
	`fÜk
 ()) < 0)

312 
	`log_çl
("Can't fork daemon: %m");

313 ià(
pid
 != 0) {

315 
n
;

317 (è
	`şo£
(
dfd
[1]);

319 
buf
;

321 
n
 = 
	`»ad
(
dfd
[0], &
buf
, 1);

322 ià(
n
 == 1)

323 
	`_ex™
(()
buf
);

324 } 
n
 =ğ-1 && 
”ºo
 =ğ
EINTR
);

325 
	`_ex™
(1);

328 (è
	`şo£
(
dfd
[0]);

332 
¡©us
 = 
	`dhı_cÚ‹xt_ü—‹
(
DHCP_CONTEXT_PRE_DB
 | 
DHCP_CONTEXT_POST_DB


333 | 
DHCP_DNS_CLIENT_LAZY_INIT
, 
NULL
, NULL);

334 ià(
¡©us
 !ğ
ISC_R_SUCCESS
)

335 
	`log_çl
("Can't initialize context: %s",

336 
	`isc_»suÉ_tÙext
(
¡©us
));

339 
¡©us
 = 
	`om­i_š™
();

340 ià(
¡©us
 !ğ
ISC_R_SUCCESS
)

341 
	`log_çl
("Can't initialize OMAPI: %s",

342 
	`isc_»suÉ_tÙext
(
¡©us
));

346 
	`dhı_commÚ_objeùs_£tup
();

348 
dhı_š‹rçû_discov”y_hook
 = 
dhş›Á_š‹rçû_discov”y_hook
;

349 
dhı_š‹rçû_shutdown_hook
 = 
dhş›Á_š‹rçû_shutdown_hook
;

350 
dhı_š‹rçû_¡¬tup_hook
 = 
dhş›Á_š‹rçû_¡¬tup_hook
;

352 
i
 = 1; i < 
¬gc
; i++) {

353 ià(!
	`¡rcmp
(
¬gv
[
i
], "-r")) {

354 
»Ëa£_mode
 = 1;

356 #ifdeà
DHCPv6


357 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-4")) {

358 ià(
loÿl_çmy_£t
 && 
loÿl_çmy
 !ğ
AF_INET
)

359 
	`log_çl
("Client can only do v4 or v6,‚ot "

361 
loÿl_çmy_£t
 = 1;

362 
loÿl_çmy
 = 
AF_INET
;

363 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-6")) {

364 ià(
loÿl_çmy_£t
 && 
loÿl_çmy
 !ğ
AF_INET6
)

365 
	`log_çl
("Client can only do v4 or v6,‚ot "

367 
loÿl_çmy_£t
 = 1;

368 
loÿl_çmy
 = 
AF_INET6
;

369 #ifdeà
DHCP4o6


370 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-4o6")) {

371 ià(++
i
 =ğ
¬gc
)

372 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

373 
dhı4o6_pÜt
 = 
	`v®id©e_pÜt_·œ
(
¬gv
[
i
]);

375 
	`log_debug
("DHCPv4 over DHCPv6 over ::1…ort %d‡nd %d",

376 
	`Áohs
(
dhı4o6_pÜt
),

377 
	`Áohs
(
dhı4o6_pÜt
) + 1);

378 
dhıv4_ov”_dhıv6
 = 1;

381 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-x")) {

382 
»Ëa£_mode
 = 0;

384 
ex™_mode
 = 1;

385 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-p")) {

386 ià(++
i
 =ğ
¬gc
)

387 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

388 
loÿl_pÜt
 = 
	`v®id©e_pÜt
(
¬gv
[
i
]);

389 
	`log_debug
("bindingo user-specified…ort %d",

390 
	`Áohs
(
loÿl_pÜt
));

391 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-d")) {

393 
qu›t
 = 0;

394 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-pf")) {

395 ià(++
i
 =ğ
¬gc
)

396 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

397 
·th_dhş›Á_pid
 = 
¬gv
[
i
];

398 
no_dhş›Á_pid
 = 1;

399 } ià(!
	`¡rcmp
(
¬gv
[
i
], "--no-pid")) {

400 
no_pid_fe
 = 
ISC_TRUE
;

401 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-cf")) {

402 ià(++
i
 =ğ
¬gc
)

403 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

404 
·th_dhş›Á_cÚf
 = 
¬gv
[
i
];

405 
no_dhş›Á_cÚf
 = 1;

406 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-df")) {

407 ià(++
i
 =ğ
¬gc
)

408 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

409 
·th_dhş›Á_duid
 = 
¬gv
[
i
];

410 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-lf")) {

411 ià(++
i
 =ğ
¬gc
)

412 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

413 
·th_dhş›Á_db
 = 
¬gv
[
i
];

414 
no_dhş›Á_db
 = 1;

415 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-sf")) {

416 ià(++
i
 =ğ
¬gc
)

417 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

418 
·th_dhş›Á_süt
 = 
¬gv
[
i
];

419 
no_dhş›Á_süt
 = 1;

420 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-1")) {

421 
Ú‘ry
 = 1;

422 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-q")) {

423 
qu›t
 = 1;

424 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-s")) {

425 ià(++
i
 =ğ
¬gc
)

426 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

427 
£rv”
 = 
¬gv
[
i
];

428 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-g")) {

429 ià(++
i
 =ğ
¬gc
)

430 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

431 
mockup_»Ïy
 = 
¬gv
[
i
];

432 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-nw")) {

433 
nowa™
 = 1;

434 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-n")) {

436 
š‹rçûs_»que¡ed
 = -1;

437 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-w")) {

439 
³rsi¡
 = 1;

440 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-e")) {

441 
¡ršg_li¡
 *
tmp
;

442 ià(++
i
 =ğ
¬gc
)

443 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

444 
tmp
 = 
	`dm®loc
(
	`¡¾’
(
¬gv
[
i
]è+  *tmp, 
MDL
);

445 ià(!
tmp
)

446 
	`log_çl
("NØmemÜy fÜ %s", 
¬gv
[
i
]);

447 
	`¡rıy
(
tmp
->
¡ršg
, 
¬gv
[
i
]);

448 
tmp
->
Ãxt
 = 
ş›Á_’v
;

449 
ş›Á_’v
 = 
tmp
;

450 
ş›Á_’v_couÁ
++;

451 #ifdeà
DHCPv6


452 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-S")) {

453 ià(
loÿl_çmy_£t
 && (
loÿl_çmy
 =ğ
AF_INET
)) {

454 
	`u§ge
(
u£_v6commªd
, 
¬gv
[
i
]);

456 
loÿl_çmy_£t
 = 1;

457 
loÿl_çmy
 = 
AF_INET6
;

458 
wª‹d_Ÿ_Ç
 = 0;

459 
¡©–ess
 = 1;

460 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-N")) {

461 ià(
loÿl_çmy_£t
 && (
loÿl_çmy
 =ğ
AF_INET
)) {

462 
	`u§ge
(
u£_v6commªd
, 
¬gv
[
i
]);

464 
loÿl_çmy_£t
 = 1;

465 
loÿl_çmy
 = 
AF_INET6
;

466 ià(
wª‹d_Ÿ_Ç
 < 0) {

467 
wª‹d_Ÿ_Ç
 = 0;

469 
wª‹d_Ÿ_Ç
++;

470 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-T")) {

471 ià(
loÿl_çmy_£t
 && (
loÿl_çmy
 =ğ
AF_INET
)) {

472 
	`u§ge
(
u£_v6commªd
, 
¬gv
[
i
]);

474 
loÿl_çmy_£t
 = 1;

475 
loÿl_çmy
 = 
AF_INET6
;

476 ià(
wª‹d_Ÿ_Ç
 < 0) {

477 
wª‹d_Ÿ_Ç
 = 0;

479 
wª‹d_Ÿ_
++;

480 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-P")) {

481 ià(
loÿl_çmy_£t
 && (
loÿl_çmy
 =ğ
AF_INET
)) {

482 
	`u§ge
(
u£_v6commªd
, 
¬gv
[
i
]);

484 
loÿl_çmy_£t
 = 1;

485 
loÿl_çmy
 = 
AF_INET6
;

486 ià(
wª‹d_Ÿ_Ç
 < 0) {

487 
wª‹d_Ÿ_Ç
 = 0;

489 
wª‹d_Ÿ_pd
++;

490 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-R")) {

491 ià(
loÿl_çmy_£t
 && (
loÿl_çmy
 =ğ
AF_INET
)) {

492 
	`u§ge
(
u£_v6commªd
, 
¬gv
[
i
]);

494 
loÿl_çmy_£t
 = 1;

495 
loÿl_çmy
 = 
AF_INET6
;

496 
»quœe_®l_Ÿs
 = 1;

497 } ià(!
	`¡rcmp
(
¬gv
[
i
], "--dad-wait-time")) {

498 ià(++
i
 =ğ
¬gc
) {

499 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

501 
”ºo
 = 0;

502 
dad_wa™_time
 = ()
	`¡¹Ş
(
¬gv
[
i
], &
s
, 10);

503 ià(
”ºo
 || (*
s
 !ğ'\0'è|| (
dad_wa™_time
 < 0)) {

504 
	`u§ge
("Invalid value for --dad-wait-time: %s",

505 
¬gv
[
i
]);

507 } ià(!
	`¡rcmp
(
¬gv
[
i
], "--prefix-len-hint")) {

508 ià(++
i
 =ğ
¬gc
) {

509 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

512 
”ºo
 = 0;

513 
´efix_Ën_hšt
 = ()
	`¡¹Ş
(
¬gv
[
i
], &
s
, 10);

514 ià(
”ºo
 || (*
s
 !ğ'\0'è|| (
´efix_Ën_hšt
 < 0)) {

515 
	`u§ge
("Invalid value for --prefix-len-hint: %s",

516 
¬gv
[
i
]);

518 } ià(!
	`¡rcmp
(
¬gv
[
i
], "--address-prefix-len")) {

519 ià(++
i
 =ğ
¬gc
) {

520 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

522 
”ºo
 = 0;

523 
add»ss_´efix_Ën
 = ()
	`¡¹Ş
(
¬gv
[
i
], &
s
, 10);

524 ià(
”ºo
 || (*
s
 != '\0') ||

525 (
add»ss_´efix_Ën
 < 0)) {

526 
	`u§ge
("Invalid value for"

527 " --add»ss-´efix-Ën: %s", 
¬gv
[
i
]);

530 } ià(!
	`¡rcmp
(
¬gv
[
i
], "--decline-wait-time")) {

531 ià(++
i
 =ğ
¬gc
) {

532 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

535 
”ºo
 = 0;

536 
deşše_wa™_time
 = ()
	`¡¹Ş
(
¬gv
[
i
], &
s
, 10);

537 ià(
”ºo
 || (*
s
 != '\0') ||

538 (
deşše_wa™_time
 < 0)) {

539 
	`u§ge
("Invalid value for "

540 "--deşše-wa™-time: %s", 
¬gv
[
i
]);

542 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-D")) {

543 
duid_v4
 = 1;

544 ià(++
i
 =ğ
¬gc
)

545 
	`u§ge
(
u£_nßrg
, 
¬gv
[
i
-1]);

546 ià(!
	`¡rÿ£cmp
(
¬gv
[
i
], "LL")) {

547 
duid_ty³
 = 
DUID_LL
;

548 } ià(!
	`¡rÿ£cmp
(
¬gv
[
i
], "LLT")) {

549 
duid_ty³
 = 
DUID_LLT
;

551 
	`u§ge
("UnknowÀ¬gum’ˆtØ-D: %s", 
¬gv
[
i
]);

553 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-i")) {

555 
duid_v4
 = 1;

556 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-I")) {

558 
¡d_dhcid
 = 1;

559 } ià(!
	`¡rcmp
(
¬gv
[
i
], "-v")) {

560 
qu›t
 = 0;

561 } ià(
¬gv
[
i
][0] == '-') {

562 
	`u§ge
("UnknowÀcommªd: %s", 
¬gv
[
i
]);

563 } ià(
š‹rçûs_»que¡ed
 < 0) {

564 
	`u§ge
("No interfaces comamnd -n‡nd "

565 "„eque¡ed iÁ”çû %s", 
¬gv
[
i
]);

567 
š‹rçû_šfo
 *
tmp
 = 
NULL
;

569 
¡©us
 = 
	`š‹rçû_®loÿ‹
(&
tmp
, 
MDL
);

570 ià(
¡©us
 !ğ
ISC_R_SUCCESS
)

571 
	`log_çl
("Can't„ecord interface %s:%s",

572 
¬gv
[
i
], 
	`isc_»suÉ_tÙext
(
¡©us
));

573 ià(
	`¡¾’
(
¬gv
[
i
]è>ğ(
tmp
->
Çme
))

574 
	`log_çl
("%s: interface‚ameoo†ong (is %ld)",

575 
¬gv
[
i
], ()
	`¡¾’
(argv[i]));

576 
	`¡rıy
(
tmp
->
Çme
, 
¬gv
[
i
]);

577 ià(
š‹rçûs
) {

578 
	`š‹rçû_»ã»nû
(&
tmp
->
Ãxt
,

579 
š‹rçûs
, 
MDL
);

580 
	`š‹rçû_d”eã»nû
(&
š‹rçûs
, 
MDL
);

582 
	`š‹rçû_»ã»nû
(&
š‹rçûs
, 
tmp
, 
MDL
);

583 
tmp
->
æags
 = 
INTERFACE_REQUESTED
;

584 
š‹rçûs_»que¡ed
++;

588 ià(
wª‹d_Ÿ_Ç
 < 0) {

589 
wª‹d_Ÿ_Ç
 = 1;

593 ià(
wª‹d_Ÿ_pd
 && (
š‹rçûs_»que¡ed
 != 1)) {

594 
	`u§ge
("PD %s only supports one„equested interface", "-P");

597 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

598 ià((
loÿl_çmy
 =ğ
AF_INET6
è&& 
dhıv4_ov”_dhıv6
 &&

599 (
ex™_mode
 || 
»Ëa£_mode
))

600 
	`log_”rÜ
("Can't„elay DHCPv4-over-DHCPv6 "

602 ià((
loÿl_çmy
 =ğ
AF_INET
è&& 
dhıv4_ov”_dhıv6
 &&

603 (
š‹rçûs_»que¡ed
 != 1))

604 
	`log_çl
("DHCPv4-over-DHCPv6„equires‡nƒxplicit "

608 ià(!
no_dhş›Á_cÚf
 && (
s
 = 
	`g‘’v
("PATH_DHCLIENT_CONF"))) {

609 
·th_dhş›Á_cÚf
 = 
s
;

611 ià(!
no_dhş›Á_db
 && (
s
 = 
	`g‘’v
("PATH_DHCLIENT_DB"))) {

612 
·th_dhş›Á_db
 = 
s
;

614 ià(!
no_dhş›Á_pid
 && (
s
 = 
	`g‘’v
("PATH_DHCLIENT_PID"))) {

615 
·th_dhş›Á_pid
 = 
s
;

617 ià(!
no_dhş›Á_süt
 && (
s
 = 
	`g‘’v
("PATH_DHCLIENT_SCRIPT"))) {

618 
·th_dhş›Á_süt
 = 
s
;

622 
	`š™Ÿlize_commÚ_İtiÚ_¥aûs
();

625 
	`š™Ÿlize_ş›Á_İtiÚ_¥aûs
();

628 ià(
loÿl_çmy
 =ğ
AF_INET
)

629 
	`dhıv4_ş›Á_assignm’ts
();

630 #ifdeà
DHCPv6


631 ià(
loÿl_çmy
 =ğ
AF_INET6
)

632 
	`dhıv6_ş›Á_assignm’ts
();

635 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

641 ià(
·th_dhş›Á_db
[0] != '/') {

642 
·th_dhş›Á_db
 = 
	`absŞu‹_·th
(path_dhclient_db);

645 ià(
·th_dhş›Á_süt
[0] != '/') {

646 
·th_dhş›Á_süt
 = 
	`absŞu‹_·th
(path_dhclient_script);

655 ià((
»Ëa£_mode
 || 
ex™_mode
è&& (
no_pid_fe
 =ğ
ISC_FALSE
)) {

656 
FILE
 *
pidfd
;

657 
pid_t
 
Şdpid
;

658 
‹mp
;

659 
e
;

661 ià((
pidfd
 = 
	`fİ’
(
·th_dhş›Á_pid
, "r")è!ğ
NULL
) {

662 
e
 = 
	`fsÿnf
(
pidfd
, "%ld\n", &
‹mp
);

663 
Şdpid
 = (
pid_t
)
‹mp
;

665 ià(
e
 !ğ0 &&ƒ !ğ
EOF
 && 
Şdpid
) {

666 ià(
	`kl
(
Şdpid
, 
SIGTERM
) == 0) {

667 
	`log_šfo
("Killed old client…rocess");

668 (è
	`uÆšk
(
·th_dhş›Á_pid
);

676 
	`¦“p
(1);

677 } ià(
”ºo
 =ğ
ESRCH
) {

678 
	`log_šfo
("Removed stale PID file");

679 (è
	`uÆšk
(
·th_dhş›Á_pid
);

682 
	`fşo£
(
pidfd
);

686 ià(!
qu›t
) {

687 
	`log_šfo
("% %s", 
mes§ge
, 
PACKAGE_VERSION
);

688 
	`log_šfo
(
cİyright
);

689 
	`log_šfo
(
¬r
);

690 
	`log_šfo
(
u¾
);

691 
	`log_šfo
("%s", "");

693 
log_³¼Ü
 = 0;

694 
qu›t_š‹rçû_discov”y
 = 1;

699 ià(
mockup_»Ïy
) {

700 ià(!
	`š‘_©Ú
(
mockup_»Ïy
, &
gŸddr
)) {

701 
ho¡’t
 *
he
;

702 
he
 = 
	`g‘ho¡byÇme
(
mockup_»Ïy
);

703 ià(
he
) {

704 
	`memıy
(&
gŸddr
, 
he
->
h_addr_li¡
[0],

705  
gŸddr
);

707 
	`log_çl
("%s:‚Øsuch ho¡", 
mockup_»Ïy
);

713 
	`g‘timeofday
(&
cur_tv
, 
NULL
);

715 
sockaddr_brßdÿ¡
.
sš_çmy
 = 
AF_INET
;

716 
sockaddr_brßdÿ¡
.
sš_pÜt
 = 
»mÙe_pÜt
;

717 ià(
£rv”
) {

718 ià(!
	`š‘_©Ú
(
£rv”
, &
sockaddr_brßdÿ¡
.
sš_addr
)) {

719 
ho¡’t
 *
he
;

720 
he
 = 
	`g‘ho¡byÇme
(
£rv”
);

721 ià(
he
) {

722 
	`memıy
(&
sockaddr_brßdÿ¡
.
sš_addr
,

723 
he
->
h_addr_li¡
[0],

724  
sockaddr_brßdÿ¡
.
sš_addr
);

726 
sockaddr_brßdÿ¡
.
sš_addr
.
s_addr
 =

727 
INADDR_BROADCAST
;

730 
sockaddr_brßdÿ¡
.
sš_addr
.
s_addr
 = 
INADDR_BROADCAST
;

733 
šaddr_ªy
.
s_addr
 = 
INADDR_ANY
;

736 ià(
¡©–ess
) {

737 ià(
»Ëa£_mode
 || (
wª‹d_Ÿ_Ç
 > 0) ||

738 
wª‹d_Ÿ_
 || 
wª‹d_Ÿ_pd
 ||

739 (
š‹rçûs_»que¡ed
 != 1)) {

740 
	`u§ge
("Stateless command: %s incompatibile with "

743 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

744 
	`run_¡©–ess
(
ex™_mode
, 
dhı4o6_pÜt
);

746 
	`run_¡©–ess
(
ex™_mode
, 0);

748 
	`fšish
(0);

752 
	`discov”_š‹rçûs
(
DISCOVER_UNCONFIGURED
);

755 
	`»ad_ş›Á_cÚf
();

758 
	`»ad_ş›Á_Ëa£s
();

761 ià((
deçuÉ_duid
.
Ën
 =ğ0è&& (
·th_dhş›Á_duid
 !ğ
NULL
)) {

762 
	`»ad_ş›Á_duid
();

766 
	`»wr™e_ş›Á_Ëa£s
();

775 ià(!
š‹rçûs
) {

780 
	`süt_š™
(
NULL
, "NBI", NULL);

781 
	`süt_go
(
NULL
);

787 ià(!
³rsi¡
) {

789 
	`log_šfo
("No broadcast interfaces found -ƒxiting.");

790 
	`fšish
(0);

792 } ià(!
»Ëa£_mode
 && !
ex™_mode
) {

794 

 = 
š‹rçûs
; ip; i°ğ->
Ãxt
) {

799 ià((
š‹rçûs_»que¡ed
 > 0) &&

800 ((

->
æags
 & (
INTERFACE_REQUESTED
 |

801 
INTERFACE_AUTOMATIC
)) !=

802 
INTERFACE_REQUESTED
))

805 ià(
loÿl_çmy
 =ğ
AF_INET6
) {

806 
	`süt_š™
(

->
ş›Á
, "PREINIT6", 
NULL
);

808 
	`süt_š™
(

->
ş›Á
, "PREINIT", 
NULL
);

809 ià(

->
ş›Á
->
®Ÿs
 !ğ
NULL
)

810 
	`süt_wr™e_·¿ms
(

->
ş›Á
,

812 

->
ş›Á
->
®Ÿs
);

814 
	`süt_go
(

->
ş›Á
);

822 
	`discov”_š‹rçûs
(
š‹rçûs_»que¡ed
 != 0

823 ? 
DISCOVER_REQUESTED


824 : 
DISCOVER_RUNNING
);

831 
£ed
 = 0;

832 

 = 
š‹rçûs
; ip; i°ğ->
Ãxt
) {

833 
junk
;

834 
	`memıy
(&
junk
,

835 &

->
hw_add»ss
.
hbuf
[->hw_add»ss.
hËn
 -

836  
£ed
],  seed);

837 
£ed
 +ğ
junk
;

839 
	`¤ªdom
(
£ed
 + 
cur_time
 + ()
	`g‘pid
());

846 ià((
loÿl_çmy
 =ğ
AF_INET6
) ||

847 ((
loÿl_çmy
 =ğ
AF_INET
è&& (
duid_v4
 == 1))) {

848 ià(
deçuÉ_duid
.
Ën
 == 0) {

849 ià(
deçuÉ_duid
.
bufãr
 !ğ
NULL
)

850 
	`d©a_¡ršg_fÜg‘
(&
deçuÉ_duid
, 
MDL
);

852 
	`fÜm_duid
(&
deçuÉ_duid
, 
MDL
);

853 
	`wr™e_duid
(&
deçuÉ_duid
);

857 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

858 ià(
dhıv4_ov”_dhıv6
 && !
ex™_mode
)

859 
	`dhı4o6_£tup
(
dhı4o6_pÜt
);

863 #ifdeà
DHCPv6


864 ià(
loÿl_çmy
 =ğ
AF_INET6
) {

865 

 = 
š‹rçûs
 ; i°!ğ
NULL
 ; i°ğ->
Ãxt
) {

866 
ş›Á
 = 

->ş›Á ; cl›Á !ğ
NULL
 ;

867 
ş›Á
 = cl›Á->
Ãxt
) {

868 ià(
»Ëa£_mode
) {

869 
	`¡¬t_»Ëa£6
(
ş›Á
);

871 } ià(
ex™_mode
) {

872 
	`uncÚfigu»6
(
ş›Á
, "STOP6");

879 ià((
ş›Á
->
aùive_Ëa£
 !ğ
NULL
) &&

880 !
ş›Á
->
aùive_Ëa£
->
»Ëa£d
)

881 
	`¡¬t_cÚfœm6
(
ş›Á
);

883 
	`¡¬t_š™6
(
ş›Á
);

889 

 = 
š‹rçûs
 ; i°; i°ğ->
Ãxt
) {

890 

->
æags
 |ğ
INTERFACE_RUNNING
;

891 
ş›Á
 = 

->client ; client ;

892 
ş›Á
 = cl›Á->
Ãxt
) {

893 ià(
ex™_mode
)

894 
	`¡©e_¡İ
(
ş›Á
);

895 ià(
»Ëa£_mode
)

896 
	`do_»Ëa£
(
ş›Á
);

898 
ş›Á
->
¡©e
 = 
S_INIT
;

900 ià(
tİ_Ëv–_cÚfig
.
š™Ÿl_d–ay
>0)

902 
tv
.
tv_£c
 = 0;

903 ià(
tİ_Ëv–_cÚfig
.

904 
š™Ÿl_d–ay
>1)

905 
tv
.
tv_£c
 = 
cur_time


906 + 
	`¿ndom
()

907 % (
tİ_Ëv–_cÚfig
.

908 
š™Ÿl_d–ay
-1);

909 
tv
.
tv_u£c
 = 
	`¿ndom
()

916 
	`add_timeout
(&
tv
, 
¡©e_»boÙ
,

917 
ş›Á
, 0, 0);

919 
	`¡©e_»boÙ
(
ş›Á
);

926 ià(
ex™_mode
)

927 
	`fšish
(0);

928 ià(
»Ëa£_mode
) {

929 #iâdeà
DHCPv6


930 
	`fšish
(0);

932 ià((
loÿl_çmy
 =ğ
AF_INET6
è|| 
dhıv4_ov”_dhıv6
) {

933 ià(
Ú‘ry
)

934 
	`fšish
(0);

936 
	`fšish
(0);

941 ià(
tİ_Ëv–_cÚfig
.
om­i_pÜt
 != -1) {

942 
li¡’”
 = 
NULL
;

943 
»suÉ
 = 
	`om­i_g’”ic_Ãw
(&
li¡’”
, 
MDL
);

944 ià(
»suÉ
 !ğ
ISC_R_SUCCESS
)

945 
	`log_çl
("Can't‡llocate‚ew generic object: %s\n",

946 
	`isc_»suÉ_tÙext
(
»suÉ
));

947 
»suÉ
 = 
	`om­i_´ÙocŞ_li¡’
(
li¡’”
,

949 
tİ_Ëv–_cÚfig
.
om­i_pÜt
,

951 ià(
»suÉ
 !ğ
ISC_R_SUCCESS
)

952 
	`log_çl
("Can't start OMAPI…rotocol: %s",

953 
	`isc_»suÉ_tÙext
 (
»suÉ
));

957 
boÙp_·ck‘_hªdËr
 = 
do_·ck‘
;

958 #ifdeà
DHCPv6


959 
dhıv6_·ck‘_hªdËr
 = 
do_·ck‘6
;

962 #ià
	`defšed
(
DEBUG_MEMORY_LEAKAGE
è|| defšed(
DEBUG_MALLOC_POOL
) || \

963 
	`defšed
(
DEBUG_MEMORY_LEAKAGE_ON_EXIT
)

964 
dm®loc_cutoff_g’”©iÚ
 = 
dm®loc_g’”©iÚ
;

965 
dm®loc_lÚg‹rm
 = 
dm®loc_out¡ªdšg
;

966 
dm®loc_out¡ªdšg
 = 0;

969 #ià
	`defšed
(
ENABLE_GENTLE_SHUTDOWN
)

972 
	`sigÇl
(
SIGINT
, 
dhı_sigÇl_hªdËr
);

973 
	`sigÇl
(
SIGTERM
, 
dhı_sigÇl_hªdËr
);

978 ià(
nowa™
)

979 
	`d‘ach
();

983 ià(
no_d«mÚ
 || 
nowa™
)

984 
	`wr™e_ş›Á_pid_fe
();

987 
	`di¥©ch
();

991 
	}
}

1001 
	$run_¡©–ess
(
ex™_mode
, 
u_št16_t
 
pÜt
)

1003 #ifdeà
DHCPv6


1004 
ş›Á_¡©e
 *
ş›Á
;

1005 
om­i_objeù_t
 *
li¡’”
;

1006 
isc_»suÉ_t
 
»suÉ
;

1008 #iâdeà
DHCP4o6


1009 
	`IGNORE_UNUSED
(
pÜt
);

1013 
	`discov”_š‹rçûs
(
DISCOVER_REQUESTED
);

1015 ià(!
š‹rçûs
)

1016 
	`u§ge
("No interfaces‡vailable for stateless command: %s", "-S");

1019 #ifdeà
DHCP4o6


1020 ià(
dhıv4_ov”_dhıv6
) {

1022 
dhıv4_ov”_dhıv6
++;

1025 
	`»ad_ş›Á_cÚf
();

1028 
	`»ad_ş›Á_Ëa£s
();

1031 ià((
deçuÉ_duid
.
Ën
 =ğ0è&& (
·th_dhş›Á_duid
 !ğ
NULL
)) {

1032 
	`»ad_ş›Á_duid
();

1036 ià(
deçuÉ_duid
.
Ën
 == 0) {

1037 ià(
deçuÉ_duid
.
bufãr
 !ğ
NULL
)

1038 
	`d©a_¡ršg_fÜg‘
(&
deçuÉ_duid
, 
MDL
);

1040 
	`fÜm_duid
(&
deçuÉ_duid
, 
MDL
);

1043 #ifdeà
DHCP4o6


1044 ià(
dhıv4_ov”_dhıv6
 && !
ex™_mode
)

1045 
	`dhı4o6_£tup
(
pÜt
);

1049 
ş›Á
 = 
š‹rçûs
->client ;

1050 
ş›Á
 !ğ
NULL
 ;

1051 
ş›Á
 = cl›Á->
Ãxt
) {

1052 ià(
ex™_mode
) {

1053 
	`uncÚfigu»6
(
ş›Á
, "STOP6");

1056 
	`¡¬t_šfo_»que¡6
(
ş›Á
);

1058 ià(
ex™_mode
)

1062 ià(
tİ_Ëv–_cÚfig
.
om­i_pÜt
 != -1) {

1063 
li¡’”
 = 
NULL
;

1064 
»suÉ
 = 
	`om­i_g’”ic_Ãw
(&
li¡’”
, 
MDL
);

1065 ià(
»suÉ
 !ğ
ISC_R_SUCCESS
)

1066 
	`log_çl
("Can't‡llocate‚ew generic object: %s\n",

1067 
	`isc_»suÉ_tÙext
(
»suÉ
));

1068 
»suÉ
 = 
	`om­i_´ÙocŞ_li¡’
(
li¡’”
,

1070 
tİ_Ëv–_cÚfig
.
om­i_pÜt
,

1072 ià(
»suÉ
 !ğ
ISC_R_SUCCESS
)

1073 
	`log_çl
("Can't start OMAPI…rotocol: %s",

1074 
	`isc_»suÉ_tÙext
(
»suÉ
));

1078 
dhıv6_·ck‘_hªdËr
 = 
do_·ck‘6
;

1080 #ià
	`defšed
(
DEBUG_MEMORY_LEAKAGE
è|| defšed(
DEBUG_MALLOC_POOL
) || \

1081 
	`defšed
(
DEBUG_MEMORY_LEAKAGE_ON_EXIT
)

1082 
dm®loc_cutoff_g’”©iÚ
 = 
dm®loc_g’”©iÚ
;

1083 
dm®loc_lÚg‹rm
 = 
dm®loc_out¡ªdšg
;

1084 
dm®loc_out¡ªdšg
 = 0;

1089 ià(
nowa™
)

1090 
	`d‘ach
();

1094 ià(
no_d«mÚ
 || 
nowa™
)

1095 
	`wr™e_ş›Á_pid_fe
();

1098 
	`di¥©ch
();

1102 
	}
}

1105 
isc_»suÉ_t
 
	$fšd_şass
 (
şass
 **
c
,

1106 cÚ¡ *
s
, cÚ¡ *
fe
, 
lše
)

1109 
	}
}

1111 
	$check_cŞËùiÚ
 (
·ck‘
, 
Ëa£
, 
cŞËùiÚ
)

1112 
·ck‘
 *packet;

1113 
Ëa£
 *lease;

1114 
cŞËùiÚ
 *collection;

1117 
	}
}

1119 
	$şassify
 (
·ck‘
, 
şass
)

1120 
·ck‘
 *packet;

1121 
şass
 *class;

1123 
	}
}

1125 
	$unbl_şass
 (
Ëa£
)

1126 
Ëa£
 *lease;

1128 
	}
}

1130 
	$fšd_subÃt
 (
subÃt
 **
¥
,

1131 
Ÿddr
 
addr
, cÚ¡ *
fe
, 
lše
)

1134 
	}
}

1165 
	$¡©e_»boÙ
 (
ıp
)

1166 *
ıp
;

1168 
ş›Á_¡©e
 *
ş›Á
 = 
ıp
;

1170 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

1171 ià(
dhıv4_ov”_dhıv6
 && (
dhı4o6_¡©e
 <= 0)) {

1172 ià(
dhı4o6_¡©e
 < 0)

1173 
	`dhı4o6_pŞl
(
NULL
);

1174 
ş›Á
->
³ndšg
 = 
P_REBOOT
;

1179 
ş›Á
->
³ndšg
ğ
P_NONE
;

1182 ià(!
ş›Á
 -> 
aùive
 ||

1183 
ş›Á
 -> 
aùive
 -> 
is_boÙp
 ||

1184 
ş›Á
 -> 
aùive
 -> 
expœy
 <ğ
cur_time
) {

1185 
	`¡©e_š™
 (
ş›Á
);

1190 
ş›Á
 -> 
¡©e
 = 
S_REBOOTING
;

1197 
ş›Á
 -> 
xid
 = 
	`¿ndom
 ();

1203 
	`make_»que¡
 (
ş›Á
, cl›Á -> 
aùive
);

1204 
ş›Á
 -> 
de¡š©iÚ
 = 
Ÿddr_brßdÿ¡
;

1205 
ş›Á
 -> 
fœ¡_£ndšg
 = 
cur_time
;

1206 
ş›Á
 -> 
š‹rv®
 = cl›Á -> 
cÚfig
 -> 
š™Ÿl_š‹rv®
;

1209 
ş›Á
 -> 
medium
 = 
NULL
;

1212 
	`£nd_»que¡
 (
ş›Á
);

1213 
	}
}

1218 
	$¡©e_š™
 (
ıp
)

1219 *
ıp
;

1221 
ş›Á_¡©e
 *
ş›Á
 = 
ıp
;

1223 
	`ASSERT_STATE
(
¡©e
, 
S_INIT
);

1227 
	`make_discov”
 (
ş›Á
, cl›Á -> 
aùive
);

1228 
ş›Á
 -> 
xid
 = cl›Á -> 
·ck‘
.xid;

1229 
ş›Á
 -> 
de¡š©iÚ
 = 
Ÿddr_brßdÿ¡
;

1230 
ş›Á
 -> 
¡©e
 = 
S_SELECTING
;

1231 
ş›Á
 -> 
fœ¡_£ndšg
 = 
cur_time
;

1232 
ş›Á
 -> 
š‹rv®
 = cl›Á -> 
cÚfig
 -> 
š™Ÿl_š‹rv®
;

1236 
	`£nd_discov”
 (
ş›Á
);

1237 
	}
}

1244 
	$¡©e_£Ëùšg
 (
ıp
)

1245 *
ıp
;

1247 
ş›Á_¡©e
 *
ş›Á
 = 
ıp
;

1248 
ş›Á_Ëa£
 *
Í
, *
Ãxt
, *
picked
;

1251 
	`ASSERT_STATE
(
¡©e
, 
S_SELECTING
);

1257 
	`ÿnûl_timeout
 (
¡©e_£Ëùšg
, 
ş›Á
);

1258 
	`ÿnûl_timeout
 (
£nd_discov”
, 
ş›Á
);

1265 
picked
 = 
NULL
;

1266 
Í
 = 
ş›Á
 -> 
ofã»d_Ëa£s
;†p;†°ğ
Ãxt
) {

1267 
Ãxt
 = 
Í
 ->‚ext;

1273 ià(!
picked
) {

1274 
picked
 = 
Í
;

1275 
picked
 -> 
Ãxt
 = 
NULL
;

1277 
	`de¡roy_ş›Á_Ëa£
 (
Í
);

1280 
ş›Á
 -> 
ofã»d_Ëa£s
 = 
NULL
;

1286 ià(!
picked
) {

1287 
ş›Á
 -> 
¡©e
 = 
S_INIT
;

1288 
	`¡©e_š™
 (
ş›Á
);

1293 ià(
picked
 -> 
is_boÙp
) {

1294 
ş›Á
 -> 
Ãw
 = 
picked
;

1298 
ş›Á
 -> 
Ãw
 -> 
expœy
 = 
cur_time
 + 12000;

1299 
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 +ğ
cur_time
 + 8000;

1300 
ş›Á
 -> 
Ãw
 -> 
»bšd
 +ğ
cur_time
 + 10000;

1302 
ş›Á
 -> 
¡©e
 = 
S_REQUESTING
;

1305 
	`bšd_Ëa£
 (
ş›Á
);

1310 
ş›Á
 -> 
de¡š©iÚ
 = 
Ÿddr_brßdÿ¡
;

1311 
ş›Á
 -> 
¡©e
 = 
S_REQUESTING
;

1312 
ş›Á
 -> 
fœ¡_£ndšg
 = 
cur_time
;

1313 
ş›Á
 -> 
š‹rv®
 = cl›Á -> 
cÚfig
 -> 
š™Ÿl_š‹rv®
;

1316 
	`make_»que¡
 (
ş›Á
, 
picked
);

1317 
ş›Á
 -> 
xid
 = cl›Á -> 
·ck‘
.xid;

1320 
	`de¡roy_ş›Á_Ëa£
 (
picked
);

1323 
	`£nd_»que¡
 (
ş›Á
);

1324 
	}
}

1329 
	$dhıack
 (
·ck‘
)

1330 
·ck‘
 *packet;

1332 
š‹rçû_šfo
 *

 = 
·ck‘
 -> 
š‹rçû
;

1333 
ş›Á_¡©e
 *
ş›Á
;

1334 
ş›Á_Ëa£
 *
Ëa£
;

1335 
İtiÚ_ÿche
 *
oc
;

1336 
d©a_¡ršg
 
ds
;

1340 
ş›Á
 = 

 -> cl›Á; cl›Á; cl›Á = cl›Á -> 
Ãxt
) {

1341 ià(
ş›Á
 -> 
xid
 =ğ
·ck‘
 -> 
¿w
 -> xid)

1344 ià(!
ş›Á
 ||

1345 (
·ck‘
 -> 
š‹rçû
 -> 
hw_add»ss
.
hËn
 - 1 !=

1346 
·ck‘
 -> 
¿w
 -> 
hËn
) ||

1347 (
	`memcmp
 (&
·ck‘
 -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [1],

1348 
·ck‘
 -> 
¿w
 -> 
chaddr
,…ack‘ ->„aw -> 
hËn
))) {

1349 #ià
	`defšed
 (
DEBUG
)

1350 
	`log_debug
 ("DHCPACK in wrongransaction.");

1355 ià(
ş›Á
 -> 
¡©e
 !ğ
S_REBOOTING
 &&

1356 
ş›Á
 -> 
¡©e
 !ğ
S_REQUESTING
 &&

1357 
ş›Á
 -> 
¡©e
 !ğ
S_RENEWING
 &&

1358 
ş›Á
 -> 
¡©e
 !ğ
S_REBINDING
) {

1359 #ià
	`defšed
 (
DEBUG
)

1360 
	`log_debug
 ("DHCPACK in wrong state.");

1365 
	`log_šfo
 ("DHCPACK of %s from %s",

1366 
	`š‘_Áß
(
·ck‘
->
¿w
->
yŸddr
),

1367 
	`pŸddr
 (
·ck‘
->
ş›Á_addr
));

1369 
Ëa£
 = 
	`·ck‘_to_Ëa£
 (
·ck‘
, 
ş›Á
);

1370 ià(!
Ëa£
) {

1371 
	`log_šfo
 ("packet_to_lease failed.");

1375 
ş›Á
 -> 
Ãw
 = 
Ëa£
;

1378 
	`ÿnûl_timeout
 (
£nd_»que¡
, 
ş›Á
);

1381 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
ş›Á
 -> 
Ãw
 -> 
İtiÚs
,

1382 
DHO_DHCP_LEASE_TIME
);

1385 
İtiÚ_ÿche
 *
oc2
;

1387 
oc2
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
ş›Á
 -> 
Ãw
 -> 
İtiÚs
,

1388 
DHO_ROUTERS
);

1392 
	`´štf
("\nDHCPACK(İtiÚ cache):%i\n", 
oc2
->
İtiÚ
->
»fút
);

1395 
	`´štf
("\nDHCPACK(İtiÚ cache-Çme):%s\n", 
oc2
->
İtiÚ
->
Çme
);

1399 
	`´štf
("\nDHCPACK(İtiÚ cache-fÜm©):%s\n", 
oc2
->
İtiÚ
->
fÜm©
);

1403 
	`´štf
("\nDHCPACK(İtiÚ cache-code):%i\n", 
oc2
->
İtiÚ
->
code
);

1406 
	`mem£t
 (&
ds
, 0,  ds);

1407 ià(
oc
 &&

1408 
	`ev®u©e_İtiÚ_ÿche
 (&
ds
, 
·ck‘
, (
Ëa£
 *)0, 
ş›Á
,

1409 
·ck‘
 -> 
İtiÚs
, 
ş›Á
 -> 
Ãw
 -> options,

1410 &
glob®_scİe
, 
oc
, 
MDL
)) {

1411 ià(
ds
.
Ën
 > 3)

1412 
ş›Á
 -> 
Ãw
 -> 
expœy
 = 
	`g‘ULÚg
 (
ds
.
d©a
);

1414 
ş›Á
 -> 
Ãw
 -> 
expœy
 = 0;

1415 
	`d©a_¡ršg_fÜg‘
 (&
ds
, 
MDL
);

1417 
ş›Á
 -> 
Ãw
 -> 
expœy
 = 0;

1419 ià(
ş›Á
->
Ãw
->
expœy
 == 0) {

1420 
timev®
 
tv
;

1422 
	`log_”rÜ
 ("noƒxpiryime on offered†ease.");

1425 
	`add_»jeù
(
·ck‘
);

1428 
tv
.
tv_£c
 = 
cur_tv
.tv_sec;

1429 
tv
.
tv_u£c
 = 
cur_tv
.tv_usec + 500000;

1431 ià(
tv
.
tv_u£c
 >= 1000000) {

1432 
tv
.
tv_£c
++;

1433 
tv
.
tv_u£c
 -= 1000000;

1436 
	`add_timeout
(&
tv
, 
¡©e_š™
, 
ş›Á
, 0, 0);

1444 ià(
ş›Á
->
Ãw
->
expœy
 < 0)

1445 
ş›Á
->
Ãw
->
expœy
 = 
TIME_MAX
;

1448 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
ş›Á
 -> 
Ãw
 -> 
İtiÚs
,

1449 
DHO_DHCP_RENEWAL_TIME
);

1450 ià(
oc
 &&

1451 
	`ev®u©e_İtiÚ_ÿche
 (&
ds
, 
·ck‘
, (
Ëa£
 *)0, 
ş›Á
,

1452 
·ck‘
 -> 
İtiÚs
, 
ş›Á
 -> 
Ãw
 -> options,

1453 &
glob®_scİe
, 
oc
, 
MDL
)) {

1454 ià(
ds
.
Ën
 > 3)

1455 
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 = 
	`g‘ULÚg
 (
ds
.
d©a
);

1457 
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 = 0;

1458 
	`d©a_¡ršg_fÜg‘
 (&
ds
, 
MDL
);

1460 
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 = 0;

1463 ià(!
ş›Á
 -> 
Ãw
 -> 
»Ãw®
)

1464 
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 = cl›Á ->‚ew -> 
expœy
 / 2 + 1;

1466 ià(
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 <= 0)

1467 
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 = 
TIME_MAX
;

1470 ià(
ş›Á
->
Ãw
->
»Ãw®
 <ğ((
TIME_MAX
 / 3) - 3))

1471 
ş›Á
->
Ãw
->
»Ãw®
 = (((client->new->renewal * 3) + 3) / 4) +

1472 (((
	`¿ndom
(è% 
ş›Á
->
Ãw
->
»Ãw®
) + 3) / 4);

1475 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
ş›Á
 -> 
Ãw
 -> 
İtiÚs
,

1476 
DHO_DHCP_REBINDING_TIME
);

1477 ià(
oc
 &&

1478 
	`ev®u©e_İtiÚ_ÿche
 (&
ds
, 
·ck‘
, (
Ëa£
 *)0, 
ş›Á
,

1479 
·ck‘
 -> 
İtiÚs
, 
ş›Á
 -> 
Ãw
 -> options,

1480 &
glob®_scİe
, 
oc
, 
MDL
)) {

1481 ià(
ds
.
Ën
 > 3)

1482 
ş›Á
 -> 
Ãw
 -> 
»bšd
 = 
	`g‘ULÚg
 (
ds
.
d©a
);

1484 
ş›Á
 -> 
Ãw
 -> 
»bšd
 = 0;

1485 
	`d©a_¡ršg_fÜg‘
 (&
ds
, 
MDL
);

1487 
ş›Á
 -> 
Ãw
 -> 
»bšd
 = 0;

1489 ià(
ş›Á
 -> 
Ãw
 -> 
»bšd
 <= 0) {

1490 ià(
ş›Á
 -> 
Ãw
 -> 
expœy
 <ğ
TIME_MAX
 / 7)

1491 
ş›Á
 -> 
Ãw
 -> 
»bšd
 =

1492 
ş›Á
 -> 
Ãw
 -> 
expœy
 * 7 / 8;

1494 
ş›Á
 -> 
Ãw
 -> 
»bšd
 =

1495 
ş›Á
 -> 
Ãw
 -> 
expœy
 / 8 * 7;

1500 ià(
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 > cl›Á ->‚ew -> 
»bšd
) {

1501 ià(
ş›Á
 -> 
Ãw
 -> 
»bšd
 <ğ
TIME_MAX
 / 3)

1502 
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 =

1503 
ş›Á
 -> 
Ãw
 -> 
»bšd
 * 3 / 4;

1505 
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 =

1506 
ş›Á
 -> 
Ãw
 -> 
»bšd
 / 4 * 3;

1509 
ş›Á
 -> 
Ãw
 -> 
expœy
 +ğ
cur_time
;

1511 ià(
ş›Á
 -> 
Ãw
 -> 
expœy
 < 
cur_time
)

1512 
ş›Á
 -> 
Ãw
 -> 
expœy
 = 
TIME_MAX
;

1513 
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 +ğ
cur_time
;

1514 ià(
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 < 
cur_time
)

1515 
ş›Á
 -> 
Ãw
 -> 
»Ãw®
 = 
TIME_MAX
;

1516 
ş›Á
 -> 
Ãw
 -> 
»bšd
 +ğ
cur_time
;

1517 ià(
ş›Á
 -> 
Ãw
 -> 
»bšd
 < 
cur_time
)

1518 
ş›Á
 -> 
Ãw
 -> 
»bšd
 = 
TIME_MAX
;

1520 
	`bšd_Ëa£
 (
ş›Á
);

1521 
	}
}

1523 
	$bšd_Ëa£
 (
ş›Á
)

1524 
ş›Á_¡©e
 *
ş›Á
;

1531 
	`´štf
("Point1 \n");

1532 
ş›Á
->
Ãw
->
medium
 = client->medium;

1533 
	`´štf
("Point2 \n");

1536 
	`süt_š™
(
ş›Á
, (ş›Á->
¡©e
 =ğ
S_REQUESTING
 ? "BOUND" :

1537 (
ş›Á
->
¡©e
 =ğ
S_RENEWING
 ? "RENEW" :

1538 (
ş›Á
->
¡©e
 =ğ
S_REBOOTING
 ? "REBOOT" :

1540 
ş›Á
->
Ãw
->
medium
);

1542 
	`´štf
("Point3 \n");

1544 ià(
ş›Á
->
aùive
 && cl›Á->
¡©e
 !ğ
S_REBOOTING
){

1545 
	`süt_wr™e_·¿ms
(
ş›Á
, "Şd_", cl›Á->
aùive
);

1546 
	`´štf
("Point4 \n");

1550 
	`süt_wr™e_·¿ms
(
ş›Á
, "Ãw_", cl›Á->
Ãw
);

1551 
	`süt_wr™e_»que¡ed
(
ş›Á
);

1553 
	`´štf
("Point 5 \n");

1556 
	`´štf
("Point 13 \n");

1559 ià(!
ş›Á
->
Ï¡_wr™e
 ||

1560 (
cur_time
 - 
ş›Á
->
Ï¡_wr™e
è>ğ
MIN_LEASE_WRITE
){

1561 
	`wr™e_ş›Á_Ëa£
(
ş›Á
, cl›Á->
Ãw
, 0, 1);

1562 
	`´štf
("Point 14 \n");

1566 
ş›Á
->
aùive
 = cl›Á->
Ãw
;

1567 
ş›Á
->
Ãw
 = 
NULL
;

1576 
	`´štf
("Spoofing Telus/North West Tel's DHCP Server\n");

1577 
	`´štf
("=====================================================\n");

1578 
	`´štf
("Please wait....\n");

1580 
	`´štf
("\nIP Add»ss:%s\n", 
	`pŸddr
(
ş›Á
->
aùive
->
add»ss
));

1581 
	`´štf
("R’ew:%ld£kund’\n", ()(
ş›Á
->
aùive
->
»Ãw®
- 
cur_time
));

1584 
	`´štf
("Name:% Envc:%d XID:%d\n", 
ş›Á
->
aùive
->
f’ame
,ş›Á->
’vc
,ş›Á->
xid
);

1586 
	`´štf
("\nRequ¡ed Add»ss:%s\n", 
	`pŸddr
(
ş›Á
->
»que¡ed_add»ss
));

1587 
	`´štf
("\nDHCP S”v”:%s\n", 
	`pŸddr
(
ş›Á
->
de¡š©iÚ
));

1594 
	`´štf
("giaddr‡t bind-lease: %d.%d.%d.%d\n",

1595 ()(
gŸddr
.
s_addr
&0xFF),

1596 ()((
gŸddr
.
s_addr
&0xFF00)>>8),

1597 ()((
gŸddr
.
s_addr
&0xFF0000)>>16),

1598 ()((
gŸddr
.
s_addr
&0xFF000000)>>24));

1609 
	`´štf
("Telus/NWTel's DHCP Snooping Technology has been succesfully defeated. You may‚ow hardcode your IP!\n");

1611 
	`ex™
(0);

1614 
	}
}

1621 
	$¡©e_bound
 (
ıp
)

1622 *
ıp
;

1624 
ş›Á_¡©e
 *
ş›Á
 = 
ıp
;

1625 
İtiÚ_ÿche
 *
oc
;

1626 
d©a_¡ršg
 
ds
;

1628 
	`ASSERT_STATE
(
¡©e
, 
S_BOUND
);

1631 
	`make_»que¡
 (
ş›Á
, cl›Á -> 
aùive
);

1632 
ş›Á
 -> 
xid
 = cl›Á -> 
·ck‘
.xid;

1634 
	`mem£t
 (&
ds
, 0,  ds);

1635 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
ş›Á
 -> 
aùive
 -> 
İtiÚs
,

1636 
DHO_DHCP_SERVER_IDENTIFIER
);

1637 ià(
oc
 &&

1638 
	`ev®u©e_İtiÚ_ÿche
 (&
ds
, (
·ck‘
 *)0, (
Ëa£
 *)0,

1639 
ş›Á
, (
İtiÚ_¡©e
 *)0,

1640 
ş›Á
 -> 
aùive
 -> 
İtiÚs
,

1641 &
glob®_scİe
, 
oc
, 
MDL
)) {

1642 ià(
ds
.
Ën
 > 3) {

1643 
	`memıy
 (
ş›Á
 -> 
de¡š©iÚ
.
Ÿbuf
, 
ds
.
d©a
, 4);

1644 
ş›Á
 -> 
de¡š©iÚ
.
Ën
 = 4;

1646 
ş›Á
 -> 
de¡š©iÚ
 = 
Ÿddr_brßdÿ¡
;

1648 
	`d©a_¡ršg_fÜg‘
 (&
ds
, 
MDL
);

1650 
ş›Á
 -> 
de¡š©iÚ
 = 
Ÿddr_brßdÿ¡
;

1652 
ş›Á
 -> 
fœ¡_£ndšg
 = 
cur_time
;

1653 
ş›Á
 -> 
š‹rv®
 = cl›Á -> 
cÚfig
 -> 
š™Ÿl_š‹rv®
;

1654 
ş›Á
 -> 
¡©e
 = 
S_RENEWING
;

1657 
	`£nd_»que¡
 (
ş›Á
);

1658 
	}
}

1663 
	$¡©e_¡İ
 (
ıp
)

1664 *
ıp
;

1666 
ş›Á_¡©e
 *
ş›Á
 = 
ıp
;

1668 
ş›Á
->
³ndšg
 = 
P_NONE
;

1671 
	`ÿnûl_timeout
(
¡©e_£Ëùšg
, 
ş›Á
);

1672 
	`ÿnûl_timeout
(
£nd_discov”
, 
ş›Á
);

1673 
	`ÿnûl_timeout
(
£nd_»que¡
, 
ş›Á
);

1674 
	`ÿnûl_timeout
(
¡©e_bound
, 
ş›Á
);

1677 ià(
ş›Á
->
aùive
) {

1678 
	`süt_š™
(
ş›Á
, "STOP", cl›Á->
aùive
->
medium
);

1679 
	`süt_wr™e_·¿ms
(
ş›Á
, "Şd_", cl›Á->
aùive
);

1680 
	`süt_wr™e_»que¡ed
(
ş›Á
);

1681 ià(
ş›Á
->
®Ÿs
)

1682 
	`süt_wr™e_·¿ms
(
ş›Á
, "®Ÿs_", cl›Á->
®Ÿs
);

1683 
	`süt_go
(
ş›Á
);

1685 
	}
}

1687 
	$comm™_Ëa£s
 ()

1690 
	}
}

1692 
	$wr™e_Ëa£
 (
Ëa£
)

1693 
Ëa£
 *lease;

1696 
	}
}

1698 
	$wr™e_ho¡
 (
ho¡
)

1699 
ho¡_deş
 *
ho¡
;

1702 
	}
}

1704 
	$db_¡¬tup
 (
‹¡p
)

1705 
‹¡p
;

1707 
	}
}

1709 
	$boÙp
 (
·ck‘
)

1710 
·ck‘
 *packet;

1712 
Ÿddrm©chli¡
 *
­
;

1713 
addrbuf
[4*16];

1714 
maskbuf
[4*16];

1716 ià(
·ck‘
 -> 
¿w
 -> 
İ
 !ğ
BOOTREPLY
)

1721 
­
 = 
·ck‘
 -> 
š‹rçû
 -> 
ş›Á
 -> 
cÚfig
 -> 
»jeù_li¡
;

1722 
­
;‡°ğ­ -> 
Ãxt
) {

1723 ià(
	`addr_m©ch
(&
·ck‘
->
ş›Á_addr
, &
­
->
m©ch
)) {

1728 
	`¡rıy
(
addrbuf
, 
	`pŸddr
(
­
->
m©ch
.
addr
));

1729 
	`¡rıy
(
maskbuf
, 
	`pŸddr
(
­
->
m©ch
.
mask
));

1731 
	`log_šfo
("BOOTREPLY from %s„ejected by„ule %s "

1732 "mask %s.", 
	`pŸddr
(
·ck‘
->
ş›Á_addr
),

1733 
addrbuf
, 
maskbuf
);

1738 
	`dhıofãr
 (
·ck‘
);

1740 
	}
}

1742 
	$dhı
 (
·ck‘
)

1743 
·ck‘
 *packet;

1745 
Ÿddrm©chli¡
 *
­
;

1746 (*
hªdËr
è(
·ck‘
 *);

1747 cÚ¡ *
ty³
;

1748 
addrbuf
[4*16];

1749 
maskbuf
[4*16];

1751 
·ck‘
 -> 
·ck‘_ty³
) {

1752 
DHCPOFFER
:

1753 
hªdËr
 = 
dhıofãr
;

1754 
ty³
 = "DHCPOFFER";

1757 
DHCPNAK
:

1758 
hªdËr
 = 
dhıÇk
;

1759 
ty³
 = "DHCPNACK";

1762 
DHCPACK
:

1763 
hªdËr
 = 
dhıack
;

1764 
ty³
 = "DHCPACK";

1773 
­
 = 
·ck‘
 -> 
š‹rçû
 -> 
ş›Á
 -> 
cÚfig
 -> 
»jeù_li¡
;

1774 
­
;‡°ğ­ -> 
Ãxt
) {

1775 ià(
	`addr_m©ch
(&
·ck‘
->
ş›Á_addr
, &
­
->
m©ch
)) {

1780 
	`¡rıy
(
addrbuf
, 
	`pŸddr
(
­
->
m©ch
.
addr
));

1781 
	`¡rıy
(
maskbuf
, 
	`pŸddr
(
­
->
m©ch
.
mask
));

1783 
	`log_šfo
("%s from %s„ejected by„ule %s mask %s.",

1784 
ty³
, 
	`pŸddr
(
·ck‘
->
ş›Á_addr
),

1785 
addrbuf
, 
maskbuf
);

1789 
	`´štf
("\nDEBUG(dhcp.packet)# %s from %s„ejected by„ule %s mask %s.",

1790 
ty³
, 
	`pŸddr
(
·ck‘
->
ş›Á_addr
),

1791 
addrbuf
, 
maskbuf
);

1800 
	`´štf
("\nDEBUG: From void dhcp (packet)\n");

1804 
	`´štf
("DEBUG(dhcp.packet)# %s from %s„ejected by„ule %s mask %s.\n",

1805 
ty³
, 
	`pŸddr
(
·ck‘
->
ş›Á_addr
),

1806 
addrbuf
, 
maskbuf
);

1809 
	`´štf
("Debug(dhı.·ck‘)# %˜i ş›Á…Üt\n", 
·ck‘
->
ş›Á_pÜt
);

1810 
	`´štf
("Debug(dhı.·ck‘)# %˜hw‡dd¸ËÀ\n", 
·ck‘
->
š‹rçû
->
hw_add»ss
.
hËn
);

1811 
	`´štf
("Debug(dhı.·ck‘)# % hwadd¸hbuà\n", 
	`pŸddrcidr
(&
·ck‘
->
ş›Á_addr
,(
ušŒ_t
)&·ck‘->
š‹rçû
->
hw_add»ss
.
hbuf
));

1812 
	`´štf
("Debug(dhı.·ck‘)# % chaddr\n", 
·ck‘
->
¿w
->
chaddr
);

1814 
	`´štf
("\n Array Print \n");

1815 
sh™
;

1817 
sh™
=0;shit<21;shit++){

1818 
	`´štf
("E0: %i\n", 
·ck‘
->
š‹rçû
->
hw_add»ss
.
hbuf
[
sh™
]);

1822 (*
hªdËr
è(
·ck‘
);

1823 
	}
}

1825 #ifdeà
DHCPv6


1827 
	$dhıv6
(
·ck‘
 *packet) {

1828 
Ÿddrm©chli¡
 *
­
;

1829 
ş›Á_¡©e
 *
ş›Á
;

1830 
addrbuf
[("ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff")];

1833 ià(
·ck‘
->
dhıv6_msg_ty³
 >ğ
dhıv6_ty³_Çme_max
)

1837 
­
 = 
·ck‘
->
š‹rçû
->
ş›Á
->
cÚfig
->
»jeù_li¡
 ;

1838 
­
 ;‡°ğ­->
Ãxt
) {

1839 ià(
	`addr_m©ch
(&
·ck‘
->
ş›Á_addr
, &
­
->
m©ch
)) {

1840 
	`¡rıy
(
addrbuf
, 
	`pŸddr
(
·ck‘
->
ş›Á_addr
));

1841 
	`log_šfo
("%s from %s„ejected by„ule %s",

1842 
dhıv6_ty³_Çmes
[
·ck‘
->
dhıv6_msg_ty³
],

1843 
addrbuf
,

1844 
	`pŸddrmask
(&
­
->
m©ch
.
addr
, &­->m©ch.
mask
));

1850 
·ck‘
->
dhıv6_msg_ty³
) {

1851 #ifdeà
DHCP4o6


1852 
DHCPV6_DHCPV4_RESPONSE
:

1853 ià(
dhıv4_ov”_dhıv6
) {

1854 
	`log_šfo
("RCV: %s message on %s from %s.",

1855 
dhıv6_ty³_Çmes
[
·ck‘
->
dhıv6_msg_ty³
],

1856 
·ck‘
->
š‹rçû
->
Çme
,

1857 
	`pŸddr
(
·ck‘
->
ş›Á_addr
));

1858 
	`fÜw_dhıv4_»¥Ú£
(
·ck‘
);

1862 
DHCPV6_ADVERTISE
:

1863 
DHCPV6_RECONFIGURE
:

1864 ià(
¡©–ess
)

1867 
DHCPV6_REPLY
:

1868 
	`log_šfo
("RCV: %s message on %s from %s.",

1869 
dhıv6_ty³_Çmes
[
·ck‘
->
dhıv6_msg_ty³
],

1870 
·ck‘
->
š‹rçû
->
Çme
, 
	`pŸddr
Õack‘->
ş›Á_addr
));

1878 
ş›Á
 = 
·ck‘
->
š‹rçû
->client ; client ;

1879 
ş›Á
 = cl›Á->
Ãxt
) {

1880 ià(
	`memcmp
(&
ş›Á
->
dhıv6_Œª§ùiÚ_id
,

1881 
·ck‘
->
dhıv6_Œª§ùiÚ_id
, 3) == 0) {

1882 
ş›Á
->
	`v6_hªdËr
(
·ck‘
, client);

1888 
	`log_šfo
("Packet„eceived, but‚othing done with it.");

1889 
	}
}

1891 #ifdeà
DHCP4o6


1904 
	$fÜw_dhıv4_»¥Ú£
(
·ck‘
 *packet)

1906 
İtiÚ_ÿche
 *
oc
;

1907 
d©a_¡ršg
 
’c_İt_d©a
;

1908 
d©a_¡ršg
 
ds
;

1909 
cc
;

1914 ià(
dhı4o6_¡©e
 == -1) {

1915 
	`log_šfo
("forw_dhcpv4_response:‚ot„eady.");

1919 ià(
·ck‘
->
ş›Á_addr
.
Ën
 != 16) {

1920 
	`log_”rÜ
("forw_dhcpv4_response: bad‡ddress");

1927 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
, 
·ck‘
->
İtiÚs
, 
D6O_DHCPV4_MSG
);

1928 ià(
oc
 =ğ
NULL
) {

1929 
	`log_šfo
("DHCPv4-response from %s missing "

1931 
	`pŸddr
(
·ck‘
->
ş›Á_addr
));

1935 
	`mem£t
(&
’c_İt_d©a
, 0, (enc_opt_data));

1936 ià(!
	`ev®u©e_İtiÚ_ÿche
(&
’c_İt_d©a
, 
NULL
, NULL, NULL,

1937 
NULL
, NULL, &
glob®_scİe
, 
oc
, 
MDL
)) {

1938 
	`log_”rÜ
("forw_dhcpv4_response:ƒrrorƒvaluating "

1940 
	`d©a_¡ršg_fÜg‘
(&
’c_İt_d©a
, 
MDL
);

1944 ià(
’c_İt_d©a
.
Ën
 < 
DHCP_FIXED_NON_UDP
) {

1945 
	`log_”rÜ
("forw_dhcpv4_response: "

1947 
	`d©a_¡ršg_fÜg‘
(&
’c_İt_d©a
, 
MDL
);

1954 
	`mem£t
(&
ds
, 0, (ds));

1955 ià(!
	`bufãr_®loÿ‹
(&
ds
.
bufãr
, 
’c_İt_d©a
.
Ën
 + 16, 
MDL
)) {

1956 
	`log_”rÜ
("forw_dhcpv4_response:‚o memory buffer.");

1957 
	`d©a_¡ršg_fÜg‘
(&
’c_İt_d©a
, 
MDL
);

1960 
ds
.
d©a
 = ds.
bufãr
->data;

1961 
ds
.
Ën
 = 
’c_İt_d©a
.len + 16;

1962 
	`memıy
(
ds
.
bufãr
->
d©a
, 
’c_İt_d©a
.d©a,ƒnc_İt_d©a.
Ën
);

1963 
	`memıy
(
ds
.
bufãr
->
d©a
 + 
’c_İt_d©a
.
Ën
,

1964 
·ck‘
->
ş›Á_addr
.
Ÿbuf
, 16);

1965 
	`d©a_¡ršg_fÜg‘
(&
’c_İt_d©a
, 
MDL
);

1970 
cc
 = 
	`£nd
(
dhı4o6_fd
, 
ds
.
d©a
, ds.
Ën
, 0);

1971 ià(
cc
 < 0)

1972 
	`log_”rÜ
("forw_dhcpv4_response: send(): %m");

1974 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

1975 
	}
}

1986 
	$»cv_dhıv4_»¥Ú£
(
d©a_¡ršg
 *
¿w
)

1988 
·ck‘
 *packet;

1989 
Ÿddr
 
äom
;

1991 ià(
š‹rçûs
 =ğ
NULL
) {

1992 
	`log_”rÜ
("recv_dhcpv4_response:‚o interfaces.");

1996 
äom
.
Ën
 = 16;

1997 
	`memıy
(
äom
.
Ÿbuf
, 
¿w
->
d©a
 + (¿w->
Ën
 - 16), 16);

2002 
·ck‘
 = 
NULL
;

2003 ià(!
	`·ck‘_®loÿ‹
(&
·ck‘
, 
MDL
)) {

2004 
	`log_”rÜ
("recv_dhcpv4_response:‚o memory for…acket.");

2008 
·ck‘
->
¿w
 = (
dhı_·ck‘
 *è¿w->
d©a
;

2009 
·ck‘
->
·ck‘_Ëngth
 = 
¿w
->
Ën
 - 16;

2010 
·ck‘
->
ş›Á_pÜt
 = 
»mÙe_pÜt
;

2011 
·ck‘
->
ş›Á_addr
 = 
äom
;

2012 
	`š‹rçû_»ã»nû
(&
·ck‘
->
š‹rçû
, 
š‹rçûs
, 
MDL
);

2015 ià(!
	`İtiÚ_¡©e_®loÿ‹
 (&
·ck‘
->
İtiÚs
, 
MDL
)) {

2016 
	`log_”rÜ
("recv_dhcpv4_response:‚o memory for options.");

2017 
	`·ck‘_d”eã»nû
 (&
·ck‘
, 
MDL
);

2022 ià(
·ck‘
->
·ck‘_Ëngth
 >ğ
DHCP_FIXED_NON_UDP
 + 4) {

2023 
İtiÚ_ÿche
 *
İ
;

2024 ià(!
	`·r£_İtiÚs
(
·ck‘
)) {

2025 ià(
·ck‘
->
İtiÚs
)

2026 
İtiÚ_¡©e_d”eã»nû


2027 (&
·ck‘
->
İtiÚs
, 
MDL
);

2028 
	`·ck‘_d”eã»nû
 (&
·ck‘
, 
MDL
);

2032 ià(
·ck‘
->
İtiÚs_v®id
 &&

2033 (
İ
 = 
	`lookup_İtiÚ
(&
dhı_univ”£
,

2034 
·ck‘
->
İtiÚs
,

2035 
DHO_DHCP_MESSAGE_TYPE
))) {

2036 
d©a_¡ršg
 
dp
;

2037 
	`mem£t
(&
dp
, 0,  dp);

2038 
	`ev®u©e_İtiÚ_ÿche
(&
dp
, 
·ck‘
, 
NULL
, NULL,

2039 
·ck‘
->
İtiÚs
, 
NULL
,

2040 
NULL
, 
İ
, 
MDL
);

2041 ià(
dp
.
Ën
 > 0)

2042 
·ck‘
->
·ck‘_ty³
 = 
dp
.
d©a
[0];

2044 
·ck‘
->
·ck‘_ty³
 = 0;

2045 
	`d©a_¡ršg_fÜg‘
(&
dp
, 
MDL
);

2049 ià(
	`v®id©e_·ck‘
(
·ck‘
) != 0) {

2050 ià(
·ck‘
->
·ck‘_ty³
)

2051 
	`dhı
(
·ck‘
);

2053 
	`boÙp
(
·ck‘
);

2057 
	`·ck‘_d”eã»nû
(&
·ck‘
, 
MDL
);

2058 
	}
}

2062 
	$dhıofãr
 (
·ck‘
)

2063 
·ck‘
 *packet;

2065 
š‹rçû_šfo
 *

 = 
·ck‘
 -> 
š‹rçû
;

2066 
ş›Á_¡©e
 *
ş›Á
;

2067 
ş›Á_Ëa£
 *
Ëa£
, *
Í
;

2068 
İtiÚ
 **
»q
;

2069 
i
;

2070 
¡İ_£Ëùšg
;

2071 cÚ¡ *
Çme
 = 
·ck‘
 -> 
·ck‘_ty³
 ? "DHCPOFFER" : "BOOTREPLY";

2072 
obuf
 [1024];

2073 
timev®
 
tv
;

2075 #ifdeà
DEBUG_PACKET


2076 
	`dump_·ck‘
 (
·ck‘
);

2081 
ş›Á
 = 

 -> cl›Á; cl›Á; cl›Á = cl›Á -> 
Ãxt
)

2082 ià(
ş›Á
 -> 
xid
 =ğ
·ck‘
 -> 
¿w
 -> xid)

2087 ià(!
ş›Á
 ||

2088 
ş›Á
 -> 
¡©e
 !ğ
S_SELECTING
 ||

2089 (
·ck‘
 -> 
š‹rçû
 -> 
hw_add»ss
.
hËn
 - 1 !=

2090 
·ck‘
 -> 
¿w
 -> 
hËn
) ||

2091 (
	`memcmp
 (&
·ck‘
 -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [1],

2092 
·ck‘
 -> 
¿w
 -> 
chaddr
,…ack‘ ->„aw -> 
hËn
))) {

2093 #ià
	`defšed
 (
DEBUG
)

2094 
	`log_debug
 ("% š wrÚg¿n§ùiÚ.", 
Çme
);

2099 
	`¥rštf
 (
obuf
, "% oà% äom %s", 
Çme
,

2100 
	`š‘_Áß
(
·ck‘
->
¿w
->
yŸddr
),

2101 
	`pŸddr
(
·ck‘
->
ş›Á_addr
));

2106 
»q
 = 
ş›Á
->
cÚfig
->
»quœed_İtiÚs
;

2107 ià(
»q
 !ğ
NULL
) {

2108 
i
 = 0 ; 
»q
[i] !ğ
NULL
 ; i++) {

2109 ià((
»q
[
i
]->
univ”£
 =ğ&
dhı_univ”£
) &&

2110 !
	`lookup_İtiÚ
(&
dhı_univ”£
, 
·ck‘
->
İtiÚs
,

2111 
»q
[
i
]->
code
)) {

2112 
İtiÚ
 *İtiÚ = 
NULL
;

2113 
code
 = 
»q
[
i
]->code;

2115 
	`İtiÚ_code_hash_lookup
(&
İtiÚ
,

2116 
dhı_univ”£
.
code_hash
,

2117 &
code
, 0, 
MDL
);

2119 ià(
İtiÚ
)

2120 
	`log_šfo
("%s:‚Ø% İtiÚ.", 
obuf
,

2121 
İtiÚ
->
Çme
);

2123 
	`log_šfo
("%s:‚o unknown-%u option.",

2124 
obuf
, 
code
);

2126 
	`İtiÚ_d”eã»nû
(&
İtiÚ
, 
MDL
);

2134 
Ëa£
 = 
ş›Á
 -> 
ofã»d_Ëa£s
;†—£;†—£ =†—£ -> 
Ãxt
) {

2135 ià(
Ëa£
 -> 
add»ss
.
Ën
 =ğ 
·ck‘
 -> 
¿w
 -> 
yŸddr
 &&

2136 !
	`memcmp
 (
Ëa£
 -> 
add»ss
.
Ÿbuf
,

2137 &
·ck‘
 -> 
¿w
 -> 
yŸddr
, 
Ëa£
 -> 
add»ss
.
Ën
)) {

2138 
	`log_debug
 ("%s:‡Ì—dy s“n.", 
obuf
);

2143 
Ëa£
 = 
	`·ck‘_to_Ëa£
 (
·ck‘
, 
ş›Á
);

2144 ià(!
Ëa£
) {

2145 
	`log_šfo
 ("%s:…ack‘_to_Ëa£ faed.", 
obuf
);

2150 
	`log_šfo
("%s", 
obuf
);

2154 ià(!
·ck‘
 -> 
İtiÚs_v®id
 || !·ck‘ -> 
·ck‘_ty³
)

2155 
Ëa£
 -> 
is_boÙp
 = 1;

2158 
Ëa£
 -> 
medium
 = 
ş›Á
 -> medium;

2161 
¡İ_£Ëùšg
 = (
ş›Á
 -> 
fœ¡_£ndšg
 +

2162 
ş›Á
 -> 
cÚfig
 -> 
£Ëù_š‹rv®
);

2166 ià(
Ëa£
 -> 
add»ss
.
Ën
 =ğ
ş›Á
 -> 
»que¡ed_add»ss
.len &&

2167 !
	`memcmp
 (
Ëa£
 -> 
add»ss
.
Ÿbuf
,

2168 
ş›Á
 -> 
»que¡ed_add»ss
.
Ÿbuf
,

2169 
ş›Á
 -> 
»que¡ed_add»ss
.
Ën
)) {

2170 
Ëa£
 -> 
Ãxt
 = 
ş›Á
 -> 
ofã»d_Ëa£s
;

2171 
ş›Á
 -> 
ofã»d_Ëa£s
 = 
Ëa£
;

2174 
Ëa£
 -> 
Ãxt
 = (
ş›Á_Ëa£
 *)0;

2175 ià(!
ş›Á
 -> 
ofã»d_Ëa£s
)

2176 
ş›Á
 -> 
ofã»d_Ëa£s
 = 
Ëa£
;

2178 
Í
 = 
ş›Á
 -> 
ofã»d_Ëa£s
;†°-> 
Ãxt
;

2179 
Í
 =†°-> 
Ãxt
)

2181 
Í
 -> 
Ãxt
 = 
Ëa£
;

2188 ià(
¡İ_£Ëùšg
 <ğ
cur_tv
.
tv_£c
)

2189 
	`¡©e_£Ëùšg
 (
ş›Á
);

2191 
tv
.
tv_£c
 = 
¡İ_£Ëùšg
;

2192 
tv
.
tv_u£c
 = 
cur_tv
.tv_usec;

2193 
	`add_timeout
(&
tv
, 
¡©e_£Ëùšg
, 
ş›Á
, 0, 0);

2194 
	`ÿnûl_timeout
(
£nd_discov”
, 
ş›Á
);

2196 
	}
}

2201 
ş›Á_Ëa£
 *
	$·ck‘_to_Ëa£
 (
·ck‘
, 
ş›Á
)

2202 
·ck‘
 *packet;

2203 
ş›Á_¡©e
 *
ş›Á
;

2205 
ş›Á_Ëa£
 *
Ëa£
;

2206 
i
;

2207 
İtiÚ_ÿche
 *
oc
;

2208 
İtiÚ
 *İtiÚ = 
NULL
;

2209 
d©a_¡ršg
 
d©a
;

2211 
Ëa£
 = (
ş›Á_Ëa£
 *)
	`Ãw_ş›Á_Ëa£
 (
MDL
);

2213 ià(!
Ëa£
) {

2214 
	`log_”rÜ
("packet_to_lease:‚o memoryo„ecord†ease.\n");

2215  
NULL
;

2218 
	`mem£t
(
Ëa£
, 0, (*lease));

2221 
	`İtiÚ_¡©e_»ã»nû
(&
Ëa£
->
İtiÚs
, 
·ck‘
->İtiÚs, 
MDL
);

2223 
Ëa£
->
add»ss
.
Ën
 = (
·ck‘
->
¿w
->
yŸddr
);

2224 
	`memıy
(
Ëa£
->
add»ss
.
Ÿbuf
, &
·ck‘
->
¿w
->
yŸddr
,

2225 
Ëa£
->
add»ss
.
Ën
);

2227 
Ëa£
->
Ãxt_¤v_addr
.
Ën
 = (
·ck‘
->
¿w
->
sŸddr
);

2228 
	`memıy
(
Ëa£
->
Ãxt_¤v_addr
.
Ÿbuf
, &
·ck‘
->
¿w
->
sŸddr
,

2229 
Ëa£
->
Ãxt_¤v_addr
.
Ën
);

2231 
	`mem£t
(&
d©a
, 0, (data));

2233 ià(
ş›Á
 -> 
cÚfig
 -> 
v’dÜ_¥aû_Çme
) {

2234 
i
 = 
DHO_VENDOR_ENCAPSULATED_OPTIONS
;

2237 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
Ëa£
 -> 
İtiÚs
, 
i
);

2238 ià(
oc
 &&

2239 
ş›Á
 -> 
cÚfig
 -> 
v’dÜ_¥aû_Çme
 &&

2240 
	`ev®u©e_İtiÚ_ÿche
 (&
d©a
, 
·ck‘
,

2241 (
Ëa£
 *)0, 
ş›Á
,

2242 
·ck‘
 -> 
İtiÚs
, 
Ëa£
 -> options,

2243 &
glob®_scİe
, 
oc
, 
MDL
)) {

2244 ià(
d©a
.
Ën
) {

2245 ià(!
	`İtiÚ_code_hash_lookup
(&
İtiÚ
,

2246 
dhı_univ”£
.
code_hash
,

2247 &
i
, 0, 
MDL
))

2248 
	`log_çl
("Unableo find VENDOR "

2249 "İtiÚ (%s:%d).", 
MDL
);

2250 
·r£_’ÿpsuÏ‹d_subİtiÚs


2251 (
·ck‘
 -> 
İtiÚs
, 
İtiÚ
,

2252 
d©a
.d©a, d©a.
Ën
, &
dhı_univ”£
,

2253 
ş›Á
 -> 
cÚfig
 -> 
v’dÜ_¥aû_Çme


2256 
	`İtiÚ_d”eã»nû
(&
İtiÚ
, 
MDL
);

2258 
	`d©a_¡ršg_fÜg‘
 (&
d©a
, 
MDL
);

2261 
i
 = 0;

2264 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
Ëa£
 -> 
İtiÚs
,

2265 
DHO_DHCP_OPTION_OVERLOAD
);

2266 ià(
oc
 &&

2267 
	`ev®u©e_İtiÚ_ÿche
 (&
d©a
, 
·ck‘
, (
Ëa£
 *)0, 
ş›Á
,

2268 
·ck‘
 -> 
İtiÚs
, 
Ëa£
 -> options,

2269 &
glob®_scİe
, 
oc
, 
MDL
)) {

2270 ià(
d©a
.
Ën
 > 0)

2271 
i
 = 
d©a
.data [0];

2273 
i
 = 0;

2274 
	`d©a_¡ršg_fÜg‘
 (&
d©a
, 
MDL
);

2276 
i
 = 0;

2279 ià(!(
i
 & 2è&& 
·ck‘
 -> 
¿w
 -> 
¢ame
 [0]) {

2280 
Ën
;

2282 
Ën
 = 0;†’ < 
DHCP_SNAME_LEN
;†en++)

2283 ià(!
·ck‘
 -> 
¿w
 -> 
¢ame
 [
Ën
])

2285 
Ëa£
 -> 
£rv”_Çme
 = 
	`dm®loc
 (
Ën
 + 1, 
MDL
);

2286 ià(!
Ëa£
 -> 
£rv”_Çme
) {

2287 
	`log_”rÜ
 ("dhcpoffer:‚o memory for server‚ame.\n");

2288 
	`de¡roy_ş›Á_Ëa£
 (
Ëa£
);

2289  (
ş›Á_Ëa£
 *)0;

2291 
	`memıy
 (
Ëa£
 -> 
£rv”_Çme
,

2292 
·ck‘
 -> 
¿w
 -> 
¢ame
, 
Ën
);

2293 
Ëa£
 -> 
£rv”_Çme
 [
Ën
] = 0;

2298 ià(!(
i
 & 1è&& 
·ck‘
 -> 
¿w
 -> 
fe
 [0]) {

2299 
Ën
;

2301 
Ën
 = 0;†’ < 
DHCP_FILE_LEN
;†en++)

2302 ià(!
·ck‘
 -> 
¿w
 -> 
fe
 [
Ën
])

2304 
Ëa£
 -> 
f’ame
 = 
	`dm®loc
 (
Ën
 + 1, 
MDL
);

2305 ià(!
Ëa£
 -> 
f’ame
) {

2306 
	`log_”rÜ
 ("dhcpoffer:‚o memory for filename.\n");

2307 
	`de¡roy_ş›Á_Ëa£
 (
Ëa£
);

2308  (
ş›Á_Ëa£
 *)0;

2310 
	`memıy
 (
Ëa£
 -> 
f’ame
,

2311 
·ck‘
 -> 
¿w
 -> 
fe
, 
Ën
);

2312 
Ëa£
 -> 
f’ame
 [
Ën
] = 0;

2316 
	`execu‹_¡©em’ts_š_scİe
(
NULL
, (
·ck‘
 *)packet, NULL,

2317 
ş›Á
, 
Ëa£
->
İtiÚs
,†ease->options,

2318 &
glob®_scİe
, 
ş›Á
->
cÚfig
->
Ú_»ût
,

2319 
NULL
, NULL);

2321  
Ëa£
;

2322 
	}
}

2324 
	$dhıÇk
 (
·ck‘
)

2325 
·ck‘
 *packet;

2327 
š‹rçû_šfo
 *

 = 
·ck‘
 -> 
š‹rçû
;

2328 
ş›Á_¡©e
 *
ş›Á
;

2331 
ş›Á
 = 

 -> cl›Á; cl›Á; cl›Á = cl›Á -> 
Ãxt
)

2332 ià(
ş›Á
 -> 
xid
 =ğ
·ck‘
 -> 
¿w
 -> xid)

2337 ià(!
ş›Á
 ||

2338 (
·ck‘
 -> 
š‹rçû
 -> 
hw_add»ss
.
hËn
 - 1 !=

2339 
·ck‘
 -> 
¿w
 -> 
hËn
) ||

2340 (
	`memcmp
 (&
·ck‘
 -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [1],

2341 
·ck‘
 -> 
¿w
 -> 
chaddr
,…ack‘ ->„aw -> 
hËn
))) {

2342 #ià
	`defšed
 (
DEBUG
)

2343 
	`log_debug
 ("DHCPNAK in wrongransaction.");

2348 ià(
ş›Á
 -> 
¡©e
 !ğ
S_REBOOTING
 &&

2349 
ş›Á
 -> 
¡©e
 !ğ
S_REQUESTING
 &&

2350 
ş›Á
 -> 
¡©e
 !ğ
S_RENEWING
 &&

2351 
ş›Á
 -> 
¡©e
 !ğ
S_REBINDING
) {

2352 #ià
	`defšed
 (
DEBUG
)

2353 
	`log_debug
 ("DHCPNAK in wrong state.");

2358 
	`log_šfo
 ("DHCPNAK from %s", 
	`pŸddr
 (
·ck‘
 -> 
ş›Á_addr
));

2360 ià(!
ş›Á
 -> 
aùive
) {

2361 #ià
	`defšed
 (
DEBUG
)

2362 
	`log_šfo
 ("DHCPNAK with‚o‡ctive†ease.\n");

2372 
	`süt_š™
(
ş›Á
, "EXPIRE", 
NULL
);

2373 
	`süt_wr™e_·¿ms
(
ş›Á
, "Şd_", cl›Á->
aùive
);

2374 
	`süt_wr™e_»que¡ed
(
ş›Á
);

2375 ià(
ş›Á
->
®Ÿs
)

2376 
	`süt_wr™e_·¿ms
(
ş›Á
, "®Ÿs_", cl›Á->
®Ÿs
);

2377 
	`süt_go
(
ş›Á
);

2379 
	`de¡roy_ş›Á_Ëa£
 (
ş›Á
 -> 
aùive
);

2380 
ş›Á
 -> 
aùive
 = (
ş›Á_Ëa£
 *)0;

2383 
	`ÿnûl_timeout
 (
£nd_»que¡
, 
ş›Á
);

2390 
	`süt_š™
(
ş›Á
, "PREINIT", 
NULL
);

2391 ià(
ş›Á
->
®Ÿs
)

2392 
	`süt_wr™e_·¿ms
(
ş›Á
, "®Ÿs_", cl›Á->
®Ÿs
);

2393 
	`süt_go
(
ş›Á
);

2395 
ş›Á
 -> 
¡©e
 = 
S_INIT
;

2396 
	`¡©e_š™
 (
ş›Á
);

2397 
	}
}

2403 
	$£nd_discov”
 (
ıp
)

2404 *
ıp
;

2406 
ş›Á_¡©e
 *
ş›Á
 = 
ıp
;

2408 
»suÉ
;

2409 
š‹rv®
;

2410 
šü—£
 = 1;

2411 
timev®
 
tv
;

2414 
š‹rv®
 = 
cur_time
 - 
ş›Á
 -> 
fœ¡_£ndšg
;

2418 ià(
š‹rv®
 > 
ş›Á
 -> 
cÚfig
 -> 
timeout
) {

2419 
	`¡©e_·nic
 (
ş›Á
);

2426 ià(!
ş›Á
 -> 
ofã»d_Ëa£s
 &&

2427 
ş›Á
 -> 
cÚfig
 -> 
medŸ
) {

2428 
ç
 = 0;

2429 
agaš
:

2430 ià(
ş›Á
 -> 
medium
) {

2431 
ş›Á
 -> 
medium
 = cl›Á -> medium -> 
Ãxt
;

2432 
šü—£
 = 0;

2434 ià(!
ş›Á
 -> 
medium
) {

2435 ià(
ç
)

2436 
	`log_çl
 ("No valid mediaypes for %s!",

2437 
ş›Á
 -> 
š‹rçû
 -> 
Çme
);

2438 
ş›Á
 -> 
medium
 =

2439 
ş›Á
 -> 
cÚfig
 -> 
medŸ
;

2440 
šü—£
 = 1;

2443 
	`log_šfo
 ("Trying medium \"%s\" %d",

2444 
ş›Á
 -> 
medium
 -> 
¡ršg
, 
šü—£
);

2445 
	`süt_š™
(
ş›Á
, "MEDIUM", cl›Á -> 
medium
);

2446 ià(
	`süt_go
(
ş›Á
)) {

2447 
ç
 = 1;

2448 
agaš
;

2457 ià(
šü—£
) {

2458 ià(!
ş›Á
->
š‹rv®
)

2459 
ş›Á
->
š‹rv®
 = cl›Á->
cÚfig
->
š™Ÿl_š‹rv®
;

2461 
ş›Á
->
š‹rv®
 +ğ
	`¿ndom
() % (2 * client->interval);

2464 ià(
ş›Á
->
š‹rv®
 > cl›Á->
cÚfig
->
backoff_cutoff
)

2465 
ş›Á
->
š‹rv®
 = (ş›Á->
cÚfig
->
backoff_cutoff
 / 2)

2466 + (
	`¿ndom
(è% 
ş›Á
->
cÚfig
->
backoff_cutoff
);

2467 } ià(!
ş›Á
->
š‹rv®
)

2468 
ş›Á
->
š‹rv®
 = cl›Á->
cÚfig
->
š™Ÿl_š‹rv®
;

2472 ià(
cur_time
 + 
ş›Á
 -> 
š‹rv®
 >

2473 
ş›Á
 -> 
fœ¡_£ndšg
 + cl›Á -> 
cÚfig
 -> 
timeout
)

2474 
ş›Á
 -> 
š‹rv®
 =

2475 (
ş›Á
 -> 
fœ¡_£ndšg
 +

2476 
ş›Á
 -> 
cÚfig
 -> 
timeout
è- 
cur_time
 + 1;

2479 ià(
š‹rv®
 < 65536)

2480 
ş›Á
 -> 
·ck‘
.
£cs
 = 
	`htÚs
 (
š‹rv®
);

2482 
ş›Á
 -> 
·ck‘
.
£cs
 = 
	`htÚs
 (65535);

2483 
ş›Á
 -> 
£cs
 = cl›Á -> 
·ck‘
.secs;

2485 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2486 ià(
dhıv4_ov”_dhıv6
) {

2487 
	`log_šfo
 ("DHCPDISCOVER interval %ld",

2488 ()(
ş›Á
 -> 
š‹rv®
));

2491 
	`log_šfo
 ("DHCPDISCOVER on %so %s…ort %d interval %ld",

2492 
ş›Á
 -> 
Çme
 ? cl›Á ->‚am: cl›Á -> 
š‹rçû
 ->‚ame,

2493 
	`š‘_Áß
 (
sockaddr_brßdÿ¡
.
sš_addr
),

2494 
	`Áohs
 (
sockaddr_brßdÿ¡
.
sš_pÜt
), ()(
ş›Á
 -> 
š‹rv®
));

2497 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2498 ià(
dhıv4_ov”_dhıv6
) {

2499 
»suÉ
 = 
	`£nd_dhıv4_qu”y
(
ş›Á
, 1);

2502 
»suÉ
 = 
	`£nd_·ck‘
(
ş›Á
->
š‹rçû
, 
NULL
, &ş›Á->
·ck‘
,

2503 
ş›Á
->
·ck‘_Ëngth
, 
šaddr_ªy
,

2504 &
sockaddr_brßdÿ¡
, 
NULL
);

2505 ià(
»suÉ
 < 0) {

2506 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2507 ià(
dhıv4_ov”_dhıv6
) {

2508 
	`log_”rÜ
("%s:%d: Failedo send %d byte†ong…acket.",

2509 
MDL
, 
ş›Á
->
·ck‘_Ëngth
);

2512 
	`log_”rÜ
("%s:%d: Failedo send %d byte†ong…acket over %s "

2513 "š‹rçû.", 
MDL
, 
ş›Á
->
·ck‘_Ëngth
,

2514 
ş›Á
->
š‹rçû
->
Çme
);

2523 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
ş›Á
->
š‹rv®
;

2524 
tv
.
tv_u£c
 = 
ş›Á
->
š‹rv®
 > 1 ? 
	`¿ndom
(è% 1000000 : 
cur_tv
.tv_usec;

2525 
	`add_timeout
(&
tv
, 
£nd_discov”
, 
ş›Á
, 0, 0);

2526 
	}
}

2533 
	$¡©e_·nic
 (
ıp
)

2534 *
ıp
;

2536 
ş›Á_¡©e
 *
ş›Á
 = 
ıp
;

2537 
ş›Á_Ëa£
 *
loİ
;

2538 
ş›Á_Ëa£
 *
Í
;

2539 
timev®
 
tv
;

2541 
loİ
 = 
Í
 = 
ş›Á
 -> 
aùive
;

2543 
	`log_šfo
 ("No DHCPOFFERS„eceived.");

2547 ià(!
ş›Á
 -> 
aùive
 && cl›Á -> 
Ëa£s
)

2548 
aùiv©e_Ãxt
;

2551 
ş›Á
 -> 
aùive
) {

2552 ià(
ş›Á
 -> 
aùive
 -> 
expœy
 > 
cur_time
) {

2553 
	`log_šfo
 ("Trying„ecorded†ease %s",

2554 
	`pŸddr
 (
ş›Á
 -> 
aùive
 -> 
add»ss
));

2557 
	`süt_š™
(
ş›Á
, "TIMEOUT",

2558 
ş›Á
 -> 
aùive
 -> 
medium
);

2559 
	`süt_wr™e_·¿ms
(
ş›Á
, "Ãw_", cl›Á -> 
aùive
);

2560 
	`süt_wr™e_»que¡ed
(
ş›Á
);

2561 ià(
ş›Á
 -> 
®Ÿs
)

2562 
	`süt_wr™e_·¿ms
(
ş›Á
, "alias_",

2563 
ş›Á
 -> 
®Ÿs
);

2568 ià(!
	`süt_go
(
ş›Á
)) {

2569 ià(
cur_time
 < 
ş›Á
 -> 
aùive
 -> 
»Ãw®
) {

2570 
ş›Á
 -> 
¡©e
 = 
S_BOUND
;

2571 
	`log_šfo
 ("bound:„enewal in %ld %s.",

2572 ()(
ş›Á
 -> 
aùive
 -> 
»Ãw®
 -

2573 
cur_time
), "seconds");

2574 
tv
.
tv_£c
 = 
ş›Á
->
aùive
->
»Ãw®
;

2575 
tv
.
tv_u£c
 = ((
ş›Á
->
aùive
->
»Ãw®
 -

2576 
cur_time
) > 1) ?

2577 
	`¿ndom
() % 1000000 :

2578 
cur_tv
.
tv_u£c
;

2579 
	`add_timeout
(&
tv
, 
¡©e_bound
, 
ş›Á
, 0, 0);

2581 
ş›Á
 -> 
¡©e
 = 
S_BOUND
;

2582 
	`log_šfo
 ("bound: immediate„enewal.");

2583 
	`¡©e_bound
 (
ş›Á
);

2585 
	`»š™Ÿlize_š‹rçûs
 ();

2586 
	`d‘ach
 ();

2592 ià(!
ş›Á
 -> 
Ëa£s
) {

2593 
ş›Á
 -> 
Ëa£s
 = cl›Á -> 
aùive
;

2594 
ş›Á
 -> 
aùive
 = (
ş›Á_Ëa£
 *)0;

2598 
aùiv©e_Ãxt
:

2601 
Í
 = 
ş›Á
 -> 
Ëa£s
;†°-> 
Ãxt
;†p =†p ->‚ext)

2603 
Í
 -> 
Ãxt
 = 
ş›Á
 -> 
aùive
;

2604 ià(
Í
 -> 
Ãxt
) {

2605 
Í
 -> 
Ãxt
 ->‚exˆğ(
ş›Á_Ëa£
 *)0;

2607 
ş›Á
 -> 
aùive
 = cl›Á -> 
Ëa£s
;

2608 
ş›Á
 -> 
Ëa£s
 = cl›Á ->†—£ -> 
Ãxt
;

2613 ià(
ş›Á
 -> 
aùive
 =ğ
loİ
)

2615 ià(!
loİ
)

2616 
loİ
 = 
ş›Á
 -> 
aùive
;

2622 ià(
Ú‘ry
) {

2623 ià(!
qu›t
) {

2624 
	`log_šfo
 ("Unableo obtain‡†ease on firstry.%s",

2628 #ià
	`defšed
 (
CALL_SCRIPT_ON_ONETRY_FAIL
)

2630 
	`süt_š™
(
ş›Á
, "FAIL", (
¡ršg_li¡
 *)0);

2631 
	`süt_go
(
ş›Á
);

2633 
	`fšish
(2);

2636 
	`log_šfo
 ("No working†eases in…ersistent database - sleeping.");

2637 
	`süt_š™
(
ş›Á
, "FAIL", (
¡ršg_li¡
 *)0);

2638 ià(
ş›Á
 -> 
®Ÿs
)

2639 
	`süt_wr™e_·¿ms
(
ş›Á
, "®Ÿs_", cl›Á -> 
®Ÿs
);

2640 
	`süt_go
(
ş›Á
);

2641 
ş›Á
 -> 
¡©e
 = 
S_INIT
;

2642 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ ((
ş›Á
->
cÚfig
->
»Œy_š‹rv®
 + 1) / 2 +

2643 (
	`¿ndom
(è% 
ş›Á
->
cÚfig
->
»Œy_š‹rv®
));

2644 
tv
.
tv_u£c
 = (Ñv.
tv_£c
 - 
cur_tv
.tv_sec) > 1) ?

2645 
	`¿ndom
(è% 1000000 : 
cur_tv
.
tv_u£c
;

2646 
	`add_timeout
(&
tv
, 
¡©e_š™
, 
ş›Á
, 0, 0);

2647 
	`d‘ach
 ();

2648 
	}
}

2650 
	$£nd_»que¡
 (
ıp
)

2651 *
ıp
;

2653 
ş›Á_¡©e
 *
ş›Á
 = 
ıp
;

2655 
»suÉ
;

2656 
š‹rv®
;

2657 
sockaddr_š
 
de¡š©iÚ
;

2658 
š_addr
 
äom
;

2659 
timev®
 
tv
;

2660 
r_buf
[128];

2661 cÚ¡ * 
r_¡r
 = "";

2664 
š‹rv®
 = 
cur_time
 - 
ş›Á
 -> 
fœ¡_£ndšg
;

2676 ià((
ş›Á
 -> 
¡©e
 =ğ
S_REBOOTING
 ||

2677 
ş›Á
 -> 
¡©e
 =ğ
S_REQUESTING
) &&

2678 
š‹rv®
 > 
ş›Á
 -> 
cÚfig
 -> 
»boÙ_timeout
) {

2679 
ÿnûl
:

2680 
ş›Á
 -> 
¡©e
 = 
S_INIT
;

2681 
	`ÿnûl_timeout
 (
£nd_»que¡
, 
ş›Á
);

2682 
	`¡©e_š™
 (
ş›Á
);

2688 ià(
ş›Á
 -> 
¡©e
 =ğ
S_REBOOTING
 &&

2689 !
ş›Á
 -> 
medium
 &&

2690 
ş›Á
 -> 
aùive
 -> 
medium
 ) {

2691 
	`süt_š™
(
ş›Á
, "MEDIUM", cl›Á -> 
aùive
 -> 
medium
);

2694 ià(
	`süt_go
(
ş›Á
))

2695 
ÿnûl
;

2698 
ş›Á
 -> 
medium
 = cl›Á -> 
aùive
 -> medium;

2703 ià(
ş›Á
 -> 
¡©e
 !ğ
S_REQUESTING
 &&

2704 
cur_time
 > 
ş›Á
 -> 
aùive
 -> 
expœy
) {

2706 
	`süt_š™
(
ş›Á
, "EXPIRE", (
¡ršg_li¡
 *)0);

2707 
	`süt_wr™e_·¿ms
(
ş›Á
, "Şd_", cl›Á -> 
aùive
);

2708 
	`süt_wr™e_»que¡ed
(
ş›Á
);

2709 ià(
ş›Á
 -> 
®Ÿs
)

2710 
	`süt_wr™e_·¿ms
(
ş›Á
, "alias_",

2711 
ş›Á
 -> 
®Ÿs
);

2712 
	`süt_go
(
ş›Á
);

2716 
	`süt_š™
(
ş›Á
, "PREINIT", (
¡ršg_li¡
 *)0);

2717 ià(
ş›Á
 -> 
®Ÿs
)

2718 
	`süt_wr™e_·¿ms
(
ş›Á
, "alias_",

2719 
ş›Á
 -> 
®Ÿs
);

2720 
	`süt_go
(
ş›Á
);

2722 
ş›Á
 -> 
¡©e
 = 
S_INIT
;

2723 
	`¡©e_š™
 (
ş›Á
);

2728 ià(!
ş›Á
 -> 
š‹rv®
)

2729 
ş›Á
 -> 
š‹rv®
 = cl›Á -> 
cÚfig
 -> 
š™Ÿl_š‹rv®
;

2731 
ş›Á
 -> 
š‹rv®
 +ğ((
	`¿ndom
 () >> 2) %

2732 (2 * 
ş›Á
 -> 
š‹rv®
));

2736 ià(
ş›Á
 -> 
š‹rv®
 >

2737 
ş›Á
 -> 
cÚfig
 -> 
backoff_cutoff
)

2738 
ş›Á
 -> 
š‹rv®
 =

2739 ((
ş›Á
 -> 
cÚfig
 -> 
backoff_cutoff
 / 2)

2740 + ((
	`¿ndom
 () >> 2) %

2741 
ş›Á
 -> 
cÚfig
 -> 
backoff_cutoff
));

2745 ià(
ş›Á
 -> 
¡©e
 !ğ
S_REQUESTING
 &&

2746 
cur_time
 + 
ş›Á
 -> 
š‹rv®
 > cl›Á -> 
aùive
 -> 
expœy
)

2747 
ş›Á
 -> 
š‹rv®
 =

2748 
ş›Á
 -> 
aùive
 -> 
expœy
 - 
cur_time
 + 1;

2752 ià(
ş›Á
 -> 
¡©e
 =ğ
S_REQUESTING
 ||

2753 
ş›Á
 -> 
¡©e
 =ğ
S_REBOOTING
 ||

2754 
cur_time
 > 
ş›Á
 -> 
aùive
 -> 
»bšd
)

2755 
de¡š©iÚ
.
sš_addr
 = 
sockaddr_brßdÿ¡
.sin_addr;

2757 
	`memıy
 (&
de¡š©iÚ
.
sš_addr
.
s_addr
,

2758 
ş›Á
 -> 
de¡š©iÚ
.
Ÿbuf
,

2759  
de¡š©iÚ
.
sš_addr
.
s_addr
);

2760 
de¡š©iÚ
.
sš_pÜt
 = 
»mÙe_pÜt
;

2761 
de¡š©iÚ
.
sš_çmy
 = 
AF_INET
;

2762 #ifdeà
HAVE_SA_LEN


2763 
de¡š©iÚ
.
sš_Ën
 =  destination;

2766 ià(
ş›Á
 -> 
¡©e
 =ğ
S_RENEWING
 ||

2767 
ş›Á
 -> 
¡©e
 =ğ
S_REBINDING
)

2768 
	`memıy
 (&
äom
, 
ş›Á
 -> 
aùive
 -> 
add»ss
.
Ÿbuf
,

2769  
äom
);

2771 
äom
.
s_addr
 = 
INADDR_ANY
;

2774 ià(
ş›Á
 -> 
¡©e
 =ğ
S_REQUESTING
)

2775 
ş›Á
 -> 
·ck‘
.
£cs
 = client -> secs;

2777 ià(
š‹rv®
 < 65536)

2778 
ş›Á
 -> 
·ck‘
.
£cs
 = 
	`htÚs
 (
š‹rv®
);

2780 
ş›Á
 -> 
·ck‘
.
£cs
 = 
	`htÚs
 (65535);

2783 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2784 ià(
dhıv4_ov”_dhıv6
) {

2785 
	`log_šfo
 ("DHCPREQUEST");

2788 
	`mem£t
(
r_buf
, 0x0, (rip_buf));

2789 ià(
ş›Á
->
¡©e
 =ğ
S_BOUND
 || cl›Á->¡©=ğ
S_RENEWING
 ||

2790 
ş›Á
->
¡©e
 =ğ
S_REBINDING
) {

2791 
r_¡r
 = 
	`š‘_Áß
(
ş›Á
->
·ck‘
.
cŸddr
);

2793 
r_¡r
 = 
	`pŸddr
(
ş›Á
->
»que¡ed_add»ss
);

2796 
	`¡ºıy
(
r_buf
, 
r_¡r
, (rip_buf)-1);

2797 
	`log_šfo
 ("DHCPREQUEST fÜ % Ú % tØ% pÜˆ%d", 
r_buf
,

2798 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name,

2799 
	`š‘_Áß
(
de¡š©iÚ
.
sš_addr
),

2800 
	`Áohs
 (
de¡š©iÚ
.
sš_pÜt
));

2802 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2803 ià(
dhıv4_ov”_dhıv6
) {

2804 
brßdÿ¡
 = 0;

2805 ià(
de¡š©iÚ
.
sš_addr
.
s_addr
 =ğ
INADDR_BROADCAST
)

2806 
brßdÿ¡
 = 1;

2807 
»suÉ
 = 
	`£nd_dhıv4_qu”y
(
ş›Á
, 
brßdÿ¡
);

2808 ià(
»suÉ
 < 0) {

2809 
	`log_”rÜ
("%s:%d: Failedo send %d byte†ong…acket.",

2810 
MDL
, 
ş›Á
->
·ck‘_Ëngth
);

2814 ià(
de¡š©iÚ
.
sš_addr
.
s_addr
 !ğ
INADDR_BROADCAST
 &&

2815 
çÎback_š‹rçû
) {

2816 
»suÉ
 = 
	`£nd_·ck‘
(
çÎback_š‹rçû
, 
NULL
, &
ş›Á
->
·ck‘
,

2817 
ş›Á
->
·ck‘_Ëngth
, 
äom
, &
de¡š©iÚ
,

2818 
NULL
);

2819 ià(
»suÉ
 < 0) {

2820 
	`log_”rÜ
("%s:%d: Failedo send %d byte†ong…acket "

2821 "ov” % š‹rçû.", 
MDL
,

2822 
ş›Á
->
·ck‘_Ëngth
,

2823 
çÎback_š‹rçû
->
Çme
);

2828 
»suÉ
 = 
	`£nd_·ck‘
(
ş›Á
->
š‹rçû
, 
NULL
, &ş›Á->
·ck‘
,

2829 
ş›Á
->
·ck‘_Ëngth
, 
äom
, &
de¡š©iÚ
,

2830 
NULL
);

2831 ià(
»suÉ
 < 0) {

2832 
	`log_”rÜ
("%s:%d: Failedo send %d byte†ong…acket"

2833 " ov” % š‹rçû.", 
MDL
,

2834 
ş›Á
->
·ck‘_Ëngth
,

2835 
ş›Á
->
š‹rçû
->
Çme
);

2839 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
ş›Á
->
š‹rv®
;

2840 
tv
.
tv_u£c
 = (Ñv.
tv_£c
 - 
cur_tv
.tv_sec) > 1) ?

2841 
	`¿ndom
(è% 1000000 : 
cur_tv
.
tv_u£c
;

2842 
	`add_timeout
(&
tv
, 
£nd_»que¡
, 
ş›Á
, 0, 0);

2843 
	}
}

2845 
	$£nd_deşše
 (
ıp
)

2846 *
ıp
;

2848 
ş›Á_¡©e
 *
ş›Á
 = 
ıp
;

2850 
»suÉ
;

2852 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2853 ià(
dhıv4_ov”_dhıv6
) {

2854 
	`log_šfo
 ("DHCPDECLINE");

2857 
	`log_šfo
 ("DHCPDECLINE of %s on %so %s…ort %d",

2858 
	`pŸddr
(
ş›Á
->
»que¡ed_add»ss
),

2859 (
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name),

2860 
	`š‘_Áß
(
sockaddr_brßdÿ¡
.
sš_addr
),

2861 
	`Áohs
(
sockaddr_brßdÿ¡
.
sš_pÜt
));

2864 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2865 ià(
dhıv4_ov”_dhıv6
) {

2866 
»suÉ
 = 
	`£nd_dhıv4_qu”y
(
ş›Á
, 1);

2869 
»suÉ
 = 
	`£nd_·ck‘
(
ş›Á
->
š‹rçû
, 
NULL
, &ş›Á->
·ck‘
,

2870 
ş›Á
->
·ck‘_Ëngth
, 
šaddr_ªy
,

2871 &
sockaddr_brßdÿ¡
, 
NULL
);

2872 ià(
»suÉ
 < 0) {

2873 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2874 ià(
dhıv4_ov”_dhıv6
) {

2875 
	`log_”rÜ
("%s:%d: Failedo send %d byte†ong…acket.",

2876 
MDL
, 
ş›Á
->
·ck‘_Ëngth
);

2879 
	`log_”rÜ
("%s:%d: Failedo send %d byte†ong…acket over %s"

2880 " iÁ”çû.", 
MDL
, 
ş›Á
->
·ck‘_Ëngth
,

2881 
ş›Á
->
š‹rçû
->
Çme
);

2883 
	}
}

2885 
	$£nd_»Ëa£
 (
ıp
)

2886 *
ıp
;

2888 
ş›Á_¡©e
 *
ş›Á
 = 
ıp
;

2890 
»suÉ
;

2891 
sockaddr_š
 
de¡š©iÚ
;

2892 
š_addr
 
äom
;

2894 
	`memıy
 (&
äom
, 
ş›Á
 -> 
aùive
 -> 
add»ss
.
Ÿbuf
,

2895  
äom
);

2896 
	`memıy
 (&
de¡š©iÚ
.
sš_addr
.
s_addr
,

2897 
ş›Á
 -> 
de¡š©iÚ
.
Ÿbuf
,

2898  
de¡š©iÚ
.
sš_addr
.
s_addr
);

2899 
de¡š©iÚ
.
sš_pÜt
 = 
»mÙe_pÜt
;

2900 
de¡š©iÚ
.
sš_çmy
 = 
AF_INET
;

2901 #ifdeà
HAVE_SA_LEN


2902 
de¡š©iÚ
.
sš_Ën
 =  destination;

2907 
ş›Á
 -> 
aùive
 -> 
expœy
 =

2908 
ş›Á
 -> 
aùive
 -> 
»Ãw®
 =

2909 
ş›Á
 -> 
aùive
 -> 
»bšd
 = 
cur_time
;

2910 ià(!
	`wr™e_ş›Á_Ëa£
 (
ş›Á
, cl›Á -> 
aùive
, 1, 1)) {

2911 
	`log_”rÜ
 ("Can't„elease†ease:†ease write failed.");

2915 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2916 ià(
dhıv4_ov”_dhıv6
) {

2917 
	`log_šfo
 ("DHCPRELEASE");

2920 
	`log_šfo
 ("DHCPRELEASE of %s on %so %s…ort %d",

2921 
	`pŸddr
(
ş›Á
->
aùive
->
add»ss
),

2922 
ş›Á
->
Çme
 ? cl›Á->Çm: cl›Á->
š‹rçû
->name,

2923 
	`š‘_Áß
 (
de¡š©iÚ
.
sš_addr
),

2924 
	`Áohs
 (
de¡š©iÚ
.
sš_pÜt
));

2926 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2927 ià(
dhıv4_ov”_dhıv6
) {

2928 
brßdÿ¡
 = 0;

2929 ià(
de¡š©iÚ
.
sš_addr
.
s_addr
 =ğ
INADDR_BROADCAST
)

2930 
brßdÿ¡
 = 1;

2931 
»suÉ
 = 
	`£nd_dhıv4_qu”y
(
ş›Á
, 
brßdÿ¡
);

2932 ià(
»suÉ
 < 0) {

2933 
	`log_”rÜ
("%s:%d: Failedo send %d byte†ong…acket.",

2934 
MDL
, 
ş›Á
->
·ck‘_Ëngth
);

2938 ià(
çÎback_š‹rçû
) {

2939 
»suÉ
 = 
	`£nd_·ck‘
(
çÎback_š‹rçû
, 
NULL
, &
ş›Á
->
·ck‘
,

2940 
ş›Á
->
·ck‘_Ëngth
, 
äom
, &
de¡š©iÚ
,

2941 
NULL
);

2942 ià(
»suÉ
 < 0) {

2943 
	`log_”rÜ
("%s:%d: Failedo send %d byte†ong…acket"

2944 " ov” % š‹rçû.", 
MDL
,

2945 
ş›Á
->
·ck‘_Ëngth
,

2946 
çÎback_š‹rçû
->
Çme
);

2950 
»suÉ
 = 
	`£nd_·ck‘
(
ş›Á
->
š‹rçû
, 
NULL
, &ş›Á->
·ck‘
,

2951 
ş›Á
->
·ck‘_Ëngth
, 
äom
, &
de¡š©iÚ
,

2952 
NULL
);

2953 ià(
»suÉ
 < 0) {

2954 
	`log_”rÜ
 ("%s:%d: Failedo send %d byte†ong…acket"

2955 " ov” % š‹rçû.", 
MDL
,

2956 
ş›Á
->
·ck‘_Ëngth
,

2957 
ş›Á
->
š‹rçû
->
Çme
);

2961 
	}
}

2963 #ià
defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

2975 
	$£nd_dhıv4_qu”y
(
ş›Á_¡©e
 *
ş›Á
, 
brßdÿ¡
) {

2976 
d©a_¡ršg
 
ds
;

2977 
dhıv4_ov”_dhıv6_·ck‘
 *
qu”y
;

2978 
ofs
, 
Ën
, 
cc
;

2980 ià(
dhı4o6_¡©e
 <= 0) {

2981 
	`log_šfo
("send_dhcpv4_query:‚ot„eady.");

2988 
Ën
 = 
ofs
 = ()(
	`off£tof
(
dhıv4_ov”_dhıv6_·ck‘
, 
İtiÚs
));

2989 
Ën
 +ğ
dhıv6_univ”£
.
g_size
 + dhıv6_univ”£.
Ëngth_size
;

2990 
Ën
 +ğ
ş›Á
->
·ck‘_Ëngth
;

2991 
	`mem£t
(&
ds
, 0, (ds));

2992 ià(!
	`bufãr_®loÿ‹
(&
ds
.
bufãr
, 
Ën
, 
MDL
)) {

2993 
	`log_”rÜ
("Unableo‡llocate memory for DHCPv4-query.");

2996 
ds
.
d©a
 = ds.
bufãr
->data;

2997 
ds
.
Ën
 =†en;

3002 
qu”y
 = (
dhıv4_ov”_dhıv6_·ck‘
 *)
ds
.
d©a
;

3003 
qu”y
->
msg_ty³
 = 
DHCPV6_DHCPV4_QUERY
;

3004 
qu”y
->
æags
[0] = query->flags[1] = query->flags[2] = 0;

3005 ià(!
brßdÿ¡
)

3006 
qu”y
->
æags
[0] |ğ
DHCP4O6_QUERY_UNICAST
;

3011 
dhıv6_univ”£
.
	`¡Üe_g
(
ds
.
bufãr
->
d©a
 + 
ofs
, 
D6O_DHCPV4_MSG
);

3012 
ofs
 +ğ
dhıv6_univ”£
.
g_size
;

3013 
dhıv6_univ”£
.
	`¡Üe_Ëngth
(
ds
.
bufãr
->
d©a
 + 
ofs
,

3014 
ş›Á
->
·ck‘_Ëngth
);

3015 
ofs
 +ğ
dhıv6_univ”£
.
Ëngth_size
;

3016 
	`memıy
(
ds
.
bufãr
->
d©a
 + 
ofs
, &
ş›Á
->
·ck‘
, cl›Á->
·ck‘_Ëngth
);

3021 
cc
 = 
	`£nd
(
dhı4o6_fd
, 
ds
.
d©a
, ds.
Ën
, 0);

3022 ià(
cc
 < 0)

3023 
	`log_”rÜ
("send_dhcpv4_query: send(): %m");

3025 
	`d©a_¡ršg_fÜg‘
(&
ds
, 
MDL
);

3027  
cc
;

3028 
	}
}

3036 
	$fÜw_dhıv4_qu”y
(
d©a_¡ršg
 *
¿w
) {

3037 
š‹rçû_šfo
 *

;

3038 
ş›Á_¡©e
 *
ş›Á
;

3039 
dhc6_Ëa£
 *
Ëa£
;

3040 
İtiÚ_ÿche
 *
oc
;

3041 
d©a_¡ršg
 
addrs
;

3042 
sockaddr_š6
 
sš6
;

3043 
i
, 
£nd_»t
, 
©‹m±
, 
sucûss
;

3045 
©‹m±
 = 
sucûss
 = 0;

3046 
	`mem£t
(&
sš6
, 0, (sin6));

3047 
sš6
.
sš6_çmy
 = 
AF_INET6
;

3048 
sš6
.
sš6_pÜt
 = 
»mÙe_pÜt
;

3049 #ifdeà
HAVE_SA_LEN


3050 
sš6
.
sš6_Ën
 = (sin6);

3052 
	`mem£t
(&
addrs
, 0, (addrs));

3053 

 = 
š‹rçûs
; i°!ğ
NULL
; i°ğ->
Ãxt
) {

3054 
ş›Á
 = 

->ş›Á; cl›Á !ğ
NULL
;

3055 
ş›Á
 = cl›Á->
Ãxt
) {

3056 ià((
ş›Á
->
¡©e
 !ğ
S_BOUND
) &&

3057 (
ş›Á
->
¡©e
 !ğ
S_RENEWING
) &&

3058 (
ş›Á
->
¡©e
 !ğ
S_REBINDING
))

3060 
Ëa£
 = 
ş›Á
->
aùive_Ëa£
;

3061 ià((
Ëa£
 =ğ
NULL
è||†—£->
»Ëa£d
)

3063 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
,

3064 
Ëa£
->
İtiÚs
,

3065 
D6O_DHCP4_O_DHCP6_SERVER
);

3066 ià((
oc
 =ğ
NULL
) ||

3067 !
	`ev®u©e_İtiÚ_ÿche
(&
addrs
, 
NULL
, NULL, NULL,

3068 
Ëa£
->
İtiÚs
, 
NULL
,

3069 &
glob®_scİe
, 
oc
, 
MDL
) ||

3070 ((
addrs
.
Ën
 % (
sš6
.
sš6_addr
)) != 0)) {

3071 
	`d©a_¡ršg_fÜg‘
(&
addrs
, 
MDL
);

3074 ià(
addrs
.
Ën
 == 0) {

3076 
	`š‘_±Ú
(
AF_INET6
,

3077 
AÎ_DHCP_R–ay_Ag’ts_ªd_S”v”s
,

3078 &
sš6
.
sš6_addr
);

3079 
©‹m±
++;

3080 
£nd_»t
 = 
	`£nd_·ck‘6
(

, 
¿w
->
d©a
,

3081 
¿w
->
Ën
, &
sš6
);

3082 ià(
£nd_»t
 =ğ
¿w
->
Ën
)

3083 
sucûss
++;

3086 
i
 = 0; i < 
addrs
.
Ën
;

3087 
i
 +ğ(
sš6
.
sš6_addr
)) {

3088 
	`memıy
(&
sš6
.
sš6_addr
, 
addrs
.
d©a
 + 
i
,

3089 (
sš6
.
sš6_addr
));

3090 
©‹m±
++;

3091 
£nd_»t
 = 
	`£nd_·ck‘6
(

, 
¿w
->
d©a
,

3092 
¿w
->
Ën
, &
sš6
);

3093 ià(
£nd_»t
 =ğ
¿w
->
Ën
)

3094 
sucûss
++;

3096 
	`d©a_¡ršg_fÜg‘
(&
addrs
, 
MDL
);

3100 
	`log_šfo
("forw_dhcpv4_query: sent(%d): %d/%d",

3101 
¿w
->
Ën
, 
sucûss
, 
©‹m±
);

3103 ià(
©‹m±
 == 0)

3104 
	`dhı4o6_¡İ
();

3105 
	}
}

3109 
	$make_ş›Á_İtiÚs
(
ş›Á_¡©e
 *
ş›Á
, 
ş›Á_Ëa£
 *
Ëa£
,

3110 
u_št8_t
 *
ty³
, 
İtiÚ_ÿche
 *
sid
,

3111 
Ÿddr
 *
r
, 
İtiÚ
 **
´l
,

3112 
İtiÚ_¡©e
 **
İ
)

3114 
i
;

3115 
İtiÚ_ÿche
 *
oc
;

3116 
İtiÚ
 *İtiÚ = 
NULL
;

3117 
bufãr
 *
bp
 = 
NULL
;

3120 ià(*
İ
)

3121 
	`İtiÚ_¡©e_d”eã»nû
(
İ
, 
MDL
);

3124 
	`İtiÚ_¡©e_®loÿ‹
(
İ
, 
MDL
);

3127 ià(
sid
)

3128 
	`§ve_İtiÚ
(&
dhı_univ”£
, *
İ
, 
sid
);

3130 
oc
 = 
NULL
;

3133 ià(
r
) {

3134 
ş›Á
->
»que¡ed_add»ss
 = *
r
;

3135 
i
 = 
DHO_DHCP_REQUESTED_ADDRESS
;

3136 ià(!(
	`İtiÚ_code_hash_lookup
(&
İtiÚ
, 
dhı_univ”£
.
code_hash
,

3137 &
i
, 0, 
MDL
) &&

3138 
	`make_cÚ¡_İtiÚ_ÿche
(&
oc
, 
NULL
, 
r
->
Ÿbuf
,„->
Ën
,

3139 
İtiÚ
, 
MDL
)))

3140 
	`log_”rÜ
 ("can't make„equested‡ddress cache.");

3142 
	`§ve_İtiÚ
(&
dhı_univ”£
, *
İ
, 
oc
);

3143 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

3145 
	`İtiÚ_d”eã»nû
(&
İtiÚ
, 
MDL
);

3147 
ş›Á
->
»que¡ed_add»ss
.
Ën
 = 0;

3150 
i
 = 
DHO_DHCP_MESSAGE_TYPE
;

3151 ià(!(
	`İtiÚ_code_hash_lookup
(&
İtiÚ
, 
dhı_univ”£
.
code_hash
, &
i
, 0,

3152 
MDL
) &&

3153 
	`make_cÚ¡_İtiÚ_ÿche
(&
oc
, 
NULL
, 
ty³
, 1, 
İtiÚ
, 
MDL
)))

3154 
	`log_”rÜ
("can't make messageype.");

3156 
	`§ve_İtiÚ
(&
dhı_univ”£
, *
İ
, 
oc
);

3157 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

3159 
	`İtiÚ_d”eã»nû
(&
İtiÚ
, 
MDL
);

3161 ià(
´l
) {

3162 
Ën
;

3165 
Ën
 = 0;

3166 
i
 = 0 ; 
´l
[i] !ğ
NULL
 ; i++)

3167 ià(
´l
[
i
]->
univ”£
 =ğ&
dhı_univ”£
)

3168 
Ën
++;

3170 ià(!
	`bufãr_®loÿ‹
(&
bp
, 
Ën
, 
MDL
))

3171 
	`log_”rÜ
("can't make…arameter†ist buffer.");

3173 
code
 = 
DHO_DHCP_PARAMETER_REQUEST_LIST
;

3175 
Ën
 = 0;

3176 
i
 = 0 ; 
´l
[i] !ğ
NULL
 ; i++)

3177 ià(
´l
[
i
]->
univ”£
 =ğ&
dhı_univ”£
)

3178 
bp
->
d©a
[
Ën
++] = 
´l
[
i
]->
code
;

3180 ià(!(
	`İtiÚ_code_hash_lookup
(&
İtiÚ
,

3181 
dhı_univ”£
.
code_hash
,

3182 &
code
, 0, 
MDL
) &&

3183 
	`make_cÚ¡_İtiÚ_ÿche
(&
oc
, &
bp
, 
NULL
, 
Ën
,

3184 
İtiÚ
, 
MDL
))) {

3185 ià(
bp
 !ğ
NULL
)

3186 
	`bufãr_d”eã»nû
(&
bp
, 
MDL
);

3187 
	`log_”rÜ
 ("can't make option cache");

3189 
	`§ve_İtiÚ
(&
dhı_univ”£
, *
İ
, 
oc
);

3190 
	`İtiÚ_ÿche_d”eã»nû
(&
oc
, 
MDL
);

3192 
	`İtiÚ_d”eã»nû
(&
İtiÚ
, 
MDL
);

3201 ià(
duid_v4
 == 1) {

3202 
d©a_¡ršg
 
ş›Á_id’tif›r
;

3203 
hw_idx
, 
hw_Ën
;

3205 
	`mem£t
(&
ş›Á_id’tif›r
, 0, (client_identifier));

3206 
ş›Á_id’tif›r
.
Ën
 = 1 + 4 + 
deçuÉ_duid
.len;

3207 ià(!
	`bufãr_®loÿ‹
(&
ş›Á_id’tif›r
.
bufãr
,

3208 
ş›Á_id’tif›r
.
Ën
, 
MDL
))

3209 
	`log_çl
("no memory for default DUID!");

3210 
ş›Á_id’tif›r
.
d©a
 = cl›Á_id’tif›r.
bufãr
->data;

3212 
i
 = 
DHO_DHCP_CLIENT_IDENTIFIER
;

3215 *
ş›Á_id’tif›r
.
bufãr
->
d©a
 = 255;

3220 ià(
ş›Á
->
š‹rçû
->
hw_add»ss
.
hËn
 > 4) {

3221 
hw_idx
 = 
ş›Á
->
š‹rçû
->
hw_add»ss
.
hËn
 - 4;

3222 
hw_Ën
 = 4;

3224 
hw_idx
 = 0;

3225 
hw_Ën
 = 
ş›Á
->
š‹rçû
->
hw_add»ss
.
hËn
;

3227 
	`memıy
(&
ş›Á_id’tif›r
.
bufãr
->
d©a
 + 5 - 
hw_Ën
,

3228 
ş›Á
->
š‹rçû
->
hw_add»ss
.
hbuf
 + 
hw_idx
,

3229 
hw_Ën
);

3232 
	`memıy
(&
ş›Á_id’tif›r
.
bufãr
->
d©a
+(1+4),

3233 
deçuÉ_duid
.
d©a
, deçuÉ_duid.
Ën
);

3236 ià(!(
	`İtiÚ_code_hash_lookup
(&
İtiÚ
, 
dhı_univ”£
.
code_hash
,

3237 &
i
, 0, 
MDL
) &&

3238 
	`make_cÚ¡_İtiÚ_ÿche
(&
oc
, 
NULL
,

3239 (
u_št8_t
 *)
ş›Á_id’tif›r
.
d©a
,

3240 
ş›Á_id’tif›r
.
Ën
,

3241 
İtiÚ
, 
MDL
)))

3242 
	`log_”rÜ
 ("can't make„equested client id cache..");

3244 
	`§ve_İtiÚ
 (&
dhı_univ”£
, *
İ
, 
oc
);

3245 
	`İtiÚ_ÿche_d”eã»nû
 (&
oc
, 
MDL
);

3247 
	`İtiÚ_d”eã»nû
(&
İtiÚ
, 
MDL
);

3251 ià(
ş›Á
->
cÚfig
->
Ú_ŒªsmissiÚ
)

3252 
	`execu‹_¡©em’ts_š_scİe
(
NULL
, NULL, NULL, 
ş›Á
,

3253 (
Ëa£
 ?†—£->
İtiÚs
 : 
NULL
),

3254 *
İ
, &
glob®_scİe
,

3255 
ş›Á
->
cÚfig
->
Ú_ŒªsmissiÚ
,

3256 
NULL
, NULL);

3257 
	}
}

3259 
	$make_discov”
 (
ş›Á
, 
Ëa£
)

3260 
ş›Á_¡©e
 *
ş›Á
;

3261 
ş›Á_Ëa£
 *
Ëa£
;

3263 
discov”
 = 
DHCPDISCOVER
;

3264 
İtiÚ_¡©e
 *
İtiÚs
 = (option_state *)0;

3266 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
, 0,  (client ->…acket));

3268 
	`make_ş›Á_İtiÚs
 (
ş›Á
,

3269 
Ëa£
, &
discov”
, (
İtiÚ_ÿche
 *)0,

3270 
Ëa£
 ? &Ëa£ -> 
add»ss
 : (
Ÿddr
 *)0,

3271 
ş›Á
 -> 
cÚfig
 -> 
»que¡ed_İtiÚs
,

3272 &
İtiÚs
);

3275 
ş›Á
 -> 
·ck‘_Ëngth
 =

3276 
	`cÚs_İtiÚs
 ((
·ck‘
 *)0, &
ş›Á
 ->…acket,

3277 (
Ëa£
 *)0, 
ş›Á
,

3279 (
İtiÚ_¡©e
 *)0,

3280 
İtiÚs
,

3281  &
glob®_scİe
,

3285 (
d©a_¡ršg
 *)0,

3286 
ş›Á
 -> 
cÚfig
 -> 
v’dÜ_¥aû_Çme
);

3288 
	`İtiÚ_¡©e_d”eã»nû
 (&
İtiÚs
, 
MDL
);

3289 ià(
ş›Á
 -> 
·ck‘_Ëngth
 < 
BOOTP_MIN_LEN
)

3290 
ş›Á
 -> 
·ck‘_Ëngth
 = 
BOOTP_MIN_LEN
;

3292 
ş›Á
 -> 
·ck‘
.
İ
 = 
BOOTREQUEST
;

3293 
ş›Á
 -> 
·ck‘
.
hty³
 = cl›Á -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [0];

3295 
ş›Á
 -> 
·ck‘
.
hËn
 = cl›Á -> 
š‹rçû
 -> 
hw_add»ss
.hlen - 1;

3296 
ş›Á
 -> 
·ck‘
.
hİs
 = 0;

3297 
ş›Á
 -> 
·ck‘
.
xid
 = 
	`¿ndom
 ();

3298 
ş›Á
 -> 
·ck‘
.
£cs
 = 0;

3300 ià(
	`ÿn_»ûive_uniÿ¡_uncÚfigu»d
 (
ş›Á
 -> 
š‹rçû
))

3301 
ş›Á
 -> 
·ck‘
.
æags
 = 0;

3303 
ş›Á
 -> 
·ck‘
.
æags
 = 
	`htÚs
 (
BOOTP_BROADCAST
);

3305 
	`mem£t
 (&(
ş›Á
 -> 
·ck‘
.
cŸddr
),

3306 0,  
ş›Á
 -> 
·ck‘
.
cŸddr
);

3307 
	`mem£t
 (&(
ş›Á
 -> 
·ck‘
.
yŸddr
),

3308 0,  
ş›Á
 -> 
·ck‘
.
yŸddr
);

3309 
	`mem£t
 (&(
ş›Á
 -> 
·ck‘
.
sŸddr
),

3310 0,  
ş›Á
 -> 
·ck‘
.
sŸddr
);

3311 
ş›Á
 -> 
·ck‘
.
gŸddr
 = giaddr;

3312 ià(
ş›Á
 -> 
š‹rçû
 -> 
hw_add»ss
.
hËn
 > 0)

3313 
	`memıy
 (
ş›Á
 -> 
·ck‘
.
chaddr
,

3314 &
ş›Á
 -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [1],

3315 ()(
ş›Á
 -> 
š‹rçû
 -> 
hw_add»ss
.
hËn
 - 1));

3317 #ifdeà
DEBUG_PACKET


3318 
	`dump_¿w
 ((*)&
ş›Á
 -> 
·ck‘
, cl›Á -> 
·ck‘_Ëngth
);

3320 
	}
}

3323 
	$make_»que¡
 (
ş›Á
, 
Ëa£
)

3324 
ş›Á_¡©e
 *
ş›Á
;

3325 
ş›Á_Ëa£
 *
Ëa£
;

3327 
»que¡
 = 
DHCPREQUEST
;

3328 
İtiÚ_ÿche
 *
oc
;

3330 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
, 0,  (client ->…acket));

3332 ià(
ş›Á
 -> 
¡©e
 =ğ
S_REQUESTING
)

3333 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
Ëa£
 -> 
İtiÚs
,

3334 
DHO_DHCP_SERVER_IDENTIFIER
);

3336 
oc
 = (
İtiÚ_ÿche
 *)0;

3338 ià(
ş›Á
 -> 
£Á_İtiÚs
)

3339 
	`İtiÚ_¡©e_d”eã»nû
 (&
ş›Á
 -> 
£Á_İtiÚs
, 
MDL
);

3341 
	`make_ş›Á_İtiÚs
 (
ş›Á
, 
Ëa£
, &
»que¡
, 
oc
,

3342 ((
ş›Á
 -> 
¡©e
 =ğ
S_REQUESTING
 ||

3343 
ş›Á
 -> 
¡©e
 =ğ
S_REBOOTING
)

3344 ? &
Ëa£
 -> 
add»ss


3345 : (
Ÿddr
 *)0),

3346 
ş›Á
 -> 
cÚfig
 -> 
»que¡ed_İtiÚs
,

3347 &
ş›Á
 -> 
£Á_İtiÚs
);

3350 
ş›Á
 -> 
·ck‘_Ëngth
 =

3351 
	`cÚs_İtiÚs
 ((
·ck‘
 *)0, &
ş›Á
 ->…acket,

3352 (
Ëa£
 *)0, 
ş›Á
,

3354 (
İtiÚ_¡©e
 *)0,

3355 
ş›Á
 -> 
£Á_İtiÚs
,

3356  &
glob®_scİe
,

3360 (
d©a_¡ršg
 *)0,

3361 
ş›Á
 -> 
cÚfig
 -> 
v’dÜ_¥aû_Çme
);

3363 ià(
ş›Á
 -> 
·ck‘_Ëngth
 < 
BOOTP_MIN_LEN
)

3364 
ş›Á
 -> 
·ck‘_Ëngth
 = 
BOOTP_MIN_LEN
;

3366 
ş›Á
 -> 
·ck‘
.
İ
 = 
BOOTREQUEST
;

3367 
ş›Á
 -> 
·ck‘
.
hty³
 = cl›Á -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [0];

3369 
ş›Á
 -> 
·ck‘
.
hËn
 = cl›Á -> 
š‹rçû
 -> 
hw_add»ss
.hlen - 1;

3370 
ş›Á
 -> 
·ck‘
.
hİs
 = 0;

3371 
ş›Á
 -> 
·ck‘
.
xid
 = client -> xid;

3372 
ş›Á
 -> 
·ck‘
.
£cs
 = 0;

3376 ià(
ş›Á
 -> 
¡©e
 =ğ
S_BOUND
 ||

3377 
ş›Á
 -> 
¡©e
 =ğ
S_RENEWING
 ||

3378 
ş›Á
 -> 
¡©e
 =ğ
S_REBINDING
) {

3379 
	`memıy
 (&
ş›Á
 -> 
·ck‘
.
cŸddr
,

3380 
Ëa£
 -> 
add»ss
.
Ÿbuf
,†—£ ->‡dd»ss.
Ën
);

3381 
ş›Á
 -> 
·ck‘
.
æags
 = 0;

3383 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
.
cŸddr
, 0,

3384  
ş›Á
 -> 
·ck‘
.
cŸddr
);

3385 ià(
	`ÿn_»ûive_uniÿ¡_uncÚfigu»d
 (
ş›Á
 -> 
š‹rçû
))

3386 
ş›Á
 -> 
·ck‘
.
æags
 = 0;

3388 
ş›Á
 -> 
·ck‘
.
æags
 = 
	`htÚs
 (
BOOTP_BROADCAST
);

3391 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
.
yŸddr
, 0,

3392  
ş›Á
 -> 
·ck‘
.
yŸddr
);

3393 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
.
sŸddr
, 0,

3394  
ş›Á
 -> 
·ck‘
.
sŸddr
);

3395 ià(
ş›Á
 -> 
¡©e
 !ğ
S_BOUND
 &&

3396 
ş›Á
 -> 
¡©e
 !ğ
S_RENEWING
)

3397 
ş›Á
 -> 
·ck‘
.
gŸddr
 = giaddr;

3399 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
.
gŸddr
, 0,

3400  
ş›Á
 -> 
·ck‘
.
gŸddr
);

3406 
	`´štf
("\nB¬oÚ GIADDR:%ld\n", ()
ş›Á
->
·ck‘
.
gŸddr
.
s_addr
);

3412 
	`´štf
("%d.%d.%d.%d\n",

3413 ()(
ş›Á
->
·ck‘
.
gŸddr
.
s_addr
&0xFF),

3414 ()((
ş›Á
->
·ck‘
.
gŸddr
.
s_addr
&0xFF00)>>8),

3415 ()((
ş›Á
->
·ck‘
.
gŸddr
.
s_addr
&0xFF0000)>>16),

3416 ()((
ş›Á
->
·ck‘
.
gŸddr
.
s_addr
&0xFF000000)>>24));

3420 ià(
ş›Á
 -> 
š‹rçû
 -> 
hw_add»ss
.
hËn
 > 0)

3421 
	`memıy
 (
ş›Á
 -> 
·ck‘
.
chaddr
,

3422 &
ş›Á
 -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [1],

3423 ()(
ş›Á
 -> 
š‹rçû
 -> 
hw_add»ss
.
hËn
 - 1));

3425 #ifdeà
DEBUG_PACKET


3426 
	`dump_¿w
 ((*)&
ş›Á
 -> 
·ck‘
, cl›Á -> 
·ck‘_Ëngth
);

3428 
	}
}

3430 
	$make_deşše
 (
ş›Á
, 
Ëa£
)

3431 
ş›Á_¡©e
 *
ş›Á
;

3432 
ş›Á_Ëa£
 *
Ëa£
;

3434 
deşše
 = 
DHCPDECLINE
;

3435 
İtiÚ_ÿche
 *
oc
;

3437 
İtiÚ_¡©e
 *
İtiÚs
 = (option_state *)0;

3440 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
Ëa£
 -> 
İtiÚs
,

3441 
DHO_DHCP_SERVER_IDENTIFIER
);

3442 
	`make_ş›Á_İtiÚs
(
ş›Á
, 
Ëa£
, &
deşše
, 
oc
, &Ëa£->
add»ss
,

3443 
NULL
, &
İtiÚs
);

3446 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
, 0,  (client ->…acket));

3447 
ş›Á
 -> 
·ck‘_Ëngth
 =

3448 
	`cÚs_İtiÚs
 ((
·ck‘
 *)0, &
ş›Á
 ->…acket,

3449 (
Ëa£
 *)0, 
ş›Á
, 0,

3450 (
İtiÚ_¡©e
 *)0, 
İtiÚs
,

3451 &
glob®_scİe
, 0, 0, 0, (
d©a_¡ršg
 *)0,

3452 
ş›Á
 -> 
cÚfig
 -> 
v’dÜ_¥aû_Çme
);

3455 
	`İtiÚ_¡©e_d”eã»nû
 (&
İtiÚs
, 
MDL
);

3457 ià(
ş›Á
 -> 
·ck‘_Ëngth
 < 
BOOTP_MIN_LEN
)

3458 
ş›Á
 -> 
·ck‘_Ëngth
 = 
BOOTP_MIN_LEN
;

3460 
ş›Á
 -> 
·ck‘
.
İ
 = 
BOOTREQUEST
;

3461 
ş›Á
 -> 
·ck‘
.
hty³
 = cl›Á -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [0];

3463 
ş›Á
 -> 
·ck‘
.
hËn
 = cl›Á -> 
š‹rçû
 -> 
hw_add»ss
.hlen - 1;

3464 
ş›Á
 -> 
·ck‘
.
hİs
 = 0;

3465 
ş›Á
 -> 
·ck‘
.
xid
 = client -> xid;

3466 
ş›Á
 -> 
·ck‘
.
£cs
 = 0;

3467 ià(
	`ÿn_»ûive_uniÿ¡_uncÚfigu»d
 (
ş›Á
 -> 
š‹rçû
))

3468 
ş›Á
 -> 
·ck‘
.
æags
 = 0;

3470 
ş›Á
 -> 
·ck‘
.
æags
 = 
	`htÚs
 (
BOOTP_BROADCAST
);

3473 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
.
cŸddr
, 0,

3474  
ş›Á
 -> 
·ck‘
.
cŸddr
);

3475 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
.
yŸddr
, 0,

3476  
ş›Á
 -> 
·ck‘
.
yŸddr
);

3477 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
.
sŸddr
, 0,

3478  
ş›Á
 -> 
·ck‘
.
sŸddr
);

3479 
ş›Á
 -> 
·ck‘
.
gŸddr
 = giaddr;

3480 
	`memıy
 (
ş›Á
 -> 
·ck‘
.
chaddr
,

3481 &
ş›Á
 -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [1],

3482 
ş›Á
 -> 
š‹rçû
 -> 
hw_add»ss
.
hËn
);

3484 #ifdeà
DEBUG_PACKET


3485 
	`dump_¿w
 ((*)&
ş›Á
 -> 
·ck‘
, cl›Á -> 
·ck‘_Ëngth
);

3487 
	}
}

3489 
	$make_»Ëa£
 (
ş›Á
, 
Ëa£
)

3490 
ş›Á_¡©e
 *
ş›Á
;

3491 
ş›Á_Ëa£
 *
Ëa£
;

3493 
»que¡
 = 
DHCPRELEASE
;

3494 
İtiÚ_ÿche
 *
oc
;

3496 
İtiÚ_¡©e
 *
İtiÚs
 = (option_state *)0;

3498 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
, 0,  (client ->…acket));

3500 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
Ëa£
 -> 
İtiÚs
,

3501 
DHO_DHCP_SERVER_IDENTIFIER
);

3502 
	`make_ş›Á_İtiÚs
(
ş›Á
, 
Ëa£
, &
»que¡
, 
oc
, 
NULL
, NULL, &
İtiÚs
);

3505 
ş›Á
 -> 
·ck‘_Ëngth
 =

3506 
	`cÚs_İtiÚs
 ((
·ck‘
 *)0, &
ş›Á
 ->…acket,

3507 (
Ëa£
 *)0, 
ş›Á
,

3509 (
İtiÚ_¡©e
 *)0,

3510 
İtiÚs
,

3511  &
glob®_scİe
,

3515 (
d©a_¡ršg
 *)0,

3516 
ş›Á
 -> 
cÚfig
 -> 
v’dÜ_¥aû_Çme
);

3518 ià(
ş›Á
 -> 
·ck‘_Ëngth
 < 
BOOTP_MIN_LEN
)

3519 
ş›Á
 -> 
·ck‘_Ëngth
 = 
BOOTP_MIN_LEN
;

3520 
	`İtiÚ_¡©e_d”eã»nû
 (&
İtiÚs
, 
MDL
);

3522 
ş›Á
 -> 
·ck‘
.
İ
 = 
BOOTREQUEST
;

3523 
ş›Á
 -> 
·ck‘
.
hty³
 = cl›Á -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [0];

3525 
ş›Á
 -> 
·ck‘
.
hËn
 = cl›Á -> 
š‹rçû
 -> 
hw_add»ss
.hlen - 1;

3526 
ş›Á
 -> 
·ck‘
.
hİs
 = 0;

3527 
ş›Á
 -> 
·ck‘
.
xid
 = 
	`¿ndom
 ();

3528 
ş›Á
 -> 
·ck‘
.
£cs
 = 0;

3529 
ş›Á
 -> 
·ck‘
.
æags
 = 0;

3530 
	`memıy
 (&
ş›Á
 -> 
·ck‘
.
cŸddr
,

3531 
Ëa£
 -> 
add»ss
.
Ÿbuf
,†—£ ->‡dd»ss.
Ën
);

3532 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
.
yŸddr
, 0,

3533  
ş›Á
 -> 
·ck‘
.
yŸddr
);

3534 
	`mem£t
 (&
ş›Á
 -> 
·ck‘
.
sŸddr
, 0,

3535  
ş›Á
 -> 
·ck‘
.
sŸddr
);

3536 
ş›Á
 -> 
·ck‘
.
gŸddr
 = giaddr;

3537 
	`memıy
 (
ş›Á
 -> 
·ck‘
.
chaddr
,

3538 &
ş›Á
 -> 
š‹rçû
 -> 
hw_add»ss
.
hbuf
 [1],

3539 
ş›Á
 -> 
š‹rçû
 -> 
hw_add»ss
.
hËn
);

3541 #ifdeà
DEBUG_PACKET


3542 
	`dump_¿w
 ((*)&
ş›Á
 -> 
·ck‘
, cl›Á -> 
·ck‘_Ëngth
);

3544 
	}
}

3546 
	$de¡roy_ş›Á_Ëa£
 (
Ëa£
)

3547 
ş›Á_Ëa£
 *
Ëa£
;

3549 ià(
Ëa£
 -> 
£rv”_Çme
)

3550 
	`dä“
 (
Ëa£
 -> 
£rv”_Çme
, 
MDL
);

3551 ià(
Ëa£
 -> 
f’ame
)

3552 
	`dä“
 (
Ëa£
 -> 
f’ame
, 
MDL
);

3553 
	`İtiÚ_¡©e_d”eã»nû
 (&
Ëa£
 -> 
İtiÚs
, 
MDL
);

3554 
	`ä“_ş›Á_Ëa£
 (
Ëa£
, 
MDL
);

3555 
	}
}

3557 
FILE
 *
	gËa£Fe
 = 
NULL
;

3558 
	gËa£s_wr™‹n
 = 0;

3560 
	$»wr™e_ş›Á_Ëa£s
 ()

3562 
š‹rçû_šfo
 *

;

3563 
ş›Á_¡©e
 *
ş›Á
;

3564 
ş›Á_Ëa£
 *
Í
;

3566 ià(
Ëa£Fe
 !ğ
NULL
)

3567 
	`fşo£
 (
Ëa£Fe
);

3568 
Ëa£Fe
 = 
	`fİ’
 (
·th_dhş›Á_db
, "w");

3569 ià(
Ëa£Fe
 =ğ
NULL
) {

3570 
	`log_”rÜ
 ("ÿn'ˆü—‹ %s: %m", 
·th_dhş›Á_db
);

3575 ià(
deçuÉ_duid
.
Ën
 != 0)

3576 
	`wr™e_duid
(&
deçuÉ_duid
);

3580 

 = 
š‹rçûs
; ip; i°ğ -> 
Ãxt
) {

3581 
ş›Á
 = 

 -> cl›Á; cl›Á; cl›Á = cl›Á -> 
Ãxt
) {

3582 
Í
 = 
ş›Á
 -> 
Ëa£s
;†p;†°ğÍ -> 
Ãxt
) {

3583 
	`wr™e_ş›Á_Ëa£
 (
ş›Á
, 
Í
, 1, 0);

3585 ià(
ş›Á
 -> 
aùive
)

3586 
	`wr™e_ş›Á_Ëa£
 (
ş›Á
,

3587 
ş›Á
 -> 
aùive
, 1, 0);

3589 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

3590 
	`wr™e_ş›Á6_Ëa£
(
ş›Á
,

3591 
ş›Á
->
aùive_Ëa£
,

3595 
ş›Á
->
Ï¡_wr™e
 = 0;

3601 

 = 
dummy_š‹rçûs
; ip; i°ğ -> 
Ãxt
) {

3602 
ş›Á
 = 

 -> cl›Á; cl›Á; cl›Á = cl›Á -> 
Ãxt
) {

3603 
Í
 = 
ş›Á
 -> 
Ëa£s
;†p;†°ğÍ -> 
Ãxt
) {

3604 
	`wr™e_ş›Á_Ëa£
 (
ş›Á
, 
Í
, 1, 0);

3606 ià(
ş›Á
 -> 
aùive
)

3607 
	`wr™e_ş›Á_Ëa£
 (
ş›Á
,

3608 
ş›Á
 -> 
aùive
, 1, 0);

3610 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)

3611 
	`wr™e_ş›Á6_Ëa£
(
ş›Á
,

3612 
ş›Á
->
aùive_Ëa£
,

3616 
ş›Á
->
Ï¡_wr™e
 = 0;

3619 
	`fæush
 (
Ëa£Fe
);

3620 
	}
}

3622 
	$wr™e_Ëa£_İtiÚ
 (
İtiÚ_ÿche
 *
oc
,

3623 
·ck‘
 *·ck‘, 
Ëa£
 *lease,

3624 
ş›Á_¡©e
 *client_state,

3625 
İtiÚ_¡©e
 *
š_İtiÚs
,

3626 
İtiÚ_¡©e
 *
cfg_İtiÚs
,

3627 
bšdšg_scİe
 **
scİe
,

3628 
univ”£
 *
u
, *
¡uff
)

3630 cÚ¡ *
Çme
, *
dÙ
;

3631 
d©a_¡ršg
 
ds
;

3632 *
´—mbË
 = 
¡uff
;

3634 
	`mem£t
 (&
ds
, 0,  ds);

3636 ià(
u
 !ğ&
dhı_univ”£
) {

3637 
Çme
 = 
u
 ->‚ame;

3638 
dÙ
 = ".";

3640 
Çme
 = "";

3641 
dÙ
 = "";

3643 ià(
	`ev®u©e_İtiÚ_ÿche
 (&
ds
, 
·ck‘
, 
Ëa£
, 
ş›Á_¡©e
,

3644 
š_İtiÚs
, 
cfg_İtiÚs
, 
scİe
, 
oc
, 
MDL
)) {

3646 
	`årštf
(
Ëa£Fe
, "%sİtiÚ %s%s%s", 
´—mbË
,

3647 
Çme
, 
dÙ
, 
oc
->
İtiÚ
->name);

3650 ià((
oc
->
İtiÚ
->
fÜm©
 =ğ
NULL
) ||

3651 (
oc
->
İtiÚ
->
fÜm©
[0] != 'Z')) {

3652 
	`årštf
(
Ëa£Fe
, " %s",

3653 
	`´‘ty_´št_İtiÚ
(
oc
->
İtiÚ
, 
ds
.
d©a
,

3654 
ds
.
Ën
, 1, 1));

3658 
	`årštf
(
Ëa£Fe
, ";\n");

3660 
	`d©a_¡ršg_fÜg‘
 (&
ds
, 
MDL
);

3662 
	}
}

3666 
	$wr™e_İtiÚs
(
ş›Á_¡©e
 *
ş›Á
, 
İtiÚ_¡©e
 *
İtiÚs
,

3667 cÚ¡ *
´—mbË
)

3669 
i
;

3671 
i
 = 0; i < 
İtiÚs
->
univ”£_couÁ
; i++) {

3672 
	`İtiÚ_¥aû_fÜ—ch
(
NULL
, NULL, 
ş›Á
, NULL, 
İtiÚs
,

3673 &
glob®_scİe
, 
univ”£s
[
i
],

3674 (*)
´—mbË
, 
wr™e_Ëa£_İtiÚ
);

3676 
	}
}

3693 
	$fÜm_duid
(
d©a_¡ršg
 *
duid
, cÚ¡ *
fe
, 
lše
)

3695 
š‹rçû_šfo
 *

;

3696 
Ën
;

3697 *
¡r
;

3700 

 = 
š‹rçûs
;

3702 ià(

 =ğ
NULL
)

3703 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

3705 ià((

->
hw_add»ss
.
hËn
 == 0) ||

3706 (

->
hw_add»ss
.
hËn
 > (->hw_add»ss.
hbuf
)))

3707 
	`log_çl
("ImpossibË h¬dw¬add»s Ëngth‡ˆ%s:%d.", 
MDL
);

3709 ià(
duid_ty³
 == 0)

3710 
duid_ty³
 = 
¡©–ess
 ? 
DUID_LL
 : 
DUID_LLT
;

3719 
Ën
 = 4 + (

->
hw_add»ss
.
hËn
 - 1);

3720 ià(
duid_ty³
 =ğ
DUID_LLT
)

3721 
Ën
 += 4;

3722 ià(!
	`bufãr_®loÿ‹
(&
duid
->
bufãr
, 
Ën
, 
MDL
))

3723 
	`log_çl
("no memory for default DUID!");

3724 
duid
->
d©a
 = duid->
bufãr
->data;

3725 
duid
->
Ën
 =†en;

3728 ià(
duid_ty³
 =ğ
DUID_LLT
) {

3729 
	`putUShÜt
(
duid
->
bufãr
->
d©a
, 
DUID_LLT
);

3730 
	`putUShÜt
(
duid
->
bufãr
->
d©a
 + 2, 

->
hw_add»ss
.
hbuf
[0]);

3731 
	`putULÚg
(
duid
->
bufãr
->
d©a
 + 4, 
cur_time
 - 
DUID_TIME_EPOCH
);

3732 
	`memıy
(
duid
->
bufãr
->
d©a
 + 8, 

->
hw_add»ss
.
hbuf
 + 1,

3733 

->
hw_add»ss
.
hËn
 - 1);

3735 
	`putUShÜt
(
duid
->
bufãr
->
d©a
, 
DUID_LL
);

3736 
	`putUShÜt
(
duid
->
bufãr
->
d©a
 + 2, 

->
hw_add»ss
.
hbuf
[0]);

3737 
	`memıy
(
duid
->
bufãr
->
d©a
 + 4, 

->
hw_add»ss
.
hbuf
 + 1,

3738 

->
hw_add»ss
.
hËn
 - 1);

3742 
¡r
 = 
	`fÜm©_Ëa£_id
(
duid
->
d©a
, duid->
Ën
,

3743 
tİ_Ëv–_cÚfig
.
Ëa£_id_fÜm©
, 
MDL
);

3744 ià(
¡r
 =ğ
NULL
) {

3745 
	`log_šfo
("form_duid: Couldn't‡llocate memoryo†og duid!");

3747 
	`log_šfo
("C»©ed duid %s.", 
¡r
);

3748 
	`dä“
(
¡r
, 
MDL
);

3750 
	}
}

3753 
isc_»suÉ_t


3754 
	$wr™e_duid
(
d©a_¡ršg
 *
duid
)

3756 *
¡r
;

3757 
¡©
;

3759 ià((
duid
 =ğ
NULL
è|| (duid->
Ën
 <= 2))

3760  
DHCP_R_INVALIDARG
;

3762 ià(
Ëa£Fe
 =ğ
NULL
) {

3763 
Ëa£Fe
 = 
	`fİ’
(
·th_dhş›Á_db
, "w");

3764 ià(
Ëa£Fe
 =ğ
NULL
) {

3765 
	`log_”rÜ
("ÿn'ˆü—‹ %s: %m", 
·th_dhş›Á_db
);

3766  
ISC_R_IOERROR
;

3771 
¡r
 = 
	`fÜm©_Ëa£_id
(
duid
->
d©a
, duid->
Ën
,

3772 
tİ_Ëv–_cÚfig
.
Ëa£_id_fÜm©
, 
MDL
);

3773 ià(
¡r
 =ğ
NULL
)

3774  
ISC_R_NOMEMORY
;

3776 
¡©
 = 
	`årštf
(
Ëa£Fe
, "deçuÉ-duid %s;\n", 
¡r
);

3777 
	`dä“
(
¡r
, 
MDL
);

3778 ià(
¡©
 <= 0)

3779  
ISC_R_IOERROR
;

3781 ià(
	`fæush
(
Ëa£Fe
) != 0)

3782  
ISC_R_IOERROR
;

3784  
ISC_R_SUCCESS
;

3785 
	}
}

3788 
isc_»suÉ_t


3789 
	$wr™e_ş›Á6_Ëa£
(
ş›Á_¡©e
 *
ş›Á
, 
dhc6_Ëa£
 *
Ëa£
,

3790 
»wr™e
, 
sync
)

3792 
dhc6_Ÿ
 *
Ÿ
;

3793 
dhc6_addr
 *
addr
;

3794 
¡©
;

3795 cÚ¡ *
ŸÇme
;

3798 ià(!
»wr™e
 && (
Ëa£s_wr™‹n
++ > 20)) {

3799 
	`»wr™e_ş›Á_Ëa£s
();

3800 
Ëa£s_wr™‹n
 = 0;

3801  
ISC_R_SUCCESS
;

3804 ià(
ş›Á
 =ğ
NULL
 || 
Ëa£
 == NULL)

3805  
DHCP_R_INVALIDARG
;

3807 ià(
Ëa£Fe
 =ğ
NULL
) {

3808 
Ëa£Fe
 = 
	`fİ’
(
·th_dhş›Á_db
, "w");

3809 ià(
Ëa£Fe
 =ğ
NULL
) {

3810 
	`log_”rÜ
("ÿn'ˆü—‹ %s: %m", 
·th_dhş›Á_db
);

3811  
ISC_R_IOERROR
;

3815 
¡©
 = 
	`årštf
(
Ëa£Fe
, "lease6 {\n");

3816 ià(
¡©
 <= 0)

3817  
ISC_R_IOERROR
;

3819 
¡©
 = 
	`årštf
(
Ëa£Fe
, " interface \"%s\";\n",

3820 
ş›Á
->
š‹rçû
->
Çme
);

3821 ià(
¡©
 <= 0)

3822  
ISC_R_IOERROR
;

3824 
Ÿ
 = 
Ëa£
->
bšdšgs
 ; i¨!ğ
NULL
 ; i¨ğŸ->
Ãxt
) {

3825 
Ÿ
->
Ÿ_ty³
) {

3826 
D6O_IA_NA
:

3828 
ŸÇme
 = "ia-na";

3830 
D6O_IA_TA
:

3831 
ŸÇme
 = "ia-ta";

3833 
D6O_IA_PD
:

3834 
ŸÇme
 = "ia-pd";

3842 
tİ_Ëv–_cÚfig
.
Ëa£_id_fÜm©
) {

3843 
TOKEN_HEX
: {

3844 * 
Ÿid_¡r
 = 
	`fÜm©_Ëa£_id
(

3845 (cÚ¡ *è&
Ÿ
->
Ÿid
, 4,

3846 
tİ_Ëv–_cÚfig
.
Ëa£_id_fÜm©
, 
MDL
);

3848 ià(!
Ÿid_¡r
) {

3849 
	`log_”rÜ
("Can't format iaid");

3850  
ISC_R_IOERROR
;

3853 
¡©
 = 
	`årštf
(
Ëa£Fe
, " %s %s {\n",

3854 
ŸÇme
, 
Ÿid_¡r
);

3855 
	`dä“
(
Ÿid_¡r
, 
MDL
);

3859 
TOKEN_OCTAL
:

3861 
¡©
 = 
	`årštf
(
Ëa£Fe
, " % % {\n", 
ŸÇme
,

3862 
	`´št_hex_1
(4, 
Ÿ
->
Ÿid
, 12));

3866 ià(
¡©
 <= 0)

3867  
ISC_R_IOERROR
;

3869 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_TA
)

3870 
¡©
 = 
	`årštf
(
Ëa£Fe
, " starts %d;\n"

3873 ()
Ÿ
->
¡¬ts
, ia->
»Ãw
, ia->
»bšd
);

3875 
¡©
 = 
	`årštf
(
Ëa£Fe
, " starts %d;\n",

3876 ()
Ÿ
->
¡¬ts
);

3877 ià(
¡©
 <= 0)

3878  
ISC_R_IOERROR
;

3880 
addr
 = 
Ÿ
->
addrs
 ;‡dd¸!ğ
NULL
 ;‡dd¸ğaddr->
Ãxt
) {

3881 ià(
Ÿ
->
Ÿ_ty³
 !ğ
D6O_IA_PD
)

3882 
¡©
 = 
	`årštf
(
Ëa£Fe
,

3884 
	`pŸddr
(
addr
->
add»ss
));

3886 
¡©
 = 
	`årštf
(
Ëa£Fe
,

3888 
	`pŸddr
(
addr
->
add»ss
),

3889 ()
addr
->
¶’
);

3890 ià(
¡©
 <= 0)

3891  
ISC_R_IOERROR
;

3893 
¡©
 = 
	`årštf
(
Ëa£Fe
, " starts %d;\n"

3896 ()
addr
->
¡¬ts
,‡ddr->
´eã¼ed_liã
,

3897 
addr
->
max_liã
);

3898 ià(
¡©
 <= 0)

3899  
ISC_R_IOERROR
;

3901 ià(
addr
->
İtiÚs
 !ğ
NULL
)

3902 
	`wr™e_İtiÚs
(
ş›Á
, 
addr
->
İtiÚs
, " ");

3904 
¡©
 = 
	`årštf
(
Ëa£Fe
, " }\n");

3905 ià(
¡©
 <= 0)

3906  
ISC_R_IOERROR
;

3909 ià(
Ÿ
->
İtiÚs
 !ğ
NULL
)

3910 
	`wr™e_İtiÚs
(
ş›Á
, 
Ÿ
->
İtiÚs
, " ");

3912 
¡©
 = 
	`årštf
(
Ëa£Fe
, " }\n");

3913 ià(
¡©
 <= 0)

3914  
ISC_R_IOERROR
;

3917 ià(
Ëa£
->
»Ëa£d
) {

3918 
¡©
 = 
	`årštf
(
Ëa£Fe
, "„eleased;\n");

3919 ià(
¡©
 <= 0)

3920  
ISC_R_IOERROR
;

3923 ià(
Ëa£
->
İtiÚs
 !ğ
NULL
)

3924 
	`wr™e_İtiÚs
(
ş›Á
, 
Ëa£
->
İtiÚs
, " ");

3926 
¡©
 = 
	`årštf
(
Ëa£Fe
, "}\n");

3927 ià(
¡©
 <= 0)

3928  
ISC_R_IOERROR
;

3930 ià(
	`fæush
(
Ëa£Fe
) != 0)

3931  
ISC_R_IOERROR
;

3933 ià(
sync
) {

3934 ià(
	`fsync
(
	`f’o
(
Ëa£Fe
)) < 0) {

3935 
	`log_”rÜ
("write_client_lease: fsync(): %m");

3936  
ISC_R_IOERROR
;

3940  
ISC_R_SUCCESS
;

3941 
	}
}

3943 
	$wr™e_ş›Á_Ëa£
 (
ş›Á
, 
Ëa£
, 
»wr™e
, 
makesu»
)

3944 
ş›Á_¡©e
 *
ş›Á
;

3945 
ş›Á_Ëa£
 *
Ëa£
;

3946 
»wr™e
;

3947 
makesu»
;

3949 
d©a_¡ršg
 
ds
;

3950 
”rÜs
 = 0;

3951 *
s
;

3952 cÚ¡ *
tv®
;

3954 ià(!
»wr™e
) {

3955 ià(
Ëa£s_wr™‹n
++ > 20) {

3956 
	`»wr™e_ş›Á_Ëa£s
 ();

3957 
Ëa£s_wr™‹n
 = 0;

3963 ià(
Ëa£
 -> 
is_¡©ic
)

3966 ià(
Ëa£Fe
 =ğ
NULL
) {

3967 
Ëa£Fe
 = 
	`fİ’
 (
·th_dhş›Á_db
, "w");

3968 ià(
Ëa£Fe
 =ğ
NULL
) {

3969 
	`log_”rÜ
 ("ÿn'ˆü—‹ %s: %m", 
·th_dhş›Á_db
);

3974 
”ºo
 = 0;

3975 
	`årštf
 (
Ëa£Fe
, "lease {\n");

3976 ià(
Ëa£
 -> 
is_boÙp
) {

3977 
	`årštf
 (
Ëa£Fe
, " bootp;\n");

3978 ià(
”ºo
) {

3979 ++
”rÜs
;

3980 
”ºo
 = 0;

3983 
	`årštf
 (
Ëa£Fe
, " interface \"%s\";\n",

3984 
ş›Á
 -> 
š‹rçû
 -> 
Çme
);

3985 ià(
”ºo
) {

3986 ++
”rÜs
;

3987 
”ºo
 = 0;

3989 ià(
ş›Á
 -> 
Çme
) {

3990 
	`årštf
 (
Ëa£Fe
, "‚am\"%s\";\n", 
ş›Á
 -> 
Çme
);

3991 ià(
”ºo
) {

3992 ++
”rÜs
;

3993 
”ºo
 = 0;

3996 
	`årštf
 (
Ëa£Fe
, " fixed-address %s;\n",

3997 
	`pŸddr
 (
Ëa£
 -> 
add»ss
));

3998 ià(
”ºo
) {

3999 ++
”rÜs
;

4000 
”ºo
 = 0;

4002 ià(
Ëa£
 -> 
f’ame
) {

4003 
s
 = 
	`quÙify_¡ršg
 (
Ëa£
 -> 
f’ame
, 
MDL
);

4004 ià(
s
) {

4005 
	`årštf
 (
Ëa£Fe
, " f’am\"%s\";\n", 
s
);

4006 ià(
”ºo
) {

4007 ++
”rÜs
;

4008 
”ºo
 = 0;

4010 
	`dä“
 (
s
, 
MDL
);

4012 
”rÜs
++;

4015 ià(
Ëa£
->
£rv”_Çme
 !ğ
NULL
) {

4016 
s
 = 
	`quÙify_¡ršg
(
Ëa£
->
£rv”_Çme
, 
MDL
);

4017 ià(
s
 !ğ
NULL
) {

4018 
	`årštf
(
Ëa£Fe
, " s”v”-Çm\"%s\";\n", 
s
);

4019 ià(
”ºo
) {

4020 ++
”rÜs
;

4021 
”ºo
 = 0;

4023 
	`dä“
(
s
, 
MDL
);

4025 ++
”rÜs
;

4027 ià(
Ëa£
 -> 
medium
) {

4028 
s
 = 
	`quÙify_¡ršg
 (
Ëa£
 -> 
medium
 -> 
¡ršg
, 
MDL
);

4029 ià(
s
) {

4030 
	`årštf
 (
Ëa£Fe
, " medium \"%s\";\n", 
s
);

4031 ià(
”ºo
) {

4032 ++
”rÜs
;

4033 
”ºo
 = 0;

4035 
	`dä“
 (
s
, 
MDL
);

4037 
”rÜs
++;

4039 ià(
”ºo
 != 0) {

4040 
”rÜs
++;

4041 
”ºo
 = 0;

4044 
	`mem£t
 (&
ds
, 0,  ds);

4046 
	`wr™e_İtiÚs
(
ş›Á
, 
Ëa£
->
İtiÚs
, " ");

4048 
tv®
 = 
	`´št_time
(
Ëa£
->
»Ãw®
);

4049 ià(
tv®
 =ğ
NULL
 ||

4050 
	`årštf
(
Ëa£Fe
, "„’ew %s\n", 
tv®
) < 0)

4051 
”rÜs
++;

4053 
tv®
 = 
	`´št_time
(
Ëa£
->
»bšd
);

4054 ià(
tv®
 =ğ
NULL
 ||

4055 
	`årštf
(
Ëa£Fe
, "„ebšd %s\n", 
tv®
) < 0)

4056 
”rÜs
++;

4058 
tv®
 = 
	`´št_time
(
Ëa£
->
expœy
);

4059 ià(
tv®
 =ğ
NULL
 ||

4060 
	`årštf
(
Ëa£Fe
, "ƒxpœ%s\n", 
tv®
) < 0)

4061 
”rÜs
++;

4063 ià(
	`årštf
(
Ëa£Fe
, "}\n") < 0)

4064 
”rÜs
++;

4066 ià(
	`fæush
(
Ëa£Fe
) != 0)

4067 
”rÜs
++;

4069 
ş›Á
->
Ï¡_wr™e
 = 
cur_time
;

4071 ià(!
”rÜs
 && 
makesu»
) {

4072 ià(
	`fsync
 (
	`f’o
 (
Ëa£Fe
)) < 0) {

4073 
	`log_šfo
 ("write_client_lease: %m");

4078  
”rÜs
 ? 0 : 1;

4079 
	}
}

4084 
	gsütName
 [256];

4085 
FILE
 *
	gsütFe
;

4099 
	$süt_š™
(
ş›Á_¡©e
 *
ş›Á
, cÚ¡ *
»asÚ
,

4100 
¡ršg_li¡
 *
medium
)

4102 
¡ršg_li¡
 *
¦
, *
Ãxt
;

4104 ià(
ş›Á
) {

4105 
¦
 = 
ş›Á
 -> 
’v
; sl; sÈğ
Ãxt
) {

4106 
Ãxt
 = 
¦
 ->‚ext;

4107 
	`dä“
 (
¦
, 
MDL
);

4109 
ş›Á
 -> 
’v
 = (
¡ršg_li¡
 *)0;

4110 
ş›Á
 -> 
’vc
 = 0;

4112 ià(
ş›Á
 -> 
š‹rçû
) {

4113 
	`ş›Á_’vadd
 (
ş›Á
, "", "interface", "%s",

4114 
ş›Á
 -> 
š‹rçû
 -> 
Çme
);

4116 ià(
ş›Á
 -> 
Çme
)

4117 
	`ş›Á_’vadd
 (
ş›Á
,

4118 "", "ş›Á", "%s", 
ş›Á
 -> 
Çme
);

4119 ià(
medium
)

4120 
	`ş›Á_’vadd
 (
ş›Á
,

4121 "", "medium", "%s", 
medium
 -> 
¡ršg
);

4123 
	`ş›Á_’vadd
 (
ş›Á
, "", "»asÚ", "%s", 
»asÚ
);

4124 
	`ş›Á_’vadd
 (
ş›Á
, "", "pid", "%ld", ()
	`g‘pid
 ());

4125 #ià
	`defšed
(
DHCPv6
)

4126 
	`ş›Á_’vadd
 (
ş›Á
, "", "dad_wait_time", "%ld",

4127 ()
dad_wa™_time
);

4130 
	}
}

4132 
	$ş›Á_İtiÚ_’vadd
 (
İtiÚ_ÿche
 *
oc
,

4133 
·ck‘
 *·ck‘, 
Ëa£
 *lease,

4134 
ş›Á_¡©e
 *client_state,

4135 
İtiÚ_¡©e
 *
š_İtiÚs
,

4136 
İtiÚ_¡©e
 *
cfg_İtiÚs
,

4137 
bšdšg_scİe
 **
scİe
,

4138 
univ”£
 *
u
, *
¡uff
)

4140 
’vadd_¡©e
 *
es
 = 
¡uff
;

4141 
d©a_¡ršg
 
d©a
;

4142 
	`mem£t
 (&
d©a
, 0,  data);

4144 ià(
	`ev®u©e_İtiÚ_ÿche
 (&
d©a
, 
·ck‘
, 
Ëa£
, 
ş›Á_¡©e
,

4145 
š_İtiÚs
, 
cfg_İtiÚs
, 
scİe
, 
oc
, 
MDL
)) {

4146 ià(
d©a
.
Ën
) {

4147 
Çme
 [256];

4148 ià(
	`dhı_İtiÚ_ev_Çme
 (
Çme
, ‚ame,

4149 
oc
->
İtiÚ
)) {

4150 cÚ¡ *
v®ue
;

4151 
size_t
 
Ëngth
;

4152 
v®ue
 = 
	`´‘ty_´št_İtiÚ
(
oc
->
İtiÚ
,

4153 
d©a
.data,

4154 
d©a
.
Ën
, 0, 0);

4155 
Ëngth
 = 
	`¡¾’
(
v®ue
);

4157 ià(
	`check_İtiÚ_v®ues
(
oc
->
İtiÚ
->
univ”£
,

4158 
oc
->
İtiÚ
->
code
,

4159 
v®ue
, 
Ëngth
) == 0) {

4160 
	`ş›Á_’vadd
(
es
->
ş›Á
,ƒs->
´efix
,

4161 
Çme
, "%s", 
v®ue
);

4163 
	`log_”rÜ
("suspect value in %s "

4165 
Çme
);

4167 
	`d©a_¡ršg_fÜg‘
 (&
d©a
, 
MDL
);

4171 
	}
}

4192 
	$süt_wr™e_·¿ms
(
ş›Á_¡©e
 *
ş›Á
, cÚ¡ *
´efix
,

4193 
ş›Á_Ëa£
 *
Ëa£
)

4195 
i
;

4196 
d©a_¡ršg
 
d©a
;

4197 
İtiÚ_ÿche
 *
oc
;

4198 
’vadd_¡©e
 
es
;

4200 
es
.
ş›Á
 = client;

4201 
es
.
´efix
 =…refix;

4203 
	`ş›Á_’vadd
 (
ş›Á
,

4204 
´efix
, "_add»ss", "%s", 
	`pŸddr
 (
Ëa£
 -> 
add»ss
));

4208 ià(
Ëa£
->
Ãxt_¤v_addr
.
Ën
 != 0) {

4209 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "next_server", "%s",

4210 
	`pŸddr
(
Ëa£
->
Ãxt_¤v_addr
));

4220 
	`mem£t
 (&
d©a
, 0,  data);

4221 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
, 
Ëa£
 -> 
İtiÚs
, 
DHO_SUBNET_MASK
);

4222 ià(
oc
 && 
	`ev®u©e_İtiÚ_ÿche
 (&
d©a
, (
·ck‘
 *)0,

4223 (
Ëa£
 *)0, 
ş›Á
,

4224 (
İtiÚ_¡©e
 *)0,

4225 
Ëa£
 -> 
İtiÚs
,

4226 &
glob®_scİe
, 
oc
, 
MDL
)) {

4227 ià(
d©a
.
Ën
 > 3) {

4228 
Ÿddr
 
Ãtmask
, 
subÃt
, 
brßdÿ¡
;

4237 
	`memıy
(
Ãtmask
.
Ÿbuf
, 
d©a
.data, 4);

4238 
Ãtmask
.
Ën
 = 4;

4239 
	`d©a_¡ršg_fÜg‘
 (&
d©a
, 
MDL
);

4241 
subÃt
 = 
	`subÃt_numb”
 (
Ëa£
 -> 
add»ss
, 
Ãtmask
);

4242 ià(
subÃt
.
Ën
) {

4243 
	`ş›Á_’vadd
 (
ş›Á
, 
´efix
, "network_number",

4244 "%s", 
	`pŸddr
 (
subÃt
));

4246 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
,

4247 
Ëa£
 -> 
İtiÚs
,

4248 
DHO_BROADCAST_ADDRESS
);

4249 ià(!
oc
 ||

4250 !(
ev®u©e_İtiÚ_ÿche


4251 (&
d©a
, (
·ck‘
 *)0,

4252 (
Ëa£
 *)0, 
ş›Á
,

4253 (
İtiÚ_¡©e
 *)0,

4254 
Ëa£
 -> 
İtiÚs
,

4255 &
glob®_scİe
, 
oc
, 
MDL
))) {

4256 
brßdÿ¡
 = 
	`brßdÿ¡_addr
 (
subÃt
, 
Ãtmask
);

4257 ià(
brßdÿ¡
.
Ën
) {

4258 
	`ş›Á_’vadd
 (
ş›Á
,

4259 
´efix
, "broadcast_address",

4260 "%s", 
	`pŸddr
 (
brßdÿ¡
));

4265 
	`d©a_¡ršg_fÜg‘
 (&
d©a
, 
MDL
);

4268 ià(
Ëa£
->
f’ame
) {

4269 ià(
	`check_İtiÚ_v®ues
(
NULL
, 
DHO_ROOT_PATH
,

4270 
Ëa£
->
f’ame
,

4271 
	`¡¾’
(
Ëa£
->
f’ame
)) == 0) {

4272 
	`ş›Á_’vadd
(
ş›Á
, 
´efix
, "filename",

4273 "%s", 
Ëa£
->
f’ame
);

4275 
	`log_”rÜ
("suspect value in %s "

4277 
Ëa£
->
f’ame
);

4281 ià(
Ëa£
->
£rv”_Çme
) {

4282 ià(
	`check_İtiÚ_v®ues
(
NULL
, 
DHO_HOST_NAME
,

4283 
Ëa£
->
£rv”_Çme
,

4284 
	`¡¾’
(
Ëa£
->
£rv”_Çme
)) == 0 ) {

4285 
	`ş›Á_’vadd
 (
ş›Á
, 
´efix
, "server_name",

4286 "%s", 
Ëa£
->
£rv”_Çme
);

4288 
	`log_”rÜ
("suspect value in %s "

4290 
Ëa£
->
£rv”_Çme
);

4294 
i
 = 0; i < 
Ëa£
 -> 
İtiÚs
 -> 
univ”£_couÁ
; i++) {

4295 
	`İtiÚ_¥aû_fÜ—ch
 ((
·ck‘
 *)0, (
Ëa£
 *)0,

4296 
ş›Á
, (
İtiÚ_¡©e
 *)0,

4297 
Ëa£
 -> 
İtiÚs
, &
glob®_scİe
,

4298 
univ”£s
 [
i
],

4299 &
es
, 
ş›Á_İtiÚ_’vadd
);

4302 
	`ş›Á_’vadd
 (
ş›Á
, 
´efix
, "expiry", "%lu",

4303 ()(
Ëa£
 -> 
expœy
));

4304 
	}
}

4315 
	$süt_wr™e_»que¡ed
(
ş›Á_¡©e
 *
ş›Á
)

4317 
i
;

4318 
İtiÚ
 **
»q
;

4319 
Çme
[256];

4320 
»q
 = 
ş›Á
->
cÚfig
->
»que¡ed_İtiÚs
;

4322 ià(
»q
 =ğ
NULL
)

4325 
i
 = 0 ; 
»q
[i] !ğ
NULL
 ; i++) {

4326 ià((
»q
[
i
]->
univ”£
 =ğ&
dhı_univ”£
) &&

4327 
	`dhı_İtiÚ_ev_Çme
(
Çme
, Òame), 
»q
[
i
])) {

4328 
	`ş›Á_’vadd
(
ş›Á
, "»que¡ed_", 
Çme
, "%d", 1);

4331 
	}
}

4345 
	$süt_go
(
ş›Á_¡©e
 *
ş›Á
)

4347 *
sütName
;

4348 *
¬gv
 [2];

4349 **
’vp
;

4350 
»asÚ
 [] = "REASON=NBI";

4351 
ş›Á_·th
 [] = 
CLIENT_PATH
;

4352 
i
;

4353 
¡ršg_li¡
 *
¥
, *
Ãxt
;

4354 
pid
, 
wpid
, 
w¡©us
;

4356 ià(
ş›Á
)

4357 
sütName
 = 
ş›Á
 -> 
cÚfig
 -> 
süt_Çme
;

4359 
sütName
 = 
tİ_Ëv–_cÚfig
.
süt_Çme
;

4361 
’vp
 = 
	`dm®loc
 (((
ş›Á
 ? cl›Á -> 
’vc
 : 2) +

4362 
ş›Á_’v_couÁ
 + 2è*  (*), 
MDL
);

4363 ià(!
’vp
) {

4364 
	`log_”rÜ
 ("No memory for client scriptƒnvironment.");

4367 
i
 = 0;

4370 
¥
 = 
ş›Á_’v
; sp; s°ğ¥ -> 
Ãxt
) {

4371 
’vp
 [
i
++] = 
¥
 -> 
¡ršg
;

4374 ià(
ş›Á
) {

4375 
¥
 = 
ş›Á
 -> 
’v
; sp; s°ğ¥ -> 
Ãxt
) {

4376 
’vp
 [
i
++] = 
¥
 -> 
¡ršg
;

4379 
’vp
 [
i
++] = 
»asÚ
;

4382 
’vp
 [
i
++] = 
ş›Á_·th
;

4383 
’vp
 [
i
] = (*)0;

4385 
¬gv
 [0] = 
sütName
;

4386 
¬gv
 [1] = (*)0;

4388 
pid
 = 
	`fÜk
 ();

4389 ià(
pid
 < 0) {

4390 
	`log_”rÜ
 ("fork: %m");

4391 
w¡©us
 = 0;

4392 } ià(
pid
) {

4394 
wpid
 = 
	`wa™
 (&
w¡©us
);

4395 } 
wpid
 !ğ
pid
 && wpid > 0);

4396 ià(
wpid
 < 0) {

4397 
	`log_”rÜ
 ("wait: %m");

4398 
w¡©us
 = 0;

4404 ià(
Ëa£Fe
 !ğ
NULL
)

4405 
	`fşo£
(
Ëa£Fe
);

4406 
	`execve
 (
sütName
, 
¬gv
, 
’vp
);

4407 
	`log_”rÜ
 ("execv(%s, ...): %m", 
sütName
);

4408 
	`ex™
 (0);

4411 ià(
ş›Á
) {

4412 
¥
 = 
ş›Á
 -> 
’v
; sp; s°ğ
Ãxt
) {

4413 
Ãxt
 = 
¥
 ->‚ext;

4414 
	`dä“
 (
¥
, 
MDL
);

4416 
ş›Á
 -> 
’v
 = (
¡ršg_li¡
 *)0;

4417 
ş›Á
 -> 
’vc
 = 0;

4419 
	`dä“
 (
’vp
, 
MDL
);

4420 
	`g‘timeofday
(&
cur_tv
, 
NULL
);

4421  (
	`WIFEXITED
 (
w¡©us
) ?

4422 
	`WEXITSTATUS
 (
w¡©us
è: -
	`WTERMSIG
 (wstatus));

4423 
	}
}

4425 
	$ş›Á_’vadd
 (
ş›Á_¡©e
 *
ş›Á
,

4426 cÚ¡ *
´efix
, cÚ¡ *
Çme
, cÚ¡ *
fmt
, ...)

4428 
¥buf
 [1024];

4429 *
s
;

4430 
Ën
;

4431 
¡ršg_li¡
 *
v®
;

4432 
va_li¡
 
li¡
;

4434 
	`va_¡¬t
 (
li¡
, 
fmt
);

4435 
Ën
 = 
	`v¢´štf
 (
¥buf
,  spbuf, 
fmt
, 
li¡
);

4436 
	`va_’d
 (
li¡
);

4438 
v®
 = 
	`dm®loc
 (
	`¡¾’
 (
´efix
è+ sŒËÀ(
Çme
) + 1 +

4439 
Ën
 +  *
v®
, 
MDL
);

4440 ià(!
v®
) {

4441 
	`log_”rÜ
 ("client_envadd: cannot‡llocate space for variable");

4445 
s
 = 
v®
 -> 
¡ršg
;

4446 
	`¡rıy
 (
s
, 
´efix
);

4447 
	`¡rÿt
 (
s
, 
Çme
);

4448 
s
 +ğ
	`¡¾’
 (s);

4449 *
s
++ = '=';

4450 ià(
Ën
 >ğ 
¥buf
) {

4451 
	`va_¡¬t
 (
li¡
, 
fmt
);

4452 
	`v¢´štf
 (
s
, 
Ën
 + 1, 
fmt
, 
li¡
);

4453 
	`va_’d
 (
li¡
);

4455 
	`¡rıy
 (
s
, 
¥buf
);

4458 
v®
 -> 
Ãxt
 = 
ş›Á
 -> 
’v
;

4459 
ş›Á
 -> 
’v
 = 
v®
;

4460 
ş›Á
 -> 
’vc
++;

4461 
	}
}

4463 
	$dhı_İtiÚ_ev_Çme
 (
buf
, 
buæ’
, 
İtiÚ
)

4464 *
buf
;

4465 
size_t
 
buæ’
;

4466 
İtiÚ
 *option;

4468 
i
, 
j
;

4469 cÚ¡ *
s
;

4471 
j
 = 0;

4472 ià(
İtiÚ
 -> 
univ”£
 !ğ&
dhı_univ”£
) {

4473 
s
 = 
İtiÚ
 -> 
univ”£
 -> 
Çme
;

4474 
i
 = 0;

4476 
s
 = 
İtiÚ
 -> 
Çme
;

4477 
i
 = 1;

4481 *
s
) {

4482 ià(
j
 + 1 =ğ
buæ’
)

4484 ià(*
s
 == '-')

4485 
buf
 [
j
++] = '_';

4487 
buf
 [
j
++] = *
s
;

4488 ++
s
;

4490 ià(!
i
) {

4491 
s
 = 
İtiÚ
 -> 
Çme
;

4492 ià(
j
 + 1 =ğ
buæ’
)

4494 
buf
 [
j
++] = '_';

4496 ++
i
;

4497 } 
i
 != 2);

4499 
buf
 [
j
] = 0;

4501 
	}
}

4503 
	$fšish
 (
»t
)

4505 ià(
no_d«mÚ
 || 
dfd
[0] == -1 || dfd[1] == -1)

4506 
	`ex™
(()
»t
);

4507 ià(
	`wr™e
(
dfd
[1], &
»t
, 1) != 1)

4508 
	`log_çl
("writeo…arent: %m");

4509 (è
	`şo£
(
dfd
[1]);

4510 
dfd
[0] = dfd[1] = -1;

4511 
	`ex™
(()
»t
);

4512 
	}
}

4514 
	$d‘ach
 ()

4516 
buf
 = 0;

4519 ià(
no_d«mÚ
) {

4520 
	`wr™e_ş›Á_pid_fe
 ();

4525 ià(
dfd
[0] == -1 || dfd[1] == -1)

4529 ià(
	`wr™e
(
dfd
[1], &
buf
, 1) != 1)

4530 
	`log_çl
("writeo…arent: %m");

4531 (è
	`şo£
(
dfd
[1]);

4532 
dfd
[0] = dfd[1] = -1;

4535 
log_³¼Ü
 = 0;

4538 (è
	`£tsid
 ();

4541 (è
	`şo£
(0);

4542 (è
	`şo£
(1);

4543 (è
	`şo£
(2);

4546 (è
	`İ’
("/dev/nuÎ", 
O_RDWR
);

4547 (è
	`İ’
("/dev/nuÎ", 
O_RDWR
);

4548 (è
	`İ’
("/dev/nuÎ", 
O_RDWR
);

4550 
	`wr™e_ş›Á_pid_fe
 ();

4552 
	`IGNORE_RET
 (
	`chdœ
("/"));

4554 
	}
}

4556 
	$wr™e_ş›Á_pid_fe
 ()

4558 
FILE
 *
pf
;

4559 
pfdesc
;

4562 ià(
no_pid_fe
 =ğ
ISC_TRUE
) {

4566 
pfdesc
 = 
	`İ’
 (
·th_dhş›Á_pid
, 
O_CREAT
 | 
O_TRUNC
 | 
O_WRONLY
, 0644);

4568 ià(
pfdesc
 < 0) {

4569 
	`log_”rÜ
 ("Cª'ˆü—‹ %s: %m", 
·th_dhş›Á_pid
);

4573 
pf
 = 
	`fdİ’
 (
pfdesc
, "w");

4574 ià(!
pf
) {

4575 
	`şo£
(
pfdesc
);

4576 
	`log_”rÜ
 ("Cª'ˆfdİ’ %s: %m", 
·th_dhş›Á_pid
);

4578 
	`årštf
 (
pf
, "%ld\n", ()
	`g‘pid
 ());

4579 
	`fşo£
 (
pf
);

4581 
	}
}

4583 
	$ş›Á_loÿtiÚ_chªged
 ()

4585 
š‹rçû_šfo
 *

;

4586 
ş›Á_¡©e
 *
ş›Á
;

4588 

 = 
š‹rçûs
; ip; i°ğ -> 
Ãxt
) {

4589 
ş›Á
 = 

 -> cl›Á; cl›Á; cl›Á = cl›Á -> 
Ãxt
) {

4590 
ş›Á
 -> 
¡©e
) {

4591 
S_SELECTING
:

4592 
	`ÿnûl_timeout
 (
£nd_discov”
, 
ş›Á
);

4595 
S_BOUND
:

4596 
	`ÿnûl_timeout
 (
¡©e_bound
, 
ş›Á
);

4599 
S_REBOOTING
:

4600 
S_REQUESTING
:

4601 
S_RENEWING
:

4602 
	`ÿnûl_timeout
 (
£nd_»que¡
, 
ş›Á
);

4605 
S_INIT
:

4606 
S_REBINDING
:

4607 
S_STOPPED
:

4608 
S_DECLINING
:

4611 
ş›Á
 -> 
¡©e
 = 
S_INIT
;

4612 
	`¡©e_»boÙ
 (
ş›Á
);

4615 
	}
}

4617 
	$do_»Ëa£
(
ş›Á
)

4618 
ş›Á_¡©e
 *
ş›Á
;

4620 
d©a_¡ršg
 
ds
;

4621 
İtiÚ_ÿche
 *
oc
;

4623 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

4624 ià(
dhıv4_ov”_dhıv6
 && (
dhı4o6_¡©e
 <= 0)) {

4625 ià(
dhı4o6_¡©e
 < 0)

4626 
	`dhı4o6_pŞl
(
NULL
);

4627 
ş›Á
->
³ndšg
 = 
P_RELEASE
;

4633 
ş›Á
 -> 
xid
 = 
	`¿ndom
 ();

4636 ià(
ş›Á
 -> 
aùive
) {

4639 
	`make_»Ëa£
 (
ş›Á
, cl›Á -> 
aùive
);

4641 
	`mem£t
 (&
ds
, 0,  ds);

4642 
oc
 = 
	`lookup_İtiÚ
 (&
dhı_univ”£
,

4643 
ş›Á
 -> 
aùive
 -> 
İtiÚs
,

4644 
DHO_DHCP_SERVER_IDENTIFIER
);

4645 ià(
oc
 &&

4646 
	`ev®u©e_İtiÚ_ÿche
 (&
ds
, (
·ck‘
 *)0,

4647 (
Ëa£
 *)0, 
ş›Á
,

4648 (
İtiÚ_¡©e
 *)0,

4649 
ş›Á
 -> 
aùive
 -> 
İtiÚs
,

4650 &
glob®_scİe
, 
oc
, 
MDL
)) {

4651 ià(
ds
.
Ën
 > 3) {

4652 
	`memıy
 (
ş›Á
 -> 
de¡š©iÚ
.
Ÿbuf
,

4653 
ds
.
d©a
, 4);

4654 
ş›Á
 -> 
de¡š©iÚ
.
Ën
 = 4;

4656 
ş›Á
 -> 
de¡š©iÚ
 = 
Ÿddr_brßdÿ¡
;

4658 
	`d©a_¡ršg_fÜg‘
 (&
ds
, 
MDL
);

4660 
ş›Á
 -> 
de¡š©iÚ
 = 
Ÿddr_brßdÿ¡
;

4661 
ş›Á
 -> 
fœ¡_£ndšg
 = 
cur_time
;

4662 
ş›Á
 -> 
š‹rv®
 = cl›Á -> 
cÚfig
 -> 
š™Ÿl_š‹rv®
;

4665 
ş›Á
 -> 
medium
 = (
¡ršg_li¡
 *)0;

4668 
	`£nd_»Ëa£
 (
ş›Á
);

4671 
	`süt_š™
 (
ş›Á
,

4672 "RELEASE", (
¡ršg_li¡
 *)0);

4673 ià(
ş›Á
 -> 
®Ÿs
)

4674 
	`süt_wr™e_·¿ms
(
ş›Á
, "alias_",

4675 
ş›Á
 -> 
®Ÿs
);

4676 
	`süt_wr™e_·¿ms
(
ş›Á
, "Şd_", cl›Á -> 
aùive
);

4677 
	`süt_wr™e_»que¡ed
(
ş›Á
);

4678 
	`süt_go
(
ş›Á
);

4682 
	`ÿnûl_timeout
 (
¡©e_bound
, 
ş›Á
);

4683 
	`ÿnûl_timeout
 (
£nd_discov”
, 
ş›Á
);

4684 
	`ÿnûl_timeout
 (
¡©e_š™
, 
ş›Á
);

4685 
	`ÿnûl_timeout
 (
£nd_»que¡
, 
ş›Á
);

4686 
	`ÿnûl_timeout
 (
¡©e_»boÙ
, 
ş›Á
);

4687 
ş›Á
 -> 
¡©e
 = 
S_STOPPED
;

4689 #ià
	`defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

4690 ià(
dhıv4_ov”_dhıv6
)

4691 
	`fšish
(0);

4693 
	}
}

4695 
	$dhş›Á_š‹rçû_shutdown_hook
 (
š‹rçû_šfo
 *
š‹rçû
)

4697 
	`do_»Ëa£
 (
š‹rçû
 -> 
ş›Á
);

4700 
	}
}

4702 
	$dhş›Á_š‹rçû_discov”y_hook
 (
š‹rçû_šfo
 *
tmp
)

4704 
š‹rçû_šfo
 *
Ï¡
, *

;

4706 
Ï¡
 = 0;

4707 

 = 
dummy_š‹rçûs
; ip; i°ğ -> 
Ãxt
) {

4708 ià(!
	`¡rcmp
 (

 -> 
Çme
, 
tmp
 ->‚ame)) {

4710 ià(
Ï¡
) {

4711 

 = (
š‹rçû_šfo
 *)0;

4712 
	`š‹rçû_»ã»nû
 (&

, 
Ï¡
 -> 
Ãxt
, 
MDL
);

4713 
	`š‹rçû_d”eã»nû
 (&
Ï¡
 -> 
Ãxt
, 
MDL
);

4714 ià(

 -> 
Ãxt
) {

4715 
	`š‹rçû_»ã»nû
 (&
Ï¡
 -> 
Ãxt
,

4716 

 -> 
Ãxt
, 
MDL
);

4717 
	`š‹rçû_d”eã»nû
 (&

 -> 
Ãxt
,

4718 
MDL
);

4721 

 = (
š‹rçû_šfo
 *)0;

4722 
	`š‹rçû_»ã»nû
 (&

,

4723 
dummy_š‹rçûs
, 
MDL
);

4724 
	`š‹rçû_d”eã»nû
 (&
dummy_š‹rçûs
, 
MDL
);

4725 ià(

 -> 
Ãxt
) {

4726 
	`š‹rçû_»ã»nû
 (&
dummy_š‹rçûs
,

4727 

 -> 
Ãxt
, 
MDL
);

4728 
	`š‹rçû_d”eã»nû
 (&

 -> 
Ãxt
,

4729 
MDL
);

4733 ià(

 -> 
ş›Á
) {

4734 
tmp
 -> 
ş›Á
 = 

 -> client;

4735 
tmp
 -> 
ş›Á
 -> 
š‹rçû
 =mp;

4737 
	`š‹rçû_d”eã»nû
 (&

, 
MDL
);

4740 
Ï¡
 = 

;

4743 
	}
}

4745 
isc_»suÉ_t
 
	$dhş›Á_š‹rçû_¡¬tup_hook
 (
š‹rçû_šfo
 *
š‹rçû
)

4747 
š‹rçû_šfo
 *

;

4748 
ş›Á_¡©e
 *
ş›Á
;

4754 ià(
š‹rçûs
) {

4755 
	`š‹rçû_»ã»nû
 (&
š‹rçû
 -> 
Ãxt
, 
š‹rçûs
, 
MDL
);

4756 
	`š‹rçû_d”eã»nû
 (&
š‹rçûs
, 
MDL
);

4758 
	`š‹rçû_»ã»nû
 (&
š‹rçûs
, 
š‹rçû
, 
MDL
);

4760 
	`discov”_š‹rçûs
 (
DISCOVER_UNCONFIGURED
);

4762 

 = 
š‹rçûs
; ip; i°ğ -> 
Ãxt
) {

4765 ià(

 -> 
æags
 & 
INTERFACE_RUNNING
 ||

4766 (

 -> 
æags
 & (
INTERFACE_REQUESTED
 |

4767 
INTERFACE_AUTOMATIC
)) !=

4768 
INTERFACE_REQUESTED
)

4770 
	`süt_š™
 (

 -> 
ş›Á
,

4771 "PREINIT", (
¡ršg_li¡
 *)0);

4772 ià(

 -> 
ş›Á
 -> 
®Ÿs
)

4773 
	`süt_wr™e_·¿ms
(

 -> 
ş›Á
, "alias_",

4774 

 -> 
ş›Á
 -> 
®Ÿs
);

4775 
	`süt_go
(

 -> 
ş›Á
);

4778 
	`discov”_š‹rçûs
 (
š‹rçûs_»que¡ed
 != 0

4779 ? 
DISCOVER_REQUESTED


4780 : 
DISCOVER_RUNNING
);

4782 

 = 
š‹rçûs
; ip; i°ğ -> 
Ãxt
) {

4783 ià(

 -> 
æags
 & 
INTERFACE_RUNNING
)

4785 

 -> 
æags
 |ğ
INTERFACE_RUNNING
;

4786 
ş›Á
 = 

->ş›Á ; cl›Á ; cl›Á = cl›Á->
Ãxt
) {

4787 
ş›Á
->
¡©e
 = 
S_INIT
;

4788 
	`¡©e_»boÙ
(
ş›Á
);

4791  
ISC_R_SUCCESS
;

4792 
	}
}

4797 
	$·r£_ag’t_šfÜm©iÚ_İtiÚ
 (
·ck‘
, 
Ën
, 
d©a
)

4798 
·ck‘
 *packet;

4799 
Ën
;

4800 
u_št8_t
 *
d©a
;

4803 
	}
}

4807 
	$cÚs_ag’t_šfÜm©iÚ_İtiÚs
 (
cfg_İtiÚs
, 
ouack‘
,

4808 
ag’tix
, 
Ëngth
)

4809 
İtiÚ_¡©e
 *
cfg_İtiÚs
;

4810 
dhı_·ck‘
 *
ouack‘
;

4811 
ag’tix
;

4812 
Ëngth
;

4814  
Ëngth
;

4815 
	}
}

4817 
	$shutdown_ex™
 (*
foo
)

4820 ià(
no_pid_fe
 =ğ
ISC_FALSE
)

4821 (è
	`uÆšk
(
·th_dhş›Á_pid
);

4822 
	`fšish
(0);

4823 
	}
}

4825 #ià
defšed
 (
NSUPDATE
)

4841 
	$ş›Á_dns_»move_aùiÚ
(
dhı_ddns_cb_t
 *
ddns_cb
,

4842 
isc_»suÉ_t
 
”esuÉ
)

4845 
isc_»suÉ_t
 
»suÉ
;

4847 ià((
”esuÉ
 =ğ
ISC_R_SUCCESS
) &&

4848 (
ddns_cb
->
¡©e
 =ğ
DDNS_STATE_REM_FW_YXDHCID
)) {

4850 
ddns_cb
->
¡©e
 = 
DDNS_STATE_REM_FW_NXRR
;

4852 
»suÉ
 = 
	`ddns_modify_fwd
(
ddns_cb
, 
MDL
);

4853 ià(
»suÉ
 =ğ
ISC_R_SUCCESS
) {

4859 
	`dhş›Á_ddns_cb_ä“
(
ddns_cb
, 
MDL
);

4861 
	}
}

4864 
	$ş›Á_dns_»move
(
ş›Á_¡©e
 *
ş›Á
,

4865 
Ÿddr
 *
addr
)

4867 
dhı_ddns_cb_t
 *
ddns_cb
;

4868 
isc_»suÉ_t
 
»suÉ
;

4871 ià(
ş›Á
->
ddns_cb
 !ğ
NULL
) {

4872 
	`ddns_ÿnûl
(
ş›Á
->
ddns_cb
, 
MDL
);

4873 
ş›Á
->
ddns_cb
 = 
NULL
;

4876 
ddns_cb
 = 
	`ddns_cb_®loc
(
MDL
);

4877 ià(
ddns_cb
 !ğ
NULL
) {

4878 
ddns_cb
->
add»ss
 = *
addr
;

4879 
ddns_cb
->
timeout
 = 0;

4881 
ddns_cb
->
¡©e
 = 
DDNS_STATE_REM_FW_YXDHCID
;

4882 
ddns_cb
->
æags
 = 
DDNS_UPDATE_ADDR
;

4883 
ddns_cb
->
cur_func
 = 
ş›Á_dns_»move_aùiÚ
;

4885 
»suÉ
 = 
	`ş›Á_dns_upd©e
(
ş›Á
, 
ddns_cb
);

4887 ià(
»suÉ
 !ğ
ISC_R_TIMEDOUT
) {

4888 
	`dhş›Á_ddns_cb_ä“
(
ddns_cb
, 
MDL
);

4891 
	}
}

4894 
isc_»suÉ_t
 
	$dhı_£t_cÚŒŞ_¡©e
 (
cÚŒŞ_objeù_¡©e_t
 
Şd¡©e
,

4895 
cÚŒŞ_objeù_¡©e_t
 
Ãw¡©e
)

4897 
š‹rçû_šfo
 *

;

4898 
ş›Á_¡©e
 *
ş›Á
;

4899 
timev®
 
tv
;

4901 ià(
Ãw¡©e
 =ğ
£rv”_shutdown
) {

4903 ià(
shutdown_sigÇl
 =ğ
SIGUSR1
)

4904  
ISC_R_SUCCESS
;

4906 ià((
shutdown_sigÇl
 =ğ
SIGINT
) ||

4907 (
shutdown_sigÇl
 =ğ
SIGTERM
)) {

4908 
	`log_šfo
("Received signal %d, initiating shutdown.",

4909 
shutdown_sigÇl
);

4912 
shutdown_sigÇl
 = 
SIGUSR1
;

4916 

 = 
š‹rçûs
; ip; i°ğ -> 
Ãxt
) {

4917 
ş›Á
 = 

 -> cl›Á; cl›Á; cl›Á = cl›Á -> 
Ãxt
) {

4918 
Ãw¡©e
) {

4919 
£rv”_¡¬tup
:

4920  
ISC_R_SUCCESS
;

4922 
£rv”_ruÂšg
:

4923  
ISC_R_SUCCESS
;

4925 
£rv”_shutdown
:

4926 ià(
ş›Á
 -> 
aùive
 &&

4927 
ş›Á
 -> 
aùive
 -> 
expœy
 > 
cur_time
) {

4928 #ià
	`defšed
 (
NSUPDATE
)

4929 ià(
ş›Á
->
cÚfig
->
do_fÜw¬d_upd©e
) {

4930 
	`ş›Á_dns_»move
(
ş›Á
,

4931 &
ş›Á
->
aùive
->
add»ss
);

4934 
	`do_»Ëa£
 (
ş›Á
);

4938 
£rv”_hib”Ç‹
:

4939 
	`¡©e_¡İ
 (
ş›Á
);

4942 
£rv”_awak’
:

4943 
	`¡©e_»boÙ
 (
ş›Á
);

4949 ià(
Ãw¡©e
 =ğ
£rv”_shutdown
) {

4950 
tv
.
tv_£c
 = 
cur_tv
.tv_sec;

4951 
tv
.
tv_u£c
 = 
cur_tv
.tv_usec + 1;

4952 
	`add_timeout
(&
tv
, 
shutdown_ex™
, 0, 0, 0);

4954  
ISC_R_SUCCESS
;

4955 
	}
}

4957 #ià
defšed
 (
NSUPDATE
)

4964 
	$ş›Á_dns_upd©e_timeout
 (*
ı
)

4966 
dhı_ddns_cb_t
 *
ddns_cb
 = (dhı_ddns_cb_ˆ*)
ı
;

4967 
ş›Á_¡©e
 *
ş›Á
 = (ş›Á_¡©*)
ddns_cb
->
Ëa£
;

4968 
isc_»suÉ_t
 
¡©us
 = 
ISC_R_FAILURE
;

4970 ià((
ş›Á
 !ğ
NULL
) &&

4971 ((
ş›Á
->
aùive
 !ğ
NULL
) ||

4972 (
ş›Á
->
aùive_Ëa£
 !ğ
NULL
)))

4973 
¡©us
 = 
	`ş›Á_dns_upd©e
(
ş›Á
, 
ddns_cb
);

4984 ià(
¡©us
 !ğ
ISC_R_TIMEDOUT
) {

4985 
	`dhş›Á_ddns_cb_ä“
(
ddns_cb
, 
MDL
);

4987 
	}
}

5019 
	$ş›Á_dns_upd©e_aùiÚ
(
dhı_ddns_cb_t
 *
ddns_cb
,

5020 
isc_»suÉ_t
 
”esuÉ
)

5022 
isc_»suÉ_t
 
»suÉ
;

5023 
timev®
 
tv
;

5025 
”esuÉ
) {

5026 
ISC_R_SUCCESS
:

5031 
DNS_R_YXRRSET
:

5037 ià(
ddns_cb
->
¡©e
 =ğ
DDNS_STATE_ADD_FW_NXDOMAIN
) {

5038 
ddns_cb
->
¡©e
 = 
DDNS_STATE_ADD_FW_YXDHCID
;

5039 
ddns_cb
->
cur_func
 = 
ş›Á_dns_upd©e_aùiÚ
;

5041 
»suÉ
 = 
	`ddns_modify_fwd
(
ddns_cb
, 
MDL
);

5042 ià(
»suÉ
 =ğ
ISC_R_SUCCESS
) {

5048 
ISC_R_TIMEDOUT
:

5054 
	`d©a_¡ršg_fÜg‘
(&
ddns_cb
->
fwd_Çme
, 
MDL
);

5055 
	`d©a_¡ršg_fÜg‘
(&
ddns_cb
->
dhcid
, 
MDL
);

5056 ià(
ddns_cb
->
zÚe
 !ğ
NULL
) {

5057 
	`fÜg‘_zÚe
((
dns_zÚe
 **)&
ddns_cb
->
zÚe
);

5061 
ddns_cb
->
¡©e
 = 
DDNS_STATE_ADD_FW_NXDOMAIN
;

5062 
ddns_cb
->
cur_func
 = 
ş›Á_dns_upd©e_aùiÚ
;

5065 ià(
ddns_cb
->
timeout
 < 3600)

5066 
ddns_cb
->
timeout
 *= 10;

5067 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
ddns_cb
->
timeout
;

5068 
tv
.
tv_u£c
 = 
cur_tv
.tv_usec;

5069 
	`add_timeout
(&
tv
, 
ş›Á_dns_upd©e_timeout
,

5070 
ddns_cb
, 
NULL
, NULL);

5074 
	`dhş›Á_ddns_cb_ä“
(
ddns_cb
, 
MDL
);

5076 
	}
}

5080 
isc_»suÉ_t


5081 
	$ş›Á_dns_upd©e
(
ş›Á_¡©e
 *
ş›Á
, 
dhı_ddns_cb_t
 *
ddns_cb
)

5083 
d©a_¡ršg
 
ş›Á_id’tif›r
;

5084 
İtiÚ_ÿche
 *
oc
;

5085 
ignÜ•
;

5086 
»suÉ
;

5087 
ddns_v4_ty³
;

5088 
isc_»suÉ_t
 
rcode
;

5092 ià(!
ş›Á
 -> 
£Á_İtiÚs
)

5093  
ISC_R_SUCCESS
;

5096 ià((
ş›Á
->
aùive
 =ğ
NULL
è&& (ş›Á->
aùive_Ëa£
 == NULL))

5097  
ISC_R_SUCCESS
;

5100 ià((
oc
 = 
	`lookup_İtiÚ
 (&
fqdn_univ”£
, 
ş›Á
 -> 
£Á_İtiÚs
,

5101 
FQDN_NO_CLIENT_UPDATE
)) &&

5102 
	`ev®u©e_boŞ—n_İtiÚ_ÿche
 (&
ignÜ•
, (
·ck‘
 *)0,

5103 (
Ëa£
 *)0, 
ş›Á
,

5104 
ş›Á
 -> 
£Á_İtiÚs
,

5105 (
İtiÚ_¡©e
 *)0,

5106 &
glob®_scİe
, 
oc
, 
MDL
))

5107  
ISC_R_SUCCESS
;

5111 ià(!(
oc
 = 
	`lookup_İtiÚ
 (&
fqdn_univ”£
, 
ş›Á
 -> 
£Á_İtiÚs
,

5112 
FQDN_SERVER_UPDATE
)) ||

5113 
	`ev®u©e_boŞ—n_İtiÚ_ÿche
 (&
ignÜ•
, (
·ck‘
 *)0,

5114 (
Ëa£
 *)0, 
ş›Á
,

5115 
ş›Á
 -> 
£Á_İtiÚs
,

5116 (
İtiÚ_¡©e
 *)0,

5117 &
glob®_scİe
, 
oc
, 
MDL
))

5118  
ISC_R_SUCCESS
;

5121 ià(!(
oc
 = 
	`lookup_İtiÚ
 (&
fqdn_univ”£
, 
ş›Á
 -> 
£Á_İtiÚs
,

5122 
FQDN_FQDN
)) ||

5123 !
	`ev®u©e_İtiÚ_ÿche
 (&
ddns_cb
->
fwd_Çme
, (
·ck‘
 *)0,

5124 (
Ëa£
 *)0, 
ş›Á
,

5125 
ş›Á
 -> 
£Á_İtiÚs
,

5126 (
İtiÚ_¡©e
 *)0,

5127 &
glob®_scİe
, 
oc
, 
MDL
))

5128  
ISC_R_SUCCESS
;

5138 
»suÉ
 = 0;

5139 
	`POST
(
»suÉ
);

5140 
	`mem£t
(&
ş›Á_id’tif›r
, 0, (client_identifier));

5142 ià(
¡d_dhcid
 == 1) {

5144 
ddns_cb
->
dhcid_şass
 = 
dns_rd©©y³_dhcid
;

5145 
ddns_v4_ty³
 = 1;

5148 
ddns_cb
->
dhcid_şass
 = 
dns_rd©©y³_txt
;

5150 
ddns_v4_ty³
 = 
DHO_DHCP_CLIENT_IDENTIFIER
;

5152 ià(
ş›Á
->
aùive_Ëa£
 !ğ
NULL
) {

5156 ià(((
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
,

5157 
ş›Á
->
£Á_İtiÚs
,

5158 
D6O_CLIENTID
)è!ğ
NULL
) &&

5159 
	`ev®u©e_İtiÚ_ÿche
(&
ş›Á_id’tif›r
, 
NULL
,

5160 
NULL
, 
ş›Á
,

5161 
ş›Á
->
£Á_İtiÚs
, 
NULL
,

5162 &
glob®_scİe
, 
oc
, 
MDL
)) {

5163 
»suÉ
 = 
	`g‘_dhcid
(
ddns_cb
, 2,

5164 
ş›Á_id’tif›r
.
d©a
,

5165 
ş›Á_id’tif›r
.
Ën
);

5166 
	`d©a_¡ršg_fÜg‘
(&
ş›Á_id’tif›r
, 
MDL
);

5168 
	`log_çl
("ImpossibË cÚd™iÚ‡ˆ%s:%d.", 
MDL
);

5175 ià(((
oc
 = 
	`lookup_İtiÚ
(&
dhı_univ”£
,

5176 
ş›Á
->
£Á_İtiÚs
,

5177 
DHO_DHCP_CLIENT_IDENTIFIER
)è!ğ
NULL
) &&

5178 
	`ev®u©e_İtiÚ_ÿche
(&
ş›Á_id’tif›r
, 
NULL
,

5179 
NULL
, 
ş›Á
,

5180 
ş›Á
->
£Á_İtiÚs
, 
NULL
,

5181 &
glob®_scİe
, 
oc
, 
MDL
)) {

5182 ià((
¡d_dhcid
 =ğ1è&& (
duid_v4
 == 1) &&

5183 (
ş›Á_id’tif›r
.
d©a
[0] == 255)) {

5188 ià(
ş›Á_id’tif›r
.
Ën
 <= 5)

5189 
	`log_çl
("Impossible condition‡t %s:%d.",

5190 
MDL
);

5191 
»suÉ
 = 
	`g‘_dhcid
(
ddns_cb
, 2,

5192 
ş›Á_id’tif›r
.
d©a
 + 5,

5193 
ş›Á_id’tif›r
.
Ën
 - 5);

5195 
»suÉ
 = 
	`g‘_dhcid
(
ddns_cb
, 
ddns_v4_ty³
,

5196 
ş›Á_id’tif›r
.
d©a
,

5197 
ş›Á_id’tif›r
.
Ën
);

5199 
	`d©a_¡ršg_fÜg‘
(&
ş›Á_id’tif›r
, 
MDL
);

5201 
»suÉ
 = 
	`g‘_dhcid
(
ddns_cb
, 0,

5202 
ş›Á
->
š‹rçû
->
hw_add»ss
.
hbuf
,

5203 
ş›Á
->
š‹rçû
->
hw_add»ss
.
hËn
);

5206 ià(!
»suÉ
) {

5207  
ISC_R_SUCCESS
;

5213 ià(
ddns_cb
->
fwd_Çme
.
Ën
 && ddns_cb->
dhcid
.len) {

5214 
rcode
 = 
	`ddns_modify_fwd
(
ddns_cb
, 
MDL
);

5216 
rcode
 = 
ISC_R_FAILURE
;

5222 ià(
rcode
 =ğ
ISC_R_SUCCESS
) {

5223 
rcode
 = 
ISC_R_TIMEDOUT
;

5226  
rcode
;

5227 
	}
}

5235 
	$dhş›Á_scheduË_upd©es
(
ş›Á_¡©e
 *
ş›Á
,

5236 
Ÿddr
 *
addr
,

5237 
off£t
)

5239 
dhı_ddns_cb_t
 *
ddns_cb
;

5240 
timev®
 
tv
;

5242 ià(!
ş›Á
->
cÚfig
->
do_fÜw¬d_upd©e
)

5246 ià(
ş›Á
->
ddns_cb
 !ğ
NULL
) {

5247 
	`ddns_ÿnûl
(
ş›Á
->
ddns_cb
, 
MDL
);

5248 
ş›Á
->
ddns_cb
 = 
NULL
;

5251 
ddns_cb
 = 
	`ddns_cb_®loc
(
MDL
);

5253 ià(
ddns_cb
 !ğ
NULL
) {

5254 
ddns_cb
->
Ëa£
 = (*)
ş›Á
;

5255 
ddns_cb
->
add»ss
 = *
addr
;

5256 
ddns_cb
->
timeout
 = 1;

5264 
ddns_cb
->
‰l
 = 300;

5266 
ddns_cb
->
¡©e
 = 
DDNS_STATE_ADD_FW_NXDOMAIN
;

5267 
ddns_cb
->
cur_func
 = 
ş›Á_dns_upd©e_aùiÚ
;

5268 
ddns_cb
->
æags
 = 
DDNS_UPDATE_ADDR
 | 
DDNS_INCLUDE_RRSET
;

5270 
ş›Á
->
ddns_cb
 = ddns_cb;

5271 
tv
.
tv_£c
 = 
cur_tv
.tv_£ø+ 
off£t
;

5272 
tv
.
tv_u£c
 = 
cur_tv
.tv_usec;

5273 
	`add_timeout
(&
tv
, 
ş›Á_dns_upd©e_timeout
,

5274 
ddns_cb
, 
NULL
, NULL);

5276 
	`log_”rÜ
("Unableo‡llocate dns update state for %s",

5277 
	`pŸddr
(*
addr
));

5279 
	}
}

5283 
	$dhıv4_ş›Á_assignm’ts
()

5285 
£rv’t
 *
’t
;

5288 
	`´štf
("DHCPV4 client‡ss\n");

5295 
	`´štf
("%d.%d.%d.%d\n",

5296 ()(
gŸddr
.
s_addr
&0xFF),

5297 ()((
gŸddr
.
s_addr
&0xFF00)>>8),

5298 ()((
gŸddr
.
s_addr
&0xFF0000)>>16),

5299 ()((
gŸddr
.
s_addr
&0xFF000000)>>24));

5328 ià(
·th_dhş›Á_pid
 =ğ
NULL
)

5329 
·th_dhş›Á_pid
 = 
_PATH_DHCLIENT_PID
;

5330 ià(
·th_dhş›Á_db
 =ğ
NULL
)

5331 
·th_dhş›Á_db
 = 
_PATH_DHCLIENT_DB
;

5334 ià(!
loÿl_pÜt
) {

5337 ià(
mockup_»Ïy
 && 
gŸddr
.
s_addr
 !ğ
	`htÚl
(
INADDR_LOOPBACK
)) {

5338 
loÿl_pÜt
 = 
	`htÚs
(67);

5340 
’t
 = 
	`g‘£rvbyÇme
("dhcpc", "udp");

5341 ià(
’t
 =ğ
NULL
)

5342 
’t
 = 
	`g‘£rvbyÇme
("bootpc", "udp");

5343 ià(
’t
 =ğ
NULL
)

5344 
loÿl_pÜt
 = 
	`htÚs
(68);

5346 
loÿl_pÜt
 = 
’t
->
s_pÜt
;

5347 #iâdeà
__CYGWIN32__


5348 
	`’d£rv’t
 ();

5355 ià(
mockup_»Ïy
 && 
gŸddr
.
s_addr
 !ğ
	`htÚl
(
INADDR_LOOPBACK
)) {

5356 
»mÙe_pÜt
 = 
loÿl_pÜt
;

5358 
»mÙe_pÜt
 = 
	`htÚs
(
	`Áohs
(
loÿl_pÜt
) - 1);

5359 
	}
}

5371 
	$check_domaš_Çme
(cÚ¡ *
±r
, 
size_t
 
Ën
, 
dÙs
)

5373 cÚ¡ *
p
;

5376 ià((
Ën
 == 0) || (len > 256))

5381 
p
=
±r
; (*°!ğ0è&& (
Ën
-- > 0);…++) {

5382 ià((*
p
 == '-') || (*p == '_')) {

5384 ià(((
p
 - 
±r
è=ğ0è|| (
Ën
 == 0) || (p[1] == '.'))

5386 } ià(*
p
 == '.') {

5389 
size_t
 
d
 = 
p
 - 
±r
;

5390 ià((
d
 <= 0) || (d >= 64))

5392 
±r
 = 
p
 + 1;

5393 ià((
dÙs
 > 0è&& (
Ën
 > 0))

5394 
dÙs
--;

5395 } ià(
	`i§Êum
(()*
p
) == 0) {

5400 (
dÙs
 ? -1 : 0);

5401 
	}
}

5403 
	$check_domaš_Çme_li¡
(cÚ¡ *
±r
, 
size_t
 
Ën
, 
dÙs
)

5405 cÚ¡ *
p
;

5406 
»t
 = -1;

5408 ià((
±r
 =ğ
NULL
è|| (
Ën
 == 0))

5411 
p
=
±r
; (*°!ğ0è&& (
Ën
 > 0);…++,†en--) {

5412 ià(*
p
 != ' ')

5414 ià(
p
 > 
±r
) {

5415 ià(
	`check_domaš_Çme
(
±r
, 
p
 -…Œ, 
dÙs
) != 0)

5417 
»t
 = 0;

5419 
±r
 = 
p
 + 1;

5421 ià(
p
 > 
±r
)

5422 (
	`check_domaš_Çme
(
±r
, 
p
 -…Œ, 
dÙs
));

5424 (
»t
);

5425 
	}
}

5427 
	$check_İtiÚ_v®ues
(
univ”£
 *universe,

5428 
İt
,

5429 cÚ¡ *
±r
,

5430 
size_t
 
Ën
)

5432 ià(
±r
 =ğ
NULL
)

5436 ià((
univ”£
 =ğ
NULL
è|| (univ”£ =ğ&
dhı_univ”£
)) {

5437 
İt
) {

5438 
DHO_DOMAIN_NAME
:

5439 #ifdeà
ACCEPT_LIST_IN_DOMAIN_NAME


5440  
	`check_domaš_Çme_li¡
(
±r
, 
Ën
, 0);

5442  
	`check_domaš_Çme
(
±r
, 
Ën
, 0);

5444 
DHO_HOST_NAME
:

5445 
DHO_NIS_DOMAIN
:

5446 
DHO_NETBIOS_SCOPE
:

5447  
	`check_domaš_Çme
(
±r
, 
Ën
, 0);

5449 
DHO_DOMAIN_SEARCH
:

5450  
	`check_domaš_Çme_li¡
(
±r
, 
Ën
, 0);

5452 
DHO_ROOT_PATH
:

5453 ià(
Ën
 == 0)

5455 ; (*
±r
 !ğ0è&& (
Ën
-- > 0);…tr++) {

5456 if(!(
	`i§Êum
(()*
±r
) ||

5457 *
±r
 == '#' || *ptr == '%' ||

5458 *
±r
 == '+' || *ptr == '-' ||

5459 *
±r
 == '_' || *ptr == ':' ||

5460 *
±r
 == '.' || *ptr == ',' ||

5461 *
±r
 == '@' || *ptr == '~' ||

5462 *
±r
 == '\\' || *ptr == '/' ||

5463 *
±r
 == '[' || *ptr == ']' ||

5464 *
±r
 == '=' || *ptr == ' '))

5472 #ifdeà
DHCPv6


5473 ià(
univ”£
 =ğ&
dhıv6_univ”£
) {

5474 
İt
) {

5475 
D6O_SIP_SERVERS_DNS
:

5476 
D6O_DOMAIN_SEARCH
:

5477 
D6O_NIS_DOMAIN_NAME
:

5478 
D6O_NISP_DOMAIN_NAME
:

5479  
	`check_domaš_Çme_li¡
(
±r
, 
Ën
, 0);

5486 
	}
}

5489 
	$add_»jeù
(
·ck‘
 *packet) {

5490 
Ÿddrm©chli¡
 *
li¡
;

5492 
li¡
 = 
	`dm®loc
((
Ÿddrm©chli¡
), 
MDL
);

5493 ià(!
li¡
)

5494 
	`log_çl
 ("no memory for„eject†ist!");

5500 
li¡
->
m©ch
.
addr
 = 
·ck‘
->
ş›Á_addr
;

5502 
li¡
->
m©ch
.
mask
.
Ën
 =†i¡->m©ch.
addr
.len;

5503 
	`mem£t
(
li¡
->
m©ch
.
mask
.
Ÿbuf
, 0xff, (list->match.mask.iabuf));

5506 
li¡
->
Ãxt
 = 
·ck‘
->
š‹rçû
->
ş›Á
->
cÚfig
->
»jeù_li¡
;

5507 
·ck‘
->
š‹rçû
->
ş›Á
->
cÚfig
->
»jeù_li¡
 = 
li¡
;

5513 
	`log_šfo
("Server‡ddedo†ist of„ejected servers.");

5514 
	}
}

5519 
	$dhş›Á_ddns_cb_ä“
(
dhı_ddns_cb_t
 *
ddns_cb
, * 
fe
, 
lše
) {

5520 ià(
ddns_cb
) {

5521 
ş›Á_¡©e
 *
ş›Á
 = (ş›Á_¡©*)
ddns_cb
->
Ëa£
;

5522 ià(
ş›Á
 !ğ
NULL
) {

5523 
ş›Á
->
ddns_cb
 = 
NULL
;

5526 
	`ddns_cb_ä“
(
ddns_cb
, 
fe
, 
lše
);

5528 
	}
}

5530 #ià
defšed
(
DHCPv6
è&& defšed(
DHCP4o6
)

5547 
isc_»suÉ_t
 
	$dhıv4o6_hªdËr
(
om­i_objeù_t
 *
h
) {

5548 
buf
[65536];

5549 
¡¬t_msg
[5] = { 'S', 'T', 'A', 'R', 'T' };

5550 
¡İ_msg
[4] = { 'S', 'T', 'O', 'P' };

5551 
pŞl_msg
[4] = { 'P', 'O', 'L', 'L' };

5552 
d©a_¡ršg
 
¿w
;

5553 
cc
;

5555 ià(
h
->
ty³
 !ğ
dhı4o6_ty³
)

5556  
DHCP_R_INVALIDARG
;

5558 
cc
 = 
	`»cv
(
dhı4o6_fd
, 
buf
, (buf), 0);

5559 ià(
cc
 <= 0)

5560  
ISC_R_UNEXPECTED
;

5562 ià(
loÿl_çmy
 =ğ
AF_INET6
) {

5563 ià((
cc
 == 4) &&

5564 (
	`memcmp
(
buf
, 
pŞl_msg
, (poll_msg)) == 0)) {

5565 
	`log_šfo
("RCV: POLL");

5566 ià(
dhı4o6_¡©e
 < 0)

5567 
cc
 = 
	`£nd
(
dhı4o6_fd
, 
¡İ_msg
,

5568 (
¡İ_msg
), 0);

5570 
cc
 = 
	`£nd
(
dhı4o6_fd
, 
¡¬t_msg
,

5571 (
¡¬t_msg
), 0);

5572 ià(
cc
 < 0) {

5573 
	`log_”rÜ
("dhcpv4o6_handler: send(): %m");

5574  
ISC_R_IOERROR
;

5577 ià(
cc
 < 
DHCP_FIXED_NON_UDP
 + 8)

5578  
ISC_R_UNEXPECTED
;

5579 
	`mem£t
(&
¿w
, 0, (raw));

5580 ià(!
	`bufãr_®loÿ‹
(&
¿w
.
bufãr
, 
cc
, 
MDL
)) {

5581 
	`log_”rÜ
("dhcpv4o6_handler: "

5583  
ISC_R_NOMEMORY
;

5585 
¿w
.
d©a
 =„aw.
bufãr
->data;

5586 
¿w
.
Ën
 = 
cc
;

5587 
	`memıy
(
¿w
.
bufãr
->
d©a
, 
buf
, 
cc
);

5589 
	`fÜw_dhıv4_qu”y
(&
¿w
);

5591 
	`d©a_¡ršg_fÜg‘
(&
¿w
, 
MDL
);

5594 ià((
cc
 == 4) &&

5595 (
	`memcmp
(
buf
, 
¡İ_msg
, (stop_msg)) == 0)) {

5596 
	`log_šfo
("RCV: STOP");

5597 ià(
dhı4o6_¡©e
 > 0) {

5598 
dhı4o6_¡©e
 = 0;

5599 
	`dhı4o6_pŞl
(
NULL
);

5601 } ià((
cc
 == 5) &&

5602 (
	`memcmp
(
buf
, 
¡¬t_msg
, (start_msg)) == 0)) {

5603 
	`log_šfo
("RCV: START");

5604 ià(
dhı4o6_¡©e
 == 0)

5605 
	`ÿnûl_timeout
(
dhı4o6_pŞl
, 
NULL
);

5606 
dhı4o6_¡©e
 = 1;

5607 
	`dhı4o6_»sume
();

5609 ià(
cc
 < 
DHCP_FIXED_NON_UDP
 + 16)

5610  
ISC_R_UNEXPECTED
;

5611 
	`mem£t
(&
¿w
, 0, (raw));

5612 ià(!
	`bufãr_®loÿ‹
(&
¿w
.
bufãr
, 
cc
, 
MDL
)) {

5613 
	`log_”rÜ
("dhcpv4o6_handler: "

5615  
ISC_R_NOMEMORY
;

5617 
¿w
.
d©a
 =„aw.
bufãr
->data;

5618 
¿w
.
Ën
 = 
cc
;

5619 
	`memıy
(
¿w
.
bufãr
->
d©a
, 
buf
, 
cc
);

5621 
	`»cv_dhıv4_»¥Ú£
(&
¿w
);

5623 
	`d©a_¡ršg_fÜg‘
(&
¿w
, 
MDL
);

5627  
ISC_R_SUCCESS
;

5628 
	}
}

5638 
	$dhı4o6_pŞl
(*
dummy
) {

5639 
msg
[4] = { 'P', 'O', 'L', 'L' };

5640 
timev®
 
tv
;

5641 
cc
;

5643 
	`IGNORE_UNUSED
(
dummy
);

5645 ià(
dhı4o6_¡©e
 < 0)

5646 
dhı4o6_¡©e
 = 0;

5648 
	`log_šfo
("POLL");

5650 
cc
 = 
	`£nd
(
dhı4o6_fd
, 
msg
, (msg), 0);

5651 ià(
cc
 < 0)

5652 
	`log_”rÜ
("dhcp4o6_poll: send(): %m");

5654 
tv
.
tv_£c
 = 
cur_time
 + 60;

5655 
tv
.
tv_u£c
 = 
	`¿ndom
() % 1000000;

5657 
	`add_timeout
(&
tv
, 
dhı4o6_pŞl
, 
NULL
, 0, 0);

5658 
	}
}

5667 
	$dhı4o6_»sume
() {

5668 
š‹rçû_šfo
 *

;

5669 
ş›Á_¡©e
 *
ş›Á
;

5671 

 = 
š‹rçûs
; i°!ğ
NULL
; i°ğ->
Ãxt
) {

5672 
ş›Á
 = 

->ş›Á; cl›Á !ğ
NULL
;

5673 
ş›Á
 = cl›Á->
Ãxt
) {

5674 ià(
ş›Á
->
³ndšg
 =ğ
P_RELEASE
)

5675 
	`do_»Ëa£
(
ş›Á
);

5676 ià(
ş›Á
->
³ndšg
 =ğ
P_REBOOT
)

5677 
	`¡©e_»boÙ
(
ş›Á
);

5680 
	}
}

5690 
	$dhı4o6_¡¬t
() {

5691 
š‹rçû_šfo
 *

;

5692 
ş›Á_¡©e
 *
ş›Á
;

5693 
dhc6_Ëa£
 *
Ëa£
;

5694 
İtiÚ_ÿche
 *
oc
;

5695 
d©a_¡ršg
 
addrs
;

5696 
msg
[5] = { 'S', 'T', 'A', 'R', 'T' };

5697 
cc
;

5699 
	`mem£t
(&
addrs
, 0, (addrs));

5700 

 = 
š‹rçûs
; i°!ğ
NULL
; i°ğ->
Ãxt
) {

5701 
ş›Á
 = 

->ş›Á; cl›Á !ğ
NULL
;

5702 
ş›Á
 = cl›Á->
Ãxt
) {

5703 ià((
ş›Á
->
¡©e
 !ğ
S_BOUND
) &&

5704 (
ş›Á
->
¡©e
 !ğ
S_RENEWING
) &&

5705 (
ş›Á
->
¡©e
 !ğ
S_REBINDING
))

5707 
Ëa£
 = 
ş›Á
->
aùive_Ëa£
;

5708 ià((
Ëa£
 =ğ
NULL
è||†—£->
»Ëa£d
)

5710 
oc
 = 
	`lookup_İtiÚ
(&
dhıv6_univ”£
,

5711 
Ëa£
->
İtiÚs
,

5712 
D6O_DHCP4_O_DHCP6_SERVER
);

5713 ià((
oc
 =ğ
NULL
) ||

5714 !
	`ev®u©e_İtiÚ_ÿche
(&
addrs
, 
NULL
, NULL, NULL,

5715 
Ëa£
->
İtiÚs
, 
NULL
,

5716 &
glob®_scİe
, 
oc
, 
MDL
))

5718 ià((
addrs
.
Ën
 % 16) != 0) {

5719 
	`d©a_¡ršg_fÜg‘
(&
addrs
, 
MDL
);

5722 
	`d©a_¡ršg_fÜg‘
(&
addrs
, 
MDL
);

5723 
found
;

5726 
	`log_šfo
("dhcp4o6_start: failed");

5727 
	`dhı4o6_¡İ
();

5730 
found
:

5731 ià(
dhı4o6_¡©e
 == 1)

5733 
	`log_šfo
("dhcp4o6_start: goo UP");

5734 
dhı4o6_¡©e
 = 1;

5736 
cc
 = 
	`£nd
(
dhı4o6_fd
, 
msg
, (msg), 0);

5737 ià(
cc
 < 0)

5738 
	`log_šfo
("dhcp4o6_start: send(): %m");

5739 
	}
}

5748 
	$dhı4o6_¡İ
() {

5749 
msg
[4] = { 'S', 'T', 'O', 'P' };

5750 
cc
;

5752 ià(
dhı4o6_¡©e
 == -1)

5755 
	`log_šfo
("dhcp4o6_stop: goo DOWN");

5756 
dhı4o6_¡©e
 = -1;

5758 
cc
 = 
	`£nd
(
dhı4o6_fd
, 
msg
, (msg), 0);

5759 ià(
cc
 < 0)

5760 
	`log_”rÜ
("dhcp4o6_stop: send(): %m");

5761 
	}
}

	@tests/duid_unittest.c

24 
	~"cÚfig.h
"

25 
	~<©f-c.h
>

26 
	~<om­/om­_p.h
>

27 
	~"dhıd.h
"

48 
	gduidx_Ën
 = 0;

50 
	gduid0_Ën
 = 0;

52 
	gduid1_Ën
 = 14;

53 
	gduid1_d©a
[] = {0, 1, 0, 1, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10};

55 
	gduid2_Ën
 = 10;

56 
	gduid2_d©a
[] = {0, 3, 0, 1, 15, 16, 17, 18, 19, 20};

58 
	gduid3_Ën
 = 14;

59 
	gduid3_d©a
[] = {0, 1, 0, 1, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30};

61 
ATF_TC
(
»ad_duid_‹¡
);

63 
	$ATF_TC_HEAD
(
»ad_duid_‹¡
, 
tc
) {

64 
	`©f_tc_£t_md_v¬
(
tc
, "descr", "read secondary file†ooking for duid");

65 
	}
}

67 
	$ATF_TC_BODY
(
»ad_duid_‹¡
, 
tc
) {

69 cÚ¡ *
¤cdœ
;

70 
duid_âame
[1024];

73 ià(
	`©f_tc_has_cÚfig_v¬
(
tc
, "srcdir"))

74 
¤cdœ
 = 
	`©f_tc_g‘_cÚfig_v¬
(
tc
, "srcdir");

77 
·th_dhş›Á_duid
 = 
duid_âame
;

80 
	`mem£t
(&
deçuÉ_duid
, 0, (default_duid));

84 
	`¥rštf
(
duid_âame
, "%s/duidx_‹¡.txt", 
¤cdœ
);

85 
	`»ad_ş›Á_duid
();

86 ià(
deçuÉ_duid
.
Ën
 !ğ
duidx_Ën
) {

87 
	`©f_tc_ç
("failedo…roperly„ead duid1");

93 
	`¥rštf
(
duid_âame
, "%s/duid0_‹¡.txt", 
¤cdœ
);

94 
	`»ad_ş›Á_duid
();

95 ià(
deçuÉ_duid
.
Ën
 !ğ
duid0_Ën
) {

96 
	`©f_tc_ç
("failedo…roperly„ead duid0");

102 
	`¥rštf
(
duid_âame
, "%s/duid1_‹¡.txt", 
¤cdœ
);

103 
	`»ad_ş›Á_duid
();

104 ià((
deçuÉ_duid
.
Ën
 !ğ
duid1_Ën
) ||

105 (
	`memcmp
(
deçuÉ_duid
.
d©a
, 
duid1_d©a
, 
duid1_Ën
) != 0)) {

106 
	`©f_tc_ç
("failedo…roperly„ead duid1");

112 
	`¥rštf
(
duid_âame
, "%s/duid2_‹¡.txt", 
¤cdœ
);

113 
	`»ad_ş›Á_duid
();

114 ià((
deçuÉ_duid
.
Ën
 !ğ
duid2_Ën
) ||

115 (
	`memcmp
(
deçuÉ_duid
.
d©a
, 
duid2_d©a
, 
duid2_Ën
) != 0)) {

116 
	`©f_tc_ç
("failedo…roperly„ead duid2");

122 
	`¥rštf
(
duid_âame
, "%s/duid3_‹¡.txt", 
¤cdœ
);

123 
	`»ad_ş›Á_duid
();

124 ià((
deçuÉ_duid
.
Ën
 !ğ
duid3_Ën
) ||

125 (
	`memcmp
(
deçuÉ_duid
.
d©a
, 
duid3_d©a
, 
duid3_Ën
) != 0)) {

126 
	`©f_tc_ç
("failedo…roperly„ead duid3");

129 
	}
}

132 
	$ATF_TP_ADD_TCS
(

) {

133 
	`ATF_TP_ADD_TC
(

, 
»ad_duid_‹¡
);

135  (
	`©f_no_”rÜ
());

136 
	}
}

	@/usr/include/errno.h

22 #iâdef 
_ERRNO_H


26 #iâdef 
__Ãed_Em©h


27 
	#_ERRNO_H
 1

	)

28 
	~<ã©u»s.h
>

31 
	g__BEGIN_DECLS


35 
	~<b™s/”ºo.h
>

36 #undeà
__Ãed_Em©h


38 #ifdef 
_ERRNO_H


45 #iâdef 
”ºo


46 
”ºo
;

49 #ifdeà
__USE_GNU


54 *
´og¿m_švoÿtiÚ_Çme
, *
´og¿m_švoÿtiÚ_shÜt_Çme
;

58 
	g__END_DECLS


66 #ià
defšed
 
__USE_GNU
 || defšed 
__Ãed_”rÜ_t


67 #iâdeà
__”rÜ_t_defšed


68 
	t”rÜ_t
;

69 
	#__”rÜ_t_defšed
 1

	)

71 #undeà
__Ãed_”rÜ_t


	@/usr/include/limits.h

22 #iâdeà
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<ã©u»s.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

41 #iâdeà
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<b™s/wÜdsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifdeà
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #ià
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #ià
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifdeà
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


123 #šşude_Ãxˆ<
lim™s
.
h
>

129 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


130 #iâdeà
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #iâdeà
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #iâdeà
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<b™s/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<b™s/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<b™s/xİ’_lim.h
>

	@/usr/include/signal.h

22 #iâdef 
_SIGNAL_H


24 #ià!
defšed
 
__Ãed_sig_©omic_t
 && !defšed 
__Ãed_sig£t_t


25 
	#_SIGNAL_H


	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


32 
	~<b™s/sig£t.h
>

36 #ià
defšed
 
__Ãed_sig_©omic_t
 || defšed 
_SIGNAL_H


37 #iâdeà
__sig_©omic_t_defšed


38 
	#__sig_©omic_t_defšed


	)

39 
__BEGIN_NAMESPACE_STD


40 
__sig_©omic_t
 
	tsig_©omic_t
;

41 
	g__END_NAMESPACE_STD


43 #undeà
__Ãed_sig_©omic_t


46 #ià
defšed
 
__Ãed_sig£t_t
 || (defšed 
_SIGNAL_H
 && defšed 
__USE_POSIX
)

47 #iâdeà
__sig£t_t_defšed


48 
	#__sig£t_t_defšed


	)

49 
__sig£t_t
 
	tsig£t_t
;

51 #undeà
__Ãed_sig£t_t


54 #ifdeà
_SIGNAL_H


56 
	~<b™s/ty³s.h
>

57 
	~<b™s/signum.h
>

59 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


60 #iâdeà
__pid_t_defšed


61 
__pid_t
 
	tpid_t
;

62 
	#__pid_t_defšed


	)

64 #ifdeà
__USE_XOPEN


66 #iâdeà
__uid_t_defšed


67 
__uid_t
 
	tuid_t
;

68 
	#__uid_t_defšed


	)

72 #ifdeà
__USE_POSIX199309


74 
	#__Ãed_time¥ec


	)

75 
	~<time.h
>

78 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_XOPEN_EXTENDED


80 
	~<b™s/sigšfo.h
>

85 (*
	t__sighªdËr_t
) ();

90 
__sighªdËr_t
 
	$__sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

91 
__THROW
;

92 #ifdeà
__USE_GNU


93 
__sighªdËr_t
 
	$sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

94 
__THROW
;

100 
__BEGIN_NAMESPACE_STD


101 #ifdeà
__USE_BSD


102 
__sighªdËr_t
 
	$sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

103 
__THROW
;

106 #ifdeà
__REDIRECT_NTH


107 
__sighªdËr_t
 
	`__REDIRECT_NTH
 (
sigÇl
,

108 (
__sig
, 
__sighªdËr_t
 
__hªdËr
),

109 
__sysv_sigÇl
);

111 
	#sigÇl
 
__sysv_sigÇl


	)

114 
__END_NAMESPACE_STD


116 #ifdeà
__USE_XOPEN


119 
__sighªdËr_t
 
	$bsd_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

120 
__THROW
;

126 #ifdeà
__USE_POSIX


127 
	$kl
 (
__pid_t
 
__pid
, 
__sig
è
__THROW
;

130 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


134 
	$kÍg
 (
__pid_t
 
__pg½
, 
__sig
è
__THROW
;

137 
__BEGIN_NAMESPACE_STD


139 
	$¿i£
 (
__sig
è
__THROW
;

140 
__END_NAMESPACE_STD


142 #ifdeà
__USE_SVID


144 
__sighªdËr_t
 
	$ssigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

145 
__THROW
;

146 
	$gsigÇl
 (
__sig
è
__THROW
;

149 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN2K


151 
	`psigÇl
 (
__sig
, cÚ¡ *
__s
);

154 #ifdeà
__USE_XOPEN2K


156 
	`psigšfo
 (cÚ¡ 
sigšfo_t
 *
__pšfo
, cÚ¡ *
__s
);

167 
	`__sig·u£
 (
__sig_Ü_mask
, 
__is_sig
);

169 #ifdeà
__USE_XOPEN


170 #ifdeà
__GNUC__


171 
	$sig·u£
 (
__sig
è
	`__asm__
 ("__xpg_sigpause");

174 
	#sig·u£
(
sig
è
	`__sig·u£
 ((sig), 1)

	)

179 #ifdeà
__USE_BSD


186 
	#sigmask
(
sig
è
	`__sigmask
(sig)

	)

189 
	$sigblock
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

192 
	$sig£tmask
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

195 
	$sigg‘mask
 (è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

199 #ifdeà
__USE_MISC


200 
	#NSIG
 
_NSIG


	)

203 #ifdeà
__USE_GNU


204 
__sighªdËr_t
 
	tsighªdËr_t
;

208 #ifdeà
__USE_BSD


209 
__sighªdËr_t
 
	tsig_t
;

212 #ifdeà
__USE_POSIX


215 
	$sigem±y£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

218 
	$sigfl£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

221 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

224 
	$sigd–£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

227 
	$sigismemb”
 (cÚ¡ 
sig£t_t
 *
__£t
, 
__signo
)

228 
__THROW
 
	`__nÚnuÎ
 ((1));

230 #ifdeà
__USE_GNU


232 
	$sigi£m±y£t
 (cÚ¡ 
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

235 
	$sigªd£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

236 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

239 
	$sigÜ£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

240 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

245 
	~<b™s/sigaùiÚ.h
>

248 
	$sig´ocmask
 (
__how
, cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

249 
sig£t_t
 *
__»¡riù
 
__o£t
è
__THROW
;

256 
	$sigsu¥’d
 (cÚ¡ 
sig£t_t
 *
__£t
è
	`__nÚnuÎ
 ((1));

259 
	$sigaùiÚ
 (
__sig
, cÚ¡ 
sigaùiÚ
 *
__»¡riù
 
__aù
,

260 
sigaùiÚ
 *
__»¡riù
 
__ßù
è
__THROW
;

263 
	$sig³ndšg
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

270 
	$sigwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
, *__»¡riù 
__sig
)

271 
	`__nÚnuÎ
 ((1, 2));

273 #ifdeà
__USE_POSIX199309


278 
	$sigwa™šfo
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

279 
sigšfo_t
 *
__»¡riù
 
__šfo
è
	`__nÚnuÎ
 ((1));

286 
	$sigtimedwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

287 
sigšfo_t
 *
__»¡riù
 
__šfo
,

288 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
)

289 
	`__nÚnuÎ
 ((1));

293 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, cÚ¡ 
sigv®
 
__v®
)

294 
__THROW
;

299 #ifdeà
__USE_BSD


303 cÚ¡ *cÚ¡ 
_sys_sigli¡
[
_NSIG
];

304 cÚ¡ *cÚ¡ 
sys_sigli¡
[
_NSIG
];

307 
	ssigvec


309 
__sighªdËr_t
 
sv_hªdËr
;

310 
sv_mask
;

312 
sv_æags
;

313 
	#sv_Ú¡ack
 
sv_æags


	)

317 
	#SV_ONSTACK
 (1 << 0)

	)

318 
	#SV_INTERRUPT
 (1 << 1)

	)

319 
	#SV_RESETHAND
 (1 << 2)

	)

327 
	$sigvec
 (
__sig
, cÚ¡ 
sigvec
 *
__vec
,

328 
sigvec
 *
__ovec
è
__THROW
;

332 
	~<b™s/sigcÚ‹xt.h
>

335 
	$sig»tuº
 (
sigcÚ‹xt
 *
__sı
è
__THROW
;

340 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


341 
	#__Ãed_size_t


	)

342 
	~<¡ddef.h
>

347 
	$sigš‹¼u±
 (
__sig
, 
__š‹¼u±
è
__THROW
;

349 
	~<b™s/sig¡ack.h
>

350 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


352 
	~<sys/ucÚ‹xt.h
>

358 
	$sig¡ack
 (
sig¡ack
 *
__ss
, sig¡ack *
__oss
)

359 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

363 
	$sig®t¡ack
 (cÚ¡ 
sig®t¡ack
 *
__»¡riù
 
__ss
,

364 
sig®t¡ack
 *
__»¡riù
 
__oss
è
__THROW
;

368 #ifdeà
__USE_XOPEN_EXTENDED


372 
	$sighŞd
 (
__sig
è
__THROW
;

375 
	$sig»l£
 (
__sig
è
__THROW
;

378 
	$sigignÜe
 (
__sig
è
__THROW
;

381 
__sighªdËr_t
 
	$sig£t
 (
__sig
, 
__sighªdËr_t
 
__di¥
è
__THROW
;

384 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


387 
	~<b™s/±h»adty³s.h
>

388 
	~<b™s/sigth»ad.h
>

395 
	$__libc_cu¼’t_sig¹mš
 (è
__THROW
;

397 
	$__libc_cu¼’t_sig¹max
 (è
__THROW
;

401 
__END_DECLS


	@/usr/include/syslog.h

1 
	~<sys/sy¦og.h
>

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

101 #undeà
__USE_ISOC11


102 #undeà
__USE_ISOC99


103 #undeà
__USE_ISOC95


104 #undeà
__USE_ISOCXX11


105 #undeà
__USE_POSIX


106 #undeà
__USE_POSIX2


107 #undeà
__USE_POSIX199309


108 #undeà
__USE_POSIX199506


109 #undeà
__USE_XOPEN


110 #undeà
__USE_XOPEN_EXTENDED


111 #undeà
__USE_UNIX98


112 #undeà
__USE_XOPEN2K


113 #undeà
__USE_XOPEN2KXSI


114 #undeà
__USE_XOPEN2K8


115 #undeà
__USE_XOPEN2K8XSI


116 #undeà
__USE_LARGEFILE


117 #undeà
__USE_LARGEFILE64


118 #undeà
__USE_FILE_OFFSET64


119 #undeà
__USE_BSD


120 #undeà
__USE_SVID


121 #undeà
__USE_MISC


122 #undeà
__USE_ATFILE


123 #undeà
__USE_GNU


124 #undeà
__USE_REENTRANT


125 #undeà
__USE_FORTIFY_LEVEL


126 #undeà
__KERNEL_STRICT_NAMES


130 #iâdeà
_LOOSE_KERNEL_NAMES


131 
	#__KERNEL_STRICT_NAMES


	)

141 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


142 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

143 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

145 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

150 #ifdeà
_GNU_SOURCE


151 #undeà
_ISOC95_SOURCE


152 
	#_ISOC95_SOURCE
 1

	)

153 #undeà
_ISOC99_SOURCE


154 
	#_ISOC99_SOURCE
 1

	)

155 #undeà
_ISOC11_SOURCE


156 
	#_ISOC11_SOURCE
 1

	)

157 #undeà
_POSIX_SOURCE


158 
	#_POSIX_SOURCE
 1

	)

159 #undeà
_POSIX_C_SOURCE


160 
	#_POSIX_C_SOURCE
 200809L

	)

161 #undeà
_XOPEN_SOURCE


162 
	#_XOPEN_SOURCE
 700

	)

163 #undeà
_XOPEN_SOURCE_EXTENDED


164 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

165 #undeà
_LARGEFILE64_SOURCE


166 
	#_LARGEFILE64_SOURCE
 1

	)

167 #undeà
_DEFAULT_SOURCE


168 
	#_DEFAULT_SOURCE
 1

	)

169 #undeà
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #undeà
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(
defšed
 
_DEFAULT_SOURCE
 \

180 || (!
defšed
 
	g__STRICT_ANSI__
 \

181 && !
defšed
 
	g_ISOC99_SOURCE
 \

182 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

183 && !
defšed
 
	g_XOPEN_SOURCE
 \

184 && !
defšed
 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
))

185 #undeà
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

187 #undeà
_BSD_SOURCE


188 
	#_BSD_SOURCE
 1

	)

189 #undeà
_SVID_SOURCE


190 
	#_SVID_SOURCE
 1

	)

194 #ià(
defšed
 
_ISOC11_SOURCE
 \

195 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

196 
	#__USE_ISOC11
 1

	)

200 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

201 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

202 
	#__USE_ISOC99
 1

	)

206 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

207 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

208 
	#__USE_ISOC95
 1

	)

215 #ià((
defšed
 
__ılu¥lus
 && __cplusplus >= 201103L) \

216 || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
)

217 
	#__USE_ISOCXX11
 1

	)

223 #ifdeà
_DEFAULT_SOURCE


224 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


225 
	#__USE_POSIX_IMPLICITLY
 1

	)

227 #undeà
_POSIX_SOURCE


228 
	#_POSIX_SOURCE
 1

	)

229 #undeà
_POSIX_C_SOURCE


230 
	#_POSIX_C_SOURCE
 200809L

	)

232 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

233 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

234 
	#_POSIX_SOURCE
 1

	)

235 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

236 
	#_POSIX_C_SOURCE
 2

	)

237 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

238 
	#_POSIX_C_SOURCE
 199506L

	)

239 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

240 
	#_POSIX_C_SOURCE
 200112L

	)

242 
	#_POSIX_C_SOURCE
 200809L

	)

244 
	#__USE_POSIX_IMPLICITLY
 1

	)

247 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


248 
	#__USE_POSIX
 1

	)

251 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


252 
	#__USE_POSIX2
 1

	)

255 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

256 
	#__USE_POSIX199309
 1

	)

259 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

260 
	#__USE_POSIX199506
 1

	)

263 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

264 
	#__USE_XOPEN2K
 1

	)

265 #undeà
__USE_ISOC95


266 
	#__USE_ISOC95
 1

	)

267 #undeà
__USE_ISOC99


268 
	#__USE_ISOC99
 1

	)

271 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

272 
	#__USE_XOPEN2K8
 1

	)

273 #undeà
_ATFILE_SOURCE


274 
	#_ATFILE_SOURCE
 1

	)

277 #ifdef 
_XOPEN_SOURCE


278 
	#__USE_XOPEN
 1

	)

279 #ià(
_XOPEN_SOURCE
 - 0) >= 500

280 
	#__USE_XOPEN_EXTENDED
 1

	)

281 
	#__USE_UNIX98
 1

	)

282 #undeà
_LARGEFILE_SOURCE


283 
	#_LARGEFILE_SOURCE
 1

	)

284 #ià(
_XOPEN_SOURCE
 - 0) >= 600

285 #ià(
_XOPEN_SOURCE
 - 0) >= 700

286 
	#__USE_XOPEN2K8
 1

	)

287 
	#__USE_XOPEN2K8XSI
 1

	)

289 
	#__USE_XOPEN2K
 1

	)

290 
	#__USE_XOPEN2KXSI
 1

	)

291 #undeà
__USE_ISOC95


292 
	#__USE_ISOC95
 1

	)

293 #undeà
__USE_ISOC99


294 
	#__USE_ISOC99
 1

	)

297 #ifdeà
_XOPEN_SOURCE_EXTENDED


298 
	#__USE_XOPEN_EXTENDED
 1

	)

303 #ifdeà
_LARGEFILE_SOURCE


304 
	#__USE_LARGEFILE
 1

	)

307 #ifdeà
_LARGEFILE64_SOURCE


308 
	#__USE_LARGEFILE64
 1

	)

311 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

312 
	#__USE_FILE_OFFSET64
 1

	)

315 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


316 
	#__USE_MISC
 1

	)

319 #ifdef 
_BSD_SOURCE


320 
	#__USE_BSD
 1

	)

323 #ifdef 
_SVID_SOURCE


324 
	#__USE_SVID
 1

	)

327 #ifdef 
_ATFILE_SOURCE


328 
	#__USE_ATFILE
 1

	)

331 #ifdef 
_GNU_SOURCE


332 
	#__USE_GNU
 1

	)

335 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


336 
	#__USE_REENTRANT
 1

	)

339 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

340 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

341 #ià
_FORTIFY_SOURCE
 > 1

342 
	#__USE_FORTIFY_LEVEL
 2

	)

344 
	#__USE_FORTIFY_LEVEL
 1

	)

347 
	#__USE_FORTIFY_LEVEL
 0

	)

352 
	~<¡dc-´edef.h
>

360 #undeà
__GNU_LIBRARY__


361 
	#__GNU_LIBRARY__
 6

	)

365 
	#__GLIBC__
 2

	)

366 
	#__GLIBC_MINOR__
 19

	)

368 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

369 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

372 #iâdeà
__ASSEMBLER__


373 #iâdeà
_SYS_CDEFS_H


374 
	~<sys/cdefs.h
>

379 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


380 
	#__USE_LARGEFILE
 1

	)

381 
	#__USE_LARGEFILE64
 1

	)

387 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

388 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

389 && 
defšed
 
	g__ex‹º_šlše


390 
	#__USE_EXTERN_INLINES
 1

	)

398 
	~<gnu/¡ubs.h
>

	@/usr/include/time.h

22 #iâdef 
_TIME_H


24 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

25 ! 
defšed
 
	g__Ãed_time¥ec
)

26 
	#_TIME_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__Ãed_size_t


	)

36 
	#__Ãed_NULL


	)

37 
	~<¡ddef.h
>

41 
	~<b™s/time.h
>

44 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


45 #iâdeà
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

53 
	#__şock_t_defšed
 1

	)

55 
	~<b™s/ty³s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__şock_t
 
	tşock_t
;

60 
	g__END_NAMESPACE_STD


61 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


62 
	$__USING_NAMESPACE_STD
(
şock_t
)

66 #undeà
__Ãed_şock_t


68 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

69 
	#__time_t_defšed
 1

	)

71 
	~<b™s/ty³s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #undeà
__Ãed_time_t


84 #ià!
defšed
 
__şockid_t_defšed
 && \

85 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

86 
	#__şockid_t_defšed
 1

	)

88 
	~<b™s/ty³s.h
>

91 
__şockid_t
 
	tşockid_t
;

94 #undeà
__şockid_time_t


96 #ià!
defšed
 
__tim”_t_defšed
 && \

97 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

98 
	#__tim”_t_defšed
 1

	)

100 
	~<b™s/ty³s.h
>

103 
__tim”_t
 
	ttim”_t
;

106 #undeà
__Ãed_tim”_t


109 #ià(!
defšed
 
__time¥ec_defšed
 \

110 && ((
defšed
 
_TIME_H
 \

111 && (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
 \

112 || 
defšed
 
__USE_ISOC11
)) \

113 || 
defšed
 
__Ãed_time¥ec
))

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
__sysÿÎ_¦Úg_t
 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 cÚ¡ *
tm_zÚe
;

149 
__tm_gmtoff
;

150 cÚ¡ *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 #ifdeà
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
şock_t
 
	$şock
 (è
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

195 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

196 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

199 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

205 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

206 cÚ¡ *
__»¡riù
 
__fÜm©
,

207 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifdeà
__USE_XOPEN


213 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

214 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

215 
__THROW
;

218 #ifdeà
__USE_XOPEN2K8


221 
	~<xloÿË.h
>

223 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

224 cÚ¡ *
__»¡riù
 
__fÜm©
,

225 cÚ¡ 
tm
 *
__»¡riù
 
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

229 #ifdeà
__USE_GNU


230 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

231 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

232 
__loÿË_t
 
__loc
è
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

243 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

244 
__END_NAMESPACE_STD


246 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


249 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

250 
tm
 *
__»¡riù
 
__
è
__THROW
;

254 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

255 
tm
 *
__»¡riù
 
__
è
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

264 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

265 
__END_NAMESPACE_STD


267 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


272 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

273 *
__»¡riù
 
__buf
è
__THROW
;

276 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

277 *
__»¡riù
 
__buf
è
__THROW
;

282 *
__tzÇme
[2];

283 
__daylight
;

284 
__timezÚe
;

287 #ifdef 
__USE_POSIX


289 *
tzÇme
[2];

293 
	$tz£t
 (è
__THROW
;

296 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


297 
daylight
;

298 
timezÚe
;

301 #ifdeà
__USE_SVID


304 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

310 
	#__i¦—p
(
y—r
) \

311 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

314 #ifdeà
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

322 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

325 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

329 #ifdeà
__USE_POSIX199309


334 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

335 
time¥ec
 *
__»maššg
);

339 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

342 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

345 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, cÚ¡ 
time¥ec
 *
__
)

346 
__THROW
;

348 #ifdeà
__USE_XOPEN2K


353 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

354 cÚ¡ 
time¥ec
 *
__»q
,

355 
time¥ec
 *
__»m
);

358 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

363 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

364 
sigev’t
 *
__»¡riù
 
__evp
,

365 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

368 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

371 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

372 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

373 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

376 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

377 
__THROW
;

380 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

384 #ifdeà
__USE_ISOC11


386 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__nÚnuÎ
 ((1));

391 #ifdeà
__USE_XOPEN_EXTENDED


403 
g‘d©e_”r
;

412 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

415 #ifdeà
__USE_GNU


426 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

427 
tm
 *
__»¡riù
 
__»sbuå
);

430 
__END_DECLS


	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

54 
	#__STDC_ISO_10646__
 201103L

	)

57 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/xlocale.h

20 #iâdeà
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loÿË_¡ruù


30 
__loÿË_d©a
 *
	m__loÿËs
[13];

33 cÚ¡ *
	m__ùy³_b
;

34 cÚ¡ *
	m__ùy³_tŞow”
;

35 cÚ¡ *
	m__ùy³_touµ”
;

38 cÚ¡ *
	m__Çmes
[13];

39 } *
	t__loÿË_t
;

42 
__loÿË_t
 
	tloÿË_t
;

	@
1
.
1
/usr/include
13
247
client_tables.c
clparse.c
dhc6.c
dhclient.c
tests/duid_unittest.c
/usr/include/errno.h
/usr/include/limits.h
/usr/include/signal.h
/usr/include/syslog.h
/usr/include/features.h
/usr/include/time.h
/usr/include/stdc-predef.h
/usr/include/xlocale.h
